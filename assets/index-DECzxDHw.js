const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-E9JDBaEh.js","assets/chart-js-DOUloTE5.js","assets/vendor-BiSKwQJc.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,a)=>((t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a)(t,"symbol"!=typeof r?r+"":r,a);import{g as r,a,r as n,R as i,j as s,C as o,b as l,L as c,B as d,c as u,P as g,p as h,d as m,e as p,i as x,f,h as y,k as b,l as v}from"./chart-js-DOUloTE5.js";import{r as w}from"./vendor-BiSKwQJc.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var S,k={};const C=r(function(){if(S)return k;S=1;var e=w();return k.createRoot=e.createRoot,k.hydrateRoot=e.hydrateRoot,k}()),j={},D=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),n=r?.nonce||r?.getAttribute("nonce");a=e(t.map(e=>{if((e=function(e){return"/dice/"+e}(e))in j)return;j[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,n&&a.setAttribute("nonce",n),document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})},N=e=>"string"==typeof e,A=()=>{let e,t;const r=new Promise((r,a)=>{e=r,t=a});return r.resolve=e,r.reject=t,r},T=e=>null==e?"":""+e,M=/###/g,E=e=>e&&e.indexOf("###")>-1?e.replace(M,"."):e,R=e=>!e||N(e),I=(e,t,r)=>{const a=N(t)?t.split("."):t;let n=0;for(;n<a.length-1;){if(R(e))return{};const t=E(a[n]);!e[t]&&r&&(e[t]=new r),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++n}return R(e)?{}:{obj:e,k:E(a[n])}},L=(e,t,r)=>{const{obj:a,k:n}=I(e,t,Object);if(void 0!==a||1===t.length)return void(a[n]=r);let i=t[t.length-1],s=t.slice(0,t.length-1),o=I(e,s,Object);for(;void 0===o.obj&&s.length;)i=`${s[s.length-1]}.${i}`,s=s.slice(0,s.length-1),o=I(e,s,Object),o?.obj&&void 0!==o.obj[`${o.k}.${i}`]&&(o.obj=void 0);o.obj[`${o.k}.${i}`]=r},O=(e,t)=>{const{obj:r,k:a}=I(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,a))return r[a]},F=(e,t,r)=>{for(const a in t)"__proto__"!==a&&"constructor"!==a&&(a in e?N(e[a])||e[a]instanceof String||N(t[a])||t[a]instanceof String?r&&(e[a]=t[a]):F(e[a],t[a],r):e[a]=t[a]);return e},P=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var $={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const W=e=>N(e)?e.replace(/[&<>"'\/]/g,e=>$[e]):e;const V=[" ",",","?","!",";"],B=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}(20),H=(e,t,r=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const a=t.split(r);let n=e;for(let i=0;i<a.length;){if(!n||"object"!=typeof n)return;let e,t="";for(let s=i;s<a.length;++s)if(s!==i&&(t+=r),t+=a[s],e=n[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&s<a.length-1)continue;i+=s-i+1;break}n=e}return n},z=e=>e?.replace("_","-"),U={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){}};class q{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||U,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,a){return a&&!this.debug?null:(N(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new q(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new q(this.logger,e)}}var Y=new q;class X{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const r=this.observers[e].get(t)||0;this.observers[e].set(t,r+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){if(this.observers[e]){Array.from(this.observers[e].entries()).forEach(([e,r])=>{for(let a=0;a<r;a++)e(...t)})}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach(([r,a])=>{for(let n=0;n<a;n++)r.apply(r,[e,...t])})}}}class _ extends X{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r,a={}){const n=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,i=void 0!==a.ignoreJSONStructure?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;e.indexOf(".")>-1?s=e.split("."):(s=[e,t],r&&(Array.isArray(r)?s.push(...r):N(r)&&n?s.push(...r.split(n)):s.push(r)));const o=O(this.data,s);return!o&&!t&&!r&&e.indexOf(".")>-1&&(e=s[0],t=s[1],r=s.slice(2).join(".")),!o&&i&&N(r)?H(this.data?.[e]?.[t],r,n):o}addResource(e,t,r,a,n={silent:!1}){const i=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator;let s=[e,t];r&&(s=s.concat(i?r.split(i):r)),e.indexOf(".")>-1&&(s=e.split("."),a=t,t=s[1]),this.addNamespaces(t),L(this.data,s,a),n.silent||this.emit("added",e,t,r,a)}addResources(e,t,r,a={silent:!1}){for(const n in r)(N(r[n])||Array.isArray(r[n]))&&this.addResource(e,t,n,r[n],{silent:!0});a.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,a,n,i={silent:!1,skipCopy:!1}){let s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),a=r,r=t,t=s[1]),this.addNamespaces(t);let o=O(this.data,s)||{};i.skipCopy||(r=JSON.parse(JSON.stringify(r))),a?F(o,r,n):o={...o,...r},L(this.data,s,o),i.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var J={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,a,n){return e.forEach(e=>{t=this.processors[e]?.process(t,r,a,n)??t}),t}};const K=Symbol("i18next/PATH_KEY");function Q(e,t){const{[K]:r}=e(function(){const e=[],t=Object.create(null);let r;return t.get=(a,n)=>(r?.revoke?.(),n===K?e:(e.push(n),r=Proxy.revocable(a,t),r.proxy)),Proxy.revocable(Object.create(null),t).proxy}());return r.join(t?.keySeparator??".")}const G={},Z=e=>!N(e)&&"boolean"!=typeof e&&"number"!=typeof e;class ee extends X{constructor(e,t={}){var r,a;super(),r=e,a=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{r[e]&&(a[e]=r[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=Y.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const r={...t};if(null==e)return!1;const a=this.resolve(e,r);if(void 0===a?.res)return!1;const n=Z(a.res);return!1!==r.returnObjects||!n}extractFromKey(e,t){let r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");const a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let n=t.ns||this.options.defaultNS||[];const i=r&&e.indexOf(r)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,r)=>{t=t||"",r=r||"";const a=V.filter(e=>t.indexOf(e)<0&&r.indexOf(e)<0);if(0===a.length)return!0;const n=B.getRegExp(`(${a.map(e=>"?"===e?"\\?":e).join("|")})`);let i=!n.test(e);if(!i){const t=e.indexOf(r);t>0&&!n.test(e.substring(0,t))&&(i=!0)}return i})(e,r,a));if(i&&!s){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:N(n)?[n]:n};const i=e.split(r);(r!==a||r===a&&this.options.ns.indexOf(i[0])>-1)&&(n=i.shift()),e=i.join(a)}return{key:e,namespaces:N(n)?[n]:n}}translate(e,t,r){let a="object"==typeof t?{...t}:t;if("object"!=typeof a&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof a&&(a={...a}),a||(a={}),null==e)return"";"function"==typeof e&&(e=Q(e,{...this.options,...a})),Array.isArray(e)||(e=[String(e)]);const n=void 0!==a.returnDetails?a.returnDetails:this.options.returnDetails,i=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,{key:s,namespaces:o}=this.extractFromKey(e[e.length-1],a),l=o[o.length-1];let c=void 0!==a.nsSeparator?a.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");const d=a.lng||this.language,u=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===d?.toLowerCase())return u?n?{res:`${l}${c}${s}`,usedKey:s,exactUsedKey:s,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(a)}:`${l}${c}${s}`:n?{res:s,usedKey:s,exactUsedKey:s,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(a)}:s;const g=this.resolve(e,a);let h=g?.res;const m=g?.usedKey||s,p=g?.exactUsedKey||s,x=void 0!==a.joinArrays?a.joinArrays:this.options.joinArrays,f=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==a.count&&!N(a.count),b=ee.hasDefaultValue(a),v=y?this.pluralResolver.getSuffix(d,a.count,a):"",w=a.ordinal&&y?this.pluralResolver.getSuffix(d,a.count,{ordinal:!1}):"",S=y&&!a.ordinal&&0===a.count,k=S&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${v}`]||a[`defaultValue${w}`]||a.defaultValue;let C=h;f&&!h&&b&&(C=k);const j=Z(C),D=Object.prototype.toString.apply(C);if(!(f&&C&&j&&["[object Number]","[object Function]","[object RegExp]"].indexOf(D)<0)||N(x)&&Array.isArray(C))if(f&&N(x)&&Array.isArray(h))h=h.join(x),h&&(h=this.extendTranslation(h,e,a,r));else{let t=!1,n=!1;!this.isValidLookup(h)&&b&&(t=!0,h=k),this.isValidLookup(h)||(n=!0,h=s);const o=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&n?void 0:h,u=b&&k!==h&&this.options.updateMissing;if(n||t||u){if(this.logger.log(u?"updateKey":"missingKey",d,l,s,u?k:h),i){const e=this.resolve(s,{...a,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let a=0;a<t.length;a++)e.push(t[a]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(a.lng||this.language):e.push(a.lng||this.language);const r=(e,t,r)=>{const n=b&&r!==h?r:o;this.options.missingKeyHandler?this.options.missingKeyHandler(e,l,t,n,u,a):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,l,t,n,u,a),this.emit("missingKey",e,l,t,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,a);S&&a[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{r([e],s+t,a[`defaultValue${t}`]||k)})}):r(e,s,k))}h=this.extendTranslation(h,e,a,g,r),n&&h===s&&this.options.appendNamespaceToMissingKey&&(h=`${l}${c}${s}`),(n||t)&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${s}`:s,t?h:void 0,a))}else{if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,C,{...a,ns:o}):`key '${s} (${this.language})' returned an object instead of string.`;return n?(g.res=e,g.usedParams=this.getUsedParamsDetails(a),g):e}if(i){const e=Array.isArray(C),t=e?[]:{},r=e?p:m;for(const n in C)if(Object.prototype.hasOwnProperty.call(C,n)){const e=`${r}${i}${n}`;t[n]=b&&!h?this.translate(e,{...a,defaultValue:Z(k)?k[n]:void 0,joinArrays:!1,ns:o}):this.translate(e,{...a,joinArrays:!1,ns:o}),t[n]===e&&(t[n]=C[n])}h=t}}return n?(g.res=h,g.usedParams=this.getUsedParamsDetails(a),g):h}extendTranslation(e,t,r,a,n){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const i=N(e)&&(void 0!==r?.interpolation?.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let s;if(i){const t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let o=r.replace&&!N(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),e=this.interpolator.interpolate(e,o,r.lng||this.language||a.usedLng,r),i){const t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(r.nest=!1)}!r.lng&&a&&a.res&&(r.lng=this.language||a.usedLng),!1!==r.nest&&(e=this.interpolator.nest(e,(...e)=>n?.[0]!==e[0]||r.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),r)),r.interpolation&&this.interpolator.reset()}const i=r.postProcess||this.options.postProcess,s=N(i)?[i]:i;return null!=e&&s?.length&&!1!==r.applyPostProcessor&&(e=J.handle(s,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,t={}){let r,a,n,i,s;return N(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(r))return;const o=this.extractFromKey(e,t),l=o.key;a=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==t.count&&!N(t.count),u=d&&!t.ordinal&&0===t.count,g=void 0!==t.context&&(N(t.context)||"number"==typeof t.context)&&""!==t.context,h=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(e=>{this.isValidLookup(r)||(s=e,G[`${h[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(s)||(G[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${a}" for languages "${h.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(a=>{if(this.isValidLookup(r))return;i=a;const s=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(s,l,a,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(a,t.count,t));const r=`${this.options.pluralSeparator}zero`,n=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(t.ordinal&&0===e.indexOf(n)&&s.push(l+e.replace(n,this.options.pluralSeparator)),s.push(l+e),u&&s.push(l+r)),g){const a=`${l}${this.options.contextSeparator||"_"}${t.context}`;s.push(a),d&&(t.ordinal&&0===e.indexOf(n)&&s.push(a+e.replace(n,this.options.pluralSeparator)),s.push(a+e),u&&s.push(a+r))}}let o;for(;o=s.pop();)this.isValidLookup(r)||(n=o,r=this.getResource(a,e,o,t))}))})}),{res:r,usedKey:a,exactUsedKey:n,usedLng:i,usedNS:s}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,r,a={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,r,a):this.resourceStore.getResource(e,t,r,a)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!N(e.replace);let a=r?e.replace:e;if(r&&void 0!==e.count&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!r){a={...a};for(const e of t)delete a[e]}return a}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,12)&&void 0!==e[r])return!0;return!1}}class te{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Y.create("languageUtils")}getScriptPartFromCode(e){if(!(e=z(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=z(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(N(e)&&e.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(e)[0]}catch(t){}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const r=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(r)||(t=r)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const r=this.getScriptPartFromCode(e);if(this.isSupportedCode(r))return t=r;const a=this.getLanguagePartFromCode(e);if(this.isSupportedCode(a))return t=a;t=this.options.supportedLngs.find(e=>e===a?e:e.indexOf("-")<0&&a.indexOf("-")<0?void 0:e.indexOf("-")>0&&a.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===a||0===e.indexOf(a)&&a.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),N(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),a=[],n=e=>{e&&(this.isSupportedCode(e)?a.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return N(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&n(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&n(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&n(this.getLanguagePartFromCode(e))):N(e)&&n(this.formatLanguageCode(e)),r.forEach(e=>{a.indexOf(e)<0&&n(this.formatLanguageCode(e))}),a}}const re={zero:0,one:1,two:2,few:3,many:4,other:5},ae={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ne{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=Y.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const r=z("dev"===e?"en":e),a=t.ordinal?"ordinal":"cardinal",n=JSON.stringify({cleanedCode:r,type:a});if(n in this.pluralRulesCache)return this.pluralRulesCache[n];let i;try{i=new Intl.PluralRules(r,{type:a})}catch(s){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),ae;if(!e.match(/-|_/))return ae;const r=this.languageUtils.getLanguagePartFromCode(e);i=this.getRule(r,t)}return this.pluralRulesCache[n]=i,i}needsPlural(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,r={}){return this.getSuffixes(e,r).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?r.resolvedOptions().pluralCategories.sort((e,t)=>re[e]-re[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,r={}){const a=this.getRule(e,r);return a?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,r))}}const ie=(e,t,r,a=".",n=!0)=>{let i=((e,t,r)=>{const a=O(e,r);return void 0!==a?a:O(t,r)})(e,t,r);return!i&&n&&N(r)&&(i=H(e,r,a),void 0===i&&(i=H(t,r,a))),i},se=e=>e.replace(/\$/g,"$$$$");class oe{constructor(e={}){this.logger=Y.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:a,prefix:n,prefixEscaped:i,suffix:s,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:u,nestingPrefixEscaped:g,nestingSuffix:h,nestingSuffixEscaped:m,nestingOptionsSeparator:p,maxReplaces:x,alwaysFormat:f}=e.interpolation;this.escape=void 0!==t?t:W,this.escapeValue=void 0===r||r,this.useRawValueToEscape=void 0!==a&&a,this.prefix=n?P(n):i||"{{",this.suffix=s?P(s):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=u?P(u):g||P("$t("),this.nestingSuffix=h?P(h):m||P(")"),this.nestingOptionsSeparator=p||",",this.maxReplaces=x||1e3,this.alwaysFormat=void 0!==f&&f,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,r,a){let n,i,s;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(e.indexOf(this.formatSeparator)<0){const n=ie(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(n,void 0,r,{...a,...t,interpolationkey:e}):n}const n=e.split(this.formatSeparator),i=n.shift().trim(),s=n.join(this.formatSeparator).trim();return this.format(ie(t,o,i,this.options.keySeparator,this.options.ignoreJSONStructure),s,r,{...a,...t,interpolationkey:i})};this.resetRegExp();const c=a?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=void 0!==a?.interpolation?.skipOnVariables?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>se(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?se(this.escape(e)):se(e)}].forEach(t=>{for(s=0;n=t.regex.exec(e);){const r=n[1].trim();if(i=l(r),void 0===i)if("function"==typeof c){const t=c(e,n,a);i=N(t)?t:""}else if(a&&Object.prototype.hasOwnProperty.call(a,r))i="";else{if(d){i=n[0];continue}this.logger.warn(`missed to pass in variable ${r} for interpolating ${e}`),i=""}else N(i)||this.useRawValueToEscape||(i=T(i));const o=t.safeValue(i);if(e=e.replace(n[0],o),d?(t.regex.lastIndex+=i.length,t.regex.lastIndex-=n[0].length):t.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,t,r={}){let a,n,i;const s=(e,t)=>{const r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;const a=e.split(new RegExp(`${r}[ ]*{`));let n=`{${a[1]}`;e=a[0],n=this.interpolate(n,i);const s=n.match(/'/g),o=n.match(/"/g);((s?.length??0)%2==0&&!o||o.length%2!=0)&&(n=n.replace(/'/g,'"'));try{i=JSON.parse(n),t&&(i={...t,...i})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${r}${n}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,e};for(;a=this.nestingRegexp.exec(e);){let o=[];i={...r},i=i.replace&&!N(i.replace)?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;const l=/{.*}/.test(a[1])?a[1].lastIndexOf("}")+1:a[1].indexOf(this.formatSeparator);if(-1!==l&&(o=a[1].slice(l).split(this.formatSeparator).map(e=>e.trim()).filter(Boolean),a[1]=a[1].slice(0,l)),n=t(s.call(this,a[1].trim(),i),i),n&&a[0]===e&&!N(n))return n;N(n)||(n=T(n)),n||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),n=""),o.length&&(n=o.reduce((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:a[1].trim()}),n.trim())),e=e.replace(a[0],n),this.regexp.lastIndex=0}return e}}const le=e=>{const t={};return(r,a,n)=>{let i=n;n&&n.interpolationkey&&n.formatParams&&n.formatParams[n.interpolationkey]&&n[n.interpolationkey]&&(i={...i,[n.interpolationkey]:void 0});const s=a+JSON.stringify(i);let o=t[s];return o||(o=e(z(a),n),t[s]=o),o(r)}},ce=e=>(t,r,a)=>e(z(r),a)(t);class de{constructor(e={}){this.logger=Y.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const r=t.cacheInBuiltFormats?le:ce;this.formats={number:r((e,t)=>{const r=new Intl.NumberFormat(e,{...t});return e=>r.format(e)}),currency:r((e,t)=>{const r=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>r.format(e)}),datetime:r((e,t)=>{const r=new Intl.DateTimeFormat(e,{...t});return e=>r.format(e)}),relativetime:r((e,t)=>{const r=new Intl.RelativeTimeFormat(e,{...t});return e=>r.format(e,t.range||"day")}),list:r((e,t)=>{const r=new Intl.ListFormat(e,{...t});return e=>r.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=le(t)}format(e,t,r,a={}){const n=t.split(this.formatSeparator);if(n.length>1&&n[0].indexOf("(")>1&&n[0].indexOf(")")<0&&n.find(e=>e.indexOf(")")>-1)){const e=n.findIndex(e=>e.indexOf(")")>-1);n[0]=[n[0],...n.splice(1,e)].join(this.formatSeparator)}return n.reduce((e,t)=>{const{formatName:n,formatOptions:i}=(e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const a=e.split("(");t=a[0].toLowerCase().trim();const n=a[1].substring(0,a[1].length-1);"currency"===t&&n.indexOf(":")<0?r.currency||(r.currency=n.trim()):"relativetime"===t&&n.indexOf(":")<0?r.range||(r.range=n.trim()):n.split(";").forEach(e=>{if(e){const[t,...a]=e.split(":"),n=a.join(":").trim().replace(/^'+|'+$/g,""),i=t.trim();r[i]||(r[i]=n),"false"===n&&(r[i]=!1),"true"===n&&(r[i]=!0),isNaN(n)||(r[i]=parseInt(n,10))}})}return{formatName:t,formatOptions:r}})(t);if(this.formats[n]){let t=e;try{const s=a?.formatParams?.[a.interpolationkey]||{},o=s.locale||s.lng||a.locale||a.lng||r;t=this.formats[n](e,o,{...i,...a,...s})}catch(s){this.logger.warn(s)}return t}return this.logger.warn(`there was no format function for ${n}`),e},e)}}class ue extends X{constructor(e,t,r,a={}){super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=a,this.logger=Y.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,a.backend,a)}queueLoad(e,t,r,a){const n={},i={},s={},o={};return e.forEach(e=>{let a=!0;t.forEach(t=>{const s=`${e}|${t}`;!r.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===i[s]&&(i[s]=!0):(this.state[s]=1,a=!1,void 0===i[s]&&(i[s]=!0),void 0===n[s]&&(n[s]=!0),void 0===o[t]&&(o[t]=!0)))}),a||(s[e]=!0)}),(Object.keys(n).length||Object.keys(i).length)&&this.queue.push({pending:i,pendingCount:Object.keys(i).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(n),pending:Object.keys(i),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(o)}}loaded(e,t,r){const a=e.split("|"),n=a[0],i=a[1];t&&this.emit("failedLoading",n,i,t),!t&&r&&this.store.addResourceBundle(n,i,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const s={};this.queue.forEach(r=>{((e,t,r)=>{const{obj:a,k:n}=I(e,t,Object);a[n]=a[n]||[],a[n].push(r)})(r.loaded,[n],i),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach(e=>{s[e]||(s[e]={});const t=r.loaded[e];t.length&&t.forEach(t=>{void 0===s[e][t]&&(s[e][t]=!0)})}),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(e=>!e.done)}read(e,t,r,a=0,n=this.retryTimeout,i){if(!e.length)return i(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:a,wait:n,callback:i});this.readingCalls++;const s=(s,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}s&&o&&a<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,r,a+1,2*n,i)},n):i(s,o)},o=this.backend[r].bind(this.backend);if(2!==o.length)return o(e,t,s);try{const r=o(e,t);r&&"function"==typeof r.then?r.then(e=>s(null,e)).catch(s):s(null,r)}catch(l){s(l)}}prepareLoading(e,t,r={},a){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();N(e)&&(e=this.languageUtils.toResolveHierarchy(e)),N(t)&&(t=[t]);const n=this.queueLoad(e,t,r,a);if(!n.toLoad.length)return n.pending.length||a(),null;n.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e,t=""){const r=e.split("|"),a=r[0],n=r[1];this.read(a,n,"read",void 0,void 0,(r,i)=>{r&&this.logger.warn(`${t}loading namespace ${n} for language ${a} failed`,r),!r&&i&&this.logger.log(`${t}loaded namespace ${n} for language ${a}`,i),this.loaded(e,r,i)})}saveMissing(e,t,r,a,n,i={},s=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=r&&""!==r){if(this.backend?.create){const l={...i,isUpdate:n},c=this.backend.create.bind(this.backend);if(c.length<6)try{let n;n=5===c.length?c(e,t,r,a,l):c(e,t,r,a),n&&"function"==typeof n.then?n.then(e=>s(null,e)).catch(s):s(null,n)}catch(o){s(o)}else c(e,t,r,a,s,l)}e&&e[0]&&this.store.addResource(e[0],t,r,a)}}else this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const ge=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),N(e[1])&&(t.defaultValue=e[1]),N(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const r=e[3]||e[2];Object.keys(r).forEach(e=>{t[e]=r[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),he=e=>(N(e.ns)&&(e.ns=[e.ns]),N(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),N(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),me=()=>{};class pe extends X{constructor(e={},t){var r;if(super(),this.options=he(e),this.services={},this.logger=Y,this.modules={external:[]},r=this,Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach(e=>{"function"==typeof r[e]&&(r[e]=r[e].bind(r))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(N(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=ge();this.options={...r,...this.options,...he(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator),"function"!=typeof this.options.overloadTranslationOptionHandler&&(this.options.overloadTranslationOptionHandler=r.overloadTranslationOptionHandler);const a=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?Y.init(a(this.modules.logger),this.options):Y.init(null,this.options),e=this.modules.formatter?this.modules.formatter:de;const t=new te(this.options);this.store=new _(this.options.resources,this.options);const n=this.services;n.logger=Y,n.resourceStore=this.store,n.languageUtils=t,n.pluralResolver=new ne(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix});this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),!e||this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format||(n.formatter=a(e),n.formatter.init&&n.formatter.init(n,this.options),this.options.interpolation.format=n.formatter.format.bind(n.formatter)),n.interpolator=new oe(this.options),n.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},n.backendConnector=new ue(a(this.modules.backend),n.resourceStore,n,this.options),n.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(n.languageDetector=a(this.modules.languageDetector),n.languageDetector.init&&n.languageDetector.init(n,this.options.detection,this.options)),this.modules.i18nFormat&&(n.i18nFormat=a(this.modules.i18nFormat),n.i18nFormat.init&&n.i18nFormat.init(this)),this.translator=new ee(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=me),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const n=A(),i=()=>{const e=(e,r)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),n.resolve(r),t(e,r)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?i():setTimeout(i,0),n}loadResources(e,t=me){let r=t;const a=N(e)?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===a?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return r();const e=[],t=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};if(a)t(a);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e))}this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),r(e)})}else r(null)}reloadResources(e,t,r){const a=A();return"function"==typeof e&&(r=e,e=void 0),"function"==typeof t&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=me),this.services.backendConnector.reload(e,t,e=>{a.resolve(),r(e)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&J.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const r=A();this.emit("languageChanging",e);const a=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},n=(n,i)=>{i?this.isLanguageChangingTo===e&&(a(i),this.translator.changeLanguage(i),this.isLanguageChangingTo=void 0,this.emit("languageChanged",i),this.logger.log("languageChanged",i)):this.isLanguageChangingTo=void 0,r.resolve((...e)=>this.t(...e)),t&&t(n,(...e)=>this.t(...e))},i=t=>{e||t||!this.services.languageDetector||(t=[]);const r=N(t)?t:t&&t[0],i=this.store.hasLanguageSomeTranslations(r)?r:this.services.languageUtils.getBestMatchFromCodes(N(t)?[t]:t);i&&(this.language||a(i),this.translator.language||this.translator.changeLanguage(i),this.services.languageDetector?.cacheUserLanguage?.(i)),this.loadResources(i,e=>{n(e,i)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(i):this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),r}getFixedT(e,t,r){const a=(e,t,...n)=>{let i;i="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(n)):{...t},i.lng=i.lng||a.lng,i.lngs=i.lngs||a.lngs,i.ns=i.ns||a.ns,""!==i.keyPrefix&&(i.keyPrefix=i.keyPrefix||r||a.keyPrefix);const s=this.options.keySeparator||".";let o;return i.keyPrefix&&Array.isArray(e)?o=e.map(e=>("function"==typeof e&&(e=Q(e,{...this.options,...t})),`${i.keyPrefix}${s}${e}`)):("function"==typeof e&&(e=Q(e,{...this.options,...t})),o=i.keyPrefix?`${i.keyPrefix}${s}${e}`:e),this.t(o,i)};return N(e)?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=r,a}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,n=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;const i=(e,t)=>{const r=this.services.backendConnector.state[`${e}|${t}`];return-1===r||0===r||2===r};if(t.precheck){const e=t.precheck(this,i);if(void 0!==e)return e}return!!this.hasResourceBundle(r,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!i(r,e)||a&&!i(n,e)))}loadNamespaces(e,t){const r=A();return this.options.ns?(N(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=A();N(e)&&(e=[e]);const a=this.options.preload||[],n=e.filter(e=>a.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return n.length?(this.options.preload=a.concat(n),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const t=new Intl.Locale(e);if(t&&t.getTextInfo){const e=t.getTextInfo();if(e&&e.direction)return e.direction}}catch(r){}const t=this.services?.languageUtils||new te(ge());return e.toLowerCase().indexOf("-latn")>1?"ltr":["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const r=new pe(e,t);return r.createInstance=pe.createInstance,r}cloneInstance(e={},t=me){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},n=new pe(a);void 0===e.debug&&void 0===e.prefix||(n.logger=n.logger.clone(e));if(["store","services","language"].forEach(e=>{n[e]=this[e]}),n.services={...this.services},n.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},r){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((r,a)=>(r[a]={...e[t][a]},r),e[t]),e),{});n.store=new _(e,a),n.services.resourceStore=n.store}return e.interpolation&&(n.services.interpolator=new oe(a)),n.translator=new ee(n.services,a),n.translator.on("*",(e,...t)=>{n.emit(e,...t)}),n.init(a,t),n.translator.options=a,n.translator.backendConnector.services.utils={hasLoadedNamespace:n.hasLoadedNamespace.bind(n)},n}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const xe=pe.createInstance();xe.createInstance,xe.dir,xe.init,xe.loadResources,xe.reloadResources,xe.use,xe.changeLanguage,xe.getFixedT,xe.t,xe.exists,xe.setDefaultNamespace,xe.hasLoadedNamespace,xe.loadNamespaces,xe.loadLanguages;const fe={},ye=(e,t,r,a)=>{Se(r)&&fe[r]||(Se(r)&&(fe[r]=new Date),((e,t,r,a)=>{const n=[r,{code:t,...a||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(n,"warn","react-i18next::",!0);Se(n[0])&&(n[0]=`react-i18next:: ${n[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...n):console})(e,t,r,a))},be=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},ve=(e,t,r)=>{e.loadNamespaces(t,be(e,r))},we=(e,t,r,a)=>{if(Se(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return ve(e,r,a);r.forEach(t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)}),e.loadLanguages(t,be(e,a))},Se=e=>"string"==typeof e,ke=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Ce={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},je=e=>Ce[e];let De={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(ke,je),transDefaultProps:void 0};let Ne;const Ae={type:"3rdParty",init(e){((e={})=>{De={...De,...e}})(e.options.react),(e=>{Ne=e})(e)}},Te=a.createContext();class Me{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var Ee,Re,Ie={exports:{}},Le={};var Oe=(Re||(Re=1,Ie.exports=function(){if(Ee)return Le;Ee=1;var e=n(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=e.useState,a=e.useEffect,i=e.useLayoutEffect,s=e.useDebugValue;function o(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!t(e,a)}catch(n){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),l=r({inst:{value:n,getSnapshot:t}}),c=l[0].inst,d=l[1];return i(function(){c.value=n,c.getSnapshot=t,o(c)&&d({inst:c})},[e,n,t]),a(function(){return o(c)&&d({inst:c}),e(function(){o(c)&&d({inst:c})})},[e]),s(n),n};return Le.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Le}()),Ie.exports);const Fe={t:(e,t)=>{return Se(t)?t:"object"==typeof(r=t)&&null!==r&&Se(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e;var r},ready:!1},Pe=()=>()=>{},$e=(e,t={})=>{const{i18n:r}=t,{i18n:n,defaultNS:i}=a.useContext(Te)||{},s=r||n||Ne;s&&!s.reportNamespaces&&(s.reportNamespaces=new Me),s||ye(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const o=a.useMemo(()=>({...De,...s?.options?.react,...t}),[s,t]),{useSuspense:l,keyPrefix:c}=o,d=e||i||s?.options?.defaultNS,u=Se(d)?[d]:d||["translation"],g=a.useMemo(()=>u,u);s?.reportNamespaces?.addUsedNamespaces?.(g);const h=a.useRef(0),m=a.useCallback(e=>{if(!s)return Pe;const{bindI18n:t,bindI18nStore:r}=o,a=()=>{h.current+=1,e()};return t&&s.on(t,a),r&&s.store.on(r,a),()=>{t&&t.split(" ").forEach(e=>s.off(e,a)),r&&r.split(" ").forEach(e=>s.store.off(e,a))}},[s,o]),p=a.useRef(),x=a.useCallback(()=>{if(!s)return Fe;const e=!(!s.isInitialized&&!s.initializedStoreOnce)&&g.every(e=>((e,t,r={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:r.lng,precheck:(t,a)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!a(t.isLanguageChangingTo,e))return!1}}):(ye(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0))(e,s,o)),r=t.lng||s.language,a=h.current,n=p.current;if(n&&n.ready===e&&n.lng===r&&n.keyPrefix===c&&n.revision===a)return n;const i={t:s.getFixedT(r,"fallback"===o.nsMode?g:g[0],c),ready:e,lng:r,keyPrefix:c,revision:a};return p.current=i,i},[s,g,c,o,t.lng]),[f,y]=a.useState(0),{t:b,ready:v}=Oe.useSyncExternalStore(m,x,x);a.useEffect(()=>{if(s&&!v&&!l){const e=()=>y(e=>e+1);t.lng?we(s,t.lng,g,e):ve(s,g,e)}},[s,t.lng,g,v,l,f]);const w=s||{},S=a.useRef(null),k=a.useRef(),C=e=>{const t=Object.getOwnPropertyDescriptors(e);t.__original&&delete t.__original;const r=Object.create(Object.getPrototypeOf(e),t);if(!Object.prototype.hasOwnProperty.call(r,"__original"))try{Object.defineProperty(r,"__original",{value:e,writable:!1,enumerable:!1,configurable:!1})}catch(a){}return r},j=a.useMemo(()=>{const e=w,t=e?.language;let r=e;e&&(S.current&&S.current.__original===e?k.current!==t?(r=C(e),S.current=r,k.current=t):r=S.current:(r=C(e),S.current=r,k.current=t));const a=[b,r,v];return a.t=b,a.i18n=r,a.ready=v,a},[b,w,v,w.resolvedLanguage,w.language,w.languages]);if(s&&l&&!v)throw new Promise(e=>{const r=()=>e();t.lng?we(s,t.lng,g,r):ve(s,g,r)});return j},We=20,Ve=1e4,Be="default",He=[Be],ze=100,Ue=200,qe=300,Ye=400,Xe=500,_e=600,Je=700,Ke=800,Qe=900,Ge=1e3,Ze="default",et=10,tt=9999,rt=99999,at=1e3,nt=1e5,it=128,st=5e3,ot=10,lt={check:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M5 13l4 4L19 7"}),"bar-chart":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{fill:t,x:"4",y:"10",width:"4",height:"10"}),s.jsx("rect",{fill:t,x:"10",y:"6",width:"4",height:"14"}),s.jsx("rect",{fill:t,x:"16",y:"13",width:"4",height:"7"})]}),"line-chart":e=>s.jsx("polyline",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,points:"4,18 8,12 12,14 16,8 20,10"}),"site-logo":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9.66,7.94l-3.92,2.08c-.68.36-1.09,1.07-1.06,1.84l.22,6.02c.02.66.37,1.27.94,1.62l5.1,3.2c.65.41,1.48.41,2.13,0l5.1-3.2c.56-.35.91-.96.94-1.62l.22-6.02c.03-.77-.38-1.48-1.06-1.84l-3.92-2.08"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M13.92,5.61c1.07.71,2.51,1.39,4.08,1.39,2.21,0,4-1.34,4-3,0-1.66-1.79-3-4-3-3.31,0-6,3-6,3,0,0-2.69,3-6,3-2.21,0-4-1.34-4-3S3.79,1,6,1c.18,0,.37,0,.55.03,1.31.13,2.47.69,3.39,1.53"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M14.25,10.98c0,.69-1.01,1.24-2.25,1.24s-2.25-.56-2.25-1.24"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M11.99,7.01c0,.1,0,.2,0,.3v2.42"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"8.78",cy:"16.77",rx:".62",ry:"1.12",transform:"translate(-7.21 6.64) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"10.49",cy:"19.73",rx:".62",ry:"1.12",transform:"translate(-8.46 7.89) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"7.07",cy:"13.8",rx:".62",ry:"1.12",transform:"translate(-5.95 5.38) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"16.96",cy:"13.75",rx:"1.12",ry:".62",transform:"translate(-3.43 21.56) rotate(-60)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"13.54",cy:"19.68",rx:"1.12",ry:".62",transform:"translate(-10.27 21.56) rotate(-60)"})]}),dice:(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.33,16.08l.32-8.65c.03-.77-.38-1.48-1.06-1.84L12.94,1.55c-.59-.31-1.29-.31-1.87,0L3.42,5.59c-.68.36-1.09,1.07-1.06,1.84l.32,8.65c.02.66.37,1.27.94,1.62l7.33,4.6c.65.41,1.48.41,2.13,0l7.33-4.6c.56-.35.91-.96.94-1.62Z"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"12",cy:"6.68",rx:"2.96",ry:"1.64"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"7.77",cy:"14.29",rx:".82",ry:"1.48",transform:"translate(-6.1 5.8) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"10.02",cy:"18.19",rx:".82",ry:"1.48",transform:"translate(-7.75 7.45) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"5.52",cy:"10.39",rx:".82",ry:"1.48",transform:"translate(-4.46 4.15) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"18.52",cy:"10.32",rx:"1.48",ry:".82",transform:"translate(.33 21.2) rotate(-60)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"14.02",cy:"18.12",rx:"1.48",ry:".82",transform:"translate(-8.68 21.2) rotate(-60)"})]}),"chevron-left":e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M15 19l-7-7 7-7"}),"chevron-right":e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5l7 7-7 7"}),"chevron-up":e=>s.jsx(s.Fragment,{children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5*e,d:"M6 15l6-6 6 6"})}),"chevron-down":e=>s.jsx(s.Fragment,{children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5*e,d:"M6 9l6 6 6-6"})}),help:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),sun:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"}),moon:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"}),diceSets:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"}),settings:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"chart-bar":e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"}),results:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"}),menu:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 6h16M4 12h16M4 18h16"}),"dots-vertical":()=>s.jsxs(s.Fragment,{children:[s.jsx("circle",{fill:"currentColor",cx:"12",cy:"5",r:"1"}),s.jsx("circle",{fill:"currentColor",cx:"12",cy:"12",r:"1"}),s.jsx("circle",{fill:"currentColor",cx:"12",cy:"19",r:"1"})]}),close:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M6 18L18 6M6 6l12 12"}),download:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"}),upload:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"}),edit:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}),save:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M16,7h.68c.8,0,1.52.48,1.84,1.21l3.09,7.21c1.13,2.64-.8,5.58-3.68,5.58H6.07c-2.87,0-4.81-2.94-3.68-5.58l3.09-7.21c.32-.74,1.04-1.21,1.84-1.21h.61"}),s.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,points:"16 10 12 14 8 10"}),s.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,x1:"5.93",y1:"18",x2:"17.93",y2:"18"}),s.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,x1:"12",y1:"14",x2:"12",y2:"4"})]}),trash:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}),copy:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"}),clipboard:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]}),export:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),import:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 16v-6m0 0l-3 3m3-3l3 3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),reroll:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.4,15.6l.28-7.55c.04-1.15-.58-2.22-1.59-2.76l-6.68-3.53c-.88-.46-1.93-.46-2.81,0l-6.68,3.53c-1.02.54-1.64,1.61-1.59,2.76l.28,7.55c.04.99.56,1.9,1.4,2.43l6.4,4.01c.98.61,2.21.61,3.19,0l6.4-4.01c.84-.53,1.37-1.44,1.4-2.43Z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M13.97,7.75c1.09.51,1.98,1.43,2.42,2.65.89,2.43-.37,5.12-2.8,6.01s-5.12-.37-6.01-2.8c-.89-2.43.37-5.12,2.8-6.01"}),s.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",points:"8.13 6.99 10.39 7.6 9.78 9.86"})]}),"add-roll":e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.4,15.6l.28-7.55c.04-1.15-.58-2.22-1.59-2.76l-6.68-3.53c-.88-.46-1.93-.46-2.81,0l-6.68,3.53c-1.02.54-1.64,1.61-1.59,2.76l.28,7.55c.04.99.56,1.9,1.4,2.43l6.4,4.01c.98.61,2.21.61,3.19,0l6.4-4.01c.84-.53,1.37-1.44,1.4-2.43Z"}),s.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",x1:"8.25",y1:"12",x2:"15.75",y2:"12"}),s.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",x1:"12",y1:"8.25",x2:"12",y2:"15.75"})]}),refresh:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"}),plus:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 4v16m8-8H4"}),"plus-circle":e=>s.jsxs(s.Fragment,{children:[s.jsx("circle",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,cx:"12",cy:"12",r:"9"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 8v8m-4-4h8"})]}),spinner:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21 12a9 9 0 1 1-6.219-8.56"}),table:()=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{strokeWidth:"2",x:"2",y:"3",width:"20",height:"18",rx:"2",ry:"2"}),s.jsx("line",{strokeWidth:"2",x1:"2",y1:"9",x2:"22",y2:"9"}),s.jsx("line",{strokeWidth:"2",x1:"2",y1:"15",x2:"22",y2:"15"}),s.jsx("line",{strokeWidth:"2",x1:"12",y1:"3",x2:"12",y2:"21"})]}),reset:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M22 21H7"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"m5 11 9 9"})]}),info:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),filter:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"}),"chart-total-distribution":e=>s.jsx(s.Fragment,{children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4,17h0c2.21,0,3.4-.83,4-3.72.6-2.9,1.75-6.28,3.96-6.28,2.21,0,3.44,3.38,4.04,6.28.6,2.9,1.79,3.72,4,3.72h0"})}),"chart-cumulative-distribution":e=>s.jsx(s.Fragment,{children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4,7h0c4.42,0,6.79,1.11,8,5s3.58,5,8,5h0"})}),"chart-roll-progress":e=>s.jsx(s.Fragment,{children:s.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,points:"4 13.04 6.42 7 11.69 17 13.78 13.76 15.98 15.77 20 9.08"})}),"chart-individual-dice":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,style:{fill:t},x:"4",y:"10",width:"2",height:"8"}),s.jsx("rect",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,style:{fill:t},x:"18",y:"14",width:"2",height:"4"}),s.jsx("rect",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,style:{fill:t},x:"11",y:"6",width:"2",height:"12"})]}),lock:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"}),unlock:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8 11V5a4 4 0 018 0"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"})]}),fullscreen:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"}),"view-list-compact":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{x:"2",y:"5",width:"10",height:"2",rx:"0.5",style:{fill:t}}),s.jsx("rect",{x:"2",y:"11",width:"10",height:"2",rx:"0.5",style:{fill:t}}),s.jsx("rect",{x:"2",y:"17",width:"10",height:"2",rx:"0.5",style:{fill:t}}),s.jsx("polyline",{points:"17 5 20 8 23 5",fill:"none",stroke:t,strokeWidth:e,strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("polyline",{points:"17 19 20 16 23 19",fill:"none",stroke:t,strokeWidth:e,strokeLinecap:"round",strokeLinejoin:"round"})]}),"view-list-detailed":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{x:"2",y:"4",width:"10",height:"5",rx:"1",style:{fill:t}}),s.jsx("rect",{x:"2",y:"15",width:"10",height:"5",rx:"1",style:{fill:t}}),s.jsx("polyline",{points:"17 7 20 4 23 7",fill:"none",stroke:t,strokeWidth:e,strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("polyline",{points:"17 17 20 20 23 17",fill:"none",stroke:t,strokeWidth:e,strokeLinecap:"round",strokeLinejoin:"round"})]})},ct=i.memo(({name:e,className:t="w-6 h-6",strokeWidth:r=2})=>{const a=lt[e];return a?s.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a(r,"currentColor")}):null});function dt(e,t,r,a){return new Promise((n,i)=>{const s=new Worker(new URL("/dice/assets/diceSimulation.worker-DCJS2b41.js",import.meta.url),{type:"module"});s.onmessage=e=>{const t=e.data;"progress"===t.type?r?.(t.progress,t.processed,t.total):"complete"===t.type?(s.terminate(),n(t.results)):"error"===t.type&&(s.terminate(),i(new Error(t.error)))},s.onerror=e=>{s.terminate(),i(e)};const o={type:"simulate",config:e,trialCount:t,chunkSize:a};s.postMessage(o)})}function ut(e){let t=`dice${e.diceCount}d${e.diceFaces}`;return e.modifierSign&&e.modifierValue>0&&(t+=`${e.modifierSign}${e.modifierValue}`),t}function gt(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function ht(){return(new Date).toISOString()}function mt(e,t){return e.diceCount===t.diceCount&&e.diceFaces===t.diceFaces&&e.modifierSign===t.modifierSign&&e.modifierValue===t.modifierValue}function pt(e,t=8){return e.length<=t?e:e.substring(0,t)+"..."}function xt(e){const t=e.name||ut(e.diceConfig);return`${void 0!==e.numericUid?`#${e.numericUid} - `:""}${t}`}function ft(e,t=8){const r=e.name||ut(e.diceConfig),a=r.length<=t?r:r.substring(0,t)+"...";return`${void 0!==e.numericUid?`#${e.numericUid} - `:""}${a}`}function yt(){return`widget-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function bt(){return[{id:yt(),type:"result"},{id:yt(),type:"cumulative"},{id:yt(),type:"rollProgress"},{id:yt(),type:"individual"}]}function vt(e,t,r){const a=r(`charts:widget.graphTypes.${e}`);return r("charts:widget.autoName",{type:a,index:t})}ct.displayName="Icon";const wt=128;function St(e){return He.includes(e)}function kt(){const e=(new Date).toISOString();return{id:Be,name:"デフォルト設定",widgets:bt(),createdAt:e,updatedAt:e}}function Ct(){return`chart-settings-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function jt(e){return e&&0!==e.trim().length?e.length>wt?{valid:!1,error:"設定名は128文字以内で入力してください"}:{valid:!0}:{valid:!1,error:"設定名を入力してください"}}const Dt="diceSets",Nt="chartSettings",At="metadata",Tt="tableFilterSets";const Mt=new class{constructor(){t(this,"dbPromise",null)}async closeDB(){if(this.dbPromise){try{(await this.dbPromise).close()}catch(e){}this.dbPromise=null}}async getDB(){return this.dbPromise||(this.dbPromise=new Promise((e,t)=>{const r=indexedDB.open("DiceSimulatorDB",7);r.onerror=()=>{t(new Error("IndexedDBを開けませんでした"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=e=>{const t=e.target.result,r=e.oldVersion,a=e.target.transaction;if(t.objectStoreNames.contains("sessions")&&!t.objectStoreNames.contains(Dt)){const e=a.objectStore("sessions").getAll();e.onsuccess=()=>{const r=e.result,a=t.createObjectStore(Dt,{keyPath:"id"});a.createIndex("by-sortOrder","sortOrder",{unique:!1}),a.createIndex("by-updated","updatedAt",{unique:!1}),r.forEach(e=>{a.add(e)})},t.deleteObjectStore("sessions")}else if(t.objectStoreNames.contains(Dt)){if(r<2){const e=a.objectStore(Dt);e.indexNames.contains("by-sortOrder")||e.createIndex("by-sortOrder","sortOrder",{unique:!1})}}else{const e=t.createObjectStore(Dt,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}if(r<3&&!t.objectStoreNames.contains(Nt)){const e=t.createObjectStore(Nt,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}if(r<4&&r>=3){const t=e.target.transaction.objectStore(Nt);t.indexNames.contains("by-sortOrder")||t.createIndex("by-sortOrder","sortOrder",{unique:!1})}if(r<6&&(t.objectStoreNames.contains(At)||t.createObjectStore(At,{keyPath:"key"})),r<7&&!t.objectStoreNames.contains(Tt)){const e=t.createObjectStore(Tt,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}}})),this.dbPromise}async loadDiceSets(){try{const e=await this.getDB(),t=e.transaction(Dt,"readonly").objectStore(Dt);return new Promise((e,r)=>{const a=t.getAll();a.onsuccess=()=>{const t=a.result;t.sort((e,t)=>void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),e(t)},a.onerror=()=>{r(new Error("ダイスセットの読み込みに失敗しました"))}})}catch(e){return[]}}async saveDiceSet(e){const t=await this.getDB();let r=e;if(void 0===e.sortOrder)try{const t=await this.getDiceSet(e.id);if(t&&void 0!==t.sortOrder)r={...e,sortOrder:t.sortOrder};else{const t=(await this.loadDiceSets()).reduce((e,t)=>void 0!==t.sortOrder&&t.sortOrder>e?t.sortOrder:e,-1);r={...e,sortOrder:t+1}}}catch(n){}const a=t.transaction(Dt,"readwrite").objectStore(Dt);return new Promise((e,t)=>{const n=a.put(r);n.onsuccess=()=>{e()},n.onerror=()=>{t(new Error("ダイスセットの保存に失敗しました"))}})}async saveDiceSets(e){const t=(await this.getDB()).transaction(Dt,"readwrite").objectStore(Dt);return await new Promise((e,r)=>{const a=t.clear();a.onsuccess=()=>e(),a.onerror=()=>r(new Error("データのクリアに失敗しました"))}),new Promise((r,a)=>{let n=0;const i=e.length;0!==i?e.forEach((e,s)=>{const o={...e,sortOrder:s},l=t.put(o);l.onsuccess=()=>{n++,n===i&&r()},l.onerror=()=>{a(new Error("ダイスセットの保存に失敗しました"))}}):r()})}async deleteDiceSet(e){const t=(await this.getDB()).transaction(Dt,"readwrite").objectStore(Dt);return new Promise((r,a)=>{const n=t.delete(e);n.onsuccess=()=>{r()},n.onerror=()=>{a(new Error("ダイスセットの削除に失敗しました"))}})}async getDiceSet(e){const t=(await this.getDB()).transaction(Dt,"readonly").objectStore(Dt);return new Promise((r,a)=>{const n=t.get(e);n.onsuccess=()=>{r(n.result)},n.onerror=()=>{a(new Error("ダイスセットの取得に失敗しました"))}})}async getDiceSetCount(){const e=(await this.getDB()).transaction(Dt,"readonly").objectStore(Dt);return new Promise((t,r)=>{const a=e.count();a.onsuccess=()=>{t(a.result)},a.onerror=()=>{r(new Error("ダイスセット数の取得に失敗しました"))}})}async migrateFromLocalStorage(){try{const t="dice-simulator-dice-sets",r=localStorage.getItem(t);if(!r)return!1;let a;try{a=JSON.parse(r)}catch(e){return localStorage.removeItem(t),!1}if(!a||"object"!=typeof a)throw new Error("LocalStorageのデータ形式が不正です");const n=a;let i=[];if(Array.isArray(n.diceSets)?i=n.diceSets:Array.isArray(n.sessions)&&(i=n.sessions),!Array.isArray(i))throw new Error("diceSetsが配列ではありません");return i.length>0&&(i.forEach((e,t)=>{!function(e,t){if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const r=e;if(!r.id||"string"!=typeof r.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(void 0===r.name||null===r.name||"string"!=typeof r.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(r.name.length>it)throw new Error(`ダイスセット${t+1}: 名前が長すぎます（最大128文字）`);if(!r.diceConfig||"object"!=typeof r.diceConfig)throw new Error(`ダイスセット${t+1}: ダイス設定が不正です`);const a=r.diceConfig;if("number"!=typeof a.diceCount||a.diceCount<1||a.diceCount>et)throw new Error(`ダイスセット${t+1}: ダイス数が範囲外です`);if("number"!=typeof a.diceFaces||a.diceFaces<1||a.diceFaces>tt)throw new Error(`ダイスセット${t+1}: ダイス面数が範囲外です`);if(""!==a.modifierSign&&"+"!==a.modifierSign&&"-"!==a.modifierSign)throw new Error(`ダイスセット${t+1}: 修正値符号が不正です`);if("number"!=typeof a.modifierValue||a.modifierValue<0||a.modifierValue>rt)throw new Error(`ダイスセット${t+1}: 修正値が範囲外です`);if("number"!=typeof r.trialCount||r.trialCount<1||r.trialCount>at)throw new Error(`ダイスセット${t+1}: 試行回数が範囲外です`);if(!Array.isArray(r.results))throw new Error(`ダイスセット${t+1}: 結果が配列ではありません`)}(e,t)}),await this.saveDiceSets(i),localStorage.removeItem(t),!0)}catch(e){return!1}}async loadChartSettings(){try{const e=await this.getDB(),t=e.transaction(Nt,"readonly").objectStore(Nt);return new Promise((e,r)=>{const a=t.getAll();a.onsuccess=()=>{const t=a.result;if(!t.some(e=>e.id===Be)){const e=kt();t.unshift(e)}t.sort((e,t)=>{const r=He.includes(e.id),a=He.includes(t.id);return r&&a?e.id===Be?-1:t.id===Be?1:He.indexOf(e.id)-He.indexOf(t.id):r?-1:a?1:void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()}),e(t)},a.onerror=()=>{r(new Error("ダッシュボード設定の読み込みに失敗しました"))}})}catch(e){return[kt()]}}async saveChartSettings(e){const t=(await this.getDB()).transaction(Nt,"readwrite").objectStore(Nt);return new Promise((r,a)=>{const n=t.put(e);n.onsuccess=()=>{r()},n.onerror=()=>{a(new Error("ダッシュボード設定の保存に失敗しました"))}})}async deleteChartSettings(e){if(e===Be)throw new Error("デフォルト設定は削除できません");const t=(await this.getDB()).transaction(Nt,"readwrite").objectStore(Nt);return new Promise((r,a)=>{const n=t.delete(e);n.onsuccess=()=>{r()},n.onerror=()=>{a(new Error("ダッシュボード設定の削除に失敗しました"))}})}async getChartSettings(e){const t=(await this.getDB()).transaction(Nt,"readonly").objectStore(Nt);return new Promise((r,a)=>{const n=t.get(e);n.onsuccess=()=>{n.result?r(n.result):r(e===Be?kt():void 0)},n.onerror=()=>{a(new Error("ダッシュボード設定の取得に失敗しました"))}})}async ensureDefaultChartSettings(){await this.getChartSettings(Be)||await this.saveChartSettings(kt())}async getNextNumericUid(){const e=(await this.getDB()).transaction(At,"readwrite").objectStore(At);return new Promise((t,r)=>{const a=e.get("numericUidCounter");a.onsuccess=()=>{const n=(a.result?.value||0)+1,i=e.put({key:"numericUidCounter",value:n});i.onsuccess=()=>{t(n)},i.onerror=()=>{r(new Error("numericUidカウンターの更新に失敗しました"))}},a.onerror=()=>{r(new Error("numericUidカウンターの取得に失敗しました"))}})}async loadTableFilterSets(){try{const e=await this.getDB(),t=e.transaction(Tt,"readonly").objectStore(Tt);return new Promise((e,r)=>{const a=t.getAll();a.onsuccess=()=>{const t=a.result||[];t.sort((e,t)=>void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),e(t)},a.onerror=()=>{r(new Error("テーブルフィルターセットの読み込みに失敗しました"))}})}catch(e){return[]}}async saveTableFilterSet(e){if(e.id===Ze)return;const t=(await this.getDB()).transaction(Tt,"readwrite").objectStore(Tt);return new Promise((r,a)=>{const n=t.put(e);n.onsuccess=()=>{r()},n.onerror=()=>{a(new Error("テーブルフィルターセットの保存に失敗しました"))}})}async saveTableFilterSets(e){const t=(await this.getDB()).transaction(Tt,"readwrite").objectStore(Tt);return new Promise((r,a)=>{let n=0;const i=e.filter(e=>e.id!==Ze).length;0!==i?e.forEach(e=>{if(e.id===Ze)return;const s=t.put(e);s.onsuccess=()=>{n++,n===i&&r()},s.onerror=()=>{a(new Error("テーブルフィルターセットの一括保存に失敗しました"))}}):r()})}async deleteTableFilterSet(e){if(e===Ze)throw new Error("デフォルト設定は削除できません");const t=(await this.getDB()).transaction(Tt,"readwrite").objectStore(Tt);return new Promise((r,a)=>{const n=t.delete(e);n.onsuccess=()=>{r()},n.onerror=()=>{a(new Error("テーブルフィルターセットの削除に失敗しました"))}})}async getTableFilterSet(e){const t=(await this.getDB()).transaction(Tt,"readonly").objectStore(Tt);return new Promise((r,a)=>{const n=t.get(e);n.onsuccess=()=>{n.result?r(n.result):r(void 0)},n.onerror=()=>{a(new Error("テーブルフィルターセットの取得に失敗しました"))}})}};async function Et(e){return Mt.saveDiceSet(e)}async function Rt(e){return Mt.saveDiceSets(e)}async function It(e){return Mt.deleteDiceSet(e)}async function Lt(){return Mt.loadChartSettings()}async function Ot(e){return Mt.saveChartSettings(e)}async function Ft(){return Mt.getNextNumericUid()}async function Pt(){return Mt.closeDB()}async function $t(){return Mt.loadTableFilterSets()}async function Wt(e){return Mt.saveTableFilterSet(e)}function Vt(){const e=(new Date).toISOString();return{id:Ze,name:"デフォルト",createdAt:e,updatedAt:e}}function Bt(e){const t=(new Date).toISOString();return{id:crypto.randomUUID(),name:e||"新規フィルターセット",createdAt:t,updatedAt:t}}const Ht="language",zt="chartHeightSettings",Ut="dice-sim-filter-history",qt="itemsPerPage",Yt="simulateButtonPosition",Xt="diceSetSimpleMode";function _t(e){localStorage.setItem(Ht,e)}function Jt(){return"true"===localStorage.getItem(Xt)}function Kt(e){localStorage.setItem(Xt,e.toString())}const Qt={mode:"fixed-height",aspectRatioWidth:4,aspectRatioHeight:3,fixedHeight:300},Gt=()=>{try{const e=localStorage.getItem(zt);if(e){const t=JSON.parse(e);return{...Qt,...t}}}catch(e){}return Qt},Zt=a.createContext(null);function er({children:e,multipleExpanded:t=!0,defaultExpanded:r=[],className:n=""}){const[i,o]=a.useState(new Set(r)),l=a.useCallback(e=>{o(r=>{const a=new Set(r);return a.has(e)?a.delete(e):(t||a.clear(),a.add(e)),a})},[t]),c=a.useMemo(()=>({expandedItems:i,toggleItem:l,multipleExpanded:t}),[i,l,t]);return s.jsx(Zt.Provider,{value:c,children:s.jsx("div",{className:n,role:"presentation",children:e})})}function tr({id:e,title:t,children:r,headerClassName:n="w-full px-4 py-3 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-600",contentClassName:i="px-4 pt-1 pb-3",disabled:o=!1}){const{expandedItems:l,toggleItem:c}=function(){const e=a.useContext(Zt);if(!e)throw new Error("Accordion components must be used within an Accordion");return e}(),d=l.has(e),u=`accordion-header-${e}`,g=`accordion-content-${e}`;return s.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-600",children:[s.jsxs("button",{id:u,type:"button",onClick:()=>{o||c(e)},onKeyDown:t=>{o||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),c(e))},className:n,"aria-expanded":d,"aria-controls":g,disabled:o,children:[s.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400",children:t}),s.jsx("svg",{className:"w-4 h-4 text-gray-400 transition-transform "+(d?"rotate-180":""),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),d&&s.jsx("div",{id:g,role:"region","aria-labelledby":u,className:i,children:r})]})}function rr({items:e,selectedIds:t,onDeselectAll:r,renderItem:a,emptyMessage:n,className:o="",itemClassName:l="",footer:c,showSelectionCount:d=!0,enableDragAndDrop:u=!1,disableDragPreview:g=!1,onReorder:h,onBulkSelect:m,onSelectionChange:p,onToggleItem:x,onItemDragStateChange:f}){const{t:y}=$e(),[b,v]=i.useState(null),[w,S]=i.useState(null),[k,C]=i.useState(null),[j,D]=i.useState(null),[N,A]=i.useState(null),[T,M]=i.useState(null),[E,R]=i.useState(null),I=i.useRef(new Map),L=i.useRef(null),[O,F]=i.useState(null),[P,$]=i.useState(!1),[W,V]=i.useState(null),B=i.useRef(null),H=i.useRef(t);i.useEffect(()=>{H.current=t},[t]);const z=n||y("common:emptyState.noItems"),U=i.useCallback((t,r,a)=>{if(!p)return void x(t.id,a);const n=H.current;if(!a){const e=n.includes(t.id)?n.filter(e=>e!==t.id):[...n,t.id];return p(e),void F(t.id)}const i="change"===a.type,s=i?null:a,o=a.nativeEvent;let l=!1,c=!1;if(s&&(l=s.ctrlKey||s.metaKey,c=s.shiftKey),o&&!i&&(l=l||!0===o.ctrlKey||!0===o.metaKey,c=c||!0===o.shiftKey,l||"function"!=typeof o.getModifierState||(l=o.getModifierState("Meta")||o.getModifierState("Control")||o.getModifierState("Os"))),l){const e=n.includes(t.id)?n.filter(e=>e!==t.id):[...n,t.id];p(e),F(t.id)}else if(c&&O){const a=e.findIndex(e=>e.id===O);if(-1!==a){const t=Math.min(r,a),n=Math.max(r,a),i=e.slice(t,n+1).map(e=>e.id);p(i)}else p([t.id]),F(t.id)}else{if(1===n.length&&n[0]===t.id)return;p([t.id]),F(t.id)}},[e,p,x,O]);i.useEffect(()=>{if(null!==w){const e=()=>{S(null)};return window.addEventListener("mouseup",e),window.addEventListener("dragend",e),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("dragend",e)}}},[w]),i.useEffect(()=>{const e=null!==b||null!==T||null!==w;f?.(e)},[b,T,w,f]),i.useEffect(()=>{I.current.clear()},[e.length]);const q=e=>(I.current.has(e)||I.current.set(e,i.createRef()),I.current.get(e)),Y=e=>{u&&(e.target.style.opacity="1",v(null),C(null))};i.useEffect(()=>{if(!P||!W)return;const e=e=>{V(t=>t?{...t,currentX:e.clientX,currentY:e.clientY}:null)},r=e=>{if($(!1),W&&B.current){const r={left:Math.min(W.startX,W.currentX),top:Math.min(W.startY,W.currentY),right:Math.max(W.startX,W.currentX),bottom:Math.max(W.startY,W.currentY)};if(Math.abs(r.right-r.left)<5&&Math.abs(r.bottom-r.top)<5)return void V(null);const a=B.current.querySelectorAll("[data-item-id]"),n=[];if(a.forEach(e=>{const t=e.getBoundingClientRect();if(!(r.right<t.left||r.left>t.right||r.bottom<t.top||r.top>t.bottom)){const t=e.getAttribute("data-item-id");t&&n.push(t)}}),n.length>0){const r=e.ctrlKey||e.metaKey||e.shiftKey;if(m)m(n,r?"add":"replace");else if(p)if(r){const e=[...t];let r=!1;n.forEach(t=>{e.includes(t)||(e.push(t),r=!0)}),r&&p(e)}else p(n)}}V(null)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",r),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r)}},[P,W,m,r,p,t]),i.useEffect(()=>{if(!r&&!p)return;const e=e=>{const t=e.target;t.closest("[data-item-id]")||B.current&&B.current.contains(t)||t.closest('button, a, input, select, textarea, [role="button"]')||P||null!==b||e.shiftKey||e.ctrlKey||e.metaKey||(r?r():p&&p([]))};return document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0)}},[r,p,P,b]);return s.jsxs("div",{ref:B,onMouseDown:e=>{0===e.button&&(m||p)&&(e.target.closest('button, input, a, [draggable="true"], [data-no-select]')||($(!0),V({startX:e.clientX,startY:e.clientY,currentX:e.clientX,currentY:e.clientY})))},className:`flex flex-col pb-10 h-full relative ${o}`,children:[P&&W&&s.jsx("div",{className:"fixed bg-accent-light-500 dark:bg-accent-dark-500 bg-opacity-20 dark:bg-opacity-20 border border-accent-light-500 dark:border-accent-dark-500 z-50 pointer-events-none",style:{left:Math.min(W.startX,W.currentX),top:Math.min(W.startY,W.currentY),width:Math.abs(W.currentX-W.startX),height:Math.abs(W.currentY-W.startY)}}),s.jsxs("div",{ref:L,className:"fixed -left-[9999px] -top-[9999px] bg-accent-light-500 dark:bg-accent-dark-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",style:{zIndex:9999,opacity:1},children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),s.jsx("span",{className:"font-medium text-sm",children:y("common:selection.moving")})]}),s.jsx("div",{className:"flex-1 space-y-2 pb-10",children:0===e.length?s.jsx("p",{className:"text-center text-gray-400 dark:text-gray-500 py-8",children:z}):e.map((r,n)=>{const i=t.includes(r.id),o=b===n,c=T===n,d=b??T??w,m=k===n&&(null!==b||null!==T)&&b!==n&&T!==n,p=null!==d&&!(d===n)&&!m,x=null!==d&&d<n?"bottom":"top",f={};if(c&&null!==j&&null!==N&&E){const e=N-j;f.position="fixed",f.top=E.top+e,f.left=E.left,f.width=E.width,f.zIndex=1e3,f.pointerEvents="none",f.transition="none",f.opacity=.7}else f.transition="all 0.2s",f.opacity=o||w===n?.5:1;return s.jsxs("div",{"data-item-id":r.id,onDragOver:e=>((e,t)=>{u&&(e.preventDefault(),e.dataTransfer.dropEffect="move",null!==b&&b!==t&&k!==t&&C(t))})(e,n),onDrop:r=>((r,a)=>{if(!u||!h||null===b)return;r.preventDefault();const n=e[b];if(!n)return;if(t.includes(n.id)&&t.length>1){const r=e.filter(e=>!t.includes(e.id)),n=e.filter(e=>t.includes(e.id)),i=e[a];if(t.includes(i.id))return v(null),void C(null);let s=r.findIndex(e=>e.id===i.id);if(-1===s)return v(null),void C(null);a>b&&s++,r.splice(s,0,...n),h(r)}else{if(b===a)return v(null),void C(null);const t=[...e],[r]=t.splice(b,1);t.splice(a,0,r),h(t)}v(null),C(null)})(r,n),onTouchStart:e=>((e,t)=>{if(!u)return;const r=e.target,a=q(t).current;if(!a||!a.contains(r))return;e.stopPropagation(),e.preventDefault();const n=e.currentTarget;R(n.getBoundingClientRect()),D(e.touches[0].clientY),A(e.touches[0].clientY),M(t)})(e,n),onTouchMove:t=>((t,r)=>{if(!u||T!==r||null===j)return;t.preventDefault(),t.stopPropagation();const a=t.touches[0].clientY;A(a);const n=t.currentTarget.getBoundingClientRect().height,i=a-j,s=.5*n;if(Math.abs(i)>s){const t=Math.round(i/n),a=Math.max(0,Math.min(e.length-1,r+t));C(a!==r?a:null)}else C(null)})(t,n),onTouchEnd:()=>(t=>{if(u&&T===t){if(null!==k&&k!==t&&h){const r=[...e],[a]=r.splice(t,1);r.splice(k,0,a),h(r)}R(null),D(null),A(null),M(null),C(null)}})(n),onTouchCancel:()=>(e=>{u&&T===e&&(R(null),D(null),A(null),M(null),C(null))})(n),style:f,className:`${c?"":"relative"} ${l} ${m?(b??T)<n?"mb-4":"mt-4":""} ${o?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500 ring-offset-2 dark:ring-offset-gray-800 rounded-lg":""}`,children:[m&&s.jsx("div",{className:`absolute left-0 right-0 h-1 bg-accent-light-500 dark:bg-accent-dark-500 rounded-full ${(b??T)<n?"-bottom-2.5":"-top-2.5"} z-10`}),p&&s.jsx("div",{className:`absolute left-0 right-0 h-0.5 bg-gray-300 dark:bg-gray-600 rounded-full ${"bottom"===x?"-bottom-1":"-top-1"} z-0 transition-opacity duration-200`}),a(r,i,n,u?{ref:q(n),onDragStart:e=>((e,t)=>{u&&(v(t),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setData("text/plain",`internal-reorder-${t}`),!g&&L.current&&e.dataTransfer.setDragImage(L.current,-10,20))})(e,n),onDragEnd:Y,onMouseDown:()=>S(n),isDraggingOther:null!==b&&b!==n||null!==T&&T!==n||null!==w&&w!==n}:void 0,{onClick:e=>U(r,n,e)})]},r.id)})}),c&&s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:[d&&s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.length,y("common:selection.selected")]}),r&&s.jsx("button",{onClick:r,disabled:0===t.length,className:"px-4 py-1.5 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 text-gray-800 dark:text-gray-200 font-medium rounded transition-colors",children:y("common:selection.deselect")})]}),c]})]})}const ar=({dragHandleProps:e,onTouchStart:t,onTouchMove:r,onTouchEnd:a,isDragging:n=!1,disableNativeDrag:i=!1,className:o=""})=>s.jsx("div",{ref:e?.ref,draggable:!i&&!!e,"data-no-select":"true",onDragStart:t=>{e?.onDragStart&&e.onDragStart(t)},onMouseDown:t=>{t.stopPropagation(),e?.onMouseDown&&e.onMouseDown(t)},onDragEnd:e?.onDragEnd,onTouchStart:t,onTouchMove:r,onTouchEnd:a,className:`select-none cursor-grab active:cursor-grabbing ${n?"text-accent-light-500 dark:text-accent-dark-400":"text-gray-400"} ${o}`,style:{touchAction:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:s.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 16 16",children:[s.jsx("circle",{cx:"6",cy:"2",r:"1"}),s.jsx("circle",{cx:"10",cy:"2",r:"1"}),s.jsx("circle",{cx:"6",cy:"6",r:"1"}),s.jsx("circle",{cx:"10",cy:"6",r:"1"}),s.jsx("circle",{cx:"6",cy:"10",r:"1"}),s.jsx("circle",{cx:"10",cy:"10",r:"1"}),s.jsx("circle",{cx:"6",cy:"14",r:"1"}),s.jsx("circle",{cx:"10",cy:"14",r:"1"})]})}),nr=({isSelected:e,onToggle:t,children:r,actions:a,showDragHandle:n=!1,dragHandleProps:i,clickable:o=!0,className:l="",showCheckbox:c=!0,draggable:d=!1,onDragStart:u,onDragEnd:g})=>s.jsxs("div",{draggable:d,onDragStart:u,onDragEnd:g,className:`flex items-center gap-3 px-3 py-2 rounded-lg transition-colors ${e?"bg-accent-light-100 dark:bg-accent-dark-900/30 border-2 border-accent-light-500 dark:border-accent-dark-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 border-2 border-transparent"} ${l}`,children:[n&&s.jsx(ar,{dragHandleProps:i,className:"p-2 -m-2"}),c&&s.jsx("input",{type:"checkbox",checked:e,onChange:t,onClick:e=>e.stopPropagation(),className:"mt-1 w-5 h-5 rounded border-gray-300 text-accent-light-500 focus:ring-accent-light-500 dark:border-gray-600 dark:bg-gray-700 dark:text-accent-dark-500 dark:focus:ring-accent-dark-500 cursor-pointer"}),s.jsx("div",{className:"flex-1 min-w-0 "+(o?"cursor-pointer":""),onClick:o?t:void 0,children:r}),a&&s.jsx("div",{className:"flex-shrink-0 relative",children:a})]}),ir=a.createContext(void 0),sr=({children:e})=>{const[t,r]=a.useState([]),n={registerModal:a.useCallback(e=>{let t=9999;return r(r=>{if(r.find(t=>t.id===e))return r;const a=r.length>0?Math.max(...r.map(e=>e.zIndex)):9998;return t=a+1,[...r,{id:e,zIndex:t}]}),t},[]),unregisterModal:a.useCallback(e=>{r(t=>t.filter(t=>t.id!==e))},[]),bringToFront:a.useCallback(e=>{r(t=>{const r=t.find(t=>t.id===e);if(!r)return t;const a=Math.max(...t.map(e=>e.zIndex));if(r.zIndex===a)return t;const n=a+1;return t.map(t=>t.id===e?{...t,zIndex:n}:t)})},[]),getZIndex:a.useCallback(e=>{const r=t.find(t=>t.id===e);return r?.zIndex},[t])};return s.jsx(ir.Provider,{value:n,children:e})};var or=w();const lr=({isOpen:e,onClose:t,children:r,size:n="lg",maxHeight:i="90vh",closeOnBackdropClick:o=!0,closeOnEsc:l=!0,className:c="",animationClassName:d="",modalId:u})=>{const g=a.useId(),h=u||g,{registerModal:m,unregisterModal:p,bringToFront:x,getZIndex:f}=(()=>{const e=a.useContext(ir);if(void 0===e)throw new Error("useModal must be used within a ModalProvider");return e})();a.useEffect(()=>{if(e)return m(h),()=>{p(h)}},[e,h,m,p]);const y=a.useCallback(()=>{x(h),o&&t()},[h,o,t,x]),b=a.useCallback(e=>{e.stopPropagation(),x(h)},[h,x]);if(a.useEffect(()=>{if(!e||!l)return;const r=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[e,l,t]),!e)return null;const v=f(h)||9999,w="fullscreen"===n?"max-h-[98vh]":{"60vh":"max-h-[60vh]","80vh":"max-h-[80vh]","90vh":"max-h-[90vh]"}[i],S=s.jsx("div",{className:`fixed inset-0 flex items-center justify-center p-4 bg-black/50 ${d}`,style:{zIndex:v},onClick:y,children:s.jsx("div",{className:`flex flex-col bg-white dark:bg-gray-800 rounded-lg shadow-xl ${{sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl",fullscreen:"max-w-[98vw]"}[n]} w-full ${w} ${c}`,onClick:b,children:r})});return or.createPortal(S,document.body)},cr=({title:e,onClose:t,closeButtonLabel:r,actions:a,showCloseButton:n=!0,sticky:i=!0,className:o=""})=>{const l=i?"sticky top-0 bg-white dark:bg-gray-800 rounded-tl-lg rounded-tr-lg border-b border-gray-200 dark:border-gray-700":"border-b border-gray-200 dark:border-gray-700";return s.jsxs("div",{className:`${l} px-6 py-4 flex justify-between items-center ${o}`,children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white",children:e}),s.jsxs("div",{className:"flex items-center gap-2",children:[a,n&&t&&s.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors text-gray-800 dark:text-gray-200","aria-label":r||"Close",children:s.jsx(ct,{name:"close"})})]})]})},dr=({children:e,padding:t=!0,scrollable:r=!1,className:a=""})=>{const n=["text-gray-700 dark:text-gray-300",t?"px-6 py-4":"",...r?["overflow-y-auto","flex-1","min-h-0"]:[],a].filter(Boolean).join(" ");return s.jsx("div",{className:n,children:e})},ur=({children:e,sticky:t=!1,align:r="right",className:a=""})=>{const n=t?"sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700":"border-t border-gray-200 dark:border-gray-700";return s.jsx("div",{className:`${n} px-6 py-4 flex ${{left:"justify-start",center:"justify-center",right:"justify-end","space-between":"justify-between"}[r]} gap-3 ${a}`,children:e})},gr=({isOpen:e,buttonRef:t,items:r,onClose:n,iconClassName:o="w-4 h-4",customContentBefore:l,customContentAfter:c})=>{const d=a.useRef(null),[u,g]=a.useState({top:0,left:0,right:"auto"});a.useEffect(()=>{if(e&&t.current){const e=t.current.getBoundingClientRect(),a=176,n=window.innerWidth,i=window.innerHeight;let s=e.right-a;const o="auto";s<8&&(s=e.left,s+a>n-8&&(s=Math.max(8,n-a-8)));let l=e.bottom+4;const c=40*r.length+20;l+c>i-8&&(l=e.top-c-4,l<8&&(l=e.bottom+4)),g({top:l,left:s,right:o})}},[e,t,r.length]),a.useEffect(()=>{const r=e=>{d.current&&!d.current.contains(e.target)&&t.current&&!t.current.contains(e.target)&&n()};if(e)return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[e,n,t]),a.useEffect(()=>{if(!e)return;const a=()=>{if(t.current){const e=t.current.getBoundingClientRect(),a=176,n=window.innerWidth,i=window.innerHeight;let s=e.right-a;const o="auto";s<8&&(s=e.left,s+a>n-8&&(s=Math.max(8,n-a-8)));let l=e.bottom+4;const c=40*r.length+20;l+c>i-8&&(l=e.top-c-4,l<8&&(l=e.bottom+4)),g({top:l,left:s,right:o})}};return window.addEventListener("scroll",a,!0),window.addEventListener("resize",a),()=>{window.removeEventListener("scroll",a,!0),window.removeEventListener("resize",a)}},[e,t,r.length]);return e?or.createPortal(s.jsxs("div",{ref:d,className:"fixed w-44 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[9999] overflow-hidden border border-gray-200 dark:border-gray-600 transition-opacity opacity-100",style:{top:`${u.top}px`,left:`${u.left}px`,right:u.right},children:[l&&s.jsx("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",onMouseDown:e=>e.stopPropagation(),children:l}),r.map((e,t)=>s.jsxs(i.Fragment,{children:[e.separator&&t>0&&s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600"}),s.jsxs("button",{onClick:t=>{t.stopPropagation(),(0,e.onClick)(),n()},disabled:e.disabled,title:e.title,className:"w-full px-4 py-2.5 text-left transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed "+(e.danger?"hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400":"hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white"),children:[e.customIcon?e.customIcon:e.icon?s.jsx(ct,{name:e.icon,className:o}):s.jsx("div",{className:o}),s.jsx("span",{className:"text-sm",children:e.label})]})]},e.id)),c&&s.jsx("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-600",children:c})]}),document.body):null},hr=({buttonRef:e,onClick:t,title:r,icon:a="dots-vertical",customIcon:n,iconClassName:i="w-4 h-4",isSelected:o=!1})=>s.jsx("button",{ref:e,onClick:e=>{e.stopPropagation(),t(e)},className:"w-8 h-8 rounded transition-colors inline-flex items-center justify-center "+(o?"text-accent-light-800/75 dark:text-accent-dark-400 hover:bg-accent-light-500/20 dark:hover:bg-accent-dark-700/50":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),title:r,children:n||s.jsx(ct,{name:a,className:i})}),mr=e=>{const{placeholder:t="Select...",options:r,headerContent:n,groupOrder:i,className:o="",buttonClassName:l="",menuClassName:c="",triggerLabel:d,renderOption:u,disabled:g=!1,multiple:h=!1,closeOnSelect:m=!h}=e,[p,x]=a.useState(!1),[f,y]=a.useState("left"),b=a.useRef(null),v=a.useRef(null);let w;if(void 0!==d)w=d;else if(h){const a=e.value||[];if(0===a.length)w=t;else{w=r.filter(e=>a.includes(e.id)).map(e=>e.label).join(", ")}}else{const a=e,n=r.find(e=>e.id===a.value);w=n?n.label:t}a.useLayoutEffect(()=>{if(p&&v.current&&b.current){const e=v.current.getBoundingClientRect(),t=b.current.getBoundingClientRect(),r=window.innerWidth;if(e.left+t.width>r-10){const r=e.right-t.width<10;y(r?"center":"right")}else y("left")}},[p]),a.useEffect(()=>{const e=e=>{p&&b.current&&!b.current.contains(e.target)&&v.current&&!v.current.contains(e.target)&&x(!1)};return p&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[p]);const S=r.reduce((e,t)=>{const r=t.group||"__default__";return e[r]||(e[r]=[]),e[r].push(t),e},{});let k=Object.keys(S);i&&(k=k.sort((e,t)=>{const r=i.indexOf(e),a=i.indexOf(t);return-1===r&&-1===a?0:-1===r?1:-1===a?-1:r-a})),k.sort((e,t)=>"__default__"===e?-1:"__default__"===t?1:i?0:e.localeCompare(t));const C=u||((e,t)=>h?s.jsxs("div",{className:"flex items-center gap-2 w-full",children:[s.jsx("div",{className:`\n            w-5 h-5 rounded border flex items-center justify-center transition-colors flex-shrink-0\n            ${t?"bg-accent-light-500 border-accent-light-500 dark:bg-accent-dark-500 dark:border-accent-dark-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"}\n          `,children:t&&s.jsx(ct,{name:"check",className:"w-3 h-3 text-white",strokeWidth:3})}),s.jsx("span",{className:"text-sm flex-1 truncate "+(t?"text-gray-900 dark:text-gray-100 font-medium":"text-gray-700 dark:text-gray-300"),children:e.label})]}):s.jsxs("div",{className:"flex items-center gap-2 w-full",children:[s.jsx("div",{className:`\n          w-5 h-5 rounded-full border flex items-center justify-center transition-colors flex-shrink-0\n          ${t?"bg-accent-light-500 border-accent-light-500 dark:bg-accent-dark-500 dark:border-accent-dark-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"}\n        `,children:t&&s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsx("span",{className:"text-sm flex-1 truncate "+(t?"text-gray-900 dark:text-gray-100 font-medium":"text-gray-700 dark:text-gray-300"),children:e.label})]}));return s.jsxs("div",{className:`relative ${o}`,children:[s.jsxs("button",{ref:v,onClick:()=>!g&&x(!p),disabled:g,className:`flex items-center justify-between gap-2 border rounded-md bg-white dark:bg-gray-700 transition-colors focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent ${g?"opacity-50 cursor-not-allowed":"hover:border-gray-400 dark:hover:border-gray-500"} ${l||"px-3 py-1.5 text-sm border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 w-auto min-w-[140px]"}`,children:[s.jsx("span",{className:"truncate",children:w}),s.jsx(ct,{name:"chevron-down",className:"w-3 h-3 transition-transform "+(p?"rotate-180":"")})]}),p&&s.jsxs("div",{ref:b,className:`absolute top-full mt-1 z-[100] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-y-auto flex flex-col ${"right"===f?"right-0":"center"===f?"left-1/2 -translate-x-1/2":"left-0"} ${c||"w-64 max-h-96"}`,children:[n&&s.jsx("div",{className:"border-b border-gray-100 dark:border-gray-700",children:n}),k.map(t=>{const r=S[t];return r&&0!==r.length?s.jsxs("div",{children:["__default__"!==t&&s.jsx("div",{className:"sticky top-0 bg-gray-50 dark:bg-gray-900/50 px-3 py-1.5 text-xs font-semibold text-gray-500 dark:text-gray-400",children:t}),s.jsx("div",{className:"p-2 space-y-1",children:r.map(t=>{const r=h?(e.value||[]).includes(t.id):e.value===t.id;return s.jsx("button",{onClick:()=>(t=>{if(h){const r=e,a=r.value||[];let n;n=a.includes(t)?a.filter(e=>e!==t):[...a,t],r.onChange(n)}else e.onChange(t);m&&x(!1)})(t.id),className:`\n                          w-full flex items-center gap-3 px-3 py-2.5 rounded transition-colors text-left\n                          ${r?"bg-accent-light-50 dark:bg-accent-dark-900/30":"hover:bg-gray-50 dark:hover:bg-gray-700"}\n                        `,children:C(t,r)},t.id)})})]},t):null})]})]})},pr=({checked:e,onChange:t,label:r,disabled:a=!1,size:n="medium",className:i=""})=>{const o={small:{switch:"h-5 w-9",slider:"h-3 w-3",translate:e?"translate-x-5":"translate-x-1"},medium:{switch:"h-6 w-11",slider:"h-4 w-4",translate:e?"translate-x-6":"translate-x-1"},large:{switch:"h-7 w-14",slider:"h-5 w-5",translate:e?"translate-x-8":"translate-x-1"}}[n];return s.jsx("button",{type:"button",role:"switch","aria-checked":e,"aria-label":r,onClick:()=>!a&&t(!e),disabled:a,className:`\n        relative inline-flex items-center rounded-full transition-colors\n        focus:outline-none focus:ring-2 focus:ring-offset-2\n        ring-offset-white dark:ring-offset-gray-800\n        dark:focus:ring-accent-dark-500 focus:ring-accent-light-500\n        ${e?"bg-accent-light-500 dark:bg-accent-dark-500":"bg-gray-300 dark:bg-gray-600"}\n        ${a?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n        ${o.switch}\n        ${i}\n      `,children:s.jsx("span",{className:`\n          inline-block transform rounded-full bg-white transition-transform\n          ${o.slider}\n          ${o.translate}\n        `})})},xr=({isOpen:e,triggerRef:t,options:r,value:n,onChange:i,onClose:o,renderOption:l,className:c="",minWidth:d,"aria-label":u})=>{const g=a.useRef(null),[h,m]=a.useState(void 0),p=a.useCallback(()=>{if(!t.current||!g.current)return;const e=t.current.getBoundingClientRect(),r=g.current.getBoundingClientRect(),a=window.innerWidth,n=window.innerHeight;let i=e.right-r.width;i<8&&(i=e.left,i+r.width>a-8&&(i=Math.max(8,a-r.width-8)));let s=e.bottom+4;s+r.height>n-8&&(s=e.top-r.height-4,s<8&&(s=e.bottom+4)),m({top:s,left:i,right:"auto"})},[t]);a.useEffect(()=>{e&&t.current&&requestAnimationFrame(()=>{p()})},[e,t,p]),a.useEffect(()=>{if(e)return window.addEventListener("scroll",p,!0),window.addEventListener("resize",p),()=>{window.removeEventListener("scroll",p,!0),window.removeEventListener("resize",p)}},[e,p]),a.useEffect(()=>{if(!e)return;const r=e=>{g.current&&!g.current.contains(e.target)&&t.current&&!t.current.contains(e.target)&&o()},a=setTimeout(()=>{document.addEventListener("mousedown",r)},0);return()=>{clearTimeout(a),document.removeEventListener("mousedown",r)}},[e,o,t]),a.useEffect(()=>{if(!e)return;const t=e=>{"Escape"===e.key&&o()};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[e,o]);const x=l||((e,t)=>s.jsx("span",{className:t?"font-medium":"",children:e.label}));return e?or.createPortal(s.jsx("div",{ref:g,className:`fixed bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-1 z-[99999] ${c}`,style:{top:h?`${h.top}px`:"-9999px",left:h?`${h.left}px`:"-9999px",right:h?.right,minWidth:d?`${d}px`:void 0,opacity:h?1:0,transition:"opacity 0.1s"},children:s.jsx("ul",{role:"listbox","aria-label":u,children:r.map((e,t)=>{const r=e.value===n;return s.jsx("li",{children:s.jsx("button",{type:"button",onClick:()=>{e.disabled||i(e.value)},disabled:e.disabled,className:`w-full text-left px-4 py-2 text-sm transition-colors flex items-center justify-between ${r?"bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white font-medium":"hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200"} ${e.disabled?"opacity-50 cursor-not-allowed":""}`,role:"option","aria-selected":r,"aria-disabled":e.disabled,children:x(e,r)})},t)})})}),document.body):null},fr=({displayValue:e,isOpen:t,onClick:r,buttonRef:a,className:n="","aria-label":i})=>{const o=n||"flex items-center gap-1 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none text-sm font-medium";return s.jsxs("button",{ref:a,onClick:r,className:o,"aria-label":i,"aria-haspopup":"listbox","aria-expanded":t,children:[e,s.jsx(ct,{name:"chevron-down",className:"w-4 h-4 transition-transform "+(t?"rotate-180":""),strokeWidth:2})]})};function yr({value:e,options:t,onChange:r,placeholder:n="Select...",className:i="",maxHeight:o="300px",ariaLabel:l,t:c=e=>e}){const[d,u]=a.useState(!1),g=a.useRef(null),h=a.useRef(null);a.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&u(!1)};if(d)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[d]),a.useEffect(()=>{const e=e=>{"Escape"===e.key&&d&&(u(!1),h.current?.focus())};if(d)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]);return s.jsxs("div",{ref:g,className:`relative ${i}`,children:[s.jsxs("button",{ref:h,type:"button",onClick:()=>u(!d),className:"px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center gap-1 min-w-[120px] justify-between","aria-label":l,"aria-expanded":d,children:[s.jsx("span",{className:"truncate",children:(()=>{if(0===e.length)return n;const r=e.map(e=>t.find(t=>t.value===e)?.label).filter(Boolean);return 1===r.length?r[0]:r.length===t.length?c("common:allColumns"):c("common:columnsSelected",{count:r.length})})()}),s.jsx(ct,{name:d?"chevron-up":"chevron-down",className:"w-4 h-4 flex-shrink-0"})]}),d&&s.jsxs("div",{className:"absolute z-50 mt-1 w-64 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg overflow-hidden",style:{maxHeight:o},children:[s.jsxs("div",{className:"flex gap-2 px-3 py-2 bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700",children:[s.jsx("button",{type:"button",onClick:()=>{r(t.map(e=>e.value))},className:"flex-1 text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300",children:c("common:selectAll")||"Select All"}),s.jsx("button",{type:"button",onClick:()=>{r([])},className:"flex-1 text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300",children:c("common:deselectAll")||"Deselect All"})]}),s.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(300px - 48px)"},children:t.map(t=>s.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:e.includes(t.value),onChange:()=>{return a=t.value,void(e.includes(a)?r(e.filter(e=>e!==a)):r([...e,a]));var a},className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-accent-light-500 dark:text-accent-dark-400 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-400"}),s.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:t.label})]},t.value))})]})]})}function br(e){return 0===e.length?"":e.map(e=>{if("single"===e.type)return String(e.value);if("range"===e.type)return`${e.min}-${e.max}`;if("modulo"===e.type){const{divisor:t,offset:r}=e;return 0===r?`${t}n`:r>0?`${t}n+${r}`:`${t}n${r}`}return"max"===e.type?"max":"min"===e.type?"min":""}).join(", ")}function vr(e){const t=[];return(isNaN(e.diceCount)||e.diceCount<1||e.diceCount>et)&&t.push({field:"diceCount",message:"ダイスの数は1〜10の範囲で指定してください"}),(isNaN(e.diceFaces)||e.diceFaces<1||e.diceFaces>tt)&&t.push({field:"diceFaces",message:"面の数は1〜9999の範囲で指定してください"}),e.modifierSign&&(isNaN(e.modifierValue)||e.modifierValue<0||e.modifierValue>rt)&&t.push({field:"modifierValue",message:"修正値は0〜99999の範囲で指定してください"}),t}function wr(e){const t=[];return(isNaN(e)||e<1||e>at)&&t.push({field:"trialCount",message:"試行回数は1〜1000の範囲で指定してください"}),t}function Sr(e,t){return[...vr(e),...wr(t)]}function kr(e){if(!e.trim())return{conditions:[],normalizedInput:""};const t=e.replace(/[^\d,\s\-+na-z\u3001\u3000]/gi,"");if(!t.trim())return{conditions:[],normalizedInput:""};const r=t.split(/[,、\s\u3000]+/).map(e=>e.trim()).filter(e=>e.length>0);if(0===r.length)return{conditions:[],normalizedInput:""};const a=[],n=new Set;for(const s of r){const e=s.toLowerCase();if("max"===e){const e="max";n.has(e)||(n.add(e),a.push({type:"max"}));continue}if("min"===e){const e="min";n.has(e)||(n.add(e),a.push({type:"min"}));continue}const t=s.match(/^(\d+)n([+-]\d+)?$/);if(t){const e=parseInt(t[1],10),r=t[2];let i=r?parseInt(r,10):0;if(isNaN(e)||0===e)return{conditions:[],error:`無効な倍数指定: "${s}"`};i=(i%e+e)%e;const o=`modulo:${e}:${i}`;n.has(o)||(n.add(o),a.push({type:"modulo",divisor:e,offset:i}));continue}if(s.includes("-")){const e=s.split("-").filter(e=>e.length>0);if(2!==e.length)return{conditions:[],error:`不正な範囲指定: "${s}"`};const t=parseInt(e[0],10),r=parseInt(e[1],10);if(isNaN(t)||isNaN(r))return{conditions:[],error:`範囲指定に無効な値: "${s}"`};const i=Math.max(1,Math.min(tt,t)),o=Math.max(1,Math.min(tt,r)),l=Math.min(i,o),c=Math.max(i,o),d=`range:${l}-${c}`;n.has(d)||(n.add(d),a.push({type:"range",min:l,max:c}))}else{const e=parseInt(s,10);if(isNaN(e))return{conditions:[],error:`無効な数値: "${s}"`};const t=Math.max(1,Math.min(tt,e)),r=`single:${t}`;n.has(r)||(n.add(r),a.push({type:"single",value:t}))}}const i=a.map(e=>"single"===e.type?`${e.value}`:"range"===e.type?`${e.min}-${e.max}`:"modulo"===e.type?0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"max"===e.type?"max":"min"===e.type?"min":"").join(", ");return{conditions:a,normalizedInput:i}}function Cr(e){return e.targets&&e.targets.length>0?e.targets:e.target?[e.target]:["total"]}function jr(e,t,r){return!(!t||0===t.length)&&t.some(t=>{if("single"===t.type)return e===t.value;if("range"===t.type)return e>=t.min&&e<=t.max;if("modulo"===t.type)return e>=t.offset&&(e-t.offset)%t.divisor===0;if("max"===t.type){if(!r||0===r.length)return!1;const t=Math.max(...r);return e===t}if("min"===t.type){if(!r||0===r.length)return!1;const t=Math.min(...r);return e===t}return!1})}const Dr=(e,t=1)=>`rgba(${getComputedStyle(document.documentElement).getPropertyValue(e).trim()}, ${t})`,Nr=(e,t=1)=>Dr(e?"--chart-accent-dark":"--chart-accent-light",t),Ar=(e=1)=>Dr("--chart-median",e),Tr=[{light:"rgb(59, 130, 246)",dark:"rgb(96, 165, 250)"},{light:"rgb(239, 68, 68)",dark:"rgb(248, 113, 113)"},{light:"rgb(34, 197, 94)",dark:"rgb(74, 222, 128)"},{light:"rgb(168, 85, 247)",dark:"rgb(192, 132, 252)"},{light:"rgb(249, 115, 22)",dark:"rgb(251, 146, 60)"},{light:"rgb(236, 72, 153)",dark:"rgb(244, 114, 182)"},{light:"rgb(14, 165, 233)",dark:"rgb(56, 189, 248)"},{light:"rgb(132, 204, 22)",dark:"rgb(163, 230, 53)"},{light:"rgb(244, 63, 94)",dark:"rgb(251, 113, 133)"},{light:"rgb(99, 102, 241)",dark:"rgb(129, 140, 248)"}],Mr=(e,t,r=1)=>{const a=Tr[e%Tr.length];return`rgba(${(t?a.dark:a.light).replace("rgb(","").replace(")","")}, ${r})`},Er=[{key:"accent",label:"アクセント",light:"rgb(59, 130, 246)",dark:"rgb(139, 92, 246)",textLight:"rgb(30, 58, 138)",textDark:"rgb(237, 233, 254)"},{key:"blue",label:"青",light:"rgb(59, 130, 246)",dark:"rgb(96, 165, 250)",textLight:"rgb(30, 58, 138)",textDark:"rgb(219, 234, 254)"},{key:"red",label:"赤",light:"rgb(239, 68, 68)",dark:"rgb(248, 113, 113)",textLight:"rgb(127, 29, 29)",textDark:"rgb(254, 226, 226)"},{key:"green",label:"緑",light:"rgb(34, 197, 94)",dark:"rgb(74, 222, 128)",textLight:"rgb(20, 83, 45)",textDark:"rgb(220, 252, 231)"},{key:"purple",label:"紫",light:"rgb(168, 85, 247)",dark:"rgb(192, 132, 252)",textLight:"rgb(88, 28, 135)",textDark:"rgb(243, 232, 255)"},{key:"orange",label:"オレンジ",light:"rgb(249, 115, 22)",dark:"rgb(251, 146, 60)",textLight:"rgb(124, 45, 18)",textDark:"rgb(254, 243, 199)"},{key:"pink",label:"ピンク",light:"rgb(236, 72, 153)",dark:"rgb(244, 114, 182)",textLight:"rgb(131, 24, 67)",textDark:"rgb(252, 231, 243)"},{key:"yellow",label:"黄色",light:"rgb(234, 179, 8)",dark:"rgb(250, 204, 21)",textLight:"rgb(113, 63, 18)",textDark:"rgb(254, 249, 195)"}],Rr=e=>{const t=e||"accent";return Er.find(e=>e.key===t)||Er[0]},Ir=(e,t,r=1)=>{const a=Rr(e),n=t?a.dark:a.light,i=n.replace("rgb(","").replace(")","");return 1===r?n:`rgba(${i}, ${r})`},Lr=(e,t)=>{const r=Rr(e);return t?r.textDark:r.textLight};function Or(e,t){const r=function(e,t,r){if(t&&0!==t.length)return t.find(t=>{if("single"===t.type)return e===t.value;if("range"===t.type)return e>=t.min&&e<=t.max;if("modulo"===t.type)return e>=t.offset&&(e-t.offset)%t.divisor===0;if("max"===t.type){if(!r||0===r.length)return!1;const t=Math.max(...r);return e===t}if("min"===t.type){if(!r||0===r.length)return!1;const t=Math.min(...r);return e===t}return!1})}(e,t.highlightConditions,t.allValues);if(!r)return;const{isDarkMode:a,alphaBackground:n=1,alphaBorder:i}=t,s={backgroundColor:Ir(r.color,a,n),color:Lr(r.color,a)};return void 0!==i&&(s.borderColor=Ir(r.color,a,i)),s}const Fr=({value:e,onChange:t,size:r="md",layout:n="row",className:i=""})=>{const[o,l]=a.useState(document.documentElement.classList.contains("dark"));a.useEffect(()=>{const e=new MutationObserver(()=>{l(document.documentElement.classList.contains("dark"))});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]);const c="sm"===r?"w-5 h-5":"w-6 h-6",d="sm"===r?"w-3 h-3":"w-4 h-4",u="grid"===n?"grid grid-cols-4 gap-2":"flex items-center gap-1";return s.jsx("div",{className:`${u} ${i}`,children:Er.map(r=>{const a=e===r.key,n="accent"===r.key,i=n?{background:"linear-gradient(45deg, #eee 0%, #eee 50%, #444 50%, #444 100%)"}:{backgroundColor:o?r.dark:r.light};return s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),t(r.key)},className:`${c} rounded-full flex items-center justify-center transition-all ${a?"ring-2 ring-offset-1 ring-gray-700 dark:ring-gray-300 dark:ring-offset-gray-800":"hover:scale-110"}`,style:i,title:n?`${r.label} (ライト/ダーク)`:r.label,"aria-label":`${r.label}を選択`,"aria-pressed":a,children:a&&s.jsx(ct,{name:"check",className:`${d} ${n?"text-blue-500 drop-shadow-[0_0_2px_rgba(255,255,255,0.8)]":"text-white drop-shadow-[0_1px_1px_rgba(0,0,0,0.5)]"}`})},r.key)})})},Pr=({color:e})=>{const t=Rr(e);return"accent"===e?s.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 dark:border-gray-600",style:{background:"linear-gradient(45deg, #eee 0%, #eee 50%, #444 50%, #444 100%)"},title:t.label}):s.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 dark:border-gray-600",style:{backgroundColor:t.light},title:t.label})},$r=({targets:e,input:t,color:r,targetOptions:n,onChange:i,onRemove:o,onAdd:l,error:c,dragHandleProps:d,onDragOver:u,onDrop:g,onTouchStart:h,onTouchMove:m,onTouchEnd:p,onTouchCancel:x,style:f,isDragging:y=!1,isDropTarget:b=!1,showTargetSelector:v=!0,canRemove:w=!0,placeholder:S="例: 1, 6 または 1-6, 2n, 3n+1, max, min",showMaxMinBadges:k=!0,t:C,className:j="",borderStyle:D="none"})=>{const[N,A]=a.useState(!1),T=a.useRef(null),M=k&&t.toLowerCase().includes("max"),E=k&&t.toLowerCase().includes("min"),R=Rr(r),I="border"===D?b?"border border-accent-light-500 dark:border-accent-dark-500 bg-accent-light-50 dark:bg-accent-dark-900/20":"border border-gray-300 dark:border-gray-600":b?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500":"";return s.jsxs("div",{className:`flex gap-2 items-center p-2 rounded ${I} ${y?"opacity-50":""} ${j}`,style:f,draggable:!1,onDragOver:u,onDrop:g,onTouchStart:h,onTouchMove:m,onTouchEnd:p,onTouchCancel:x,children:[s.jsx(ar,{dragHandleProps:d,onTouchStart:h,onTouchMove:m,onTouchEnd:p,isDragging:y}),v&&s.jsx(yr,{value:e,options:n,onChange:e=>{i(e,t,r)},placeholder:C("common:selectColumns")||"Select columns",ariaLabel:C("common:aria.selectTargetColumns")||"Select target columns",t:C}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",value:t,onChange:t=>i(e,t.target.value,r),placeholder:S,className:"w-full px-2 py-1.5 text-sm border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(c?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")}),(M||E)&&s.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1",children:[M&&s.jsxs("div",{className:"flex items-center gap-0.5 px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 border border-green-300 dark:border-green-700",title:C("common:max")||"最大値",children:[s.jsx(ct,{name:"chevron-up",className:"w-3 h-3"}),s.jsx("span",{children:"max"})]}),E&&s.jsxs("div",{className:"flex items-center gap-0.5 px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-300 dark:border-blue-700",title:C("common:min")||"最小値",children:[s.jsx(ct,{name:"chevron-down",className:"w-3 h-3"}),s.jsx("span",{children:"min"})]})]})]}),c&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:c})]}),s.jsxs("div",{onMouseDown:e=>e.stopPropagation(),children:[s.jsx(hr,{buttonRef:T,onClick:()=>A(!N),title:`${C("common:highlightColor")||"ハイライト色"}: ${R.label}`,customIcon:s.jsx(Pr,{color:r})}),s.jsx(gr,{isOpen:N,buttonRef:T,items:[],onClose:()=>A(!1),customContentBefore:s.jsxs("div",{className:"px-4 py-3",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:C("common:highlightColor")||"ハイライト色"}),s.jsx(Fr,{value:r,onChange:r=>{i(e,t,r),A(!1)},size:"sm",layout:"grid"})]})})]}),s.jsx("button",{onClick:l,className:"p-1.5 text-accent-light-500 dark:text-accent-dark-400 hover:bg-accent-light-50 dark:hover:bg-accent-dark-900/20 rounded","aria-label":C("common:aria.addFilterCondition"),title:C("common:addBelow")||"この項目の下に条件を追加",children:s.jsx(ct,{name:"plus-circle",className:"w-5 h-5"})}),w&&s.jsx("button",{onClick:o,className:"p-1.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded","aria-label":C("common:aria.removeFilterCondition"),title:C("common:remove")||"削除",children:s.jsx(ct,{name:"close",className:"w-4 h-4"})})]})};function Wr({items:e,onReorder:t,enabled:r=!0,dragPreviewRef:n}){const[i,s]=a.useState(null),[o,l]=a.useState(null),[c,d]=a.useState(null),[u,g]=a.useState(null),[h,m]=a.useState(null),[p,x]=a.useState(null),f=a.useRef(new Map),y=a.useCallback(e=>(f.current.has(e)||f.current.set(e,{current:null}),f.current.get(e)),[]),b=a.useCallback((e,t)=>{r&&(s(t),e.dataTransfer.effectAllowed="move",n?.current&&e.dataTransfer.setDragImage(n.current,-10,20))},[r,n]),v=a.useCallback(e=>{r&&(e.target.style.opacity="1",s(null),l(null))},[r]),w=a.useCallback((e,t)=>{r&&(e.preventDefault(),e.dataTransfer.dropEffect="move",null!==i&&i!==t&&o!==t&&l(t))},[r,i,o]),S=a.useCallback((a,n)=>{if(!r)return;if(a.preventDefault(),null===i||i===n)return;const o=[...e],[c]=o.splice(i,1);o.splice(n,0,c),t(o),s(null),l(null)},[r,i,e,t]),k=a.useCallback((e,t)=>{if(!r)return;const a=e.target,n=y(t).current;if(!n||!n.contains(a))return;e.stopPropagation(),e.preventDefault();const i=e.currentTarget;x(i.getBoundingClientRect()),g(e.touches[0].clientY),m(e.touches[0].clientY),d(t)},[r,y]),C=a.useCallback((t,a)=>{if(!r||c!==a||null===u)return;t.preventDefault(),t.stopPropagation();const n=t.touches[0].clientY;m(n);const i=t.currentTarget.getBoundingClientRect().height,s=n-u,o=.5*i;if(Math.abs(s)>o){const t=Math.round(s/i),r=Math.max(0,Math.min(e.length-1,a+t));l(r!==a?r:null)}else l(null)},[r,c,u,e.length]),j=a.useCallback(a=>{if(r&&c===a){if(null!==o&&o!==a){const r=[...e],[n]=r.splice(a,1);r.splice(o,0,n),t(r)}x(null),g(null),m(null),d(null),l(null)}},[r,c,o,e,t]),D=a.useCallback(e=>{r&&c===e&&(x(null),g(null),m(null),d(null),l(null))},[r,c]),N=a.useCallback(e=>({ref:y(e),onDragStart:t=>b(t,e),onDragEnd:v,isDraggingOther:null!==i&&i!==e||null!==c&&c!==e}),[y,b,v,i,c]),A=a.useCallback(e=>{const t=i===e,r={};if(c===e&&null!==u&&null!==h&&p){const e=h-u;r.position="fixed",r.top=p.top+e,r.left=p.left,r.width=p.width,r.zIndex=1e3,r.pointerEvents="none",r.transition="none",r.opacity=.7}else r.transition="all 0.2s",r.opacity=t?.5:1;return r},[i,c,u,h,p]),T=a.useCallback(e=>i===e||c===e,[i,c]),M=a.useCallback(e=>o===e&&(null!==i||null!==c)&&i!==e&&c!==e,[o,i,c]);return{draggedIndex:i,dropTargetIndex:o,touchDraggedIndex:c,touchStartY:u,touchCurrentY:h,dragStartRect:p,dragHandleRefs:f,handleDragStart:b,handleDragEnd:v,handleDragOver:w,handleDrop:S,handleTouchStart:k,handleTouchMove:C,handleTouchEnd:j,handleTouchCancel:D,getDragHandleRef:y,getDragHandleProps:N,getItemStyle:A,isItemDragging:T,isItemDropTarget:M}}const Vr=({value:e,onChange:t,showTargetSelector:r=!1,targetOptions:n=[],t:i})=>{const[o,l]=a.useState(()=>{return(t=e)&&0!==t.length?t.map(e=>({id:crypto.randomUUID(),targets:Cr(e),input:br([e]),color:e.color||"accent"})):[{id:crypto.randomUUID(),targets:["total"],input:"",color:"accent"}];var t}),c=e=>{const a=[],n=[];e.forEach((e,t)=>{if(!e.input.trim())return;const i=kr(e.input);i.error?n.push({index:t,error:i.error}):i.conditions.forEach(t=>{a.push({...t,targets:r?e.targets:void 0,color:e.color})})});const i=e.map((e,t)=>{const r=n.find(e=>e.index===t);return r?{...e,error:r.error}:{...e,error:void 0}});JSON.stringify(i)!==JSON.stringify(e)&&l(i),t(a)},{draggedIndex:d,dropTargetIndex:u,handleDragOver:g,handleDrop:h,handleTouchStart:m,handleTouchMove:p,handleTouchEnd:x,getDragHandleProps:f}=Wr({items:o,onReorder:e=>{l(e),c(e)}});return s.jsx("div",{className:"space-y-2",children:o.map((e,t)=>s.jsx($r,{targets:e.targets,input:e.input,color:e.color,error:e.error,showTargetSelector:r,targetOptions:n,onChange:(e,r,a)=>((e,t)=>{const r=[...o];r[e]={...r[e],...t},l(r),c(r)})(t,{targets:e,input:r,color:a}),onAdd:()=>(e=>{const t=[...o];t.splice(e+1,0,{id:crypto.randomUUID(),targets:["total"],input:"",color:"accent"}),l(t),c(t)})(t),onRemove:()=>(e=>{if(1===o.length){const e=[{id:crypto.randomUUID(),targets:["total"],input:"",color:"accent"}];l(e),c(e)}else{const t=o.filter((t,r)=>r!==e);l(t),c(t)}})(t),onDragOver:e=>g(e,t),onDrop:e=>h(e,t),onTouchStart:e=>m(e,t),onTouchMove:e=>p(e,t),onTouchEnd:()=>x(t),isDragging:d===t,isDropTarget:u===t,dragHandleProps:f(t),canRemove:o.length>1,placeholder:i("charts:recentRolls.highlightPlaceholder"),showMaxMinBadges:!1,t:i},e.id))})},Br=[{value:"ja",label:"日本語",displayValue:"JA"},{value:"en",label:"English",displayValue:"EN"}],Hr=a.lazy(()=>D(()=>import("./index-E9JDBaEh.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.HelpModal}))),zr=a.lazy(()=>D(()=>import("./index-E9JDBaEh.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.SettingsModal})));i.memo(({darkMode:e,onToggleDarkMode:t,onAboutClick:r,onChangelogClick:n,themeMode:i,onChangeThemeMode:o,transparentExport:l,onChangeTransparentExport:c,onExportData:d,onImportData:u,diceSetsCount:g,chartSettingsCount:h,chartHeightSettings:m,onChangeChartHeightSettings:p})=>{const{i18n:x,t:f}=$e("common"),[y,b]=a.useState(!1),[v,w]=a.useState(!1),[S,k]=a.useState(!0),[C,j]=a.useState(!1),D=a.useRef(0),N=a.useRef(null),A=f("common:siteName");a.useEffect(()=>{const e=()=>{if(window.innerWidth>=768)return void k(!0);const e=window.scrollY;if(e<=0)return k(!0),void(D.current=e);Math.abs(e-D.current)<10||(e>D.current?k(!1):k(!0),D.current=e)};return e(),window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]);const T=Br.find(e=>e.value===x.language)||Br[0];return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"h-18 fixed top-0 left-0 right-0 z-[500] border-b border-gray-200 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm text-gray-800 dark:text-white py-2 px-4 transition-all duration-300 "+(S?"translate-y-0":"-translate-y-full"),children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center flex-1 min-w-0 mr-2",children:[s.jsx("div",{className:"mr-2 flex-shrink-0",children:s.jsx(ct,{name:"site-logo",className:"w-10 h-10",strokeWidth:1})}),s.jsx("h1",{className:"text-xl font-bold truncate",children:A})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(fr,{displayValue:s.jsx("span",{children:T.displayValue}),isOpen:C,onClick:()=>j(e=>!e),buttonRef:N,"aria-label":f("label.toggleLanguage")}),s.jsx(xr,{isOpen:C,triggerRef:N,options:Br,value:x.language,onChange:e=>{x.language!==e&&(x.changeLanguage(e),_t(e)),j(!1)},onClose:()=>j(!1),renderOption:e=>s.jsxs(s.Fragment,{children:[s.jsx("span",{children:e.label}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.displayValue})]}),minWidth:160,"aria-label":f("label.toggleLanguage")}),s.jsx("button",{onClick:()=>b(!0),className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none","aria-label":f("label.help"),children:s.jsx(ct,{name:"help"})}),s.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none","aria-label":f("label.toggleTheme"),children:s.jsx(ct,{name:e?"moon":"sun"})}),s.jsx("button",{onClick:()=>w(!0),className:"hidden md:flex p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none mr-2 flex-shrink-0","aria-label":f("label.settings"),children:s.jsx(ct,{name:"settings"})})]})]})}),y&&s.jsx(a.Suspense,{fallback:null,children:s.jsx(Hr,{isOpen:y,onClose:()=>b(!1),onOpenAbout:r})}),v&&s.jsx(a.Suspense,{fallback:null,children:s.jsx(zr,{isOpen:v,onClose:()=>w(!1),darkMode:i,onChangeDarkMode:o,transparentExport:l,onChangeTransparentExport:c,onExportData:d,onImportData:u,diceSetsCount:g,chartSettingsCount:h,onAboutClick:r,onChangelogClick:n,chartHeightSettings:m,onChangeChartHeightSettings:p})})]})}),i.memo(()=>{const{t:e}=$e("common");return s.jsx("footer",{className:"mt-auto py-10 px-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:s.jsx("div",{className:"max-w-7xl mx-auto flex justify-center items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:s.jsxs("span",{children:["© 2025 ",e("siteName")]})})})});const{slice:Ur,forEach:qr}=[];const Yr=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Xr={create(e,t,r,a){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};r&&(n.expires=new Date,n.expires.setTime(n.expires.getTime()+60*r*1e3)),a&&(n.domain=a),document.cookie=function(e,t){const r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let a=`${e}=${encodeURIComponent(t)}`;if(r.maxAge>0){const e=r.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");a+=`; Max-Age=${Math.floor(e)}`}if(r.domain){if(!Yr.test(r.domain))throw new TypeError("option domain is invalid");a+=`; Domain=${r.domain}`}if(r.path){if(!Yr.test(r.path))throw new TypeError("option path is invalid");a+=`; Path=${r.path}`}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");a+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(a+="; Partitioned"),a}(e,t,n)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let a=0;a<r.length;a++){let e=r[a];for(;" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var _r={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return Xr.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:a,cookieDomain:n,cookieOptions:i}=t;r&&"undefined"!=typeof document&&Xr.create(r,e,a,n,i)}},Jr={name:"querystring",lookup(e){let t,{lookupQuerystring:r}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const a=e.substring(1).split("&");for(let n=0;n<a.length;n++){const e=a[n].indexOf("=");if(e>0){a[n].substring(0,e)===r&&(t=a[n].substring(e+1))}}}return t}},Kr={name:"hash",lookup(e){let t,{lookupHash:r,lookupFromHashIndex:a}=e;if("undefined"!=typeof window){const{hash:e}=window.location;if(e&&e.length>2){const n=e.substring(1);if(r){const e=n.split("&");for(let a=0;a<e.length;a++){const n=e[a].indexOf("=");if(n>0){e[a].substring(0,n)===r&&(t=e[a].substring(n+1))}}}if(t)return t;if(!t&&a>-1){const t=e.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(t))return;const r="number"==typeof a?a:0;return t[r]?.replace("/","")}}}return t}};let Qr=null;const Gr=()=>{if(null!==Qr)return Qr;try{if(Qr="undefined"!=typeof window&&null!==window.localStorage,!Qr)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){Qr=!1}return Qr};var Zr={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&Gr())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&Gr()&&window.localStorage.setItem(r,e)}};let ea=null;const ta=()=>{if(null!==ea)return ea;try{if(ea="undefined"!=typeof window&&null!==window.sessionStorage,!ea)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){ea=!1}return ea};var ra={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&ta())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&ta()&&window.sessionStorage.setItem(r,e)}},aa={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:r,language:a}=navigator;if(e)for(let n=0;n<e.length;n++)t.push(e[n]);r&&t.push(r),a&&t.push(a)}return t.length>0?t:void 0}},na={name:"htmlTag",lookup(e){let t,{htmlTag:r}=e;const a=r||("undefined"!=typeof document?document.documentElement:null);return a&&"function"==typeof a.getAttribute&&(t=a.getAttribute("lang")),t}},ia={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if("undefined"==typeof window)return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(r))return;const a="number"==typeof t?t:0;return r[a]?.replace("/","")}},sa={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const r="number"==typeof t?t+1:1,a="undefined"!=typeof window&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(a)return a[r]}};let oa=!1;try{document.cookie,oa=!0}catch(Li){}const la=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];oa||la.splice(1,1);class ca{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return qr.call(Ur.call(arguments,1),t=>{if(t)for(const r in t)void 0===e[r]&&(e[r]=t[r])}),e}(t,this.options||{},{order:la,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(_r),this.addDetector(Jr),this.addDetector(Zr),this.addDetector(ra),this.addDetector(aa),this.addDetector(na),this.addDetector(ia),this.addDetector(sa),this.addDetector(Kr)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach(e=>{if(this.detectors[e]){let r=this.detectors[e].lookup(this.options);r&&"string"==typeof r&&(r=[r]),r&&(t=t.concat(r))}}),t=t.filter(e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(e=>e.test(t)));var t}).map(e=>this.options.convertDetectedLanguage(e)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)}))}}ca.type="languageDetector";const da={button:{start:"開始",reroll:"振り直し",addRoll:"さらに振る",save:"保存",cancel:"キャンセル",close:"閉じる",delete:"削除",duplicate:"複製",edit:"編集",apply:"適用",confirm:"確認",create:"作成",export:"エクスポート",import:"インポート",copy:"コピー",reset:"リセット",ok:"OK",yes:"はい",no:"いいえ",back:"戻る",next:"次へ"},action:{edit:"編集",save:"保存",cancel:"キャンセル",delete:"削除",duplicate:"複製",create:"作成",close:"閉じる",change:"変更",lockPosition:"位置を固定",unlockPosition:"位置固定を解除",dragToMove:"ドラッグして移動",collapse:"折りたたむ",expand:"展開"},unit:{count:"件",piece:"個",times:"回",diceSet:"ダイスセット"},label:{loading:"読み込み中...",processing:"処理中...",noData:"データがありません",help:"ヘルプ",toggleTheme:"テーマ切り替え",toggleLanguage:"言語切り替え",settings:"設定",firstPage:"最初のページ",lastPage:"最後のページ",quantile:"分位点",aggregation:"集約",target:"対象",all:"すべて",preview:"プレビュー",list:"リスト",roll:"ロール",start:"開始",addMore:"さらに振る",noChanges:"変更なし",trial:"試行",dice:"ダイス",modifier:"補正",total:"合計",itemsPerPage:"表示件数",filter:"フィルター",clearFilter:"フィルターをクリア",highlight:"ハイライト",manage:"管理",filterSet:"フィルターセット",filterCondition:"フィルター条件",showOnlyHighlighted:"ハイライトのみ表示",trialNumber:"試行回数",offset:"オフセット",addCondition:"条件追加",removeCondition:"条件を削除",andCondition:"すべてに該当（AND）",orCondition:"いずれかに該当（OR）",conditionType:"条件の結合方法",fromHistory:"履歴から選択",clearHistory:"履歴をクリア",noHistory:"履歴なし"},filterOperator:{equals:"指定値と等しい",notEquals:"指定値と異なる",greaterThan:"指定値より大きい",lessThan:"指定値より小さい"},filterOperatorSymbol:{equals:"x = ",notEquals:"x ≠ ",greaterThan:"x > ",lessThan:"x < "},filterColumn:{all:"全て",trialNumber:"試行回数",dice:"ダイス{{index}}",modifier:"オフセット",total:"合計",trialNumberShort:"試行",modifierShort:"補正"},tableFilter:{itemsPerPage:"表示件数",filter:"フィルター",filterSet:"フィルターセット",editFilter:"フィルター編集",manageFilters:"フィルター管理",filteredCount:"{{filtered}}件 / 全{{total}}件",activeFilters:"フィルター条件",activeHighlights:"ハイライト条件",noActiveFilters:"フィルター条件なし",noActiveHighlights:"ハイライト条件なし",highlightSingle:"{{target}}: {{value}}",highlightRange:"{{target}}: {{min}}～{{max}}",highlightModulo:"{{target}}: {{divisor}}の倍数{{offset}}",highlightMax:"{{target}}: 最大値",highlightMin:"{{target}}: 最小値",conditions:"条件",conditionValueSingle:"= {{value}}",conditionValueRange:"{{min}} ~ {{max}}",conditionValueModulo:"{{divisor}}の倍数{{offset}}",conditionValueMax:"最大値",conditionValueMin:"最小値",moduloOffsetPlus:"+{{offset}}",moduloOffsetMinus:"-{{offset}}",moduloOffsetZero:"",showOnlyHighlighted:"ハイライトのみ表示",managerTitle:"フィルター設定管理",editorTitle:"フィルター設定",newFilterSet:"新規フィルターセット",createNew:"新規作成",filterSetName:"フィルターセット名",filterSetNamePlaceholder:"フィルターセット名を入力",currentFilterSet:"使用中",defaultFilterSet:"デフォルト",confirmDelete:"「{{name}}」を削除してもよろしいですか？",confirmDeleteMultiple:"選択した{{count}}件のフィルターセットを削除してもよろしいですか？",filterActive:"{{filtered}}件 / 全{{total}}件",conditionsActive:"{{count}}条件適用中",noMatchingResults:"フィルター条件に一致する結果がありません",importSuccess:"フィルターセットをインポートしました",importError:"インポート失敗: {{error}}",exportFileName:"フィルターセット",selectJsonFile:"JSONファイルを選択",invalidFileFormat:"無効なファイル形式です",maxNameLength:"名前は最大50文字です",moreOptions:"その他のオプション",deleteAll:"すべて削除",confirmDeleteAll:"デフォルト以外のすべてのフィルターセットを削除してもよろしいですか？",copySuffix:" (コピー)",filterConditionPresent:"フィルター条件あり",highlightPresent:"ハイライトあり"},actions:{select:"選択",exportSelected:"選択項目をエクスポート",import:"インポート",duplicateSelected:"選択を一括複製",deleteSelected:"選択を一括削除"},error:{unknown:"不明なエラー",deleteDefault:"デフォルト設定は削除できません",deleteFailed:"削除に失敗しました",saveFailed:"保存に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",deleteAllFailed:"全削除に失敗しました",noSelection:"削除可能な項目が選択されていません",noDuplicateSelection:"複製する項目が選択されていません"},itemsPerPageOption:{25:"25件",50:"50件",75:"75件",100:"100件"},aria:{itemsPerPage:"1ページあたりの表示件数",selectFilterSet:"フィルターセットを選択",manageFilterSets:"フィルターセットを管理",editFilterConditions:"フィルター条件を編集",filterTargetColumn:"フィルター対象カラム",filterOperator:"フィルター演算子",filterValue:"フィルター値",removeFilterCondition:"条件を削除",addFilterCondition:"条件追加",filterSetName:"フィルターセット名",selectTargetColumns:"対象列を選択"},punctuation:{comma:"、"},none:"なし",unnamed:"名称未設定",siteName:"てすとDice",menu:{options:"オプション",edit:"編集",duplicate:"複製",delete:"削除"},emptyState:{noItems:"アイテムがありません"},selection:{moving:"移動中...",selected:"{{count}}件選択中",deselect:"選択解除",delete:"削除"},selectAll:"すべて選択",deselectAll:"すべて解除",selectColumns:"列を選択",allColumns:"すべての列",columnsSelected:"{{count}}列選択中",custom:"カスタム"},ua={title:"ガイド",closeButton:"閉じる",aboutSection:{description:{before:"当アプリの詳細情報やプライバシーポリシーについては",after:"をご覧ください。"},linkText:"こちら"},basicSettings:{diceNotation:{title:"ダイス記法について",description:"ダイス記法は以下の形式で指定します：",format:"dice[個数]d[面数](+|-)[修正値]",parameters:{count:{label:"個数",description:"振るダイスの数（1〜10）"},sides:{label:"面数",description:"ダイスの面の数（1〜9,999）"},modifier:{label:"修正値",description:"オプション。結果に加算または減算する値（0〜99,999）"}}},examples:{title:"使用例",items:[{notation:"dice1d6",description:"→ 6面ダイスを1個振る"},{notation:"dice3d6+2",description:"→ 6面ダイスを3個振り、合計に2を加算"},{notation:"dice2d10-5",description:"→ 10面ダイスを2個振り、合計から5を減算"}]},trials:{title:"試行回数",description:"同じダイスロールを複数回実行できます（1〜1,000回）。\n試行回数を増やすことで、より正確な確率分布を確認できます。"}},diceSetManagement:{diceSetFeatures:{title:"ダイスセット機能",features:["各ダイスセットに任意の名前を付けて保存できます（最大128文字）","最大20個のダイスセットを保存可能","結果はブラウザのIndexedDBに自動保存されます","ダイスセットの複製と削除が可能","ドラッグ&ドロップでダイスセットの並び替えが可能","ダイスセット全体をJSON形式でエクスポート/インポート可能","複数のダイスセットを選択して一括で複製・削除が可能","全ダイスセットを一括削除する機能（確認ダイアログ付き）"]},comparison:{title:"ダイスセットの比較",features:["複数のダイスセットを選択してグラフで比較表示が可能","比較モードでは各ダイスセットが異なる色で表示されます","最大20個のダイスセットまで同時比較可能","比較時は各ダイスセットのラベルに試行回数が表示されます"]}},resultDisplay:{title:"結果の表示",table:{label:"シート",description:"各試行の詳細な結果を一覧表示",features:["試行番号、各ダイスの値、合計値を表示","ページネーション機能（1ページあたり25件表示）","CSV形式でのエクスポートが可能"]},chart:{label:"ウィジェット",description:"結果の分布を自在なレイアウトで視覚化（5種類のウィジェット）\nウィジェットの追加・削除・並び替えが自由に可能です。",types:{distribution:{title:"合計値の分布",features:["全試行の合計値の分布をヒストグラムで表示","棒グラフと折れ線グラフの切り替え可能","統計情報をアノテーションラインで表示（平均値：緑、中央値：オレンジ、期待値：ピンク、±1σ：紫）","中央値に該当するバー/ポイントをオレンジ色でハイライト","理論分布を灰色の点線で重ねて表示（単一セッション時のみ）","データ集約機能で大量データを見やすく表示"]},cumulative:{title:"累積分布",features:["確率の累積分布を表示","合計値と個別のダイスの両方に対応","実測値と理論値の比較が可能","分位点（10分位、20分位など）の表示切り替え機能","「この値以下が出る確率」を視覚的に把握可能"]},progress:{title:"試行の推移",features:["各試行での合計値の推移を表示","時系列で結果の変動を確認可能","移動平均線を表示してトレンドを把握","移動平均のウィンドウサイズを調整可能（5〜100試行）"]},individualDice:{title:"個別の出目の分布",features:["各ダイスの出目の分布を表示（ダイスが2個以上の場合）","棒グラフと折れ線グラフの切り替え可能","理論分布を灰色の点線で重ねて表示","データ集約機能で大量データを見やすく表示"]},recentRolls:{title:"直近の出目",features:["最新のダイスロール結果（1〜3件）を大きく表示","特定の条件（値がXX以上、特定の値など）でのハイライト表示が可能","最大値・最小値の自動ハイライト機能"]}}}},advancedFeatures:{title:"高度な機能",widgetManagement:{title:"ウィジェット管理システム",description:"画面上のグラフ（ウィジェット）を自由にカスタマイズできます。",features:["グラフの追加・削除（最大10個まで）","ドラッグ＆ドロップによる並び替え","グラフの種類変更（合計値、累積、推移、個別、直近）","ウィジェットの複製"]},filterSystem:{title:"テーブルフィルター",description:"シート（表）のデータを詳細に分析するための機能です。",features:["条件による行の絞り込み（値がX以上、特定の目が出た場合など）","条件に合致する行のハイライト表示（8色から選択可能）","フィルター設定の保存と呼び出し","ダイスセットごとのフィルター適用の記憶"]},dataAggregation:{title:"データ集約機能",description:"グラフ表示時、データポイント数が多い場合は集約機能を使用することで、見やすく表示できます。",features:[{label:"データ集約を使用する",description:"指定した間隔を目安にデータを均等にまとめて表示"},{label:"集約間隔の目安",description:"おおよそ何件ずつにまとめるかを設定（2〜5,000、デフォルト: 20）"},{label:"対応グラフ",description:"合計値の分布グラフ、個別の出目の分布グラフ"},{label:"例: 間隔を20に設定すると、全体を約20件ずつの均等なグループに分割します",subFeatures:["端数が出ないよう、各グループはできるだけ均等なサイズに自動調整されます"]},{label:"集約時はグラフタイトルに「集約：XX」と表示されます"}]},chartSettings:{title:"ダッシュボード設定（レイアウト保存）",description:"カスタマイズしたウィジェットの配置や設定をセットとして保存・切り替えできます。",features:["複数の設定プリセットを作成・管理可能","設定の名前変更、複製、削除が可能","未保存の変更がある場合は警告を表示","各グラフの表示設定を個別に保存","デフォルト設定は削除・変更不可"]}},globalSettings:{title:"全体設定",description:"ヘッダー（モバイル版はフッター）の歯車アイコンから全体設定を開くことができます。",appearance:{label:"外観",features:["テーマ切り替え（ライト/ダーク/システム設定に従う）","選択はブラウザに自動保存されます"]},dataManagement:{label:"データ管理",features:[{label:"データのエクスポート",description:"全ダイスセットとカスタムグラフ設定をJSON形式でバックアップ",subFeatures:["デフォルト設定とプリセット設定は除外されます"]},{label:"データのインポート",description:"エクスポートしたJSONファイルから復元",subFeatures:["既存データとマージされます（上書きではありません）"]},{label:"全データの削除",description:"全てのダイスセットとグラフ設定を削除（確認ダイアログ付き）"},{label:"保存されているダイスセット数とグラフ設定数を表示"}]}},operations:{retryAndRoll:{title:"再試行と追加ロール",features:[{label:"結果リセット",description:"現在のダイスセットの結果をクリア（確認ダイアログ付き）"},{label:"再試行",description:"既存の結果をクリアして新しい結果に置き換え"},{label:"追加ロール",description:"既存の結果を保持したまま追加でダイスロールを実行",subFeatures:["ダイス設定が変更されている場合は警告を表示","追加実行時は既存データと統合されます"]}]},dataExport:{title:"データのエクスポート",description:"結果とダイスセットデータを様々な形式でエクスポートできます。",features:[{label:"CSV形式",description:"結果を表形式のCSVファイルでダウンロード"},{label:"PNG形式",description:"グラフを画像でダウンロード"},{label:"JSON形式",description:"ダイスセット全体をJSON形式でエクスポート/インポート"},{label:"クリップボードコピー",description:"ダイス設定のプレビュー文字列をコピー"}]}}},ga={title:"About / Privacy",close:"閉じる",sections:{app:{title:"このアプリについて",description:"{{siteName}}は、複数のダイスロールをシミュレーションし、結果を統計的に分析するためのWebアプリケーションです。TRPG（テーブルトークRPG）やボードゲームなどで使用するダイスの確率分布を確認することができます。"},data:{title:"データの取り扱い",items:["このアプリケーションはすべてのデータをブラウザ内にローカル保存します","ダイスセットデータ: IndexedDBに保存","設定（ダークモード等）: LocalStorageに保存","サーバーへのデータ送信は一切行いません","個人情報の収集は行いません","外部サービスとの連携はありません","データの管理はユーザー自身の責任で行ってください。ブラウザのデータクリアやアップデートにより保存データが消失する可能性があるため、重要なデータは定期的にエクスポート機能でバックアップすることを推奨します"]},disclaimer:{title:"免責事項",items:["このアプリケーションは無保証で提供されます","動作の正確性や継続性についても保証いたしかねます","本アプリの使用により生じた損害について、開発者は一切の責任を負いません"]},libraries:{title:"使用ライブラリ",description:"このアプリケーションは以下のオープンソースライブラリを使用しています：",items:["React (MIT License)","Chart.js (MIT License)","Tailwind CSS (MIT License)","Vite (MIT License)"]},version:{version:"Version: {{version}}",lastUpdated:"Last Updated: {{date}}"}}},ha={title:"全体設定",close:"閉じる",appearance:{title:"外観",theme:{title:"テーマ",description:"アプリの表示テーマを選択できます",light:"ライト",dark:"ダーク",system:"システム"},language:{title:"言語",description:"アプリの表示言語を選択できます"},chartImage:{title:"グラフ画像",description:"グラフを画像としてダウンロードする際の設定",transparentExport:{label:"透明背景でエクスポート",description:"有効にすると、グラフ画像をダウンロードする際に背景を透明にします"}},chartHeight:{title:"グラフの高さ",description:"表示されるグラフの高さを設定します",mode:{aspectRatio:"縦横比",fixedHeight:"高さ指定"},aspectRatio:{presetsLabel:"プリセット",customLabel:"カスタム値",presets:{custom:"カスタム","2-1":"2:1","16-9":"16:9","4-3":"4:3","1-1":"1:1"},widthLabel:"横",heightLabel:"縦"},fixedHeight:{label:"高さ (px)",help:"200px 〜 800pxの範囲で入力",error:{min:"200px以上で入力してください",max:"800px以下で入力してください"}}}},dataManagement:{title:"データ管理",currentData:{title:"保存されているデータ",diceSets:"ダイスセット: {{count}}件",chartSettings:"グラフ設定: {{count}}件"},backup:{title:"バックアップと復元",description:"すべてのダイスセットとダッシュボード、フィルターセット設定を含む完全なバックアップをJSON形式でエクスポート・インポートできます。",export:"エクスポート",exportDescription:"すべてのデータをJSON形式で保存",import:"インポート",importDescription:"バックアップファイルから復元"},reset:{title:"データの完全消去",description:"すべてのダイスセット、ダッシュボード設定、アプリケーション設定を削除します。この操作は元に戻せません。",button:"すべてのデータを削除",confirm:"本当にすべてのデータを削除しますか？",confirmButton:"削除する",cancel:"キャンセル",processing:"削除中...",resetError:"データの初期化に失敗しました"}},system:{resetError:"IndexedDBの削除に失敗しました"},chartSettings:{title:"ダッシュボード管理",renameTitle:"設定名を変更",editTitle:"ダッシュボードを編集",duplicateTitle:"設定を複製",close:"閉じる",new:"+ 新規",create:"新規作成",rename:"名前変更",edit:"編集",duplicate:"複製",delete:"削除",save:"保存",change:"変更",cancel:"キャンセル",discard:"破棄",preset:"プリセット",custom:"カスタム",inUse:"使用中",selected:"{{count}}件選択",emptyMessage:"設定がありません",maxLength:"最大128文字",copyNameSuffix:"のコピー",unsavedChanges:"未保存の変更があります",unsavedWarning:"未保存の変更があります。保存したい設定の「保存」ボタンをクリックしてください。",savePrompt:"変更を保存しますか？",nameLabel:"設定名",namePlaceholder:"設定名を入力",rememberDiceSet:{label:"選択中のダイスセットを記憶する",description:"このダッシュボードに切り替えたときに、記憶したダイスセットを自動的に選択します"},chartOptions:"ウィジェットオプション",moreOptions:"その他のオプション",bulkActions:{title:"一括操作",duplicate:"選択を一括複製",delete:"選択を一括削除",selectAll:"すべて選択",deselectAll:"選択解除"},errors:{nameRequired:"設定名を入力してください",duplicateFailed:"設定の複製に失敗しました",renameFailed:"設定の名前変更に失敗しました",deleteFailed:"設定の削除に失敗しました",saveFailed:"保存に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",deleteAllFailed:"全削除に失敗しました",cannotDeletePreset:"プリセット設定は削除できません",noSelection:"削除可能な設定が選択されていません",noDuplicateSelection:"複製する設定を選択してください"},confirmDelete:"設定「{{name}}」を削除しますか？",confirmBulkDelete:"{{count}}件の設定を削除しますか？",deleteAll:"すべて削除",confirmDeleteAll:"プリセット以外のすべての設定を削除してもよろしいですか？"},about:{link:"About / Privacy"}},ma={type:{bar:"棒グラフ",line:"線グラフ"},title:{totalDistribution:"合計値の分布",totalDistributionShort:"合計値",cumulative:"累積分布 - {{diceCode}} / {{trials}}回試行{{quantile}}",cumulativeTotalBase:"累積分布（合計値）",cumulativeTotalBaseShort:"累積",cumulativeIndividualBase:"累積分布（全ダイスの出目）",cumulativeIndividual:"累積分布 (全ダイスの出目) - {{diceCode}} / {{trials}}回試行{{quantile}}",cumulativeComparison:"累積分布の比較 - {{count}}件のダイスセット比較{{quantile}}",cumulativeComparisonIndividual:"累積分布の比較 (全ダイスの出目) - {{count}}件のダイスセット比較{{quantile}}",cumulativeAggregated:"累積分布 - {{diceCode}} (集約)",individualDice:"個別の出目の分布",individualDiceShort:"個別出目",rollProgress:"試行推移 - {{diceCode}} / {{trials}}回試行{{aggregation}}",rollProgressBase:"試行推移",rollProgressBaseShort:"推移",rollProgressComparison:"試行推移の比較 - {{count}}件のダイスセット比較{{aggregation}}",targetValue:"特定の目の出現",comparison:"{{count}}件のダイスセット比較"},subtitle:{trialCount:"{{count}}回試行",aggregation:"集約：{{interval}}",binning:"ビニング: {{algorithm}} ({{binCount}}ビン)",quantilePoints:"分位点：{{count}}",custom:"カスタム"},legend:{title:"凡例",actual:"実測値",actualSampled:"実測値 (サンプリング)",actualCumulative:"累積分布 (実測)",theoretical:"理論値",theoreticalCumulative:"理論値",movingAverage:"移動平均",movingAverageWindow:"移動平均 ({{window}}試行)",expectedValue:"期待値 ({{value}})",showMore:"他 {{count}} 件を表示",collapse:"折りたたむ"},axis:{total:"合計値",diceValue:"ダイスの出目",trialNumber:"試行回数",frequency:"出現回数",cumulativeProbability:"累積確率 (%)",dicePosition:"ダイス位置"},stats:{mean:"平均",median:"中央値",mode:"最頻値",stdDev:"標準偏差",expectedValue:"期待値",totalCount:"合計",averagePerDice:"平均（各ダイス）",maxCount:"最大",minCount:"最小",individualStats:"個別の出目の統計",dataPoints:"表示データポイント数: {{count}}点"},options:{title:"ウィジェットオプション",widgetType:"ウィジェットの種類",chartType:"グラフの外観",displaySettings:"表示設定",manageSettings:"設定を管理",createNew:"新規ダッシュボード",editSettings:"設定を編集",editingSettings:"編集中の設定",settingsName:"設定名",settingsNamePlaceholder:"設定名を入力",maxLength:"最大128文字",download:"画像ダウンロード",useAggregation:"集約",aggregationInterval:"集約間隔",movingAverageWindow:"移動平均ウィンドウ",cumulativeType:"分布タイプ",cumulativeTotal:"合計値",cumulativeIndividual:"全ダイスの出目",cumulativeShowOnlyActual:"実データ範囲のみ表示",cumulativeQuantile:"分位点による集約",cumulativeQuantileCount:"分位点数",aggregation:{title:"データ集約",useAggregation:"集約を使用",intervalLabel:"集約間隔の目安（件数）",apply:"適用",reset:"リセット",status:"データポイント数: {{count}}",statusAggregated:"✓ 集約中（約{{interval}}件ずつ）"},binning:{title:"ビニング設定",useBinning:"ビニングを使用",algorithm:"アルゴリズム",equalWidth:"等幅",scott:"Scott's rule",fd:"Freedman-Diaconis",binWidthMultiple:"ビン幅の倍数",status:"データポイント数: {{count}}",statusBinned:"{{binCount}}ビン（幅: {{binWidth}}）に集約"},targetValue:{title:"特定の目を集計",label:"集計する目の値",range:"{{min}}-{{max}}の範囲で指定"},movingAverage:{title:"移動平均の設定",windowLabel:"移動平均ウィンドウ（試行数）",apply:"適用",reset:"リセット",description:"移動平均を表示: {{window}}試行"},cumulative:{title:"累積分布の設定",distributionType:"分布タイプ",total:"合計値",individual:"出目（全ダイス統合）",dataRange:"データ表示範囲",fullRange:"全範囲",actualOnly:"実データのみ",quantileAggregation:"分位点による集約",points:"{{count}}点",aggregationLabel:"集約: {{count}}点",yAxisRange:"Y軸範囲指定",yAxisMin:"最小値 (%)",yAxisMax:"最大値 (%)",resetRange:"範囲をリセット",apply:"適用",reset:"リセット"},xAxisScale:{title:"X軸範囲設定",mode:"範囲指定モード",auto:"自動",semiAuto:"初期範囲で固定",manual:"手動",rangeLabel:"表示範囲",min:"最小値",max:"最大値",apply:"適用",reset:"リセット",description:{auto:"データに応じて自動調整","semi-auto":"初期レンダリング時の範囲を維持",manual:"指定した範囲で固定"},manualHelp:"空欄の場合は自動で範囲が調整されます",placeholder:"空欄で自動"},yAxisScale:{title:"Y軸範囲設定",mode:"範囲指定モード",auto:"自動",semiAuto:"初期範囲で固定",manual:"手動",rangeLabel:"表示範囲",min:"最小値",max:"最大値",apply:"適用",reset:"リセット",description:{auto:"データに応じて自動調整","semi-auto":"初期レンダリング時の範囲を維持",manual:"指定した範囲で固定"},manualHelp:"空欄の場合は自動で範囲が調整されます",placeholder:"空欄で自動"}},noData:"結果がありません",message:{startRoll:"ダイスロールを実行すると、ここに結果が表示されます"},description:{totalDistribution:"全試行における合計値の出現頻度をヒストグラムで表示します。",theoreticalDistributionComparison:"期待頻度（理論値）と比較して、実際の分布の偏りを確認できます。",cumulativeTotal:"特定の合計値以上が出る確率の累積分布を表示しています。",cumulativeIndividual:"特定の出目以上が出る確率の累積分布を表示しています。",theoreticalComparison:"理論値（点線）と実測値を比較できます。",rollProgress:"各試行での合計値の推移を表示しています。移動平均により傾向を把握できます。",expectedValueComparison:"期待値ライン（点線）との比較で、偏りの有無を確認できます。",progressDescription:"各試行での合計値の推移を表示しています。移動平均により傾向を把握できます。",expectedLineDescription:"期待値ライン（点線）との比較で、偏りの有無を確認できます。",individualDiceDescription:"このグラフは、複数のダイスを振った際に、それぞれのダイスで出た目を個別に集計したものです。\n各出目が全体で何回出現したかを表示しています。"},view:{chart:"ダッシュボード",table:"シート",manage:"ダッシュボード管理",saveCurrentView:"現在のダッシュボードを保存",overwrite:"上書き",selectView:"ダッシュボード",presetGroup:"プリセット設定",customGroup:"カスタム設定",layout:"レイアウト",layoutType:{"4row1col":"4行1列","2row2col":"2行2列","2row1col3col":"2行（1列+3列）"}},widget:{add:"ウィジェットを追加",duplicate:"複製",remove:"削除",resetToDefault:"デフォルト構成に戻す",limitReached:"グラフ数が上限（{{max}}個）に達しています",minLimitReached:"最低1つのグラフが必要です",confirmReset:"デフォルト構成（4グラフ）にリセットしますか？",autoName:"{{type}} #{{index}}",graphTypes:{result:"合計値",cumulative:"累積分布",rollProgress:"試行推移",individual:"個別出目",recentRolls:"ロール結果"}},preset:{default:"デフォルト設定"},menu:{options:"その他のオプション",csvDownload:"CSVダウンロード",rollReset:"ロールリセット",confirmReset:"結果をリセットしてもよろしいですか？",csvDownloadFailed:"CSVのダウンロードに失敗しました",fullScreen:"全画面表示",exitFullScreen:"全画面表示を終了",toggleLegend:"凡例表示切り替え (F)"},targetStats:{title:{base:"特定の目の集計",single:"特定の目（{{value}}）の集計 - {{dice}} / {{trials}}回試行",comparison:"特定の目（{{value}}）の比較 - {{count}}件のダイスセット比較"},occurrences:"{{value}}の出現回数",occurrenceRate:"（出現率: {{rate}}%）",yAxis:"出現回数",summary:{title:"【{{value}}】の統計サマリー",total:"合計出現回数: {{count}}回",average:"ダイスあたり平均: {{average}}回",rate:"全試行中の出現率: {{rate}}%",range:"最大: {{max}}回 / 最小: {{min}}回"},totalAppearances:"合計出現回数",averagePerDice:"ダイスあたり平均",appearanceRate:"出現率",maxMin:"最大: {{max}}回 / 最小: {{min}}回"},result:{title:"結果表示"},recentRolls:{noResultsYet:"まだ結果がありません",trialNumber:"{{number}} 回目",total:"合計",countLabel:"表示件数",countOption:"{{count}}件",highlightLabel:"ハイライト条件",highlightPlaceholder:"例: 1, 6 または 1-6, 2n, 3n+1",highlightHelp:"カンマ、スペースで区切って複数値指定（例：2,5,8）、数値間をハイフンで区切って範囲指定（例：50-100）できます。倍数指定（例：2n, 5n+3）も可能です"}},pa={config:{title:"ダイス設定",titleEdit:"ダイス設定の編集",titleCreate:"ダイス設定の新規追加",editingMultiple:"{{count}}件編集",name:{label:"ダイスセット名（128文字まで）",placeholder:"ダイスセット名を記入（任意）"},count:{label:"ダイスの数 ({{min}}-{{max}})",description:"振るダイスの数"},sides:{label:"面の数 ({{min}}-{{max}})",description:"ダイスの面の数"},modifier:{label:"修正値 ({{min}}-{{max}})",sign:"符号",value:"値",add:"加算",subtract:"減算"},trial:{label:"試行回数 ({{min}}-{{max}})",description:"実行する試行の回数"},notation:{label:"ダイス記法",copy:"クリップボードにコピー",copied:"コピー完了",preview:"プレビュー"},editing:{multipleMessage:"{{count}}件のダイスセットを編集中です"},unspecified:"未指定"},action:{simulate:"ダイスロール開始",reroll:"振り直し",addRoll:"追加ロール",reset:"結果をリセット",export:"CSVでエクスポート"}},xa={title:"ダイスセット",dice:"ダイス",empty:"ダイスセットがありません",selectPrompt:"ダイスセットを選択してください",selectOrCreatePrompt:"ダイスセットを選択または作成してください",list:{multiSelectMode:"複数選択モード",selected:"{{count}}件選択中",comparing:"{{count}}件のダイスセットを比較中"},action:{create:"新規作成",createShort:"新規",compare:"比較",export:"エクスポート",import:"インポート",bulkDelete:"一括削除",bulkDuplicate:"一括複製",bulkDuplicateShort:"選択を一括複製",bulkDeleteShort:"選択を一括削除",deleteAll:"すべて削除",deleteAllShort:"すべて削除",reorder:"並び替え",clearSelection:"選択解除",change:"変更",selectDiceSet:"ダイスセットを選択"},confirm:{delete:"このダイスセットを削除してもよろしいですか？",deleteAll:"全てのダイスセットを削除してもよろしいですか？",bulkDelete:"選択した{{count}}件のダイスセットを削除してもよろしいですか？",bulkDeleteWarning:"選択中の{{count}}件のダイスセットを削除してもよろしいですか？\nこの操作は取り消せません。"},copy:{suffix:"のコピー"},label:{deck:"デッキ"},deck:{showMore:"他{{count}}件",allItems:"表示中のデッキ"},limit:{reached:"ダイスセット数が上限（{{max}}個）に達しています",maxRecords:"記録可能な最大試行数（{{max}}回）を超えています"},target:{label:"対象",all:"すべて ({{count}})",selected:"選択中"},multiSelect:{label:"複数選択"},viewing:{single:"{{count}}件のダイスセットを閲覧中",multiple:"{{count}}件のダイスセットを比較中"},guidance:{dropToSwitch:"ドロップしてシートを切り替え",dropToAddToDeck:"サイドバーからダイスセットをドラッグ＆ドロップして追加",dropToViewSheet:"サイドバーからダイスセットをドラッグ＆ドロップして結果を表示"},tooltip:{create:"新しいダイスセットを作成",maxReached:"ダイスセット数が上限に達しています",addRollDisabled:"特定の目が変更されたため追加ロールできません"}},fa={dice:{count:{required:"ダイスの数を入力してください",range:"ダイスの数は{{min}}〜{{max}}の範囲で指定してください",invalid:"ダイスの数が不正です"},sides:{required:"面の数を入力してください",range:"面の数は{{min}}〜{{max}}の範囲で指定してください",invalid:"面の数が不正です"},modifier:{range:"修正値は{{min}}〜{{max}}の範囲で指定してください",invalid:"修正値が不正です"}},trial:{required:"試行回数を入力してください",range:"試行回数は{{min}}〜{{max}}の範囲で指定してください",invalid:"試行回数が不正です"},diceSet:{nameRequired:"ダイスセット名を入力してください",nameTooLong:"ダイスセット名は{{max}}文字以内で入力してください",limitReached:"ダイスセット数の上限に達しています"},file:{invalidFormat:"ファイル形式が不正です",parseError:"ファイルのパースに失敗しました",readError:"ファイルの読み込みに失敗しました"},chart:{aggregationRange:"集約間隔は{{min}}〜{{max}}の範囲で指定してください",targetValueRange:"目の値は{{min}}〜{{max}}の範囲で指定してください"}},ya={success:{diceSetCreated:"新しいダイスセットを作成しました",diceSetDeleted:"ダイスセットを削除しました",diceSetDuplicated:"ダイスセットを複製しました",diceSetUpdated:"ダイス設定を更新しました",bulkDeleted:"{{count}}件のダイスセットを削除しました",bulkDuplicated:"{{count}}件のダイスセットを複製しました",rollCompleted:"{{count}}回のダイスロールが完了しました",dataExported:"データをエクスポートしました",dataImported:"データをインポートしました",migrated:"LocalStorageからIndexedDBへ移行しました",copied:"クリップボードにコピーしました",settingsCreated:"設定を作成しました",settingsCreatedWithName:"設定「{{name}}」を作成しました",settingsDuplicatedWithName:"設定「{{name}}」を複製しました",settingsSaved:"設定を保存しました",settingsUpdated:"設定を更新しました",settingsRenamed:"設定名を変更しました",settingsDeleted:"設定を削除しました"},error:{diceSetCreateFailed:"ダイスセットの作成に失敗しました",diceSetDeleteFailed:"ダイスセットの削除に失敗しました",diceSetDuplicateFailed:"ダイスセットの複製に失敗しました",diceSetUpdateFailed:"ダイスセットの更新に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",rollFailed:"ダイスロールに失敗しました",loadFailed:"データの読み込みに失敗しました",exportFailed:"エクスポートに失敗しました",importFailed:"インポートに失敗しました",copyFailed:"クリップボードへのコピーに失敗しました",csvDownloadFailed:"CSVのダウンロードに失敗しました",imageGenerationFailed:"画像の生成に失敗しました",generic:"エラーが発生しました",partialSuccess:"{{completed}}件完了、{{failed}}件エラー:\n{{errors}}",cannotModifyDefault:"デフォルト設定は変更できません",diceSetLimitReached:"ダイスセット数が上限（{{max}}個）に達しています",bulkDuplicateLimitReached:"ダイスセット数の上限により、{{count}}件までしか複製できません",trialCountExceeded:"試行回数が上限の{{max}}件を超えています",maxRecordsExceeded:"記録可能な上限（{{max}}件）を超えるため、追加ロールできません",settingImportSkipped:'ダッシュボード設定 "{{name}}" のインポートをスキップ:'},import:{successWithDetails:"{{details}}をインポートしました",diceSetsCount:"ダイスセット{{count}}件",chartSettingsCount:"ダッシュボード設定{{count}}件"},info:{processing:"処理中...",simulating:"シミュレーション中... ({{progress}}%)",noResults:"結果がありません",noDiceSets:"ダイスセットがありません",resetResults:"結果をリセットしました",selectDiceSet:"ダイスセットを選択してください"},warning:{unsavedChanges:"未保存の変更があります",configChanged:"ダイス設定が変更されています",noImportableData:"インポートできるデータがありません（すべて既に存在します）",addRollDisabled:"特定の目が変更されたため追加ロールできません"}},ba={title:"更新履歴",entries:[{version:"0.2.1",date:"2026-01-19",changes:{added:["ハイライト条件のターゲット列指定で複数列を選択できる機能を追加（チェックボックス形式で任意の列を組み合わせて指定可能）"],changed:["ハイライト条件のターゲット列選択を単一選択から複数選択可能な方式に変更（「全て」という特別な選択肢を廃止し、より明示的な操作に）","新規ハイライト条件のデフォルトターゲットを「全て」から「合計値」に変更"],fixed:[]}},{version:"0.2.0",date:"2026-01-18",changes:{added:["全体設定にグラフの高さ設定を追加（縦横比モード: プリセット16:9/4:3/1:1またはカスタム値、高さ固定モード: 200〜800pxで指定可能）","ダイスセット一覧の操作性を一般的なファイルマネージャ（エクスプローラ等）と同様の方式に刷新（ドラッグでの範囲選択、Shift/Ctrlキーでの複数選択、複数項目の同時移動に対応）","結果テーブルの列幅をドラッグ＆ドロップで変更できる機能を追加（設定はダイスセットごとに保存）","結果テーブルにフィルター機能を追加（試行回数、各ダイス値、オフセット、合計値でフィルタリング可能）","テーブルフィルターセット管理機能を追加（フィルター条件とハイライト設定をセットとして保存・切り替え）","ロール結果ウィジェットとテーブルハイライト条件に「最大値」「最小値」を追加（max, minキーワードで指定可能）","ハイライト条件に色指定機能を追加（8色のカラーパレットから選択可能）","フィルター条件のドラッグ&ドロップによる並び替え機能を追加","PC版において、シミュレーション実行ボタンを画面内の任意の位置へドラッグ移動できる機能を追加（位置は保存されます）"],changed:["UI/UXの大幅な変更を実施（特にダイスセット一覧と結果テーブル周り）","ダイスセット一覧をデフォルトで単一選択に変更し、複数選択モードトグルを廃止（直感的なマウス操作だけで完結するように）","テーブル表示件数設定をフィルターセットごとに保存するように変更"],fixed:[]}},{version:"0.1.10",date:"2026-01-03",changes:{added:["直近のロール結果を表示するウィジェット「ロール結果」を追加（表示件数: 1〜3件）","ロール結果ウィジェットに出目ハイライト機能を追加（単一値、範囲、倍数指定に対応）","合計値分布グラフのビニング機能に「等幅」アルゴリズムを追加","ウィジェットセットに「選択中のダイスセットを記憶する」オプションを追加（ウィジェットセットごとに異なるダイスセットを自動選択可能に）"],changed:["名称変更：「グラフビュー」→「ウィジェットセット」、「グラフボックス」→「ウィジェット」","ビニング機能のデフォルトアルゴリズムを「等幅」に変更（データ範囲を均等分割し、両端も含めて均一な頻度表示が可能に）"],fixed:["その他コードの最適化を実施"]}},{version:"0.1.9",date:"2026-01-02",changes:{fixed:["累積分布グラフのオプションメニューでグラフ外観を変更するとカスタムメニュー項目が消える問題を修正","その他軽微な修正"]}},{version:"0.1.8",date:"2026-01-01",changes:{added:["ウィジェットの全画面表示機能を追加（全画面モードではCharts.js標準の凡例を常に表示させます）"],changed:["PC版のグラフビュー設定エディタのタブ表示を横スクロールからサイドバー方式に変更","モバイル版のグラフビュー設定エディタでグラフ選択をドロップダウンに変更"],fixed:["ウィジェット内のグラフオプションでビニング設定を変更して上書き保存しても設定が保存されない問題を修正","モバイルデバイスでモーダル内コンテンツがはみ出す問題を修正","各ウィジェットのグラフオプションでグラフタイプ切り替えボタンが表示されない問題を修正"]}},{version:"0.1.7",date:"2026-01-01",changes:{added:["合計値分布グラフにビニング機能を追加（Scott's rule、Freedman-Diaconis法によるビン幅自動計算）","グラフ画像ダウンロード時の背景色をテーマに応じて自動設定（ライトモード: 白、ダークモード: グレー）","全体設定にグラフ背景を透明にするオプションを追加","各ウィジェットごとに凡例の表示・非表示状態を保存する機能を追加"],changed:["合計値分布グラフの集約設定をビニング設定に移行","グラフ画像のファイル名を統一形式に変更（チャートタイプ_タイムスタンプ.png）"],fixed:[]}},{version:"0.1.6",date:"2025-12-31",changes:{added:["全グラフにY軸範囲指定機能を追加（自動/半自動/手動モード対応）"],changed:["グラフビュー設定の構造をウィジェットベースに変更し、各ウィジェットごとに独立した設定を保持するように改善","グラフビュー設定エディタのタブを動的生成に変更し、ウィジェットの追加・削除・複製に対応","グラフビュー設定にウィジェットの配置情報を保存するように変更","プリセット設定をデフォルトのみに簡略化","累積分布グラフのY軸範囲指定をX軸範囲指定と同じ統一された方式に変更"],fixed:["ウィジェットを複製した際に設定が共有されてしまう問題を修正","グラフビュー設定を切り替えてもウィジェットの配置が反映されない問題を修正"]}},{version:"0.1.5",date:"2025-12-30",changes:{added:["ダイスセット一覧に編集ボタンを追加（メニューを開かずに直接編集可能に）","ダイスセット一覧にダイス記法のコピーボタンを追加（ダイス記法の横に配置）"],changed:[],fixed:[]}},{version:"0.1.4",date:"2025-12-29",changes:{added:[],changed:[],fixed:["スマートフォンでグラフの並び替えができない問題を修正（タッチ操作に対応）"]}},{version:"0.1.3",date:"2025-12-29",changes:{added:["グラフエリアのレイアウト選択機能を追加（4行1列/2行2列/2行（1列+3列）の3種類）","各グラフの表示順序を変更できる機能を追加","ウィジェットセット設定選択欄に編集ボタンを追加（グラフビュー設定モーダルへの導線を減らしました）"],changed:["凡例ラベルを各グラフから分離し、グラフエリア上部に一元化して表示するように変更","ダイスセット名を空欄にできるように変更。空欄の場合はダイス記法（例：dice2d6+3）が自動的に表示されます","試行推移グラフは線グラフのみをサポートするように変更（棒グラフが指定されている場合は自動的に線グラフを表示）","試行推移グラフの移動平均線を点線で表示するように変更","グラフビュー設定モーダルのUIをアコーディオン式からタブ式に変更","ダイスセットリスト、グラフ凡例、比較画面でのダイスセット名表示に連番の接頭辞を付与"],fixed:["グラフビュー設定の新規作成時にグラフオプションを変更しても反映されない問題を修正"]}},{version:"0.1.2",date:"2025-12-26",changes:{added:[],changed:[],fixed:["試行推移グラフと累積分布グラフのチャートタイプを変更して上書き保存しても設定が保持されない問題を修正"]}},{version:"0.1.1",date:"2025-12-26",changes:{added:["グラフX軸範囲設定機能（自動/半自動/手動の3モード）を追加","グラフビュー管理モーダルで各グラフのオプション（チャートタイプ、集約設定、移動平均など）を編集できる機能を追加","グラフビュー設定を新規作成する際、名前だけでなく各グラフの初期設定を編集できるように"],changed:["グラフオプションメニューの幅を拡大して操作性を改善","グラフ設定編集メニューのラベルを「名前変更」から「編集」に変更","グラフ設定編集モーダルのタイトルを「設定名を変更」から「設定を編集」に変更"],fixed:["スマホ版ダイスセット一覧モーダルで全削除機能が動作しない問題を修正"]}},{version:"0.1.0",date:"2025-12-24",changes:{added:["ダイスロールシミュレーション機能","結果の表形式表示","結果のグラフ表示（正規分布、累積分布、個別ダイス、ターゲット値別など）","ダイスセットの保存・管理機能","CSVエクスポート機能","画像エクスポート機能","日本語/英語の多言語対応","ダークモード対応","レスポンシブデザイン"],changed:[],fixed:[]}}],categories:{added:"追加",changed:"変更",fixed:"修正",removed:"削除",security:"セキュリティ"}},va={button:{start:"Start",reroll:"Reroll",addRoll:"Add Roll",save:"Save",cancel:"Cancel",close:"Close",delete:"Delete",duplicate:"Duplicate",edit:"Edit",apply:"Apply",confirm:"Confirm",create:"Create",export:"Export",import:"Import",copy:"Copy",reset:"Reset",ok:"OK",yes:"Yes",no:"No",back:"Back",next:"Next"},action:{edit:"Edit",save:"Save",cancel:"Cancel",delete:"Delete",duplicate:"Duplicate",create:"Create",close:"Close",change:"Change",lockPosition:"Lock Position",unlockPosition:"Unlock Position",dragToMove:"Drag to Move",collapse:"Collapse",expand:"Expand"},unit:{count:"items",piece:"pcs",times:"times",diceSet:"dice set"},label:{loading:"Loading...",processing:"Processing...",noData:"No data available",help:"Help",toggleTheme:"Toggle Theme",toggleLanguage:"Toggle Language",settings:"Settings",firstPage:"First Page",lastPage:"Last Page",quantile:"Quantile",aggregation:"Aggregation",target:"Target",all:"All",preview:"Preview",list:"List",roll:"Roll",start:"Start",addMore:"Roll more",noChanges:"No changes",trial:"Trial",dice:"Dice",modifier:"Modifier",total:"Total",itemsPerPage:"Items per page",filter:"Filter",clearFilter:"Clear filter",highlight:"Highlight",manage:"Manage",filterSet:"Filter set",filterCondition:"Filter condition",showOnlyHighlighted:"Show only highlighted",trialNumber:"Trial number",offset:"Offset",addCondition:"Add condition",removeCondition:"Remove condition",andCondition:"All conditions (AND)",orCondition:"Any condition (OR)",conditionType:"Condition type",fromHistory:"From history",clearHistory:"Clear history",noHistory:"No history"},filterOperator:{equals:"equals specified value",notEquals:"not equals specified value",greaterThan:"greater than specified value",lessThan:"less than specified value"},filterOperatorSymbol:{equals:"x = ",notEquals:"x ≠ ",greaterThan:"x > ",lessThan:"x < "},filterColumn:{all:"All",trialNumber:"Trial number",dice:"Dice {{index}}",modifier:"Offset",total:"Total",trialNumberShort:"Trial",modifierShort:"Mod."},tableFilter:{itemsPerPage:"Items per page",filter:"Filter",filterSet:"Filter Set",editFilter:"Edit Filter",manageFilters:"Manage Filters",filteredCount:"{{filtered}} / {{total}} items",activeFilters:"Filter Conditions",activeHighlights:"Highlight Conditions",noActiveFilters:"No filter conditions",noActiveHighlights:"No highlight conditions",highlightSingle:"{{target}}: {{value}}",highlightRange:"{{target}}: {{min}}~{{max}}",highlightModulo:"{{target}}: multiples of {{divisor}}{{offset}}",highlightMax:"{{target}}: Maximum",highlightMin:"{{target}}: Minimum",conditions:"Conditions",conditionValueSingle:"= {{value}}",conditionValueRange:"{{min}} ~ {{max}}",conditionValueModulo:"multiples of {{divisor}}{{offset}}",conditionValueMax:"Maximum",conditionValueMin:"Minimum",moduloOffsetPlus:" +{{offset}}",moduloOffsetMinus:" -{{offset}}",moduloOffsetZero:"",showOnlyHighlighted:"Show only highlighted",managerTitle:"Filter Set Manager",editorTitle:"Filter Settings",newFilterSet:"New Filter Set",createNew:"Create New",filterSetName:"Filter set name",filterSetNamePlaceholder:"Enter filter set name",currentFilterSet:"Current",defaultFilterSet:"Default",confirmDelete:"Are you sure you want to delete '{{name}}'?",confirmDeleteMultiple:"Are you sure you want to delete {{count}} selected filter sets?",filterActive:"{{filtered}} / {{total}} total",conditionsActive:"{{count}} condition(s) active",noMatchingResults:"No results match the filter conditions",importSuccess:"Filter set imported successfully",importError:"Import failed: {{error}}",exportFileName:"Filter Set",selectJsonFile:"Select JSON file",invalidFileFormat:"Invalid file format",maxNameLength:"Name must be 50 characters or less",deleteAll:"Delete All",confirmDeleteAll:"Are you sure you want to delete all non-default filter sets?",copySuffix:" (Copy)",moreOptions:"More options",filterConditionPresent:"Filter condition active",highlightPresent:"Highlight active"},itemsPerPageOption:{25:"25",50:"50",75:"75",100:"100"},aria:{itemsPerPage:"Items per page",selectFilterSet:"Select filter set",manageFilterSets:"Manage filter sets",editFilterConditions:"Edit filter conditions",filterTargetColumn:"Filter target column",filterOperator:"Filter operator",filterValue:"Filter value",removeFilterCondition:"Remove condition",addFilterCondition:"Add condition",filterSetName:"Filter set name",selectTargetColumns:"Select target columns"},punctuation:{comma:", "},none:"None",unnamed:"Unnamed",siteName:"Dice Simulator",menu:{options:"Options",edit:"Edit",duplicate:"Duplicate",delete:"Delete"},emptyState:{noItems:"No items available"},selection:{moving:"Moving...",selected:"selected",deselect:"Deselect",delete:"Delete"},selectAll:"Select All",deselectAll:"Deselect All",selectColumns:"Select columns",allColumns:"All columns",columnsSelected:"{{count}} columns selected",custom:"Custom",actions:{select:"Select",exportSelected:"Export Selected",import:"Import",duplicateSelected:"Duplicate Selected",deleteSelected:"Delete Selected"},error:{unknown:"Unknown error",deleteDefault:"Cannot delete default settings",deleteFailed:"Failed to delete",saveFailed:"Failed to save",bulkDeleteFailed:"Failed to bulk delete",bulkDuplicateFailed:"Failed to bulk duplicate",deleteAllFailed:"Failed to delete all",noSelection:"No deletable items selected",noDuplicateSelection:"No items selected to duplicate"}},wa={title:"Guide",closeButton:"Close",aboutSection:{description:{before:"For more information about this app and privacy policy, please see",after:"."},linkText:"here"},basicSettings:{diceNotation:{title:"About Dice Notation",description:"Dice notation is specified in the following format:",format:"dice[count]d[sides](+|-)[modifier]",parameters:{count:{label:"Count",description:"Number of dice to roll (1-10)"},sides:{label:"Sides",description:"Number of sides on each die (1-9,999)"},modifier:{label:"Modifier",description:"Optional. Value to add or subtract from result (0-99,999)"}}},examples:{title:"Usage Examples",items:[{notation:"dice1d6",description:"→ Roll one 6-sided die"},{notation:"dice3d6+2",description:"→ Roll three 6-sided dice and add 2 to the total"},{notation:"dice2d10-5",description:"→ Roll two 10-sided dice and subtract 5 from the total"}]},trials:{title:"Number of Trials",description:"You can execute the same dice roll multiple times (1-1,000 times).\nIncreasing the number of trials allows you to verify more accurate probability distributions."}},diceSetManagement:{diceSetFeatures:{title:"Dice Set Features",features:["Save each dice set with any name (up to 128 characters)","Store up to 20 dice sets","Results are automatically saved to browser IndexedDB","Duplicate and delete dice sets","Reorder dice sets via drag and drop","Export/import entire dice sets in JSON format","Select multiple dice sets for bulk duplicate/delete","Bulk delete all dice sets (with confirmation dialog)"]},comparison:{title:"Dice Set Comparison",features:["Select multiple dice sets to compare in charts","In comparison mode, each dice set is displayed in a different color","Compare up to 20 dice sets simultaneously","Trial count is displayed in each dice set's label during comparison"]}},resultDisplay:{title:"Result Display",table:{label:"Table Format",description:"Display detailed results of each trial in list format",features:["Shows trial number, each die value, and total value","Pagination feature (25 items per page)","Export to CSV format available"]},chart:{label:"Widgets",description:"Visualize result distribution with flexible layout (5 types of widgets)\nYou can freely add, remove, and reorder widgets.",types:{distribution:{title:"Total Value Distribution",features:["Display histogram of total value distribution across all trials","Toggle between bar chart and line chart","Display statistical information as annotation lines (mean: green, median: orange, expected value: pink, ±1σ: purple)","Highlight bars/points corresponding to median in orange","Overlay theoretical distribution as gray dotted line (single diceSet only)","Data aggregation feature for viewing large datasets clearly"]},cumulative:{title:"Cumulative Distribution",features:["Display cumulative probability distribution","Support both total values and individual dice","Compare actual and theoretical values","Toggle display of quantiles (deciles, vigintiles, etc.)",'Visually grasp "probability of rolling this value or less"']},progress:{title:"Trial Progress",features:["Display progression of total values across trials","Verify result variation in time series","Display moving average line to understand trends","Adjust moving average window size (5-100 trials)"]},individualDice:{title:"Individual Die Value Distribution",features:["Display distribution of each die's values (when 2+ dice)","Toggle between bar chart and line chart","Overlay theoretical distribution as gray dotted line","Data aggregation feature for viewing large datasets clearly"]},recentRolls:{title:"Recent Rolls",features:["Display latest dice roll results (1-3 items) in large size","Highlighting with conditional formatting (e.g., value >= X, specific value)","Automatic highlighting of max/min values"]}}}},advancedFeatures:{title:"Advanced Features",widgetManagement:{title:"Widget Management System",description:"Customize charts (widgets) on the screen freely.",features:["Add/Remove charts (up to 10)","Reorder via drag and drop","Change chart type (Total, Cumulative, Progress, Individual, Recent)","Duplicate widgets"]},filterSystem:{title:"Table Filters",description:"Detailed analysis for sheet (table) data.",features:["Filter rows by conditions (Greater than X, Specific value, etc.)","Highlight rows matching conditions (8 colors available)","Save and recall filter settings","Remember applied filters per dice set"]},dataAggregation:{title:"Data Aggregation Feature",description:"When displaying charts, if there are many data points, you can use the aggregation feature to display them more clearly.",features:[{label:"Use Data Aggregation",description:"Group and display data evenly based on specified interval"},{label:"Aggregation Interval",description:"Set approximately how many items to group together (2-5,000, default: 20)"},{label:"Supported Charts",description:"Total value distribution chart, individual die value distribution chart"},{label:"Example: Setting interval to 20 divides the whole into approximately 20 evenly sized groups",subFeatures:["Each group is automatically adjusted to be as even as possible to avoid remainders"]},{label:'When aggregated, "Aggregation: XX" is displayed in the chart title'}]},chartSettings:{title:"Dashboard (Layout Saving)",description:"Save and switch between customized widget layouts and settings.",features:["Create and manage multiple setting presets","Rename, duplicate, and delete settings","Display warning when there are unsaved changes","Save display settings for each chart individually","Default settings cannot be deleted or modified"]}},globalSettings:{title:"Global Settings",description:"You can open global settings from the gear icon in the header (footer on mobile).",appearance:{label:"Appearance",features:["Theme switching (light/dark/follow system settings)","Selection is automatically saved to browser"]},dataManagement:{label:"Data Management",features:[{label:"Export Data",description:"Backup all dice sets and custom chart settings in JSON format",subFeatures:["Default and preset settings are excluded"]},{label:"Import Data",description:"Restore from exported JSON file",subFeatures:["Merged with existing data (not overwritten)"]},{label:"Delete All Data",description:"Delete all dice sets and chart settings (with confirmation dialog)"},{label:"Display saved dice set count and chart settings count"}]}},operations:{retryAndRoll:{title:"Retry and Add Roll",features:[{label:"Reset Results",description:"Clear current dice set results (with confirmation dialog)"},{label:"Retry",description:"Clear existing results and replace with new results"},{label:"Add Roll",description:"Execute additional dice rolls while preserving existing results",subFeatures:["Display warning if dice configuration has changed","Integrated with existing data during additional execution"]}]},dataExport:{title:"Data Export",description:"Export results and dice set data in various formats.",features:[{label:"CSV Format",description:"Download results as tabular CSV file"},{label:"PNG Format",description:"Download chart as image"},{label:"JSON Format",description:"Export/import entire dice sets in JSON format"},{label:"Clipboard Copy",description:"Copy dice configuration preview string"}]}}},Sa={title:"About / Privacy",sections:{app:{title:"About This App",description:"{{siteName}} is a web application for simulating multiple dice rolls and analyzing results statistically. You can verify probability distributions of dice used in TRPGs (Tabletop Role-Playing Games), board games, and more."},data:{title:"Data Handling",items:["This application stores all data locally in your browser","Dice set data: Stored in IndexedDB","Settings (dark mode, etc.): Stored in LocalStorage","No data is sent to any server","No personal information is collected","No integration with external services","Data management is the user's responsibility. Saved data may be lost due to browser data clearing or updates, so we recommend regularly backing up important data using the export feature"]},disclaimer:{title:"Disclaimer",items:["This application is provided without warranty","We cannot guarantee the accuracy or continuity of operation","The developer assumes no responsibility for damages arising from use of this app"]},libraries:{title:"Libraries Used",description:"This application uses the following open-source libraries:",items:["React (MIT License)","Chart.js (MIT License)","Tailwind CSS (MIT License)","Vite (MIT License)"]},version:{version:"Version: {{version}}",lastUpdated:"Last Updated: {{date}}"}}},ka={title:"Global Settings",close:"Close",appearance:{title:"Appearance",theme:{title:"Theme",description:"Select the application display theme",light:"Light",dark:"Dark",system:"System"},language:{title:"Language",description:"Select the application display language"},chartImage:{title:"Chart Images",description:"Settings for downloading charts as images",transparentExport:{label:"Export with transparent background",description:"When enabled, chart images will be downloaded with a transparent background"}},chartHeight:{title:"Chart Height",description:"Set the display height of charts",mode:{aspectRatio:"Aspect Ratio",fixedHeight:"Fixed Height"},aspectRatio:{presetsLabel:"Presets",customLabel:"Custom Value",presets:{custom:"Custom","2-1":"2:1","16-9":"16:9","4-3":"4:3","1-1":"1:1"},widthLabel:"W",heightLabel:"H"},fixedHeight:{label:"Height (px)",help:"Range: 200px - 800px",error:{min:"Must be 200px or more",max:"Must be 800px or less"}}}},dataManagement:{title:"Data Management",currentData:{title:"Saved Data",diceSets:"Dice Sets: {{count}}",chartSettings:"Chart Settings: {{count}}"},backup:{title:"Backup and Restore",description:"Export or import a complete backup in JSON format, including all dice sets, Dashboards, and filter set settings.",export:"Export",exportDescription:"Save all data as JSON",import:"Import",importDescription:"Restore from backup file"},reset:{title:"Complete Data Deletion",description:"Delete all dice sets, chart settings, and application settings. This action cannot be undone.",button:"Delete All Data",confirm:"Are you sure you want to delete all data?",confirmButton:"Delete",cancel:"Cancel",processing:"Deleting...",resetError:"Failed to reset data"}},system:{resetError:"Failed to delete IndexedDB"},chartSettings:{title:"Manage Dashboard",renameTitle:"Rename Settings",editTitle:"Edit Settings",duplicateTitle:"Duplicate Settings",close:"Close",new:"+ New",create:"Create New",rename:"Rename",edit:"Edit",duplicate:"Duplicate",delete:"Delete",save:"Save",change:"Change",cancel:"Cancel",discard:"Discard",preset:"Preset",custom:"Custom",inUse:"In Use",selected:"{{count}} selected",emptyMessage:"No settings available",maxLength:"Max 128 characters",copyNameSuffix:" Copy",unsavedChanges:"You have unsaved changes",unsavedWarning:"You have unsaved changes. Click the Save button for the settings you want to save.",savePrompt:"Do you want to save your changes?",nameLabel:"Settings Name",namePlaceholder:"Enter settings name",rememberDiceSet:{label:"Remember Selected Dice Sets",description:"Automatically select the remembered dice sets when switching to this Dashboard"},chartOptions:"Chart Options",moreOptions:"More options",bulkActions:{title:"Bulk Actions",duplicate:"Bulk Duplicate Selected",delete:"Bulk Delete Selected",selectAll:"Select All",deselectAll:"Deselect All"},errors:{nameRequired:"Please enter a settings name",duplicateFailed:"Failed to duplicate settings",renameFailed:"Failed to rename settings",deleteFailed:"Failed to delete settings",saveFailed:"Failed to save",bulkDeleteFailed:"Failed to bulk delete",bulkDuplicateFailed:"Failed to bulk duplicate",cannotDeletePreset:"Cannot delete preset settings",noSelection:"No deletable settings selected",noDuplicateSelection:"Please select settings to duplicate",deleteAllFailed:"Failed to delete all settings"},confirmDelete:'Delete settings "{{name}}"?',confirmBulkDelete:"Delete {{count}} settings?",deleteAll:"Delete All",confirmDeleteAll:"Are you sure you want to delete all settings except presets?"},about:{link:"About / Privacy"}},Ca={type:{bar:"Bar Chart",line:"Line Chart"},title:{totalDistribution:"Total Value Distribution",totalDistributionShort:"Total",cumulative:"Cumulative Distribution - {{diceCode}} / {{trials}} trials{{quantile}}",cumulativeTotalBase:"Cumulative Distribution (Total)",cumulativeTotalBaseShort:"Cumulative",cumulativeIndividualBase:"Cumulative Distribution (All Dice)",cumulativeIndividual:"Cumulative Distribution (All Dice Values) - {{diceCode}} / {{trials}} trials{{quantile}}",cumulativeComparison:"Cumulative Distribution Comparison - {{count}} dice sets{{quantile}}",cumulativeComparisonIndividual:"Cumulative Distribution Comparison (All Dice Values) - {{count}} dice sets{{quantile}}",cumulativeAggregated:"Cumulative Distribution - {{diceCode}} (Aggregated)",individualDice:"Individual Die Value Distribution",individualDiceShort:"Individual",rollProgress:"Trial Progress - {{diceCode}} / {{trials}} trials{{aggregation}}",rollProgressBase:"Trial Progress",rollProgressBaseShort:"Progress",rollProgressComparison:"Trial Progress Comparison - {{count}} dice sets{{aggregation}}",targetValue:"Specific Value Occurrences",comparison:"Comparing {{count}} dice sets"},subtitle:{trialCount:"{{count}} trials",aggregation:"Aggregation: {{interval}}",binning:"Binning: {{algorithm}} ({{binCount}} bins)",quantilePoints:"{{count}} points",custom:"Custom"},legend:{title:"Legend",actual:"Actual",actualSampled:"Actual (Sampled)",actualCumulative:"Cumulative Distribution (Actual)",theoretical:"Theoretical",theoreticalCumulative:"Theoretical",movingAverage:"Moving Average",movingAverageWindow:"Moving Average ({{window}} trials)",expectedValue:"Expected Value ({{value}})",showMore:"Show {{count}} more",collapse:"Collapse"},axis:{total:"Total Value",diceValue:"Die Value",trialNumber:"Trial Number",frequency:"Frequency",cumulativeProbability:"Cumulative Probability (%)",dicePosition:"Die Position"},stats:{mode:"Mode",stdDev:"Standard Deviation",expectedValue:"Expected Value",totalCount:"Total",averagePerDice:"Average (per die)",maxCount:"Maximum",minCount:"Minimum",individualStats:"Individual Die Statistics",dataPoints:"Data points displayed: {{count}}"},options:{title:"Chart Options",widgetType:"Widget Type",chartType:"Chart Type",displaySettings:"Display Settings",manageSettings:"Manage Settings",createNew:"Create New Settings",editSettings:"Edit Settings",editingSettings:"Editing Settings",settingsName:"Settings Name",settingsNamePlaceholder:"Enter settings name",maxLength:"Maximum 128 characters",download:"Download Image",useAggregation:"Aggregation",aggregationInterval:"Aggregation Interval",movingAverageWindow:"Moving Average Window",cumulativeType:"Distribution Type",cumulativeTotal:"Total Value",cumulativeIndividual:"All Dice Values",cumulativeShowOnlyActual:"Show Actual Data Range Only",cumulativeQuantile:"Quantile Aggregation",cumulativeQuantileCount:"Quantile Count",aggregation:{title:"Data Aggregation",useAggregation:"Use Aggregation",intervalLabel:"Aggregation Interval (approximate count)",apply:"Apply",reset:"Reset",status:"Data points: {{count}}",statusAggregated:"✓ Aggregated (approx. every {{interval}} items)"},binning:{title:"Binning Settings",useBinning:"Use Binning",algorithm:"Algorithm",equalWidth:"Equal Width",scott:"Scott's rule",fd:"Freedman-Diaconis",binWidthMultiple:"Bin Width Multiple",status:"Data points: {{count}}",statusBinned:"{{binCount}} bins (width: {{binWidth}})"},targetValue:{title:"Specific Value Count",label:"Value to count",range:"Specify in range {{min}}-{{max}}"},movingAverage:{title:"Moving Average Settings",windowLabel:"Moving Average Window (trials)",apply:"Apply",reset:"Reset",description:"Show moving average: {{window}} trials"},cumulative:{title:"Cumulative Distribution Settings",distributionType:"Distribution Type",total:"Total Value",individual:"Individual Die (All Dice Combined)",dataRange:"Data Display Range",fullRange:"Full Range",actualOnly:"Actual Data Only",quantileAggregation:"Quantile Aggregation",points:"{{count}} points",aggregationLabel:"Aggregation: {{count}} points",yAxisRange:"Y-Axis Range",yAxisMin:"Min (%)",yAxisMax:"Max (%)",resetRange:"Reset Range",apply:"Apply",reset:"Reset"},xAxisScale:{title:"X-Axis Scale Settings",mode:"Scale Mode",auto:"Auto",semiAuto:"Lock Initial Range",manual:"Manual",rangeLabel:"Display Range",min:"Min",max:"Max",apply:"Apply",reset:"Reset",description:{auto:"Automatically adjust to data","semi-auto":"Lock initial rendering range",manual:"Fix to specified range"},manualHelp:"Empty fields will be auto-scaled",placeholder:"Auto if empty"},yAxisScale:{title:"Y-Axis Scale Settings",mode:"Scale Mode",auto:"Auto",semiAuto:"Lock Initial Range",manual:"Manual",rangeLabel:"Display Range",min:"Min",max:"Max",apply:"Apply",reset:"Reset",description:{auto:"Automatically adjust to data","semi-auto":"Lock initial rendering range",manual:"Fix to specified range"},manualHelp:"Empty fields will be auto-scaled",placeholder:"Auto if empty"}},noData:"No results",message:{startRoll:"Results will appear here when you roll the dice"},description:{totalDistribution:"Displays a histogram of total value frequencies across all trials.",theoreticalDistributionComparison:"Compare with expected frequency (theoretical) to check for distribution bias.",cumulativeTotal:"Displays the cumulative probability distribution of getting a total value or higher.",cumulativeIndividual:"Displays the cumulative probability distribution of getting a die value or higher.",theoreticalComparison:"You can compare the theoretical values (dashed line) with actual measurements.",rollProgress:"Shows the progression of total values for each trial. Use moving average to identify trends.",expectedValueComparison:"Compare with the expected value line (dashed) to check for bias.",progressDescription:"Shows the progression of total values for each trial. Use moving average to identify trends.",expectedLineDescription:"Compare with the expected value line (dashed) to check for bias.",individualDiceDescription:"This chart aggregates individual dice outcomes when rolling multiple dice. \nIt shows how many times each outcome appeared in total."},view:{chart:"Widget",table:"Sheet",manage:"Manage Dashboard",saveCurrentView:"Save current set",overwrite:"Overwrite",selectView:"Widget Set",presetGroup:"Preset Settings",customGroup:"Custom Settings",layout:"Layout",layoutType:{"4row1col":"4 Rows × 1 Column","2row2col":"2 Rows × 2 Columns","2row1col3col":"2 Rows (1 Column + 3 Columns)"}},widget:{add:"Add Widget",duplicate:"Duplicate",remove:"Remove",resetToDefault:"Reset to Default",limitReached:"Graph limit ({{max}}) reached",minLimitReached:"At least one graph is required",confirmReset:"Reset to default configuration (4 graphs)?",autoName:"{{type}} #{{index}}",graphTypes:{result:"Total",cumulative:"Cumulative",rollProgress:"Progress",individual:"Individual",recentRolls:"Roll Results"}},preset:{default:"Default Settings"},menu:{options:"More options",csvDownload:"Download CSV",rollReset:"Reset Rolls",confirmReset:"Are you sure you want to reset the results?",csvDownloadFailed:"Failed to download CSV",fullScreen:"Full Screen",exitFullScreen:"Exit Full Screen",toggleLegend:"Toggle Legend (F)"},targetStats:{title:{base:"Target Value Statistics",single:"Target Value ({{value}}) Statistics - {{dice}} / {{trials}} trials",comparison:"Target Value ({{value}}) Comparison - {{count}} dice sets"},occurrences:"Occurrences of {{value}}",occurrenceRate:"(Rate: {{rate}}%)",yAxis:"Occurrences",summary:{title:"Summary for [{{value}}]",total:"Total occurrences: {{count}}",average:"Average per die: {{average}}",rate:"Occurrence rate: {{rate}}%",range:"Max: {{max}} / Min: {{min}}"},totalAppearances:"Total appearances",averagePerDice:"Average per die",appearanceRate:"Appearance rate",maxMin:"Max: {{max}} / Min: {{min}}"},result:{title:"Results"},recentRolls:{noResultsYet:"No results yet",trialNumber:"Trial {{number}}",total:"Total",countLabel:"Display Count",countOption:"{{count}} result_one",countOption_other:"{{count}} results",highlightLabel:"Highlight Conditions",highlightPlaceholder:"e.g., 1, 6 or 1-6, 2n, 3n+1",highlightHelp:"Specify multiple values separated by commas or spaces (e.g., 2,5,8). Use hyphens for ranges (e.g., 50-100). Modulo notation is also supported (e.g., 2n, 5n+3)"}},ja={config:{title:"Dice Configuration",titleEdit:"Edit Dice Configuration",titleCreate:"Create New Dice Configuration",editingMultiple:"Editing {{count}} items",name:{label:"Dice Set Name (up to 128 characters)",placeholder:"Enter dice set name (optional)"},count:{label:"Number of Dice ({{min}}-{{max}})",description:"Number of dice to roll"},sides:{label:"Number of Sides ({{min}}-{{max}})",description:"Number of sides on each die"},modifier:{label:"Modifier ({{min}}-{{max}})",sign:"Sign",value:"Value",add:"Add",subtract:"Subtract"},trial:{label:"Number of Trials ({{min}}-{{max}})",description:"Number of trials to execute"},notation:{label:"Dice Notation",copy:"Copy to clipboard",copied:"Copied",preview:"Preview"},editing:{multipleMessage:"Editing {{count}} dice sets"},unspecified:"Unspecified"},action:{simulate:"Start Rolling",reroll:"Reroll",addRoll:"Add Roll",reset:"Reset Results",export:"Export as CSV"}},Da={title:"Dice Sets",dice:"Dice",empty:"No dice sets available",selectPrompt:"Please select a dice set",selectOrCreatePrompt:"Please select or create a dice set",list:{multiSelectMode:"Multi-select mode",selected:"{{count}} selected",comparing:"Comparing {{count}} dice sets"},action:{create:"Create New",createShort:"New",compare:"Compare",export:"Export",import:"Import",bulkDelete:"Bulk Delete",bulkDuplicate:"Bulk Duplicate",bulkDuplicateShort:"Bulk duplicate selected",bulkDeleteShort:"Bulk delete selected",deleteAll:"Delete All",deleteAllShort:"Delete all",reorder:"Reorder",clearSelection:"Clear selection",change:"Change",selectDiceSet:"Select dice set"},confirm:{delete:"Are you sure you want to delete this dice set?",deleteAll:"Are you sure you want to delete all dice sets?",bulkDelete:"Are you sure you want to delete {{count}} selected dice sets?",bulkDeleteWarning:"Are you sure you want to delete {{count}} selected dice sets?\nThis operation cannot be undone."},copy:{suffix:" (Copy)"},deck:{showMore:"+{{count}} more",allItems:"Displayed Deck"},label:{deck:"Deck"},limit:{reached:"Maximum number of dice sets ({{max}}) reached",maxRecords:"Exceeds maximum number of trials ({{max}})"},target:{label:"Target",all:"All ({{count}})",selected:"Selected"},multiSelect:{label:"Multi-select"},viewing:{single:"Viewing {{count}} dice set",multiple:"Comparing {{count}} dice sets"},guidance:{dropToSwitch:"Drop to switch sheet",dropToAddToDeck:"Drag and drop a dice set from the sidebar to add",dropToViewSheet:"Drag and drop a dice set from the sidebar to view results"},tooltip:{create:"Create a new dice set",maxReached:"Maximum number of dice sets reached",addRollDisabled:"Cannot add rolls because specific values were modified"}},Na={dice:{count:{required:"Please enter the number of dice",range:"Number of dice must be between {{min}} and {{max}}",invalid:"Invalid number of dice"},sides:{required:"Please enter the number of sides",range:"Number of sides must be between {{min}} and {{max}}",invalid:"Invalid number of sides"},modifier:{range:"Modifier must be between {{min}} and {{max}}",invalid:"Invalid modifier"}},trial:{required:"Please enter the number of trials",range:"Number of trials must be between {{min}} and {{max}}",invalid:"Invalid number of trials"},diceSet:{nameRequired:"Please enter a dice set name",nameTooLong:"Dice set name must be {{max}} characters or less",limitReached:"Maximum number of dice sets reached"},file:{invalidFormat:"Invalid file format",parseError:"Failed to parse file",readError:"Failed to read file"},chart:{aggregationRange:"Aggregation interval must be between {{min}} and {{max}}",targetValueRange:"Die value must be between {{min}} and {{max}}"}},Aa={success:{diceSetCreated:"New dice set created",diceSetDeleted:"Dice set deleted",diceSetDuplicated:"Dice set duplicated",diceSetUpdated:"Dice configuration updated",bulkDeleted:"{{count}} dice sets deleted",bulkDuplicated:"{{count}} dice sets duplicated",rollCompleted:"{{count}} dice rolls completed",dataExported:"Data exported",dataImported:"Data imported",migrated:"Migrated from LocalStorage to IndexedDB",copied:"Copied to clipboard",settingsCreated:"Settings created",settingsCreatedWithName:'Settings "{{name}}" created',settingsDuplicatedWithName:'Settings "{{name}}" duplicated',settingsSaved:"Settings saved",settingsUpdated:"Settings updated",settingsRenamed:"Settings renamed",settingsDeleted:"Settings deleted"},error:{diceSetCreateFailed:"Failed to create dice set",diceSetDeleteFailed:"Failed to delete dice set",diceSetDuplicateFailed:"Failed to duplicate dice set",diceSetUpdateFailed:"Failed to update dice set",bulkDeleteFailed:"Bulk delete failed",bulkDuplicateFailed:"Bulk duplicate failed",rollFailed:"Dice roll failed",loadFailed:"Failed to load data",exportFailed:"Export failed",importFailed:"Import failed",copyFailed:"Failed to copy to clipboard",csvDownloadFailed:"Failed to download CSV",imageGenerationFailed:"Failed to generate image",generic:"An error occurred",partialSuccess:"{{completed}} completed, {{failed}} errors:\n{{errors}}",cannotModifyDefault:"Cannot modify default settings",diceSetLimitReached:"Dice set limit ({{max}}) reached",bulkDuplicateLimitReached:"Can only duplicate {{count}} due to dice set limit",trialCountExceeded:"Trial count exceeds the limit of {{max}}",maxRecordsExceeded:"Cannot add roll because it exceeds the maximum limit ({{max}} records)",settingImportSkipped:'Skipping import of chart settings "{{name}}":'},import:{successWithDetails:"Imported {{details}}",diceSetsCount:"{{count}} dice sets",chartSettingsCount:"{{count}} chart settings"},info:{processing:"Processing...",simulating:"Simulating... ({{progress}}%)",noResults:"No results",noDiceSets:"No dice sets",resetResults:"Results have been reset",selectDiceSet:"Please select a dice set"},warning:{unsavedChanges:"You have unsaved changes",configChanged:"Dice configuration has been changed",noImportableData:"No importable data (all already exist)",addRollDisabled:"Cannot add roll because specific die values were changed"}},Ta={title:"Changelog",entries:[{version:"0.2.1",date:"2026-01-19",changes:{added:["Added multi-column selection for highlight condition targets (checkbox-based interface allows selecting any combination of columns)"],changed:["Changed highlight condition target selection from single to multi-select (removed special 'all' option for more explicit control)","Changed default target for new highlight conditions from 'all' to 'total'"],fixed:[]}},{version:"0.2.0",date:"2026-01-18",changes:{added:["Added chart height settings to global settings (Aspect Ratio mode: presets 16:9/4:3/1:1 or custom values, Fixed Height mode: 200-800px)","Revamped dice set list interaction to resemble file manager behavior (supports drag-selection, Shift/Ctrl+Click for multi-selection, and bulk reordering)","Added drag & drop column resizing to result table (settings saved per dice set)","Added filter feature to result table (filter by trial number, dice values, offset, and total)","Added table filter set management (save and switch filter conditions and highlight settings as sets)","Added 'max' and 'min' keywords to roll result widget and table highlight conditions","Added color selection to highlight conditions (choose from 8-color palette)","Added drag & drop reordering for filter conditions","Added the ability to drag and move the simulation button to any position on the screen in PC version (position is saved)"],changed:["Major UI/UX overhaul (especially around the dice set list and result table)","Changed default selection mode to single-select and removed the multi-select toggle in favor of intuitive mouse operations","Changed items per page setting to be saved per filter set"],fixed:[]}},{version:"0.1.10",date:"2026-01-03",changes:{added:["Added 'Roll Results' widget to display recent roll results (display count: 1-3)","Added dice value highlighting feature to Roll Results widget (supports single values, ranges, and modulo notation)","Added 'Equal Width' binning algorithm to total distribution chart","Added 'Remember Selected Dice Sets' option to Dashboards (automatically select different dice sets for each Dashboard)"],changed:["Renamed: 'Chart View' → 'Widget Set', 'Chart Box' → 'Widget'","Changed default binning algorithm to 'Equal Width' (divides data range evenly and displays uniform frequency including edges)"],fixed:["Performed other code optimizations"]}},{version:"0.1.9",date:"2026-01-02",changes:{fixed:["Fixed issue where custom menu items disappeared when changing chart appearance in cumulative distribution chart options","Other minor fixes"]}},{version:"0.1.8",date:"2026-01-01",changes:{added:["Added fullscreen display feature for widgets (always displays Chart.js native legend in fullscreen mode)"],changed:["Changed chart view settings editor tab display on PC from horizontal scroll to sidebar layout","Changed graph selection in chart view settings editor on mobile to dropdown"],fixed:["Fixed issue where binning settings changed in graph options within widgets were not saved when overwriting","Fixed issue where modal content overflows on mobile devices","Fixed issue where chart type toggle buttons were not displayed in graph options for each widget"]}},{version:"0.1.7",date:"2026-01-01",changes:{added:["Added binning feature to total distribution chart (automatic bin width calculation using Scott's rule and Freedman-Diaconis method)","Added automatic background color for chart image downloads based on theme (light mode: white, dark mode: gray)","Added transparent background export option to settings","Added ability to save legend visibility state for each widget"],changed:["Migrated aggregation settings to binning settings for total distribution chart","Standardized chart image filenames to unified format (charttype_timestamp.png)"],fixed:["Fixed issue where rounding did not work properly when bin width multiple exceeded a certain value"]}},{version:"0.1.6",date:"2025-12-31",changes:{added:["Added Y-axis range settings to all charts (auto/semi-auto/manual modes supported)"],changed:["Restructured chart settings to be widget-based, allowing each widget to maintain independent settings","Chart settings editor tabs are now dynamically generated to support adding, removing, and duplicating widgets","Chart view settings now save widget layout information","Simplified preset settings to default only","Changed cumulative distribution chart Y-axis range settings to use the same unified approach as X-axis range settings"],fixed:["Fixed issue where duplicated widgets shared settings instead of having independent configurations","Fixed issue where switching chart view settings did not reflect widget layout"]}},{version:"0.1.5",date:"2025-12-30",changes:{added:["Added edit button to dice set list (can now edit directly without opening the menu)","Added copy button for dice notation to dice set list (placed next to dice notation)"],changed:[],fixed:[]}},{version:"0.1.4",date:"2025-12-29",changes:{added:[],changed:[],fixed:["Fixed issue where charts could not be reordered on mobile devices (added touch support for drag and drop)"]}},{version:"0.1.3",date:"2025-12-29",changes:{added:["Added graph area layout selection feature (3 types: 4 rows x 1 column, 2 rows x 2 columns, 2 rows (1 column + 3 columns))","Added drag handles to chart areas, allowing users to reorder charts via drag and drop","Added edit button for custom chart settings in the chart settings selector (allows direct editing of selected custom settings)"],changed:["Separated legend labels from individual charts and moved them to a unified display at the top of the chart area","Dice set names can now be left blank. When blank, dice notation (e.g., dice2d6+3) is automatically displayed","Roll Progress Chart now only supports line charts (automatically falls back to line chart if bar chart is specified)","Moving average line in Roll Progress Chart now displays as a dashed line","Changed chart options UI in chart view settings creation/editing from accordion-style to tab-style","Updated dice set list, chart legends, and comparison screen to display UIDs in the format '#1 - dice3d6+2'"],fixed:["Fixed issue where chart options changes were not reflected when creating new chart view settings"]}},{version:"0.1.2",date:"2025-12-26",changes:{added:[],changed:[],fixed:["Fixed issue where chart type settings for Roll Progress Chart and Cumulative Distribution Chart were not saved when overwriting chart view settings"]}},{version:"0.1.1",date:"2025-12-26",changes:{added:["Chart X-axis scale settings (auto/semi-auto/manual modes)","Ability to edit chart options (chart type, aggregation, moving average, etc.) in the chart view management modal","Ability to edit initial settings for each chart (not just the name) when creating new chart view settings"],changed:["Expanded chart options menu width for improved usability","Changed chart settings edit menu label from 'Rename' to 'Edit'","Changed chart settings edit modal title from 'Rename Settings' to 'Edit Settings'"],fixed:["Fixed issue where delete all function didn't work in mobile dice set list modal"]}},{version:"0.1.0",date:"2025-12-24",changes:{added:["Dice roll simulation feature","Table view of results","Chart view of results (normal distribution, cumulative distribution, individual dice, by target value, etc.)","Dice set save and management feature","CSV export feature","Image export feature","Multi-language support (Japanese/English)","Dark mode support","Responsive design"],changed:[],fixed:[]}}],categories:{added:"Added",changed:"Changed",fixed:"Fixed",removed:"Removed",security:"Security"}};function Ma(){return"ja"===xe.language?"ja-JP":"en-US"}function Ea(e){return e.toLocaleString(Ma())}function Ra(e,t=2){return e.toLocaleString(Ma(),{minimumFractionDigits:t,maximumFractionDigits:t})}xe.use(ca).use(Ae).init({resources:{ja:{common:da,help:ua,about:ga,settings:ha,charts:ma,dice:pa,diceSets:xa,validation:fa,messages:ya,changelog:ba},en:{common:va,help:wa,about:Sa,settings:ka,charts:Ca,dice:ja,diceSets:Da,validation:Na,messages:Aa,changelog:Ta}},fallbackLng:"ja",defaultNS:"common",ns:["common","help","about","settings","charts","dice","diceSets","validation","messages","changelog"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"],lookupLocalStorage:"language"}});const Ia=({targetDiceSetType:e,onChange:t,disabled:r,selectedDiceSetsCount:a,selectedDiceSets:n,className:i="",t:o})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap",children:o("diceSets:target.label")}),s.jsxs("select",{value:e,onChange:e=>t(e.target.value),disabled:r,className:`flex-1 px-4 py-3 bg-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer focus:outline-none disabled:opacity-50 max-w-full truncate ${i}`,children:[s.jsx("option",{value:"selected",children:o("diceSets:target.all",{count:a})}),n.map(e=>s.jsx("option",{value:e.id,children:ft(e)},e.id))]})]}),La=({onReroll:e,onAddRoll:t,isSimulating:r,hasResults:n,isAddRollDisabled:i=!1,diceSets:o=[],selectedDiceSetIds:l=[],targetDiceSetType:c="selected",onTargetDiceSetTypeChange:d,className:u="",isDraggable:g=!1})=>{const{t:h}=$e(["dice","diceSets","messages","common"]),[m,p]=a.useState(()=>{try{if(!g)return!0;return"false"!==localStorage.getItem("simulateButtonLocked")}catch{return!0}}),[x,f]=a.useState(()=>{try{return"true"===localStorage.getItem("simulateButtonCollapsed")}catch{return!1}});a.useEffect(()=>{g&&localStorage.setItem("simulateButtonLocked",String(m))},[m,g]),a.useEffect(()=>{localStorage.setItem("simulateButtonCollapsed",String(x))},[x]);const[y,b]=a.useState(()=>g?function(){try{const e=localStorage.getItem(Yt);return e?JSON.parse(e):null}catch{return null}}():null),v=a.useRef(!1),w=a.useRef(null),S=a.useRef(null),k=a.useRef(y),C=a.useRef(0),j=a.useCallback(e=>{if(!v.current||!w.current||!S.current)return;const t=e.clientX,r=e.clientY;cancelAnimationFrame(C.current),C.current=requestAnimationFrame(()=>{if(!v.current||!w.current||!S.current)return;const e=t-w.current.x,a=r-w.current.y;let n=w.current.initialX+e,i=w.current.initialY+a;const{maxX:s,maxY:o}=w.current;n=Math.max(0,Math.min(n,s)),i=Math.max(0,Math.min(i,o));const l=n-w.current.initialX,c=i-w.current.initialY;S.current.style.transform=`translate3d(${l}px, ${c}px, 0)`,k.current={x:n,y:i}})},[]),D=a.useCallback(()=>{v.current=!1,cancelAnimationFrame(C.current),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",D),document.body.style.userSelect="",S.current&&(S.current.style.willChange=""),k.current&&S.current&&(S.current.style.transform="",b(k.current),function(e){localStorage.setItem(Yt,JSON.stringify(e))}(k.current))},[j]);a.useEffect(()=>()=>{cancelAnimationFrame(C.current),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",D),document.body.style.userSelect=""},[j,D]),a.useEffect(()=>{const e=()=>{g&&!m&&b(e=>{if(!e||!S.current)return e;const t=S.current.getBoundingClientRect(),r=window.innerWidth-t.width,a=window.innerHeight-t.height,n=Math.max(0,Math.min(e.x,r)),i=Math.max(0,Math.min(e.y,a));return n===e.x&&i===e.y?e:{x:n,y:i}})};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[g,m]);const N=l.length,A=o.filter(e=>l.includes(e.id)),T=d&&N>1,M=h(n?"dice:action.reroll":"dice:action.simulate"),E=h(n?"dice:action.reroll":"common:button.start"),R=h("common:button.addRoll"),I=g&&!m&&y?{position:"fixed",left:y.x,top:y.y,bottom:"auto",right:"auto",margin:0,transform:"none",zIndex:600}:{};return s.jsxs("div",{ref:S,style:I,className:`w-64 bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 flex flex-col overflow-hidden ${u}`,children:[g&&s.jsxs("div",{className:"h-6 w-full flex items-center justify-between px-2 bg-gray-50/80 dark:bg-gray-800/80 border-b border-gray-200/50 dark:border-gray-600/50 transition-colors flex-shrink-0",children:[s.jsx("div",{className:"flex items-center justify-center w-8",children:!m&&s.jsx(ar,{dragHandleProps:{onMouseDown:e=>{if(!g||m)return;if(0!==e.button)return;const t=S.current?.getBoundingClientRect();if(!t)return;const r=y?.x??t.left,a=y?.y??t.top;v.current=!0;const n=window.innerWidth-t.width,i=window.innerHeight-t.height;if(w.current={x:e.clientX,y:e.clientY,initialX:r,initialY:a,maxX:n,maxY:i},S.current&&(S.current.style.willChange="transform"),!y){const e={x:r,y:a};b(e),k.current=e}document.body.style.userSelect="none",window.addEventListener("mousemove",j,{passive:!0}),window.addEventListener("mouseup",D)}},disableNativeDrag:!0,className:"w-4 h-4 rotate-90 flex items-center justify-center"})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:e=>{e.stopPropagation(),p(!m)},className:"p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 rounded transition-colors",title:h(m?"common:action.unlockPosition":"common:action.lockPosition"),children:s.jsx(ct,{name:m?"lock":"unlock",className:"w-3 h-3"})}),s.jsx("button",{onClick:e=>{e.stopPropagation(),f(!x)},className:"p-1 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 rounded transition-colors",title:h(x?"common:action.expand":"common:action.collapse"),children:s.jsx(ct,{name:x?"chevron-up":"chevron-down",className:"w-3 h-3"})})]})]}),!x&&s.jsxs("div",{className:"py-2 flex flex-col w-full animate-fadeIn",children:[T&&s.jsx("div",{className:"mb-4 pb-4 px-4 border-b border-gray-200 dark:border-gray-600",children:s.jsx(Ia,{targetDiceSetType:c,onChange:d,disabled:r,selectedDiceSetsCount:N,selectedDiceSets:A,className:"px-3 py-2 text-sm",t:h})}),s.jsxs("div",{className:"flex flex-row mt-2 px-4 text-xs text-gray-500 dark:text-gray-400",children:[n&&s.jsxs("button",{onClick:t,disabled:r||i,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(r||i?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":h("dice:action.addRoll"),title:i?h("messages:warning.addRollDisabled"):"","data-testid":"add-roll-button",children:[s.jsx("div",{className:"mb-1",children:s.jsx(ct,{name:r?"spinner":"add-roll",className:r?"w-6 h-6 animate-spin":"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:R})]}),s.jsxs("button",{onClick:e,disabled:r,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(r?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":M,"data-testid":"simulate-button",children:[s.jsx("div",{className:"mb-1",children:s.jsx(ct,{name:r?"spinner":"reroll",className:r?"w-6 h-6 animate-spin":"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:E})]})]})]})]})},Oa=a.lazy(()=>D(()=>import("./index-E9JDBaEh.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.SettingsModal}))),Fa=({onReroll:e,onAddRoll:t,isSimulating:r=!1,hasResults:n=!1,isAddRollDisabled:i=!1,diceSets:o=[],selectedDiceSetIds:l=[],targetDiceSetType:c="selected",onTargetDiceSetTypeChange:d,onOpenDiceSetList:u,themeMode:g,onChangeThemeMode:h,transparentExport:m,onChangeTransparentExport:p,onExportData:x,onImportData:f,diceSetsCount:y,chartSettingsCount:b,onAboutClick:v,onChangelogClick:w,chartHeightSettings:S,onChangeChartHeightSettings:k})=>{const{t:C}=$e(["common","diceSets"]),[j,D]=a.useState(!1),[N,A]=a.useState(!1),T=a.useRef(null),M=a.useRef(null),E=l.length,R=!!d;return a.useEffect(()=>{const e=e=>{M.current&&!M.current.contains(e.target)&&T.current&&!T.current.contains(e.target)&&D(!1)};if(j)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[j]),s.jsxs("nav",{className:"pt-2 pb-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 lg:hidden z-50 transition-colors",children:[j&&R&&or.createPortal(s.jsx("div",{ref:M,className:"fixed bottom-24 left-1/2 -translate-x-1/2 z-50",children:s.jsx(La,{onReroll:e,onAddRoll:t,isSimulating:r,hasResults:n,isAddRollDisabled:i,diceSets:o,selectedDiceSetIds:l,targetDiceSetType:c,onTargetDiceSetTypeChange:d})}),document.body),s.jsxs("div",{className:"flex justify-around items-center h-16",children:[s.jsxs("button",{onClick:u,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300","aria-label":C("common:label.list"),children:[s.jsxs("div",{className:"mb-1 relative",children:[s.jsx(ct,{name:"diceSets",className:"w-6 h-6"}),l.length>0&&s.jsx("span",{className:"absolute -top-3 -right-3 bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center",children:Ea(l.length)})]}),s.jsx("span",{className:"text-xs font-medium",children:C("common:label.list")})]}),R&&s.jsxs("button",{ref:T,onClick:()=>{E>0&&D(!j)},className:"flex flex-col items-center justify-center flex-1 h-full transition-colors relative "+(j?"text-accent-light-600 dark:text-accent-dark-400":0===E?"text-gray-300 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),"aria-label":C("common:label.roll"),disabled:r||0===E,children:[s.jsx("div",{className:"mb-1",children:s.jsx(ct,{name:"dice",className:"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:C("common:label.roll")})]}),s.jsxs("button",{onClick:()=>A(!0),className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300","aria-label":C("common:label.settings"),children:[s.jsx("div",{className:"mb-1",children:s.jsx(ct,{name:"settings",className:"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:C("common:label.settings")})]})]}),N&&s.jsx(a.Suspense,{fallback:null,children:s.jsx(Oa,{isOpen:N,onClose:()=>A(!1),darkMode:g,onChangeDarkMode:h,transparentExport:m,onChangeTransparentExport:p,onExportData:x,onImportData:f,diceSetsCount:y,chartSettingsCount:b,onAboutClick:v,onChangelogClick:w,chartHeightSettings:S,onChangeChartHeightSettings:k})})]})},Pa=i.memo(({message:e,onClose:t})=>{const[r,n]=a.useState(!1),[i,o]=a.useState(!1);a.useEffect(()=>{if(e){n(!0),setTimeout(()=>{o(!0)},10);const e=setTimeout(()=>{o(!1),setTimeout(()=>{t(),n(!1)},500)},3e3);return()=>clearTimeout(e)}n(!1),o(!1)},[e,t]);const l=()=>{o(!1),setTimeout(()=>{t(),n(!1)},500)};if(!e||!r)return null;const c={success:"border-green-500 dark:border-green-400",error:"border-red-500 dark:border-red-400",warning:"border-yellow-500 dark:border-yellow-400",info:"border-accent-light-500 dark:border-accent-dark-400"}[e.type],d={success:"text-green-500 dark:text-green-400",error:"text-red-500 dark:text-red-400",warning:"text-yellow-500 dark:text-yellow-400",info:"text-accent-light-500 dark:text-accent-dark-400"}[e.type];return s.jsx("div",{className:"fixed top-18 left-1/2 -translate-x-1/2 z-[10000] w-full max-w-2xl px-4 transition-all duration-500 "+(i?"opacity-100 blur-0":"opacity-0 blur-sm"),children:s.jsxs("div",{onClick:l,className:`bg-white dark:bg-gray-800 text-sm text-gray-900 dark:text-gray-100 px-3 py-2 rounded-md shadow-lg border-l-4 ${c} flex items-center justify-between cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-750 transition-colors`,children:[s.jsxs("div",{className:"flex items-center",children:[s.jsxs("span",{className:`mr-3 text-xl font-bold ${d}`,children:["success"===e.type&&"✓","error"===e.type&&"✕","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),s.jsx("span",{className:"whitespace-pre-line",children:e.text})]}),s.jsx("button",{onClick:l,className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-bold",children:"×"})]})})}),$a="bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-white rounded-lg transition-colors inline-flex items-center justify-center gap-2",Wa=(e,t)=>({name:e?"spinner":t,className:e?"w-6 h-6 animate-spin":"w-6 h-6"}),Va=({targetDiceSetType:e,onChange:t,disabled:r,selectedDiceSetsCount:a,selectedDiceSets:n,className:i="",t:o})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap",children:o("diceSets:target.label")}),s.jsxs("select",{value:e,onChange:e=>t(e.target.value),disabled:r,className:`flex-1 px-4 py-3 bg-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer focus:outline-none disabled:opacity-50 max-w-full truncate ${i}`,children:[s.jsx("option",{value:"selected",children:o("diceSets:target.all",{count:a})}),n.map(e=>s.jsx("option",{value:e.id,children:ft(e)},e.id))]})]}),Ba=({onReroll:e,onAddRoll:t,isSimulating:r,simulationProgress:a=0,hasResults:n,variant:i="large",className:o="",isAddRollDisabled:l=!1,diceSets:c=[],selectedDiceSetIds:d=[],targetDiceSetType:u="selected",onTargetDiceSetTypeChange:g})=>{const{t:h}=$e(["dice","diceSets","messages","common"]),m=d.length,p=c.filter(e=>d.includes(e.id)),x=g&&m>1,f=h(n?"dice:action.reroll":"dice:action.simulate"),y=h(n?"dice:action.reroll":"common:button.start"),b=h("dice:action.addRoll"),v=h("common:button.addRoll");return"large"===i?s.jsxs("div",{className:`flex flex-col gap-2 ${o}`,children:[r&&a>0&&s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:s.jsx("div",{className:"bg-accent-light-500 dark:bg-accent-dark-500 h-2.5 rounded-full transition-all duration-300",style:{width:`${a}%`}})}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 items-stretch lg:items-center",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[n&&s.jsxs("button",{onClick:t,disabled:r||l,className:`${$a} font-bold py-3 px-3 text-lg flex-1`,title:l?h("messages:warning.addRollDisabled"):"","data-testid":"add-roll-button",children:[s.jsx(ct,{...Wa(r,"add-roll"),strokeWidth:1}),s.jsx("span",{className:"hidden lg:inline",children:b}),s.jsx("span",{className:"lg:hidden",children:v})]}),s.jsxs("button",{onClick:e,disabled:r,className:`${$a} font-bold py-3 px-3 text-lg flex-1`,"data-testid":"simulate-button",children:[s.jsx(ct,{...Wa(r,"reroll"),strokeWidth:1}),s.jsx("span",{className:"hidden lg:inline",children:f}),s.jsx("span",{className:"lg:hidden",children:y}),r&&a>0&&s.jsxs("span",{className:"ml-2 text-sm",children:["(",Math.round(a),"%)"]})]})]}),x&&s.jsx(Va,{targetDiceSetType:u,onChange:g,disabled:r,selectedDiceSetsCount:m,selectedDiceSets:p,className:"px-4 py-3 lg:w-auto",t:h})]})]}):s.jsx("div",{className:"fixed bottom-20 mb-4 right-6 left-6 lg:left-auto lg:bottom-6 lg:mb-0 z-[600] lg:w-auto",children:s.jsx(La,{onReroll:e,onAddRoll:t,isSimulating:r,hasResults:n,isAddRollDisabled:l,diceSets:c,selectedDiceSetIds:d,targetDiceSetType:u,onTargetDiceSetTypeChange:g,isDraggable:!0})})};function Ha(e,t=1){if(0===e.length)return{data:[],isAggregated:!1};if(t<=1)return{data:e,isAggregated:!1};const r=e[0][0],a=e[e.length-1][0]-r+1,n=Math.ceil(a/t),i=Math.floor(a/n),s=a%n,o=[];let l=r;for(let c=0;c<n;c++){const t=i+(c<s?1:0),r=l+t-1,a=e.filter(([e])=>e>=l&&e<=r);if(a.length>0){const e=l+t/2,r=a.reduce((e,[,t])=>e+t,0);o.push([Math.round(e),r])}l+=t}return{data:o,isAggregated:!0}}function za(e,t=1e3){const r=e.length;if(r<=t)return e;const a=[];a.push(e[0]);const n=(r-2)/(t-2);let i=0;for(let s=0;s<t-2;s++){const t=Math.floor((s+1)*n)+1,o=Math.floor((s+2)*n)+1,l=Math.min(o,r)-t;let c=0,d=0;for(let a=t;a<Math.min(o,r);a++)c+=e[a].x,d+=e[a].y;c/=l,d/=l;const u=Math.floor(s*n)+1,g=Math.floor((s+1)*n)+1,h=e[i].x,m=e[i].y;let p=-1,x=u;for(let a=u;a<Math.min(g,r);a++){const t=.5*Math.abs((h-c)*(e[a].y-m)-(h-e[a].x)*(d-m));t>p&&(p=t,x=a)}a.push(e[x]),i=x}return a.push(e[r-1]),a}function Ua(e){return e.length>2e3?{data:za(e,1e3),wasDownsampled:!0}:{data:e,wasDownsampled:!1}}function qa(e,t="scott",r=1){if(0===e.length)return 1;if(1===e.length)return 1;const a=e.length;let n;if("scott"===t){const t=e.reduce((e,t)=>e+t,0)/a,r=e.reduce((e,r)=>e+Math.pow(r-t,2),0)/a;n=3.5*Math.sqrt(r)*Math.pow(a,-1/3)}else{const t=[...e].sort((e,t)=>e-t),r=Math.floor(.25*a),i=Math.floor(.75*a),s=t[r];n=2*(t[i]-s)*Math.pow(a,-1/3)}return(n<=0||!isFinite(n))&&(n=1),n=r>1?Math.max(r,Math.ceil(n/r)*r):Math.max(1,Math.round(n)),n}function Ya(e,t=1,r="equal-width"){if(0===e.length)return{data:[],isBinned:!1,binCount:0,binWidth:1};if(t<=1)return{data:e,isBinned:!1,binCount:e.length,binWidth:1};const a=e[0][0],n=e[e.length-1][0]-a+1;if("equal-width"===r){const r=Math.ceil(n/t),i=n/r,s=new Map;for(const[t,n]of e){const e=Math.floor((t-a)/i),o=Math.min(e,r-1),l=s.get(o)||{frequency:0,weightedSum:0};s.set(o,{frequency:l.frequency+n,weightedSum:l.weightedSum+t*n})}const o=Array.from(s.entries()).sort((e,t)=>e[0]-t[0]).map(([,{frequency:e,weightedSum:t}])=>{const r=t/e;return[Math.round(r),e]});return{data:o,isBinned:!0,binCount:o.length,binWidth:i}}{const r=Math.floor(a/t)*t,n=new Map;for(const[a,s]of e){const e=r+Math.floor((a-r)/t)*t,i=n.get(e)||{frequency:0,weightedSum:0};n.set(e,{frequency:i.frequency+s,weightedSum:i.weightedSum+a*s})}const i=Array.from(n.entries()).sort((e,t)=>e[0]-t[0]).map(([,{frequency:e,weightedSum:t}])=>{const r=t/e;return[Math.round(r),e]});return{data:i,isBinned:!0,binCount:i.length,binWidth:t}}}function Xa(e,t,r=0){if(0===e||0===t)return[];const a=e,n=e*t,i=Array(n+1).fill(0);i[0]=1;for(let l=0;l<e;l++){const e=Array(n+1).fill(0);for(let r=0;r<=n;r++)if(0!==i[r])for(let a=1;a<=t;a++){const t=r+a;t<=n&&(e[t]+=i[r])}i.splice(0,i.length,...e)}const s=Math.pow(t,e),o=[];for(let l=a;l<=n;l++){const e=i[l];if(e>0){const t=e/s;o.push([l+r,t])}}return o}function _a(e){const t=document.createElement("div");t.textContent=e;return(t.textContent||"").replace(/[\x00-\x1F\x7F-\x9F]/g,"")}function Ja(e){if("string"!=typeof e)return!1;const t=new Date(e);return!isNaN(t.getTime())&&e===t.toISOString()}function Ka(e,t,r="ダイス設定"){if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: ${r}が不正です`);const a=e;if("number"!=typeof a.diceCount||a.diceCount<1||a.diceCount>et)throw new Error(`ダイスセット${t+1}: ${r}のダイス数が不正です（1-10の範囲）`);if("number"!=typeof a.diceFaces||a.diceFaces<1||a.diceFaces>tt)throw new Error(`ダイスセット${t+1}: ${r}のダイス面数が不正です（1-9999の範囲）`);if(""!==a.modifierSign&&"+"!==a.modifierSign&&"-"!==a.modifierSign)throw new Error(`ダイスセット${t+1}: ${r}の修正値符号が不正です`);if("number"!=typeof a.modifierValue||a.modifierValue<0||a.modifierValue>rt)throw new Error(`ダイスセット${t+1}: ${r}の修正値が不正です（0-99999の範囲）`)}function Qa(e,t,r=!1,a=!1){if(r)return void e.toBlob(e=>{if(!e)throw new Error("画像の生成に失敗しました");const r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},"image/png");const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i&&(i.fillStyle=a?"#1f2937":"#ffffff",i.fillRect(0,0,n.width,n.height),i.drawImage(e,0,0)),n.toBlob(e=>{if(!e)throw new Error("画像の生成に失敗しました");const r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},"image/png")}async function Ga(e){try{await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch{throw new Error("クリップボードへのコピーに失敗しました")}finally{document.body.removeChild(t)}}}function Za(e,t,r=!1,a=!1){if(!e.current)return;Qa(e.current.canvas,`${{total:"total-distribution",individual:"individual-dice",target:"target-value"}[t]}_${Date.now()}.png`,r,a)}const en="chart-settings-migration-v1",tn="chart-settings-binning-migration-v1";async function rn(e){if("completed"===localStorage.getItem(en))return await an(e);const t=e.map(e=>function(e){if(e.widgets&&e.widgets.length>0)return e;const t=e;if(t.chartBoxes&&Array.isArray(t.chartBoxes)&&t.chartBoxes.length>0)return{id:e.id,name:e.name,widgets:t.chartBoxes,createdAt:e.createdAt,updatedAt:(new Date).toISOString(),sortOrder:e.sortOrder};const r=function(e){return bt().map(t=>({...t,...nn(e,t.type)}))}(t),a={id:e.id,name:e.name,widgets:r,createdAt:e.createdAt,updatedAt:(new Date).toISOString(),sortOrder:e.sortOrder};return a}(e));return localStorage.setItem(en,"completed"),await an(t)}async function an(e){if("completed"===localStorage.getItem(tn))return e;const t=e.map(e=>{let t=!1;const r=e.resultChart;let a=r;r&&"useAggregation"in r&&(a={useBinning:r.useAggregation,binningAlgorithm:"scott",binWidthMultiple:1},t=!0);let n=e.widgets;return e.widgets&&e.widgets.length>0&&(n=e.widgets.map(e=>{if("result"===e.type&&e.aggregationSettings&&"useAggregation"in e.aggregationSettings){const r=e.aggregationSettings;return t=!0,{...e,aggregationSettings:{useBinning:r.useAggregation,binningAlgorithm:"scott",binWidthMultiple:1}}}return e})),t?{...e,resultChart:a,widgets:n,updatedAt:(new Date).toISOString()}:e});return localStorage.setItem(tn,"completed"),t}function nn(e,t,r){const a={};switch(t){case"result":e.resultChart&&(a.aggregationSettings=e.resultChart),e.resultChartType&&(a.chartType=e.resultChartType),e.resultChartXScale&&(a.xAxisScale=e.resultChartXScale);break;case"cumulative":e.cumulativeChartType&&(a.chartType=e.cumulativeChartType),e.cumulativeDistributionType&&(a.distributionType=e.cumulativeDistributionType),void 0!==e.cumulativeShowOnlyActualData&&void 0===r?.showOnlyActualData&&(a.showOnlyActualData=e.cumulativeShowOnlyActualData),void 0!==e.cumulativeQuantileCount&&void 0===r?.quantileCount&&(a.quantileCount=e.cumulativeQuantileCount),e.cumulativeChartXScale&&(a.xAxisScale=e.cumulativeChartXScale);break;case"rollProgress":e.rollProgressChart&&(a.aggregationSettings=e.rollProgressChart),e.rollProgressChartType&&(a.chartType=e.rollProgressChartType),e.rollProgressMovingAverageWindow&&(a.movingAverageWindow=e.rollProgressMovingAverageWindow),e.rollProgressChartXScale&&(a.xAxisScale=e.rollProgressChartXScale);break;case"individual":e.individualDiceChart&&(a.aggregationSettings=e.individualDiceChart),e.individualDiceChartType&&(a.chartType=e.individualDiceChartType),e.individualDiceChartXScale&&(a.xAxisScale=e.individualDiceChartXScale)}return a}function sn(){const[e,t]=a.useState(document.documentElement.classList.contains("dark"));return a.useEffect(()=>{const e=new MutationObserver(()=>{t(document.documentElement.classList.contains("dark"))});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),e}function on(){const[e,t]=a.useState([]),[r,n]=a.useState(()=>localStorage.getItem("current-chart-settings-id")||Be),[i,s]=a.useState(!0),[o,l]=a.useState(null);a.useEffect(()=>{(async()=>{try{await async function(){return Mt.ensureDefaultChartSettings()}();const e=await Lt(),r=await rn(e);r!==e&&await Promise.all(r.map(e=>Ot(e))),t(r);const a=localStorage.getItem("current-chart-settings-id");a&&!r.some(e=>e.id===a)&&(n(Be),localStorage.setItem("current-chart-settings-id",Be))}catch(e){l("ダッシュボード設定の読み込みに失敗しました。デフォルト設定にリセットします。"),n(Be),localStorage.setItem("current-chart-settings-id",Be)}finally{s(!1)}})()},[]),a.useEffect(()=>{r&&localStorage.setItem("current-chart-settings-id",r)},[r]);const c=a.useCallback(()=>e.find(e=>e.id===r),[e,r]),d=a.useCallback(async()=>{const e=await Lt();return t(e),e},[]),u=a.useCallback(async(e,t)=>{const r=jt(e);if(!r.valid)throw new Error(r.error);const a=function(e){const t=(new Date).toISOString();return{id:Ct(),name:e.slice(0,wt),widgets:bt(),createdAt:t,updatedAt:t}}(e),i=t?{...a,...t,id:a.id,name:a.name}:a;return await Ot(i),await d(),n(i.id),i},[d]),g=a.useCallback(async(t,r)=>{const a=e.find(e=>e.id===t);if(!a)throw new Error("複製元の設定が見つかりません");const i=function(e,t){const r=(new Date).toISOString();return{...e,id:Ct(),name:(t||`${e.name}のコピー`).slice(0,wt),createdAt:r,updatedAt:r}}(a,r),s=jt(i.name);if(!s.valid)throw new Error(s.error);return await Ot(i),await d(),n(i.id),i},[e,d]),h=a.useCallback(async(t,r)=>{const a=e.find(e=>e.id===t);if(!a)throw new Error("設定が見つかりません");if(St(t))throw new Error("プリセット設定は変更できません");const n={...a,...r,id:a.id,updatedAt:(new Date).toISOString()};if(r.name){const e=jt(r.name);if(!e.valid)throw new Error(e.error)}await Ot(n),await d()},[e,d]),m=a.useCallback(async e=>{if(St(e))throw new Error("プリセット設定は削除できません");await async function(e){return Mt.deleteChartSettings(e)}(e),r===e&&n(Be),await d()},[r,d]),p=a.useCallback(async(e,t)=>{await h(e,{name:t})},[h]),x=a.useCallback(async e=>{t(e);try{for(let t=0;t<e.length;t++){const r={...e[t],sortOrder:t};await Ot(r)}}catch(r){throw new Error("設定の並び替えに失敗しました")}},[]),f=a.useCallback(async(e,t,r)=>{await h(e,{[t]:r})},[h]),y=a.useCallback(async(e,t)=>{await h(e,{resultChart:t})},[h]),b=a.useCallback(async e=>{try{const t=await function(e){return new Promise((t,r)=>{const a=new FileReader;a.onload=e=>{try{const a=e.target?.result,n=JSON.parse(a);if(!Array.isArray(n))return void r(new Error("JSONファイルの形式が正しくありません（配列である必要があります）"));const i=n.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`設定${t+1}: データが不正です`);const r=e;if(!r.id||"string"!=typeof r.id)throw new Error(`設定${t+1}: IDが不正です`);if(void 0===r.name||null===r.name||"string"!=typeof r.name)throw new Error(`設定${t+1}: 名前が不正です`);if(r.name.length>it)throw new Error(`設定${t+1}: 名前が長すぎます（最大128文字）`);if(!Array.isArray(r.widgets))throw new Error(`設定${t+1}: ウィジェットデータが不正です`);if(r.createdAt&&!Ja(r.createdAt))throw new Error(`設定${t+1}: 作成日時の形式が不正です`);if(r.updatedAt&&!Ja(r.updatedAt))throw new Error(`設定${t+1}: 更新日時の形式が不正です`);const a=r.widgets;return{id:r.id,name:_a(r.name),widgets:a.map(e=>e),createdAt:r.createdAt||(new Date).toISOString(),updatedAt:r.updatedAt||(new Date).toISOString()}});t(i)}catch(a){a instanceof Error?r(a):r(new Error("JSONファイルのパースに失敗しました"))}},a.onerror=()=>{r(new Error("ファイルの読み込みに失敗しました"))},a.readAsText(e)})}(e);let r=0;for(const e of t){const t=crypto.randomUUID(),a={...e,id:t,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};await Ot(a),r++}return await d(),r}catch(t){throw t}},[d]);return{chartSettings:e,currentSettingsId:r,setCurrentSettingsId:n,getCurrentSettings:c,isLoading:i,migrationError:o,createSettings:u,duplicateSettings:g,updateSettings:h,deleteSettings:m,renameSettings:p,importSettings:b,reorderSettings:x,updateAggregationSettings:f,updateBinningSettings:y,reloadSettings:d}}function ln(e,t){const r=e?.[t],n=void 0!==r&&"useAggregation"in r?r:void 0,i=e?.id,[s,o]=a.useState(n?.useAggregation??!1),[l,c]=a.useState(n?.aggregationInterval??20);return a.useEffect(()=>{o(n?.useAggregation??!1),c(n?.aggregationInterval??20)},[i,n?.useAggregation,n?.aggregationInterval]),{useAggregation:s,setUseAggregation:o,aggregationInterval:l,setAggregationInterval:c}}function cn(e,t){const r=e?.[t],n=e?.id,[i,s]=a.useState(r??"bar");return a.useEffect(()=>{s(r??"bar")},[n,r]),{chartType:i,setChartType:s}}function dn(e,t){const r=e?.[t],n=e?.id,i=JSON.stringify(r),[s,o]=a.useState(r??{mode:"auto"});return a.useEffect(()=>{const e=i?JSON.parse(i):void 0;o(e??{mode:"auto"})},[n,i]),{xAxisScale:s,setXAxisScale:o}}function un(e,t){const r=e?.[t],n=e?.id,i=JSON.stringify(r),[s,o]=a.useState(r??{mode:"auto"});return a.useEffect(()=>{const e=i?JSON.parse(i):void 0;o(e??{mode:"auto"})},[n,i]),{yAxisScale:s,setYAxisScale:o}}function gn(){const[e,t]=a.useState(()=>"true"===localStorage.getItem("transparentExport"));return a.useEffect(()=>{const e=()=>{t("true"===localStorage.getItem("transparentExport"))};window.addEventListener("transparentExportChanged",e);const r=e=>{"transparentExport"===e.key&&t("true"===e.newValue)};return window.addEventListener("storage",r),()=>{window.removeEventListener("transparentExportChanged",e),window.removeEventListener("storage",r)}},[]),e}function hn(e,t,r,n){const i=a.useRef([]);return a.useCallback(()=>{if(!t.current)return[];const a=t.current.data.datasets||[],s=r?.hiddenLegends||[],o=a.map(r=>{const a=r.label||"";let i;a.includes("理論値")||a.includes("Theoretical")?i="theoretical":a.includes("実測値")||a.includes("Actual")?i="actual":a.includes("中央値")||a.includes("Median")?i="median":a.includes("移動平均")||a.includes("Moving Average")?i="movingAverage":(a.includes("期待値")||a.includes("Expected"))&&(i="expectedValue");const o=Array.isArray(r.backgroundColor)?r.backgroundColor[0]:r.backgroundColor,l=Array.isArray(r.borderColor)?r.borderColor[0]:r.borderColor,c=Array.isArray(r.borderDash)?r.borderDash:void 0,d=s.includes(a);return{label:a,color:o||"#999",borderColor:l||void 0,borderWidth:r.borderWidth||1,borderDash:c,chartType:e,datasetType:i,hidden:d,onClick:()=>{const e=t.current;if(!e)return;const r=e.data.datasets||[],i=[...s];r.forEach((t,r)=>{if(t.label===a){const t=e.getDatasetMeta(r);t.hidden=!t.hidden;const n=i.indexOf(a);t.hidden&&-1===n?i.push(a):t.hidden||-1===n||i.splice(n,1)}}),e.update(),n&&n(i)}}});return i.current=o,o},[e,t,r,n])()}function mn(e,t,r,a){if(!t.current)return[];const n=t.current.data.datasets||[],i=[];return n.map(r=>{const a=r.label||"";let n;a.includes("理論値")||a.includes("Theoretical")?n="theoretical":a.includes("実測値")||a.includes("Actual")?n="actual":a.includes("中央値")||a.includes("Median")?n="median":a.includes("移動平均")||a.includes("Moving Average")?n="movingAverage":(a.includes("期待値")||a.includes("Expected"))&&(n="expectedValue");const s=Array.isArray(r.backgroundColor)?r.backgroundColor[0]:r.backgroundColor,o=Array.isArray(r.borderColor)?r.borderColor[0]:r.borderColor,l=Array.isArray(r.borderDash)?r.borderDash:void 0,c=i.includes(a);return{label:a,color:s||"#999",borderColor:o||void 0,borderWidth:r.borderWidth||1,borderDash:l,chartType:e,datasetType:n,hidden:c,onClick:()=>{const e=t.current;if(!e)return;const r=e.data.datasets||[],n=[...i];r.forEach((t,r)=>{if(t.label===a){const t=e.getDatasetMeta(r);t.hidden=!t.hidden;const i=n.indexOf(a);t.hidden&&-1===i?n.push(a):t.hidden||-1===i||n.splice(i,1)}}),e.update()}}})}o.register(l,c,d,u,g,h,m,p,x,f);const pn=e=>{if("fixed-height"===e.mode)return{height:`${e.fixedHeight??400}px`,width:"100%",position:"relative"};const t=e.aspectRatioWidth??16;return{width:"100%",position:"relative",paddingBottom:`${(e.aspectRatioHeight??9)/t*100}%`,height:0}},xn=e=>"fixed-height"===e.mode?{width:"100%",height:"100%"}:{position:"absolute",top:0,left:0,right:0,bottom:0},fn=(e,t)=>({...t,responsive:!0,maintainAspectRatio:!1});class yn{constructor(){t(this,"items",[]),t(this,"cachedItems",null)}addItem(e){this.items.find(t=>t.id===e.id),this.items.push(e),this.cachedItems=null}removeItem(e){const t=this.items.length;return this.items=this.items.filter(t=>t.id!==e),this.cachedItems=null,t-this.items.length}disableItem(e){let t=0;return this.items.forEach(r=>{r.id!==e||r.disabled||(r.disabled=!0,t++)}),t>0&&(this.cachedItems=null),t}enableItem(e){let t=0;return this.items.forEach(r=>{r.id===e&&r.disabled&&(r.disabled=!1,t++)}),t>0&&(this.cachedItems=null),t}getItems(){if(null!==this.cachedItems)return this.cachedItems;const e=this.items.filter(e=>!e.disabled&&!(e.condition&&!e.condition())).sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:this.items.indexOf(e)-this.items.indexOf(t));return this.cachedItems=e,e}debugItems(){}}const bn=({value:e,min:t,max:r,onChange:n,disabled:i=!1,className:o=""})=>{const[l,c]=a.useState(String(e)),d=a.useRef(null);a.useEffect(()=>{c(String(e))},[e]);const u=a.useCallback(e=>e.replace(/[^0-9]/g,""),[]),g=a.useCallback(e=>Math.min(Math.max(e,t),r),[t,r]),h=a.useCallback(e=>{const t=u(e.target.value);c(t)},[u]),m=a.useCallback(()=>{const e=u(l);let r;r=""===e?t:g(parseInt(e,10)),c(String(r)),n(r)},[l,u,g,n,t]),p=a.useCallback(()=>{m()},[m]),x=a.useCallback(e=>{"Enter"===e.key&&(m(),d.current?.blur())},[m]);return s.jsx("input",{ref:d,type:"text",inputMode:"numeric",pattern:"[0-9]*",value:l,onChange:h,onBlur:p,onKeyDown:x,disabled:i,className:o})},vn=({conditions:e,onChange:t,t:r})=>s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:r("charts:recentRolls.highlightLabel")}),s.jsx(Vr,{value:e,onChange:e=>t?.(e),showTargetSelector:!1,t:r}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"カンマまたはスペース区切りで複数指定可能（例：2,5,8）。範囲指定はハイフン（例：50-100）。倍数指定も可能（例：2n, 5n+3）。最大値/最小値指定はmax/min"})]});function wn(e){const{t:t}=$e(),r=i.useRef(e);r.current=e;const n=a.useRef(null);n.current||(n.current=new yn);const o=n.current,l=a.useMemo(()=>["widget-type","chart-settings","appearance","aggregation","binning","target-value","moving-average","recent-rolls-count","highlight-conditions","x-axis-scale","y-axis-scale","fullscreen","download","custom-children"],[]);a.useEffect(()=>{l.forEach(e=>{o.removeItem(e)}),e.showWidgetTypeSelector&&o.addItem({id:"widget-type",priority:ze,render:()=>{const e=r.current;return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:t("charts:options.widgetType")}),s.jsxs("select",{value:e.widgetType,onChange:t=>e.onWidgetTypeChange?.(t.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"result",children:t("charts:widget.graphTypes.result")}),s.jsx("option",{value:"cumulative",children:t("charts:widget.graphTypes.cumulative")}),s.jsx("option",{value:"rollProgress",children:t("charts:widget.graphTypes.rollProgress")}),s.jsx("option",{value:"individual",children:t("charts:widget.graphTypes.individual")}),s.jsx("option",{value:"recentRolls",children:t("charts:widget.graphTypes.recentRolls")})]})]},"widget-type")}}),e.showChartSettingsSelector&&o.addItem({id:"chart-settings",priority:Ue,render:()=>{const e=r.current;return s.jsxs(tr,{id:"chart-settings",title:t("charts:options.displaySettings"),children:[s.jsx("select",{value:e.currentChartSettingsId,onChange:t=>e.onSelectChartSettings?.(t.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:e.chartSettings?.map(e=>s.jsx("option",{value:e.id,children:e.name.length>30?e.name.substring(0,30)+"...":e.name},e.id))}),e.onManageChartSettings&&s.jsx("button",{onClick:()=>{e.onManageChartSettings?.(),e.closeMenu?.()},className:"w-full mt-2 px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-xs transition-colors",children:t("charts:options.manageSettings")})]},"chart-settings")}}),e.showChartTypeToggle&&o.addItem({id:"appearance",priority:qe,render:()=>{const e=r.current;return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:t("charts:options.chartType")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>{e.onChartTypeChange?.("bar"),e.closeMenu?.()},className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-2 "+("bar"===e.chartType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),title:t("charts:type.bar"),children:[s.jsx(ct,{name:"bar-chart",className:"w-4 h-4"}),s.jsx("span",{className:"hidden md:inline",children:t("charts:type.bar")})]}),s.jsxs("button",{onClick:()=>{e.onChartTypeChange?.("line"),e.closeMenu?.()},className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-2 "+("line"===e.chartType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),title:t("charts:type.line"),children:[s.jsx(ct,{name:"line-chart",className:"w-4 h-4"}),s.jsx("span",{className:"hidden md:inline",children:t("charts:type.line")})]})]})]},"appearance")}}),e.showBinningSettings&&o.addItem({id:"binning",priority:Ye,render:()=>{const e=r.current;return s.jsxs(tr,{id:"binning",title:t("charts:options.binning.title"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:t("charts:options.binning.useBinning")}),s.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:e.useBinning,onChange:t=>{e.onBinningChange?.({useBinning:t.target.checked,binningAlgorithm:e.binningAlgorithm||"scott",binWidthMultiple:e.binWidthMultiple||1})},className:"sr-only peer"}),s.jsx("div",{className:"relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent-light-300 dark:peer-focus:ring-accent-dark-300 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-accent-light-500 dark:peer-checked:bg-accent-dark-500"})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.binning.algorithm")}),s.jsxs("select",{value:e.binningAlgorithm||"equal-width",onChange:t=>{e.onBinningChange?.({useBinning:e.useBinning??!1,binningAlgorithm:t.target.value,binWidthMultiple:e.binWidthMultiple||1})},disabled:!e.useBinning,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("option",{value:"equal-width",children:t("charts:options.binning.equalWidth")}),s.jsx("option",{value:"scott",children:t("charts:options.binning.scott")}),s.jsx("option",{value:"fd",children:t("charts:options.binning.fd")})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.binning.binWidthMultiple")}),s.jsx(bn,{value:e.binWidthMultiple||1,min:1,max:Ve,onChange:t=>{e.onBinningChange?.({useBinning:e.useBinning??!1,binningAlgorithm:e.binningAlgorithm||"equal-width",binWidthMultiple:t})},disabled:!e.useBinning,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"})]}),s.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[s.jsx("p",{children:t("charts:options.binning.status",{count:e.currentDataPoints})}),e.isBinned&&s.jsx("p",{className:"text-accent-light-600 dark:text-accent-dark-400",children:t("charts:options.binning.statusBinned",{binCount:e.binCount,binWidth:e.binWidth})})]})]},"binning")}}),e.showAggregationSettings&&o.addItem({id:"aggregation",priority:Ye,render:()=>{const e=r.current;return s.jsxs(tr,{id:"aggregation",title:t("charts:options.aggregation.title"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:t("charts:options.aggregation.useAggregation")}),s.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:e.useAggregation,onChange:t=>{e.onAggregationChange?.({useAggregation:t.target.checked,aggregationInterval:e.aggregationInterval||2})},className:"sr-only peer"}),s.jsx("div",{className:"relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent-light-300 dark:peer-focus:ring-accent-dark-300 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-accent-light-500 dark:peer-checked:bg-accent-dark-500"})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.aggregation.intervalLabel")}),s.jsx(bn,{value:e.aggregationInterval||2,min:2,max:st,onChange:t=>{e.onAggregationChange?.({useAggregation:e.useAggregation??!1,aggregationInterval:t})},disabled:!e.useAggregation,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"})]}),s.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[s.jsx("p",{children:t("charts:options.aggregation.status",{count:e.currentDataPoints})}),e.isAggregated&&s.jsx("p",{className:"text-accent-light-600 dark:text-accent-dark-400",children:t("charts:options.aggregation.statusAggregated",{interval:e.aggregationInterval})})]})]},"aggregation")}}),e.showTargetValueSettings&&o.addItem({id:"target-value",priority:Xe,render:()=>{const e=r.current;return s.jsxs(tr,{id:"target-value",title:t("charts:options.targetValue.title"),children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.targetValue.label")}),s.jsx(bn,{value:e.targetValue||e.minTargetValue||1,min:e.minTargetValue||1,max:e.maxTargetValue||6,onChange:t=>{e.onTargetValueChange?.(t)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t("charts:options.targetValue.range",{min:e.minTargetValue,max:e.maxTargetValue})})]},"target-value")}}),e.showMovingAverageSettings&&o.addItem({id:"moving-average",priority:_e,render:()=>{const e=r.current;return s.jsxs(tr,{id:"moving-average",title:t("charts:options.movingAverage.title"),children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.movingAverage.windowLabel")}),s.jsx(bn,{value:e.movingAverageWindow||20,min:2,max:100,onChange:t=>{e.onMovingAverageWindowChange?.(t)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"2-100の範囲で指定"})]},"moving-average")}}),e.showRecentRollsCountSettings&&o.addItem({id:"recent-rolls-count",priority:650,render:()=>{const e=r.current,a=e.recentRollsCount||1;return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:t("charts:recentRolls.countLabel")}),s.jsx("select",{value:a,onChange:t=>{e.onRecentRollsCountChange?.(Number(t.target.value)),e.closeMenu?.()},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[1,2,3].map(e=>s.jsx("option",{value:e,children:t("charts:recentRolls.countOption",{count:e})},e))})]},"recent-rolls-count")}}),e.showHighlightConditionsSettings&&o.addItem({id:"highlight-conditions",priority:655,render:()=>{const e=r.current;return s.jsx(vn,{conditions:e.highlightConditions,onChange:e.onHighlightConditionsChange,t:t})}}),e.showXAxisScaleSettings&&o.addItem({id:"x-axis-scale",priority:Je,render:()=>{const e=r.current;return s.jsxs(tr,{id:"x-axis-scale",title:t("charts:options.xAxisScale.title"),children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"x-axis-scale-mode",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.xAxisScale.mode")}),s.jsxs("select",{id:"x-axis-scale-mode",value:e.xAxisScale?.mode||"auto",onChange:t=>{const r=t.target.value,a={mode:r};"semi-auto"===r&&(a.initialMin=e.xAxisScale?.initialMin,a.initialMax=e.xAxisScale?.initialMax),e.onXAxisScaleChange?.(a)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"auto",children:t("charts:options.xAxisScale.auto")}),s.jsx("option",{value:"semi-auto",children:t("charts:options.xAxisScale.semiAuto")}),s.jsx("option",{value:"manual",children:t("charts:options.xAxisScale.manual")})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t(`charts:options.xAxisScale.description.${e.xAxisScale?.mode||"auto"}`)})]}),"manual"===(e.xAxisScale?.mode||"auto")&&s.jsxs("div",{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"x-axis-scale-min",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.xAxisScale.min")}),s.jsx("input",{id:"x-axis-scale-min",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.xAxisScale?.min?.toString()||"",onChange:t=>{const r=""!==t.target.value?parseFloat(t.target.value):void 0;e.onXAxisScaleChange?.({mode:"manual",min:r,max:e.xAxisScale?.max})},placeholder:t("charts:options.xAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"x-axis-scale-max",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.xAxisScale.max")}),s.jsx("input",{id:"x-axis-scale-max",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.xAxisScale?.max?.toString()||"",onChange:t=>{const r=""!==t.target.value?parseFloat(t.target.value):void 0;e.onXAxisScaleChange?.({mode:"manual",min:e.xAxisScale?.min,max:r})},placeholder:t("charts:options.xAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("charts:options.xAxisScale.manualHelp")})]})]},"x-axis-scale")}}),e.showYAxisScaleSettings&&o.addItem({id:"y-axis-scale",priority:Qe,render:()=>{const e=r.current;return s.jsxs(tr,{id:"y-axis-scale",title:t("charts:options.yAxisScale.title"),children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"y-axis-scale-mode",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.yAxisScale.mode")}),s.jsxs("select",{id:"y-axis-scale-mode",value:e.yAxisScale?.mode||"auto",onChange:t=>{const r=t.target.value,a={mode:r};"semi-auto"===r&&(a.initialMin=e.yAxisScale?.initialMin,a.initialMax=e.yAxisScale?.initialMax),e.onYAxisScaleChange?.(a)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"auto",children:t("charts:options.yAxisScale.auto")}),s.jsx("option",{value:"semi-auto",children:t("charts:options.yAxisScale.semiAuto")}),s.jsx("option",{value:"manual",children:t("charts:options.yAxisScale.manual")})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t(`charts:options.yAxisScale.description.${e.yAxisScale?.mode||"auto"}`)})]}),"manual"===(e.yAxisScale?.mode||"auto")&&s.jsxs("div",{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"y-axis-scale-min",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.yAxisScale.min")}),s.jsx("input",{id:"y-axis-scale-min",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.yAxisScale?.min?.toString()||"",onChange:t=>{const r=""!==t.target.value?parseFloat(t.target.value):void 0;e.onYAxisScaleChange?.({mode:"manual",min:r,max:e.yAxisScale?.max})},placeholder:t("charts:options.yAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"y-axis-scale-max",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.yAxisScale.max")}),s.jsx("input",{id:"y-axis-scale-max",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.yAxisScale?.max?.toString()||"",onChange:t=>{const r=""!==t.target.value?parseFloat(t.target.value):void 0;e.onYAxisScaleChange?.({mode:"manual",min:e.yAxisScale?.min,max:r})},placeholder:t("charts:options.yAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("charts:options.yAxisScale.manualHelp")})]})]},"y-axis-scale")}}),e.children&&o.addItem({id:"custom-children",priority:e.childrenPriority||Ke,render:()=>s.jsx(i.Fragment,{children:r.current.children},"custom-children")}),e.onOpenFullscreen&&o.addItem({id:"fullscreen",priority:950,render:()=>{const e=r.current;return s.jsxs("button",{onClick:()=>{e.onOpenFullscreen?.(),e.closeMenu?.()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})}),s.jsx("span",{className:"text-sm",children:t("charts:menu.fullScreen")})]},"fullscreen")}}),e.onDownloadImage&&o.addItem({id:"download",priority:Ge,render:()=>{const e=r.current;return s.jsxs("button",{onClick:()=>{e.onDownloadImage?.(),e.closeMenu?.()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),s.jsx("polyline",{points:"21 15 16 10 5 21"})]}),s.jsx("span",{className:"text-sm",children:t("charts:options.download")})]},"download")}})},[o,l,e.showWidgetTypeSelector,e.showChartSettingsSelector,e.showChartTypeToggle,e.showAggregationSettings,e.showBinningSettings,e.showTargetValueSettings,e.showMovingAverageSettings,e.showRecentRollsCountSettings,e.showHighlightConditionsSettings,e.showXAxisScaleSettings,e.showYAxisScaleSettings,e.children,e.childrenPriority,e.onOpenFullscreen,e.onDownloadImage,t]);const c=a.useCallback(e=>{o.addItem(e)},[]),d=a.useCallback(e=>{o.removeItem(e)},[]),u=a.useCallback(e=>{o.disableItem(e)},[]),g=a.useCallback(e=>{o.enableItem(e)},[]);return{manager:o,addCustomItem:c,removeItem:d,disableItem:u,enableItem:g}}const Sn=({chartType:e,onChartTypeChange:t,onDownloadImage:r,showChartTypeToggle:n=!0,showAggregationSettings:o=!1,useAggregation:l=!1,aggregationInterval:c=10,onAggregationChange:d,currentDataPoints:u=0,isAggregated:g=!1,showTargetValueSettings:h=!1,targetValue:m=1,minTargetValue:p=1,maxTargetValue:x=6,onTargetValueChange:f,showMovingAverageSettings:y=!1,movingAverageWindow:b=20,onMovingAverageWindowChange:v,showRecentRollsCountSettings:w=!1,recentRollsCount:S=1,onRecentRollsCountChange:k,showHighlightConditionsSettings:C=!1,highlightConditions:j=[],onHighlightConditionsChange:D,showXAxisScaleSettings:N=!1,xAxisScale:A={mode:"auto"},onXAxisScaleChange:T,showYAxisScaleSettings:M=!1,yAxisScale:E={mode:"auto"},onYAxisScaleChange:R,showChartSettingsSelector:I=!1,chartSettings:L=[],currentChartSettingsId:O="",onSelectChartSettings:F,onManageChartSettings:P,showWidgetTypeSelector:$=!1,widgetType:W="result",onWidgetTypeChange:V,children:B,childrenPriority:H=850,menuManager:z})=>{const{t:U}=$e(["charts"]),[q,Y]=i.useState(!1),X=a.useRef(null),_=a.useRef(null),J=wn({showWidgetTypeSelector:$,widgetType:W,onWidgetTypeChange:V,showChartSettingsSelector:I,chartSettings:L,currentChartSettingsId:O,onSelectChartSettings:F,onManageChartSettings:P,showChartTypeToggle:n,chartType:e,onChartTypeChange:t,showAggregationSettings:o,useAggregation:l,aggregationInterval:c,onAggregationChange:d,currentDataPoints:u,isAggregated:g,showTargetValueSettings:h,targetValue:m,minTargetValue:p,maxTargetValue:x,onTargetValueChange:f,showMovingAverageSettings:y,movingAverageWindow:b,onMovingAverageWindowChange:v,showRecentRollsCountSettings:w,recentRollsCount:S,onRecentRollsCountChange:k,showHighlightConditionsSettings:C,highlightConditions:j,onHighlightConditionsChange:D,showXAxisScaleSettings:N,xAxisScale:A,onXAxisScaleChange:T,showYAxisScaleSettings:M,yAxisScale:E,onYAxisScaleChange:R,children:B,childrenPriority:H,onDownloadImage:r,closeMenu:()=>Y(!1)}),K=z||J.manager;a.useEffect(()=>{const e=e=>{X.current&&!X.current.contains(e.target)&&_.current&&!_.current.contains(e.target)&&Y(!1)};if(q)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[q]);return s.jsxs("div",{className:"relative",children:[s.jsx("button",{ref:_,onClick:()=>{Y(!q)},className:"w-8 h-8 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center z-10",title:U("charts:options.title"),children:s.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"5",r:"1"}),s.jsx("circle",{cx:"12",cy:"12",r:"1"}),s.jsx("circle",{cx:"12",cy:"19",r:"1"})]})}),s.jsx("div",{ref:X,className:"absolute right-0 top-full mt-2 w-72 bg-white dark:bg-gray-700 rounded-lg shadow-lg overflow-hidden border border-gray-200 dark:border-gray-600 z-50 overflow-y-auto transition-opacity "+(q?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:s.jsx(er,{multipleExpanded:!0,children:K.getItems().map(e=>s.jsx(i.Fragment,{children:e.render()},e.id))})})]})};function kn(e){return void 0!==e&&"useAggregation"in e}function Cn(e){return void 0!==e&&"useBinning"in e}const jn=({widgets:e,activeTab:t,onSelect:r,onReorder:a,onDelete:n,t:i,renderContent:o})=>{const{getDragHandleProps:l,handleDragOver:c,handleDrop:d,handleTouchStart:u,handleTouchMove:g,handleTouchEnd:h,getItemStyle:m,isItemDropTarget:p,draggedIndex:x,touchDraggedIndex:f}=Wr({items:e,onReorder:a});return s.jsx("div",{className:"space-y-2 md:space-y-1",children:e.map((a,y)=>{const b=(e=>{switch(e){case"result":return"chart-total-distribution";case"cumulative":return"chart-cumulative-distribution";case"rollProgress":return"chart-roll-progress";case"individual":return"chart-individual-dice";case"recentRolls":return"dice";default:return"chart-bar"}})(a.type),v=e.filter((e,t)=>t<=y&&e.type===a.type).length,w=a.customName||vt(a.type,v,i),S=t===y.toString(),k=p(y),C=!!o,j=x??f,D=k&&!(j===y),N=null!==j&&j<y?"bottom-0 translate-y-1/2":"top-0 -translate-y-1/2";return s.jsxs("div",{draggable:!S||!C,onDragStart:e=>l(y).onDragStart?.(e),onDragEnd:e=>l(y).onDragEnd?.(e),onDragOver:e=>c(e,y),onDrop:e=>d(e,y),onTouchStart:e=>u(e,y),onTouchMove:e=>g(e,y),onTouchEnd:()=>h(y),style:m(y),className:`flex flex-col rounded-lg transition-all group relative border ${S?"border-accent-light-500/30 dark:border-accent-dark-500/30 bg-white dark:bg-gray-800 shadow-sm":"border-transparent bg-transparent hover:bg-gray-100 dark:hover:bg-gray-700"} ${k?"z-10 bg-accent-light-50 dark:bg-accent-dark-900/10":""}`,children:[D&&s.jsx("div",{className:`absolute left-0 right-0 h-0.5 bg-accent-light-500 dark:bg-accent-dark-500 shadow-[0_0_4px_rgba(var(--accent-light-500),0.5)] z-20 pointer-events-none transform ${N} rounded-full mx-1`}),s.jsxs("div",{className:"flex items-center gap-2 w-full py-2.5 px-2 cursor-pointer "+(S&&!C?"bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded-lg":""),onClick:()=>r(y.toString()),children:[s.jsx("div",{onClick:e=>e.stopPropagation(),className:"cursor-grab active:cursor-grabbing p-1 rounded hover:bg-black/10 dark:hover:bg-white/10 "+(S&&!C?"text-white/80":"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"),children:s.jsx(ar,{dragHandleProps:l(y),isDragging:!1,className:S&&!C?"!text-white":void 0})}),s.jsx(ct,{name:b,className:"w-4 h-4 flex-shrink-0 "+(S&&!C?"text-white":"text-gray-500 dark:text-gray-400")}),s.jsx("span",{className:"truncate select-none text-sm font-medium flex-1 "+(S&&!C?"text-white":"text-gray-700 dark:text-gray-300"),children:w}),s.jsx("div",{onClick:e=>{e.stopPropagation(),window.confirm(i("common:confirmDelete"))&&n(y)},className:"p-1.5 rounded-full transition-colors "+(S&&!C?"text-white/70 hover:text-white hover:bg-white/20":"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20"),title:i("common:delete"),role:"button","aria-label":i("common:delete"),children:s.jsx(ct,{name:"close",className:"w-4 h-4"})}),C&&s.jsx(ct,{name:"chevron-down",className:"w-4 h-4 flex-shrink-0 transition-transform "+(S?"rotate-180 text-accent-light-500 dark:text-accent-dark-500":"text-gray-400")})]}),C&&S&&s.jsx("div",{className:"px-4 pb-4 pt-2 border-t border-gray-100 dark:border-gray-700/50 cursor-default",onClick:e=>e.stopPropagation(),children:o(a,y)})]},a.id)})})},Dn=({settings:e,onChange:t,showAllCharts:r=!0,activeTab:n,onActiveTabChange:i})=>{const{t:o}=$e(["charts","common"]),[l,c]=a.useState("0"),d=void 0!==n?n:l,u=i||c,g=e?.widgets||[],h=(e,r)=>{const a=[...g];a[e]={...a[e],chartType:r},t({widgets:a})},m=(e,r)=>{const a=[...g];a[e]={...a[e],aggregationSettings:r},t({widgets:a})},p=(e,r)=>{const a=[...g];a[e]={...a[e],aggregationSettings:r},t({widgets:a})},x=(e,r)=>{const a=[...g];a[e]={...a[e],distributionType:r},t({widgets:a})},f=(e,r)=>{const a=[...g];a[e]={...a[e],quantileCount:r},t({widgets:a})},y=e=>{const r=[...g];r.splice(e,1),t({widgets:r});const a=parseInt(d);if(a===e){const t=Math.max(0,Math.min(e,r.length-1));u(t.toString())}else a>e&&u((a-1).toString())},b=(r,a)=>{const n="rollProgress"!==a.type&&"recentRolls"!==a.type,i="result"===a.type,l="rollProgress"===a.type||"individual"===a.type,c="recentRolls"!==a.type;return s.jsxs("div",{className:"space-y-3",children:[n&&s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("charts:options.chartType")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>h(r,"bar"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-1.5 "+("bar"===(a.chartType||"bar")?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:[s.jsx(ct,{name:"bar-chart",className:"w-4 h-4"}),o("charts:type.bar")]}),s.jsxs("button",{onClick:()=>h(r,"line"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-1.5 "+("line"===a.chartType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:[s.jsx(ct,{name:"line-chart",className:"w-4 h-4",strokeWidth:1.5}),o("charts:type.line")]})]})]}),i&&(()=>{const t=a.aggregationSettings??e?.resultChart,n=!!Cn(t)&&t.useBinning,i=Cn(t)?t.binningAlgorithm:"equal-width",l=Cn(t)?t.binWidthMultiple:1;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.binning.useBinning")}),s.jsx(pr,{checked:n,onChange:e=>p(r,{useBinning:e,binningAlgorithm:i,binWidthMultiple:l}),label:o("charts:options.binning.useBinning"),size:"small"})]}),n&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 block mb-1",children:o("charts:options.binning.algorithm")}),s.jsxs("select",{value:i,onChange:e=>{p(r,{useBinning:!0,binningAlgorithm:e.target.value,binWidthMultiple:l})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[s.jsx("option",{value:"equal-width",children:o("charts:options.binning.equalWidth")}),s.jsx("option",{value:"scott",children:o("charts:options.binning.scott")}),s.jsx("option",{value:"fd",children:o("charts:options.binning.fd")})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 block mb-1",children:o("charts:options.binning.binWidthMultiple")}),s.jsx("input",{type:"number",min:1,max:Ve,value:l,onChange:e=>{const t=""===e.target.value?1:parseInt(e.target.value);p(r,{useBinning:!0,binningAlgorithm:i,binWidthMultiple:t})},onBlur:e=>{const t=parseInt(e.target.value)||1,a=Math.max(1,Math.min(Ve,t));p(r,{useBinning:!0,binningAlgorithm:i,binWidthMultiple:a})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]})})(),l&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.useAggregation")}),s.jsx(pr,{checked:!!kn(a.aggregationSettings)&&a.aggregationSettings.useAggregation,onChange:e=>m(r,{useAggregation:e,aggregationInterval:kn(a.aggregationSettings)?a.aggregationSettings.aggregationInterval:20}),label:o("charts:options.useAggregation"),size:"small"})]}),kn(a.aggregationSettings)&&a.aggregationSettings.useAggregation&&s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:o("charts:options.aggregationInterval")}),s.jsx("input",{type:"number",min:2,max:st,value:a.aggregationSettings.aggregationInterval,onChange:e=>{const t=""===e.target.value?2:parseInt(e.target.value);m(r,{useAggregation:!0,aggregationInterval:t})},onBlur:e=>{const t=parseInt(e.target.value)||2,a=Math.max(2,Math.min(st,t));m(r,{useAggregation:!0,aggregationInterval:a})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),c&&s.jsx(Nn,{chartKey:r.toString(),settings:a.xAxisScale,onChange:(e,a)=>((e,r)=>{const a=[...g],n={mode:"auto",...a[e].xAxisScale,...r};"manual"!==n.mode&&(delete n.min,delete n.max),a[e]={...a[e],xAxisScale:n},t({widgets:a})})(r,a),t:o}),"recentRolls"!==a.type&&s.jsx(An,{chartKey:r.toString(),settings:a.yAxisScale,onChange:(e,a)=>((e,r)=>{const a=[...g],n={mode:"auto",...a[e].yAxisScale,...r};"manual"!==n.mode&&(delete n.min,delete n.max),a[e]={...a[e],yAxisScale:n},t({widgets:a})})(r,a),t:o})]})},v=(e,r)=>{switch(r.type){case"rollProgress":return s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 block mb-2",children:o("charts:options.movingAverageWindow")}),s.jsx("input",{type:"number",min:2,max:1e3,value:r.movingAverageWindow||20,onChange:r=>{const a=parseInt(r.target.value)||2;((e,r)=>{const a=[...g];a[e]={...a[e],movingAverageWindow:r},t({widgets:a})})(e,Math.max(2,Math.min(1e3,a)))},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]});case"cumulative":return s.jsxs("div",{className:"mt-3 space-y-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("charts:options.cumulativeType")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>x(e,"total"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors "+("total"===(r.distributionType||"total")?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:o("charts:options.cumulativeTotal")}),s.jsx("button",{onClick:()=>x(e,"individual"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors "+("individual"===r.distributionType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:o("charts:options.cumulativeIndividual")})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.cumulativeShowOnlyActual")}),s.jsx(pr,{checked:r.showOnlyActualData||!1,onChange:r=>((e,r)=>{const a=[...g];a[e]={...a[e],showOnlyActualData:r},t({widgets:a})})(e,r),label:o("charts:options.cumulativeShowOnlyActual"),size:"small"})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.cumulativeQuantile")}),s.jsx(pr,{checked:null!==r.quantileCount&&void 0!==r.quantileCount,onChange:t=>f(e,t?10:null),label:o("charts:options.cumulativeQuantile"),size:"small"})]}),null!==r.quantileCount&&void 0!==r.quantileCount&&s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:o("charts:options.cumulativeQuantileCount")}),s.jsxs("select",{value:r.quantileCount||10,onChange:t=>{const r=Number(t.target.value);f(e,r)},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[s.jsx("option",{value:"10",children:o("charts:options.cumulative.points",{count:10})}),s.jsx("option",{value:"20",children:o("charts:options.cumulative.points",{count:20})}),s.jsx("option",{value:"50",children:o("charts:options.cumulative.points",{count:50})}),s.jsx("option",{value:"100",children:o("charts:options.cumulative.points",{count:100})})]})]})]})]});case"recentRolls":return s.jsxs("div",{className:"mt-3 space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 block mb-2",children:o("charts:recentRolls.countLabel")}),s.jsxs("select",{value:r.recentRollsCount||1,onChange:r=>{const a=Number(r.target.value);((e,r)=>{const a=[...g];a[e]={...a[e],recentRollsCount:r},t({widgets:a})})(e,a)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[s.jsx("option",{value:"1",children:o("charts:recentRolls.countOption",{count:1})}),s.jsx("option",{value:"2",children:o("charts:recentRolls.countOption",{count:2})}),s.jsx("option",{value:"3",children:o("charts:recentRolls.countOption",{count:3})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 block mb-2",children:o("charts:recentRolls.highlightLabel")}),s.jsx(Vr,{value:r.highlightConditions,onChange:r=>((e,r)=>{const a=[...g];a[e]={...a[e],highlightConditions:r},t({widgets:a})})(e,r),showTargetSelector:!1,t:o}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"カンマまたはスペース区切りで複数指定可能（例：2,5,8）。範囲指定はハイフン（例：50-100）。倍数指定も可能（例：2n, 5n+3）。最大値/最小値指定はmax/min"})]})]});default:return null}};return s.jsx("div",{className:"space-y-4",children:r&&g.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"md:hidden",children:s.jsx(jn,{widgets:g,activeTab:d,onSelect:e=>{u(d===e?"":e)},onReorder:e=>t({widgets:e}),onDelete:y,t:o,renderContent:(e,t)=>s.jsxs(s.Fragment,{children:[b(t,e),v(t,e)]})})}),s.jsxs("div",{className:"hidden md:flex flex-col md:flex-row gap-4",children:[s.jsx("div",{className:"w-full md:w-32 lg:w-64 flex-shrink-0",children:s.jsx("div",{className:"space-y-1 max-h-[60vh] overflow-y-auto",children:s.jsx(jn,{widgets:g,activeTab:d,onSelect:e=>u(e),onReorder:e=>t({widgets:e}),onDelete:y,t:o})})}),s.jsx("div",{className:"flex-1 min-w-0",children:(()=>{const e=parseInt(d),t=g[e];return t?s.jsxs(s.Fragment,{children:[b(e,t),v(e,t)]}):null})()})]})]})})},Nn=({chartKey:e,settings:t,onChange:r,t:a})=>{const n=t?.mode||"auto";return s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("charts:options.xAxisScale.title")}),s.jsxs("div",{className:"flex gap-1 mb-2",children:[s.jsx("button",{onClick:()=>r(e,{mode:"auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("auto"===n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:a("charts:options.xAxisScale.auto")}),s.jsx("button",{onClick:()=>r(e,{mode:"semi-auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("semi-auto"===n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:a("charts:options.xAxisScale.semiAuto")}),s.jsx("button",{onClick:()=>r(e,{mode:"manual"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("manual"===n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:a("charts:options.xAxisScale.manual")})]}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:a(`charts:options.xAxisScale.description.${n}`)}),"manual"===n&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:a("charts:options.xAxisScale.manualHelp")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:a("charts:options.xAxisScale.min")}),s.jsx("input",{type:"number",value:t?.min??"",placeholder:a("charts:options.xAxisScale.placeholder"),onChange:t=>{const a=""===t.target.value?void 0:Number(t.target.value);r(e,{mode:"manual",min:a})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:a("charts:options.xAxisScale.max")}),s.jsx("input",{type:"number",value:t?.max??"",placeholder:a("charts:options.xAxisScale.placeholder"),onChange:t=>{const a=""===t.target.value?void 0:Number(t.target.value);r(e,{mode:"manual",max:a})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]})]})},An=({chartKey:e,settings:t,onChange:r,t:a})=>{const n=t?.mode||"auto";return s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:a("charts:options.yAxisScale.title")}),s.jsxs("div",{className:"flex gap-1 mb-2",children:[s.jsx("button",{onClick:()=>r(e,{mode:"auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("auto"===n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:a("charts:options.yAxisScale.auto")}),s.jsx("button",{onClick:()=>r(e,{mode:"semi-auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("semi-auto"===n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:a("charts:options.yAxisScale.semiAuto")}),s.jsx("button",{onClick:()=>r(e,{mode:"manual"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("manual"===n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:a("charts:options.yAxisScale.manual")})]}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:a(`charts:options.yAxisScale.description.${n}`)}),"manual"===n&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:a("charts:options.yAxisScale.manualHelp")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:a("charts:options.yAxisScale.min")}),s.jsx("input",{type:"number",value:t?.min??"",placeholder:a("charts:options.yAxisScale.placeholder"),onChange:t=>{const a=""===t.target.value?void 0:Number(t.target.value);r(e,{mode:"manual",min:a})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:a("charts:options.yAxisScale.max")}),s.jsx("input",{type:"number",value:t?.max??"",placeholder:a("charts:options.yAxisScale.placeholder"),onChange:t=>{const a=""===t.target.value?void 0:Number(t.target.value);r(e,{mode:"manual",max:a})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]})]})},Tn=({chartSettings:e,currentSettingsId:t,diceSets:r,compareDiceSetIds:n,currentDiceSetIds:o,onCreateSettings:l,onDuplicateSettings:c,onRenameSettings:d,onUpdateSettings:u,onDeleteSettings:g,onClose:h,hasUnsavedChanges:m,onSaveToSettings:p,onDiscardChanges:x,onReorderSettings:f,onCreateSettingsWithConfig:y,onDuplicateSettingsWithConfig:b,onImportSettings:v})=>{const{t:w}=$e(["settings","common"]),[S,k]=a.useState(""),[C,j]=a.useState(!1),[D,N]=a.useState([]),[A,T]=a.useState(null),[M,E]=a.useState(!1),R=a.useRef({}),I=a.useRef(null),L=a.useRef(null),[O,F]=a.useState({isOpen:!1,mode:"create"});e.forEach(e=>{R.current[e.id]||(R.current[e.id]=i.createRef())}),i.useEffect(()=>{const e=e=>{I.current&&!I.current.contains(e.target)&&E(!1)};if(M)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[M]);const P=e=>{D.includes(e)?N(D.filter(t=>t!==e)):N([...D,e])},$=t=>{const r=St(t.id),a=[];return m&&p&&!r&&a.push({id:"save",label:w("settings:chartSettings.save"),customIcon:s.jsx(ct,{name:"save",className:"w-4 h-4"}),onClick:async()=>{j(!0);try{await p(t.id),k("")}catch(e){k(e instanceof Error?e.message:w("settings:chartSettings.errors.saveFailed"))}finally{j(!1)}},disabled:C}),a.push({id:"duplicate",label:w("settings:chartSettings.duplicate"),customIcon:s.jsx(ct,{name:"copy",className:"w-4 h-4"}),onClick:()=>{F({isOpen:!0,mode:"duplicate",settingsId:t.id,initialSettings:{...t},initialName:`${t.name}${w("settings:chartSettings.copyNameSuffix")}`})},disabled:C},{id:"rename",label:w("settings:chartSettings.edit"),customIcon:s.jsx(ct,{name:"edit",className:"w-4 h-4"}),onClick:()=>{F({isOpen:!0,mode:"edit",settingsId:t.id,initialSettings:{...t},initialName:t.name})},disabled:C||r},{id:"delete",label:w("settings:chartSettings.delete"),customIcon:s.jsx(ct,{name:"trash",className:"w-4 h-4"}),onClick:()=>(async t=>{if(St(t))return void k(w("settings:chartSettings.errors.cannotDeletePreset"));const r=e.find(e=>e.id===t);if(r&&confirm(w("settings:chartSettings.confirmDelete",{name:r.name}))){j(!0),k("");try{await g(t)}catch(a){k(a instanceof Error?a.message:w("settings:chartSettings.errors.deleteFailed"))}finally{j(!1)}}})(t.id),disabled:C||r,danger:!0,separator:!0}),a};return s.jsxs(s.Fragment,{children:[s.jsxs(lr,{isOpen:!0,onClose:h,size:"2xl",maxHeight:"80vh",modalId:"chart-settings-manager-modal",children:[s.jsx(cr,{title:w("settings:chartSettings.title"),onClose:h,actions:D.length>0?s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:w("settings:chartSettings.selected",{count:D.length})}):null,sticky:!1}),s.jsx("div",{className:"px-6 py-2 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsx("button",{onClick:()=>F({isOpen:!0,mode:"create"}),disabled:C,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",children:w("settings:chartSettings.new")}),s.jsxs("div",{className:"relative",ref:I,children:[s.jsx("button",{onClick:()=>E(!M),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:w("settings:chartSettings.moreOptions"),children:s.jsx(ct,{name:"dots-vertical",className:"w-5 h-5"})}),s.jsx("input",{type:"file",ref:L,className:"hidden",accept:".json",onChange:async e=>{const t=e.target.files?.[0];if(t&&v){j(!0),k("");try{await v(t)}catch(r){k(r instanceof Error?r.message:w("common:error.importFailed"))}finally{j(!1),L.current&&(L.current.value="")}}}}),M&&s.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[s.jsxs("button",{onClick:()=>{L.current?.click(),E(!1)},disabled:!v,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"import",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:w("common:actions.import","インポート")})]}),s.jsxs("button",{onClick:()=>{try{!function(e){const t=e.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-"));if(0===t.length)throw new Error("エクスポートするデータがありません（プリセット以外の設定が必要です）");const r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json;charset=utf-8;"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n;const s=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5);i.download=`dice-sim-chart-settings_${s}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}(D.length>0?e.filter(e=>D.includes(e.id)):e),E(!1)}catch(t){k(t instanceof Error?t.message:"Export failed")}},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"export",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:D.length>0?w("common:actions.exportSelected","選択項目をエクスポート"):w("common:actions.export","すべてエクスポート")})]}),s.jsxs("button",{onClick:()=>{N([]),E(!1)},disabled:0===D.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white border-t border-gray-200 dark:border-gray-600 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",title:w("settings:chartSettings.bulkActions.deselectAll"),children:[s.jsx(ct,{name:"close",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:w("settings:chartSettings.bulkActions.deselectAll")})]}),s.jsxs("button",{onClick:async()=>{if(0!==D.length){j(!0),k("");try{for(const e of D)await c(e);N([])}catch(e){k(e instanceof Error?e.message:w("settings:chartSettings.errors.bulkDuplicateFailed"))}finally{j(!1)}E(!1)}else k(w("settings:chartSettings.errors.noDuplicateSelection"))},disabled:0===D.length||C,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"copy",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:w("settings:chartSettings.bulkActions.duplicate")})]}),s.jsxs("button",{onClick:async()=>{const e=D.filter(e=>!St(e));if(0!==e.length){if(confirm(w("settings:chartSettings.confirmBulkDelete",{count:e.length}))){j(!0),k("");try{for(const t of e)await g(t);N([])}catch(t){k(t instanceof Error?t.message:w("settings:chartSettings.errors.bulkDeleteFailed"))}finally{j(!1)}E(!1)}}else k(w("settings:chartSettings.errors.noSelection"))},disabled:0===D.length||C,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"trash",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:w("settings:chartSettings.bulkActions.delete")})]}),s.jsxs("button",{onClick:async()=>{const t=e.filter(e=>!St(e.id));if(0!==t.length&&confirm(w("settings:chartSettings.confirmDeleteAll","プリセット以外のすべての設定を削除してもよろしいですか？"))){j(!0),k("");try{for(const e of t)await g(e.id);N([])}catch(r){k(r instanceof Error?r.message:w("settings:chartSettings.errors.deleteAllFailed","削除に失敗しました"))}finally{j(!1)}E(!1)}},disabled:0===e.filter(e=>!St(e.id)).length||C,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"trash",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:w("settings:chartSettings.deleteAll","全削除")})]})]})]})]})}),s.jsxs(dr,{scrollable:!0,padding:!1,className:"p-4",children:[S&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:S})}),m&&x&&s.jsx("div",{className:"mb-4 p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-300 dark:border-orange-700 rounded-lg",children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[s.jsx("svg",{className:"w-5 h-5 text-orange-600 dark:text-orange-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),s.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:w("settings:chartSettings.unsavedWarning")})]}),s.jsx("button",{onClick:()=>{x(),k("")},disabled:C,className:"px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-sm transition-colors whitespace-nowrap disabled:opacity-50",title:w("settings:chartSettings.discard"),children:w("settings:chartSettings.discard")})]})}),s.jsx(rr,{items:e,selectedIds:D,onToggleItem:P,onSelectionChange:N,emptyMessage:w("settings:chartSettings.emptyMessage"),enableDragAndDrop:!!f,onReorder:e=>{if(!f)return;const t=[...e.filter(e=>St(e.id)),...e.filter(e=>!St(e.id))];f(t)},renderItem:(e,r,a,n,i)=>{const o=St(e.id),l=e.id===t;return s.jsx(nr,{isSelected:D.includes(e.id),onToggle:i?.onClick||(()=>P(e.id)),showCheckbox:!1,showDragHandle:!!f&&!o,dragHandleProps:n,actions:s.jsxs(s.Fragment,{children:[s.jsx(hr,{buttonRef:R.current[e.id],onClick:t=>{t.stopPropagation(),T(A===e.id?null:e.id)},isSelected:D.includes(e.id)}),s.jsx(gr,{isOpen:A===e.id,buttonRef:R.current[e.id],items:$(e),onClose:()=>T(null)})]}),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:[e.name,o&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",w("settings:chartSettings.preset"),")"]})]}),l&&s.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded flex-shrink-0",children:w("settings:chartSettings.inUse")})]})})}})]})]}),O.isOpen&&s.jsx(Xn,{mode:O.mode,initialSettings:O.initialSettings,initialName:O.initialName,diceSets:r,compareDiceSetIds:n,currentDiceSetIds:o,onSubmit:async(t,r)=>{if("create"===O.mode){if(y)await y(t,r);else if(await l(t),Object.keys(r).length>0&&u){const a=e.find(e=>e.name===t);a&&await u(a.id,r)}}else if("duplicate"===O.mode&&O.settingsId){if(b)await b(O.settingsId,t,r);else if(await c(O.settingsId,t),Object.keys(r).length>0&&u){await new Promise(e=>setTimeout(e,100));const a=e.find(e=>e.name===t);a&&await u(a.id,r)}}else if("edit"===O.mode&&O.settingsId){const e={...r,name:t};u?await u(O.settingsId,e):await d(O.settingsId,t)}F({isOpen:!1,mode:"create"})},onClose:()=>F({isOpen:!1,mode:"create"})})]})};const Mn=({items:e,isDarkMode:t=!1,onLegendClick:r})=>{const{t:n}=$e("charts"),[i,o]=a.useState(!1),[l,c]=a.useState("undefined"!=typeof window&&window.innerWidth<640);a.useEffect(()=>{const e=()=>{c(window.innerWidth<640)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const d=l?2:4,u=a.useMemo(()=>{const t=function(e){const t=new Map;return e.forEach(e=>{const r=`${e.label}|${e.datasetType||""}`;if(t.has(r)){const a=t.get(r),n=a.onClick,i=e.onClick;n&&i&&(a.onClick=()=>{n(),i()})}else t.set(r,{...e})}),Array.from(t.values())}(e);return function(e){const t={actual:1,theoretical:2,median:3,movingAverage:4,expectedValue:5};return e.sort((e,r)=>{const a=t[e.datasetType||""]||999,n=t[r.datasetType||""]||999;return a!==n?a-n:e.label.localeCompare(r.label)})}(t)},[e]),g=u.length>d,h=i||!g?u:u.slice(0,d),m=u.length-d;return 0===u.length?null:s.jsxs("div",{className:"mb-6 bg-gray-50/90 dark:bg-gray-800/75 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("div",{className:(g?"px-4 pt-4":"p-4")+" flex flex-wrap gap-x-6 gap-y-2 justify-center max-h-[70vh] overflow-y-auto",children:h.map((e,a)=>s.jsxs("button",{onClick:()=>(e=>{e.onClick?.(),setTimeout(()=>{r?.()},50)})(e),className:"flex items-center gap-2 px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors "+(e.hidden?"opacity-50 line-through":""),title:e.label,children:[e.borderDash&&e.borderDash.length>0?s.jsx("span",{className:"inline-block h-0.5 w-4 flex-shrink-0",style:{background:`repeating-linear-gradient(\n                    to right,\n                    ${e.borderColor||e.color} 0,\n                    ${e.borderColor||e.color} ${e.borderDash[0]}px,\n                    transparent ${e.borderDash[0]}px,\n                    transparent ${e.borderDash[0]+(e.borderDash[1]||e.borderDash[0])}px\n                  )`,height:"2px"}}):s.jsx("span",{className:"inline-block w-4 h-4 rounded-sm border flex-shrink-0",style:{backgroundColor:e.color,borderColor:e.borderColor||e.color,borderWidth:e.borderWidth||1}}),s.jsx("span",{className:"text-xs font-medium",style:{color:t?"#D1D5DB":"#374151"},children:e.label})]},`${e.label}-${e.datasetType||""}-${a}`))}),g&&s.jsxs("button",{onClick:()=>o(!i),className:"py-2 px-3 flex items-center justify-center gap-1 text-xs w-full text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:[s.jsx(ct,{name:i?"chevron-up":"chevron-down",className:"w-4 h-4"}),s.jsx("span",{children:i?n("legend.collapse"):n("legend.showMore",{count:m})})]})]})},En=({items:e,isDarkMode:t=!1,onLegendClick:r,className:n=""})=>{const{t:i}=$e(["charts"]),[o,l]=a.useState(!1),c=a.useRef(null);a.useEffect(()=>{const e=e=>{c.current&&!c.current.contains(e.target)&&l(!1)};return o&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o]);return 0===e.length?null:s.jsxs("div",{ref:c,className:`relative ${n}`,children:[s.jsxs("button",{onClick:()=>l(!o),className:"px-3 py-1.5 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-white dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:i("charts:legend.title","凡例")}),s.jsx("svg",{className:"w-3 h-3 text-gray-500 dark:text-gray-400 transition-transform "+(o?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&s.jsx("div",{className:"absolute top-full left-0 z-20 mt-1 min-w-[200px] max-w-[300px] bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 shadow-xl max-h-[60vh] overflow-y-auto",children:s.jsx("div",{className:"py-1",children:e.map((e,a)=>s.jsxs("button",{onClick:()=>(e=>{e.onClick?.(),setTimeout(()=>{r?.()},50)})(e),className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left "+(e.hidden?"opacity-50":""),title:e.label,children:[s.jsx("span",{className:"flex-shrink-0 w-4 h-4 rounded border-2 flex items-center justify-center "+(e.hidden?"border-gray-300 dark:border-gray-600 bg-transparent":"border-gray-400 dark:border-gray-500"),style:{borderColor:e.hidden?void 0:e.borderColor||e.color,backgroundColor:e.hidden?void 0:e.color},children:!e.hidden&&s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.borderDash&&e.borderDash.length>0?s.jsx("span",{className:"inline-block w-4 flex-shrink-0",style:{background:`repeating-linear-gradient(\n                        to right,\n                        ${e.borderColor||e.color} 0,\n                        ${e.borderColor||e.color} ${e.borderDash[0]}px,\n                        transparent ${e.borderDash[0]}px,\n                        transparent ${e.borderDash[0]+(e.borderDash[1]||e.borderDash[0])}px\n                      )`,height:"2px"}}):s.jsx("span",{className:"inline-block w-4 h-3 rounded-sm border flex-shrink-0",style:{backgroundColor:e.color,borderColor:e.borderColor||e.color,borderWidth:e.borderWidth||1}}),s.jsx("span",{className:"text-xs font-medium flex-grow "+(e.hidden?"line-through":""),style:{color:t?"#D1D5DB":"#374151"},children:e.label})]},`${e.label}-${e.datasetType||""}-${a}`))})})]})};let Rn=null;function In(e,t){Rn||(Rn=function(){const e=document.createElement("div");return e.style.position="absolute",e.style.background="rgba(0, 0, 0, 0.8)",e.style.color="white",e.style.padding="8px 12px",e.style.borderRadius="4px",e.style.fontSize="14px",e.style.pointerEvents="none",e.style.zIndex="1000",e.style.display="none",e.style.whiteSpace="nowrap",document.body.appendChild(e),e}()),Rn.textContent=e,Rn.style.display="block",Rn.style.left=`${t.pageX+10}px`,Rn.style.top=`${t.pageY+10}px`}function Ln(){Rn&&(Rn.style.display="none")}function On(){Rn&&Rn.parentNode&&(Rn.parentNode.removeChild(Rn),Rn=null)}function Fn(e,t){const r=e.canvas;if(!r)return;const a=r._legendTooltipHandlers;if(a&&(r.removeEventListener("mousemove",a.mouseMove),r.removeEventListener("mouseleave",a.mouseLeave)),t)return r.style.cursor="default",void Ln();const n=t=>{const a=e.legend;if(!a)return void Ln();const n=r.getBoundingClientRect(),i=t.clientX-n.left,s=t.clientY-n.top,o=a.legendItems||[];let l=null;for(const e of o){const t=e._hitBox;if(t&&(i>=t.left&&i<=t.left+t.width&&s>=t.top&&s<=t.top+t.height)){l=e;break}}l&&l._fullText?(r.style.cursor="pointer",In(l._fullText,t)):(r.style.cursor="default",Ln())},i=()=>{r.style.cursor="default",Ln()};r.addEventListener("mousemove",n),r.addEventListener("mouseleave",i),r._legendTooltipHandlers={mouseMove:n,mouseLeave:i}}const Pn=i.memo(({diceSets:e,onBinningSettingsChange:t,onChartTypeChange:r,onXAxisScaleChange:n,onYAxisScaleChange:i,chartSettings:o,currentChartSettingsId:l,isNarrowLayout:c=!1,chartRef:d,widgetType:u,onWidgetTypeChange:g,widget:h,onUpdateHiddenLegends:m,onOpenFullscreen:p,isFullscreen:x=!1,chartTitleProp:f,chartHeightSettings:v})=>{const{t:w}=$e(["charts","common"]),S=a.useRef(null),k=d||S,C=sn(),j=gn(),[,D]=a.useState(0),N=hn("result",k,h,m),A=a.useRef(null),T=a.useRef(null),M=o?.find(e=>e.id===l),{useBinning:E,setUseBinning:R,binningAlgorithm:I,setBinningAlgorithm:L,binWidthMultiple:O,setBinWidthMultiple:F}=function(e,t){const r=e?.[t],n=e?.id,[i,s]=a.useState(r?.useBinning??!1),[o,l]=a.useState(r?.binningAlgorithm??"equal-width"),[c,d]=a.useState(r?.binWidthMultiple??1);return a.useEffect(()=>{s(r?.useBinning??!1),l(r?.binningAlgorithm??"scott"),d(r?.binWidthMultiple??1)},[n,r]),{useBinning:i,setUseBinning:s,binningAlgorithm:o,setBinningAlgorithm:l,binWidthMultiple:c,setBinWidthMultiple:d}}(M,"resultChart"),{chartType:P,setChartType:$}=cn(M,"resultChartType"),{xAxisScale:W,setXAxisScale:V}=dn(M,"resultChartXScale"),{yAxisScale:B,setYAxisScale:H}=un(M,"resultChartYScale"),z=e=>{$(e),r?.(e)},U=e[0],q=e.length>1;a.useEffect(()=>{const e=setTimeout(()=>{k.current&&Fn(k.current,c)},100);return()=>{clearTimeout(e),On()}},[e,C,E,I,O,c,k]),a.useEffect(()=>{if(!k.current||!h?.hiddenLegends)return;const e=setTimeout(()=>{if(k.current){const e=k.current,t=h.hiddenLegends||[];e.data.datasets?.forEach((r,a)=>{const n=r.label||"";e.getDatasetMeta(a).hidden=t.includes(n)}),e.update()}},150);return()=>clearTimeout(e)},[k,h?.hiddenLegends,e]),a.useEffect(()=>{if("semi-auto"!==W.mode)return void(A.current&&(A.current=null));if(void 0!==W.initialMin&&void 0!==W.initialMax)return void(A.current||(A.current={min:W.initialMin,max:W.initialMax}));const e=setTimeout(()=>{if(k.current&&k.current.scales&&k.current.scales.x){const e=k.current.scales.x.min,t=k.current.scales.x.max;void 0!==e&&void 0!==t&&(A.current={min:e,max:t},V({...W,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[W.mode]),a.useEffect(()=>{if("semi-auto"!==B.mode)return void(T.current&&(T.current=null));if(void 0!==B.initialMin&&void 0!==B.initialMax)return void(T.current||(T.current={min:B.initialMin,max:B.initialMax}));const e=setTimeout(()=>{if(k.current&&k.current.scales&&k.current.scales.y){const e=k.current.scales.y.min,t=k.current.scales.y.max;void 0!==e&&void 0!==t&&(T.current={min:e,max:t},H({...B,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[B.mode]);const Y=a.useMemo(()=>{if(!E||!q)return null;const t=[];return e.forEach(e=>{e.results.forEach(e=>{t.push(e.total)})}),0===t.length?1:"equal-width"===I?Math.max(O,1):qa(t,I,O)},[e,E,q,I,O]),X=a.useMemo(()=>e.map((e,t)=>{const r=new Map;e.results.forEach(e=>{const t=r.get(e.total)||0;r.set(e.total,t+1)});const a=Array.from(r.entries()).sort((e,t)=>e[0]-t[0]);let n,i,s,o;if(E){let t;t=q&&Y?Y:"equal-width"===I?O:qa(e.results.map(e=>e.total),I,O);const r=Ya(a,t,I);n=r.data,i=r.isBinned,s=r.binCount,o=r.binWidth}else n=a,i=!1,s=a.length,o=1;const l=xt(e),c=e.resultsConfig||e.diceConfig;return{diceSet:e,chartData:n,isBinned:i,binCount:s,binWidth:o,diceSetName:l,diceCode:e.hasMultipleDiceConfigs||!1?w("charts:subtitle.custom"):ut(c),index:t}}),[e,E,I,O,q,Y,w]),_=a.useMemo(()=>{if(q||!U)return null;const e=U.results.map(e=>e.total),{mean:t,median:r,stdDev:a}=function(e){const t=e.length;if(0===t)return{mean:0,median:0,stdDev:0};const r=e.reduce((e,t)=>e+t,0)/t,a=[...e].sort((e,t)=>e-t),n=t%2==0?(a[t/2-1]+a[t/2])/2:a[Math.floor(t/2)],i=e.reduce((e,t)=>e+Math.pow(t-r,2),0)/t,s=Math.sqrt(i);return{mean:r,median:n,stdDev:s}}(e);return{mean:t,median:r,medianBar:Math.round(r),stdDev:a,expectedValue:function(e){let t=e.diceCount*(e.diceFaces+1)/2;return"+"===e.modifierSign?t+=e.modifierValue:"-"===e.modifierSign&&(t-=e.modifierValue),t}(U.resultsConfig||U.diceConfig)}},[U,q]),J=a.useMemo(()=>{const t=X[0],r=w("equal-width"===I?"charts:options.binning.equalWidth":"scott"===I?"charts:options.binning.scott":"charts:options.binning.fd"),a=t?.isBinned?` / ${w("charts:subtitle.binning",{algorithm:r,binCount:t.binCount})}`:"";return q?`${w("charts:title.totalDistribution")}\n（${w("charts:title.comparison",{count:e.length})}${a}）`:`${w("charts:title.totalDistribution")}\n（${t?.diceCode||""} / ${w("charts:subtitle.trialCount",{count:U?.results.length||0})}${a})`},[X,q,e.length,U,I,w]);a.useEffect(()=>{x&&f&&f(J)},[x,J,f]);const K={labels:[],datasets:a.useMemo(()=>{const e=X.map(({chartData:e,diceSetName:t,index:r,diceSet:a})=>{const n=a.resultsConfig||a.diceConfig,i=a.hasMultipleDiceConfigs||!1,s=q?Mr(r,C,"bar"===P?.6:.05):"bar"===P?e.map(([e])=>e===_?.medianBar?Ar(.6):Nr(C,.5)):Nr(C,.05),o=q?Mr(r,C,1):"bar"===P?e.map(([e])=>e===_?.medianBar?Ar(1):Nr(C,1)):Nr(C,1);return{label:`${i?w("charts:subtitle.custom"):ut(n)} - ${t} (${w("charts:subtitle.trialCount",{count:a.results.length})})`,data:e.map(([e,t])=>({x:e,y:t})),backgroundColor:s,borderColor:o,borderWidth:"bar"===P?1:2,fill:"line"===P,tension:"line"===P?.3:void 0,pointBackgroundColor:"line"===P&&!q&&_?e.map(([e])=>e===_.medianBar?Ar(1):Nr(C,1)):void 0,pointBorderColor:"line"===P&&!q&&_?e.map(([e])=>e===_.medianBar?Ar(1):Nr(C,1)):void 0,pointRadius:"line"===P?3:0}});if(!q&&U&&!U.hasMultipleDiceConfigs){const t=U.resultsConfig||U.diceConfig,r="+"===t.modifierSign?t.modifierValue:"-"===t.modifierSign?-t.modifierValue:0,a=t.diceCount*t.diceFaces>5e4,n=a?[]:Xa(t.diceCount,t.diceFaces,r),i=U.results.length,s=n.map(([e,t])=>[e,t*i]);let o;if(E&&X[0]){o=Ya(s,X[0].binWidth,X[0].isBinned?I:"equal-width").data}else o=s;const l=a?null:{label:w("charts:legend.theoretical"),data:o.map(([e,t])=>({x:e,y:t})),backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:C?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:"bar"===P?1:2,borderDash:[5,5],fill:!1,tension:"line"===P?.3:void 0,pointRadius:"line"===P?2:0,pointBackgroundColor:void 0,pointBorderColor:void 0};l&&e.push(l)}return e},[X,C,P,_,q,U,E,I,w])},Q=a.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:x,position:"top",labels:{color:C?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:J.split("\n"),font:{size:16},color:C?"#D1D5DB":"#374151"},decimation:{enabled:!0,algorithm:"lttb"},annotation:!q&&_?{annotations:{median:{type:"line",xMin:_.medianBar,xMax:_.medianBar,borderColor:"rgba(234, 88, 12, 0.8)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${w("charts:stats.median")}: ${_.median.toFixed(2)}`,position:"start",backgroundColor:"rgba(234, 88, 12, 0.8)",color:"white",font:{size:11},padding:4}},mean:{type:"line",xMin:_.mean,xMax:_.mean,borderColor:"rgba(16, 185, 129, 0.8)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${w("charts:stats.mean")}: ${_.mean.toFixed(2)}`,position:"end",backgroundColor:"rgba(16, 185, 129, 0.8)",color:"white",font:{size:11},padding:4}},stdDevPlus:{type:"line",xMin:_.mean+_.stdDev,xMax:_.mean+_.stdDev,borderColor:"rgba(139, 92, 246, 0.6)",borderWidth:1.5,borderDash:[3,3],label:{display:!0,content:"+1σ",position:"start",backgroundColor:"rgba(139, 92, 246, 0.6)",color:"white",font:{size:10},padding:3}},stdDevMinus:{type:"line",xMin:_.mean-_.stdDev,xMax:_.mean-_.stdDev,borderColor:"rgba(139, 92, 246, 0.6)",borderWidth:1.5,borderDash:[3,3],label:{display:!0,content:"-1σ",position:"start",backgroundColor:"rgba(139, 92, 246, 0.6)",color:"white",font:{size:10},padding:3}},expectedValue:{type:"line",xMin:_.expectedValue,xMax:_.expectedValue,borderColor:"rgb(241, 13, 120)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${w("charts:stats.expectedValue")}: ${_.expectedValue.toFixed(2)}`,position:"center",backgroundColor:"rgb(241, 13, 120)",color:"white",font:{size:11},padding:4}}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:w("charts:axis.frequency"),color:C?"#D1D5DB":"#374151"},ticks:{precision:0,color:C?"#9CA3AF":"#6B7280"},grid:{color:C?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===B.mode?B.min:"semi-auto"===B.mode&&void 0!==B.initialMin?B.initialMin:void 0,max:"manual"===B.mode?B.max:"semi-auto"===B.mode&&void 0!==B.initialMax?B.initialMax:void 0},x:{type:"linear",title:{display:!0,text:w("charts:axis.total"),color:C?"#D1D5DB":"#374151"},ticks:{color:C?"#9CA3AF":"#6B7280"},grid:{color:C?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===W.mode?W.min:"semi-auto"===W.mode&&void 0!==W.initialMin?W.initialMin:void 0,max:"manual"===W.mode?W.max:"semi-auto"===W.mode&&void 0!==W.initialMax?W.initialMax:void 0}}}),[J,C,q,x,_,w,W,B]),G=a.useMemo(()=>v?fn(0,Q):Q,[Q,v]),Z=()=>{Za(k,"total",j,C)},ee=wn({showChartTypeToggle:!0,chartType:P,onChartTypeChange:z,showBinningSettings:!0,useBinning:E,binningAlgorithm:I,binWidthMultiple:O,onBinningChange:e=>{R(e.useBinning),L(e.binningAlgorithm),F(e.binWidthMultiple),t?.(e)},currentDataPoints:X[0]?.chartData.length||0,isBinned:X[0]?.isBinned||!1,binCount:X[0]?.binCount||0,binWidth:X[0]?.binWidth||1,showXAxisScaleSettings:!0,xAxisScale:W,onXAxisScaleChange:e=>{V(e),"semi-auto"!==e.mode&&(A.current=null),n?.(e)},showYAxisScaleSettings:!0,yAxisScale:B,onYAxisScaleChange:e=>{H(e),"semi-auto"!==e.mode&&(T.current=null),i?.(e)},showWidgetTypeSelector:!!u&&!!g,widgetType:u,onWidgetTypeChange:g,onOpenFullscreen:p,onDownloadImage:Z});return U?s.jsxs("div",{className:"relative",style:x?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(x?"justify-end":"justify-between"),children:[!x&&s.jsx(En,{items:N,isDarkMode:C,onLegendClick:()=>{D(e=>e+1)}}),s.jsx(Sn,{chartType:P,onChartTypeChange:z,onDownloadImage:Z,menuManager:ee.manager})]}),s.jsx("div",{className:"relative",style:x?{height:"calc(100% - 24px)"}:v?pn(v):{height:"400px"},children:s.jsx("div",{style:v&&!x?xn(v):{width:"100%",height:"100%"},children:"bar"===P?s.jsx(y,{ref:k,data:K,options:G},`bar-${c}`):s.jsx(b,{ref:k,data:K,options:G},`line-${c}`)})}),!x&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("p",{children:w("charts:description.totalDistribution")}),!q&&s.jsx("p",{className:"mt-1",children:w("charts:description.theoreticalDistributionComparison")})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:w("charts:noData")})}),$n=e=>{const{t:t,...r}=$e(e);return{t:(e,r)=>(e=>{if("string"!=typeof e)return e;const t=e.split("\n");return 1===t.length?e:t.map((e,r)=>s.jsxs("span",{children:[e,r<t.length-1&&s.jsx("br",{})]},r))})(t(e,r)),tRaw:t,...r}},Wn=i.memo(({diceSets:e,onAggregationSettingsChange:t,onChartTypeChange:r,onXAxisScaleChange:n,onYAxisScaleChange:o,chartSettings:l,currentChartSettingsId:c,isNarrowLayout:d=!1,chartRef:u,widgetType:g,onWidgetTypeChange:h,widget:m,onUpdateHiddenLegends:p,onOpenFullscreen:x,isFullscreen:f=!1,chartTitleProp:v,chartHeightSettings:w})=>{const{t:S,tRaw:k}=$n(["charts","common"]),C=a.useRef(null),j=u||C,D=sn(),N=gn(),[,A]=a.useState(0),T=hn("individual",j,m,p);a.useEffect(()=>{if(!j.current||!m?.hiddenLegends)return;const e=setTimeout(()=>{if(j.current){const e=j.current,t=m.hiddenLegends||[];e.data.datasets?.forEach((r,a)=>{const n=r.label||"";e.getDatasetMeta(a).hidden=t.includes(n)}),e.update()}},150);return()=>clearTimeout(e)},[j,m?.hiddenLegends,e]);const M=a.useRef(null),E=a.useRef(null),R=l?.find(e=>e.id===c),{useAggregation:I,setUseAggregation:L,aggregationInterval:O,setAggregationInterval:F}=ln(R,"individualDiceChart"),{chartType:P,setChartType:$}=cn(R,"individualDiceChartType"),{xAxisScale:W,setXAxisScale:V}=dn(R,"individualDiceChartXScale"),{yAxisScale:B,setYAxisScale:H}=un(R,"individualDiceChartYScale"),z=e[0],U=e.length>1;i.useEffect(()=>{const e=setTimeout(()=>{j.current&&Fn(j.current,d)},100);return()=>{clearTimeout(e),On()}},[e,D,I,O,d,j]);const q=a.useMemo(()=>e.map((e,t)=>{const r=new Map;return e.results.forEach(e=>{e.diceValues.forEach(e=>{const t=r.get(e)||0;r.set(e,t+1)})}),{diceSet:e,frequencyMap:r,diceSetName:xt(e),diceCode:e.hasMultipleDiceConfigs?k("charts:subtitle.custom"):ut(e.resultsConfig||e.diceConfig),index:t}}),[e,k]),Y=a.useMemo(()=>{const e=q.map(({frequencyMap:e,diceSetName:t,index:r,diceSet:a})=>{const n=Array.from(e.entries()).sort((e,t)=>e[0]-t[0]),{data:i}=Ha(n,I?O:1),s=U?Mr(r,D,"bar"===P?.6:.05):Nr(D,"bar"===P?.5:.05),o=U?Mr(r,D,1):Nr(D,1);return{label:`${a.hasMultipleDiceConfigs?k("charts:subtitle.custom"):ut(a.resultsConfig||a.diceConfig)} - ${t} (${k("charts:subtitle.trialCount",{count:a.results.length})})`,data:i.map(([e,t])=>({x:e,y:t})),backgroundColor:s,borderColor:o,borderWidth:"bar"===P?1:2,fill:"line"===P,tension:"line"===P?.3:void 0,pointRadius:"line"===P?4:void 0,pointHoverRadius:"line"===P?6:void 0}});if(!U&&z&&!z.hasMultipleDiceConfigs){const t=z.resultsConfig||z.diceConfig,r=z.results.length*t.diceCount,a=function(e,t){const r=t/e;return Array.from({length:e},(e,t)=>[t+1,r])}(t.diceFaces,r),{data:n}=Ha(a,I?O:1),i={label:k("charts:legend.theoretical"),data:n.map(([e,t])=>({x:e,y:t})),backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:D?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:"bar"===P?1:2,borderDash:[5,5],fill:!1,tension:"line"===P?.3:void 0,pointRadius:"line"===P?3:void 0,pointHoverRadius:"line"===P?5:void 0};e.push(i)}if(0===q.length)return{labels:[],datasets:e,isAggregated:!1};const t=Array.from(q[0].frequencyMap.entries()).sort((e,t)=>e[0]-t[0]),{isAggregated:r}=Ha(t,I?O:1);return{labels:[],datasets:e,isAggregated:r}},[q,D,P,I,O,U,z,k]),X=a.useMemo(()=>{if(U||0===q.length)return null;const e=q[0].frequencyMap,t=Array.from(e.entries()).reduce((e,[,t])=>e+t,0),r=function(e){const t=Array.from(e.entries());if(0===t.length)return 0;const r=t.reduce((e,[,t])=>e+t,0);return 0===r?0:t.reduce((e,[t,r])=>e+t*r,0)/r}(e),a=function(e){const t=Array.from(e.entries());if(0===t.length)return[];const r=Math.max(...t.map(([,e])=>e));return t.filter(([,e])=>e===r).map(([e])=>e)}(e);return{mean:r,modes:a,totalCount:t}},[q,U]),_=e=>{$(e),r?.(e)},J=e=>{V(e),"semi-auto"!==e.mode&&(M.current=null),n?.(e)},K=e=>{H(e),"semi-auto"!==e.mode&&(E.current=null),o?.(e)},Q=z?.resultsConfig||z?.diceConfig,G=z?.hasMultipleDiceConfigs||!1?k("common:custom"):Q?ut(Q):"",Z=U?`${k("charts:title.individualDice")}\n（${k("charts:title.comparison",{count:e.length})}${Y.isAggregated?` / ${k("charts:subtitle.aggregation",{interval:O})}`:""}）`:`${k("charts:title.individualDice")}\n（${G} / ${k("charts:subtitle.trialCount",{count:z?.results.length||0})}${Y.isAggregated?` / ${k("charts:subtitle.aggregation",{interval:O})}`:""})`;a.useEffect(()=>{f&&v&&v(Z)},[f,Z,v]);const ee=a.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:f,position:"top",labels:{color:D?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},decimation:{enabled:!0,algorithm:"lttb"},title:{display:!0,text:Z.split("\n"),font:{size:16},color:D?"#D1D5DB":"#374151"},tooltip:!U&&X?{callbacks:{afterLabel:e=>{const t=X.totalCount||0,r=e.parsed.y??0;return`${t>0?(r/t*100).toFixed(1):"0.0"}%`}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:k("charts:axis.frequency"),color:D?"#D1D5DB":"#374151"},ticks:{precision:0,color:D?"#9CA3AF":"#6B7280"},grid:{color:D?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===B.mode?B.min:"semi-auto"===B.mode&&void 0!==B.initialMin?B.initialMin:void 0,max:"manual"===B.mode?B.max:"semi-auto"===B.mode&&void 0!==B.initialMax?B.initialMax:void 0},x:{type:"linear",title:{display:!0,text:k("charts:axis.diceValue"),color:D?"#D1D5DB":"#374151"},ticks:{color:D?"#9CA3AF":"#6B7280"},grid:{color:D?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===W.mode?W.min:"semi-auto"===W.mode&&void 0!==W.initialMin?W.initialMin:void 0,max:"manual"===W.mode?W.max:"semi-auto"===W.mode&&void 0!==W.initialMax?W.initialMax:void 0}}}),[Z,D,U,f,X,k,W,B]),te=a.useMemo(()=>w?fn(0,ee):ee,[ee,w]),re=()=>{Za(j,"individual",N,D)},ae=e=>{L(e.useAggregation),F(e.aggregationInterval),t?.(e)},ne=wn({showChartTypeToggle:!0,chartType:P,onChartTypeChange:_,showAggregationSettings:!0,useAggregation:I,aggregationInterval:O,onAggregationChange:ae,currentDataPoints:q[0]?.frequencyMap.size||0,isAggregated:Y.isAggregated,showXAxisScaleSettings:!0,xAxisScale:W,onXAxisScaleChange:J,showYAxisScaleSettings:!0,yAxisScale:B,onYAxisScaleChange:K,showWidgetTypeSelector:!!g&&!!h,widgetType:g,onWidgetTypeChange:h,onOpenFullscreen:x,onDownloadImage:re});return z?s.jsxs("div",{className:"relative",style:f?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(f?"justify-end":"justify-between"),children:[!f&&s.jsx(En,{items:T,isDarkMode:D,onLegendClick:()=>{A(e=>e+1)}}),s.jsx(Sn,{chartType:P,onChartTypeChange:_,onDownloadImage:re,showAggregationSettings:!0,useAggregation:I,aggregationInterval:O,onAggregationChange:ae,currentDataPoints:q[0]?.frequencyMap.size||0,isAggregated:Y.isAggregated,showXAxisScaleSettings:!0,xAxisScale:W,onXAxisScaleChange:J,showYAxisScaleSettings:!0,yAxisScale:B,onYAxisScaleChange:K,showWidgetTypeSelector:!!g&&!!h,widgetType:g,onWidgetTypeChange:h,menuManager:ne.manager})]}),s.jsx("div",{className:"relative",style:f?{height:"calc(100% - 24px)"}:w?pn(w):{height:"400px"},children:s.jsx("div",{style:w&&!f?xn(w):{width:"100%",height:"100%"},children:"bar"===P?s.jsx(y,{ref:j,data:Y,options:te},`bar-${d}`):s.jsx(b,{ref:j,data:Y,options:te},`line-${d}`)})}),!f&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("p",{children:S("charts:description.individualDiceDescription")}),!U&&X&&s.jsxs("p",{className:"mt-2 text-xs opacity-75",children:[S("charts:stats.mean"),": ",Ra(X.mean)," /",S("charts:stats.mode"),": ",X.modes.join(", ")," /",S("charts:stats.totalCount"),": ",Ea(X.totalCount),S("common:unit.piece")]})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:S("charts:noData")})}),Vn=i.memo(({diceSets:e,onChartTypeChange:t,chartSettings:r,currentChartSettingsId:n,onCumulativeSettingsChange:o,onYAxisScaleChange:l,isNarrowLayout:c=!1,chartRef:d,widgetType:u,onWidgetTypeChange:g,widget:h,onUpdateHiddenLegends:m,onOpenFullscreen:p,isFullscreen:x=!1,chartTitleProp:f,chartHeightSettings:y})=>{const{t:b}=$e(["charts","diceSets","common"]),w=a.useRef(null),S=d||w,k=sn(),C=gn(),[,j]=a.useState(0),D=hn("cumulative",S,h,m),N=r?.find(e=>e.id===n),A=a.useRef(null),[T,M]=i.useState(void 0!==N?.cumulativeQuantileCount?N.cumulativeQuantileCount:50),[E,R]=i.useState(N?.cumulativeDistributionType||"total"),[I,L]=i.useState(void 0===N?.cumulativeShowOnlyActualData||N.cumulativeShowOnlyActualData);i.useEffect(()=>{N&&(void 0!==N.cumulativeQuantileCount&&M(N.cumulativeQuantileCount),N.cumulativeDistributionType&&R(N.cumulativeDistributionType),void 0!==N.cumulativeShowOnlyActualData&&L(N.cumulativeShowOnlyActualData))},[N,n]);const{chartType:O,setChartType:F}=cn(N,"cumulativeChartType"),{yAxisScale:P,setYAxisScale:$}=un(N,"cumulativeChartYScale"),W=e=>{F(e),t?.(e)};i.useEffect(()=>{if("semi-auto"!==P.mode)return void(A.current&&(A.current=null));if(void 0!==P.initialMin&&void 0!==P.initialMax)return void(A.current||(A.current={min:P.initialMin,max:P.initialMax}));const e=setTimeout(()=>{if(S.current&&S.current.scales&&S.current.scales.y){const e=S.current.scales.y.min,t=S.current.scales.y.max;void 0!==e&&void 0!==t&&(A.current={min:e,max:t},$({...P,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[P.mode]),a.useEffect(()=>{if(!S.current||!h?.hiddenLegends)return;const e=setTimeout(()=>{if(S.current){const e=S.current,t=h.hiddenLegends||[];e.data.datasets?.forEach((r,a)=>{const n=r.label||"";e.getDatasetMeta(a).hidden=t.includes(n)}),e.update()}},150);return()=>clearTimeout(e)},[S,h?.hiddenLegends,e]);const V=e.length>1,B=a.useMemo(()=>{if(0===e.length||!e[0]||0===e[0].results.length)return[];let t;return t="total"===E?e.map((e,t)=>{const r=e.resultsConfig||e.diceConfig,a=(e=>"+"===e.modifierSign?e.modifierValue:"-"===e.modifierSign?-e.modifierValue:0)(r);let n=[],i=r.diceCount+a,s=r.diceCount*r.diceFaces+a;const o=r.diceCount*r.diceFaces>5e4;if(!e.hasMultipleDiceConfigs&&!o){const e=Xa(r.diceCount,r.diceFaces,a);if(n=function(e){if(0===e.length)return[];const t=[...e].sort((e,t)=>e[0]-t[0]),r=t.reduce((e,[,t])=>e+t,0),a=[];let n=0;for(const[i,s]of t){const e=r-n;a.push([i,e]),n+=s}return a}(e),e.length>0){const t=e[0][0],r=e[e.length-1][0];t<=i&&r>=s&&(i=t,s=r)}}const l=e.results.map(e=>e.total),c=[...l].sort((e,t)=>e-t),d=l.length;let u;if(I){if(u=[...new Set(l)].sort((e,t)=>e-t),u.length>1e3){const e=Math.ceil(u.length/1e3);u=u.filter((t,r)=>r%e===0)}}else{const e=s-i+1;if(e>1e4){const t=Math.ceil(e/1e3);u=Array.from({length:Math.ceil(e/t)},(e,r)=>i+r*t)}else u=Array.from({length:e},(e,t)=>i+t)}const g=[];for(const h of u){let e=0,t=c.length;for(;e<t;){const r=Math.floor((e+t)/2);c[r]<h?e=r+1:t=r}const r=(c.length-e)/d;g.push([h,r])}return{diceSet:e,actualCDF:g,theoreticalCDF:n,diceSetName:xt(e),diceCode:e.hasMultipleDiceConfigs?b("charts:subtitle.custom"):ut(r),index:t}}):e.map((e,t)=>{const r=e.resultsConfig||e.diceConfig,a=function(e,t){if(0===e.length)return[];const r=[];if(e.forEach(e=>{e.forEach(e=>{void 0!==e&&r.push(e)})}),0===r.length)return[];const a=[...r].sort((e,t)=>e-t),n=a.length,i=[];for(let s=1;s<=t;s++){let e=0,t=a.length;for(;e<t;){const r=Math.floor((e+t)/2);a[r]<s?e=r+1:t=r}const r=(a.length-e)/n;i.push([s,r])}return i}(e.results.map(e=>e.diceValues),r.diceFaces);let n=[];return e.hasMultipleDiceConfigs||(n=function(e){const t=[];for(let r=1;r<=e;r++){const a=(e-r+1)/e;t.push([r,a])}return t}(r.diceFaces)),{diceSet:e,actualCDF:a,theoreticalCDF:n,diceSetName:xt(e),diceCode:e.hasMultipleDiceConfigs?b("charts:subtitle.custom"):ut(r),index:t}}),t},[e,E,I,b]),H=a.useMemo(()=>{const e=new Set;B.forEach(({actualCDF:t})=>{t.forEach(([t])=>e.add(t))});let t=Array.from(e).sort((e,t)=>e-t);if(T&&T>0&&t.length>T){const e=[];for(let r=0;r<T;r++){const a=r/(T-1)*(t.length-1),n=Math.round(a);e.push(t[n])}t=[...new Set(e)].sort((e,t)=>e-t)}const r=B.flatMap(({actualCDF:e,theoreticalCDF:r,diceSetName:a,diceSet:n,index:i})=>{const s=new Map(e),o=t.map(e=>{const t=s.get(e);return void 0!==t?100*t:null}),l=V?Mr(i,k,.8):Nr(k,.8),c=V?Mr(i,k,1):Nr(k,1),d={label:V?`${n.hasMultipleDiceConfigs?b("charts:subtitle.custom"):ut(n.resultsConfig||n.diceConfig)} - ${a} (${b("charts:subtitle.trialCount",{count:n.results.length})})`:`${n.hasMultipleDiceConfigs?b("charts:subtitle.custom"):ut(n.resultsConfig||n.diceConfig)} - ${b("charts:cumulative.actual")}`,data:o,backgroundColor:l,borderColor:c,borderWidth:"bar"===O?1:2,fill:!1,tension:"line"===O?.3:void 0,pointRadius:"line"===O?3:void 0,pointHoverRadius:"line"===O?5:void 0,spanGaps:!0,type:O};if(!V&&r.length>0){const e=new Map(r),a=r.map(([e])=>e).sort((e,t)=>e-t),n=[],i=10;if(a.length<=i)n.push(...a);else for(let t=0;t<i;t++){const e=t/(i-1)*(a.length-1),r=Math.round(e);n.push(a[r])}const s=t.map(t=>{let r=a[0],n=e.get(r)||0,i=a[a.length-1],s=e.get(i)||0;if(t<=r)return 100*n;if(t>=i)return 100*s;let o=0,l=a.length-1;for(;o<l;){const e=Math.floor((o+l+1)/2);a[e]<=t?o=e:l=e-1}if(r=a[o],n=e.get(r)||0,o+1<a.length){i=a[o+1],s=e.get(i)||0;return 100*(n+(t-r)/(i-r)*(s-n))}return 100*n});return[d,{label:b("charts:legend.theoreticalCumulative"),data:s,backgroundColor:"transparent",borderColor:k?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:2,borderDash:[5,5],fill:!1,tension:.3,pointRadius:2,pointHoverRadius:4,spanGaps:!0,type:"line"}]}return[d]});return{labels:t,datasets:r}},[B,k,V,T,O,b]),z=e[0],U=z?.resultsConfig||z?.diceConfig,q=z?.hasMultipleDiceConfigs||!1,Y=q?b("charts:subtitle.custom"):U?ut(U):"",X=T?` / ${b("charts:subtitle.quantilePoints",{count:T})}`:"",_=V?"individual"===E?`${b("charts:title.cumulativeIndividualBase")}\n（${b("charts:title.comparison",{count:e.length})}${X}）`:`${b("charts:title.cumulativeTotalBase")}\n（${b("charts:title.comparison",{count:e.length})}${X}）`:"individual"===E?`${b("charts:title.cumulativeIndividualBase")}\n（${Y} / ${b("charts:subtitle.trialCount",{count:z?.results.length||0})}${X})`:`${b("charts:title.cumulativeTotalBase")}\n（${Y} / ${b("charts:subtitle.trialCount",{count:z?.results.length||0})}${X})`,J=b("total"===E?"charts:axis.total":"charts:axis.diceValue");a.useEffect(()=>{x&&f&&f(_)},[x,_,f]);const K=a.useCallback(()=>{if(S.current){Qa(S.current.canvas,`cumulative-distribution_${Date.now()}.png`,C,k)}},[S,C,k]),Q=a.useCallback(e=>{R(e),o?.({distributionType:e,showOnlyActualData:I,quantileCount:T})},[I,T,o]),G=a.useCallback(e=>{L(e),o?.({distributionType:E,showOnlyActualData:e,quantileCount:T})},[E,T,o]),Z=a.useCallback(e=>{M(e),o?.({distributionType:E,showOnlyActualData:I,quantileCount:e})},[E,I,o]),ee=a.useCallback(e=>{$(e),"semi-auto"!==e.mode&&(A.current=null),l?.(e)},[$,l]),te=wn({showChartTypeToggle:!0,chartType:O,onChartTypeChange:W,showYAxisScaleSettings:!0,yAxisScale:P,onYAxisScaleChange:ee,showWidgetTypeSelector:!!u&&!!g,widgetType:u,onWidgetTypeChange:g,onOpenFullscreen:p,onDownloadImage:K});a.useEffect(()=>(te.addCustomItem({id:"cumulative-distribution-type",priority:450,render:()=>s.jsx(tr,{id:"cumulative-distribution-type",title:b("charts:options.cumulative.distributionType"),children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("button",{onClick:()=>Q("total"),className:"px-3 py-2 text-left text-sm rounded transition-colors "+("total"===E?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:b("charts:options.cumulative.total")}),s.jsx("button",{onClick:()=>Q("individual"),className:"px-3 py-2 text-left text-sm rounded transition-colors "+("individual"===E?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:b("charts:options.cumulative.individual")})]})},"cumulative-distribution-type")}),te.addCustomItem({id:"cumulative-data-range",priority:550,render:()=>s.jsx(tr,{id:"cumulative-data-range",title:b("charts:options.cumulative.dataRange"),children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("button",{onClick:()=>G(!1),className:"px-3 py-2 text-left text-sm rounded transition-colors "+(I?"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600":"bg-accent-light-500 dark:bg-accent-dark-500 text-white"),children:b("charts:options.cumulative.fullRange")}),s.jsx("button",{onClick:()=>G(!0),className:"px-3 py-2 text-left text-sm rounded transition-colors "+(I?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:b("charts:options.cumulative.actualOnly")})]})},"cumulative-data-range")}),te.addCustomItem({id:"cumulative-quantile-aggregation",priority:650,render:()=>s.jsx(tr,{id:"cumulative-quantile-aggregation",title:b("charts:options.cumulative.quantileAggregation"),children:s.jsxs("select",{value:null===T?"none":T,onChange:e=>{const t="none"===e.target.value?null:Number(e.target.value);Z(t)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"none",children:b("common:none")}),s.jsx("option",{value:"10",children:b("charts:options.cumulative.points",{count:10})}),s.jsx("option",{value:"20",children:b("charts:options.cumulative.points",{count:20})}),s.jsx("option",{value:"50",children:b("charts:options.cumulative.points",{count:50})}),s.jsx("option",{value:"100",children:b("charts:options.cumulative.points",{count:100})})]})},"cumulative-quantile-aggregation")}),()=>{te.removeItem("cumulative-distribution-type"),te.removeItem("cumulative-data-range"),te.removeItem("cumulative-quantile-aggregation")}),[te.addCustomItem,te.removeItem,b,E,I,T,Q,G,Z]);const re={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},plugins:{legend:{display:x,position:"top",labels:{color:k?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:_.split("\n"),color:k?"#D1D5DB":"#374151",font:{size:16}},decimation:{enabled:!0,algorithm:"lttb"},tooltip:{callbacks:{label:e=>{const t=e.dataset.label||"",r=e.parsed.y??0,a=e.parsed.x??0;return`${t}: ${r.toFixed(2)}% (${H.labels[a]}以上)`}}}},scales:{x:{title:{display:!0,text:J,color:k?"#D1D5DB":"#374151"},ticks:{color:k?"#9CA3AF":"#6B7280"},grid:{color:k?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}},y:{title:{display:!0,text:b("charts:axis.cumulativeProbability"),color:k?"#D1D5DB":"#374151"},ticks:{color:k?"#9CA3AF":"#6B7280",callback:e=>`${e}%`},grid:{color:k?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===P.mode?P.min:"semi-auto"===P.mode&&void 0!==P.initialMin?P.initialMin:void 0,max:"manual"===P.mode?P.max:"semi-auto"===P.mode&&void 0!==P.initialMax?P.initialMax:void 0}}},ae=y?fn(0,re):re;return z?s.jsxs("div",{className:"relative",style:x?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(x?"justify-end":"justify-between"),children:[!x&&s.jsx(En,{items:D,isDarkMode:k,onLegendClick:()=>{j(e=>e+1)}}),s.jsx(Sn,{chartType:O,onChartTypeChange:W,onDownloadImage:K,showYAxisScaleSettings:!0,yAxisScale:P,onYAxisScaleChange:ee,showWidgetTypeSelector:!!u&&!!g,widgetType:u,onWidgetTypeChange:g,menuManager:te.manager})]}),s.jsx("div",{className:"relative z-5",style:x?{height:"calc(100% - 24px)"}:y?pn(y):{height:"400px"},children:s.jsx("div",{style:y&&!x?xn(y):{width:"100%",height:"100%"},children:s.jsx(v,{ref:S,type:O,data:H,options:ae},`chart-${e[0]?.id}-${E}-${T}`)})}),!x&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:["total"===E?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:b("charts:description.cumulativeTotal")}),!q&&s.jsx("p",{className:"mt-1",children:b("charts:description.theoreticalComparison")})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{children:b("charts:description.cumulativeIndividual")}),!q&&s.jsx("p",{className:"mt-1",children:b("charts:description.theoreticalComparison")})]}),!V&&s.jsxs("p",{className:"mt-2 text-xs opacity-75",children:[b("charts:stats.dataPoints",{count:H.labels.length}),I&&` (${b("charts:options.cumulative.actualOnly")})`,T&&` / ${b("charts:options.cumulative.aggregationLabel",{count:T})}`]})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:b("charts:noData")})}),Bn=i.memo(({diceSets:e,onChartTypeChange:t,onAggregationChange:r,onMovingAverageWindowChange:n,onXAxisScaleChange:i,onYAxisScaleChange:o,chartSettings:l,currentChartSettingsId:c,isNarrowLayout:d=!1,chartRef:u,widgetType:g,onWidgetTypeChange:h,widget:m,onUpdateHiddenLegends:p,onOpenFullscreen:x,isFullscreen:f=!1,chartTitleProp:y,chartHeightSettings:v})=>{const{t:w}=$e(["charts","common"]),S=a.useRef(null),k=u||S,C=sn(),j=gn(),[,D]=a.useState(0),N=hn("rollProgress",k,m,p),A=a.useRef(null),T=a.useRef(null),M=l?.find(e=>e.id===c),{chartType:E,setChartType:R}=cn(M,"rollProgressChartType"),I="bar"===E?"line":E,{aggregationInterval:L,useAggregation:O,setAggregationInterval:F,setUseAggregation:P}=ln(M,"rollProgressChart"),{movingAverageWindow:$,setMovingAverageWindow:W}=function(e){const t=e?.rollProgressMovingAverageWindow,r=e?.id,[n,i]=a.useState(t??20);return a.useEffect(()=>{i(t??20)},[r,t]),{movingAverageWindow:n,setMovingAverageWindow:i}}(M),{xAxisScale:V,setXAxisScale:B}=dn(M,"rollProgressChartXScale"),{yAxisScale:H,setYAxisScale:z}=un(M,"rollProgressChartYScale"),U=e=>{R(e),t?.(e)},q=e[0],Y=e.length>1;a.useEffect(()=>{const e=setTimeout(()=>{k.current&&Fn(k.current,d)},100);return()=>{clearTimeout(e),On()}},[e,C,L,$,d,k]),a.useEffect(()=>{if(!k.current||!m?.hiddenLegends)return;const e=setTimeout(()=>{if(k.current){const e=k.current,t=m.hiddenLegends||[];e.data.datasets?.forEach((r,a)=>{const n=r.label||"";e.getDatasetMeta(a).hidden=t.includes(n)}),e.update()}},150);return()=>clearTimeout(e)},[k,m?.hiddenLegends,e]),a.useEffect(()=>{if("semi-auto"!==V.mode)return void(A.current&&(A.current=null));if(void 0!==V.initialMin&&void 0!==V.initialMax)return void(A.current||(A.current={min:V.initialMin,max:V.initialMax}));const e=setTimeout(()=>{if(k.current&&k.current.scales&&k.current.scales.x){const e=k.current.scales.x.min,t=k.current.scales.x.max;void 0!==e&&void 0!==t&&(A.current={min:e,max:t},B({...V,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[V.mode]),a.useEffect(()=>{if("semi-auto"!==H.mode)return void(T.current&&(T.current=null));if(void 0!==H.initialMin&&void 0!==H.initialMax)return void(T.current||(T.current={min:H.initialMin,max:H.initialMax}));const e=setTimeout(()=>{if(k.current&&k.current.scales&&k.current.scales.y){const e=k.current.scales.y.min,t=k.current.scales.y.max;void 0!==e&&void 0!==t&&(T.current={min:e,max:t},z({...H,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[H.mode]);const X=a.useMemo(()=>e.map((e,t)=>{const r=e.results.map(e=>e.total),a=e.results.map(e=>e.trialNumber);let n=a,i=r;if(O&&L>1){const e=[],t=[];for(let n=0;n<a.length;n+=L){const i=Math.min(n+L,a.length),s=a.slice(n,i),o=r.slice(n,i),l=s.reduce((e,t)=>e+t,0)/s.length,c=o.reduce((e,t)=>e+t,0)/o.length;e.push(l),t.push(c)}n=e,i=t}const s=((e,t)=>{const r=[];for(let a=0;a<e.length;a++)if(a<t-1)r.push(null);else{const n=e.slice(a-t+1,a+1).reduce((e,t)=>e+t,0);r.push(n/t)}return r})(i,$);let o=null;if(!e.hasMultipleDiceConfigs){const t=e.resultsConfig||e.diceConfig;o=t.diceCount*((t.diceFaces+1)/2)+("+"===t.modifierSign?t.modifierValue:"-"===t.modifierSign?-t.modifierValue:0)}const l=Math.min(...n),c=Math.max(...n),d="manual"===V.mode&&null!==V.min&&void 0!==V.min?V.min:l,u=("manual"===V.mode&&null!==V.max&&void 0!==V.max?V.max:c)-d<3e3,g=n.map((e,t)=>({x:e,y:i[t]})),{data:h,wasDownsampled:m}=u?{data:g,wasDownsampled:!1}:Ua(g);let p=[];if(s.length>0){const e=n.map((e,t)=>({x:e,y:null!==s[t]?s[t]:NaN})).filter(e=>!isNaN(e.y));p=(u?e:Ua(e).data).map(e=>({x:e.x,y:e.y}))}return{diceSet:e,actualData:h,movingAvgData:p,wasDownsampled:m,expectedValue:o,diceSetName:xt(e),diceCode:e.hasMultipleDiceConfigs?w("charts:subtitle.custom"):ut(e.resultsConfig||e.diceConfig),index:t}}),[e,$,O,L,V.mode,V.min,V.max,w]),_=a.useMemo(()=>{const e=Math.max(...X.map(e=>e.diceSet.results.length));return{datasets:X.flatMap(({actualData:t,movingAvgData:r,expectedValue:a,diceSetName:n,diceSet:i,index:s})=>{const o=[],l=Y?Mr(s,C,.2):Nr(C,.2),c=Y?Mr(s,C,.5):Nr(C,.5);if(o.push({label:Y?`${i.hasMultipleDiceConfigs?w("charts:subtitle.custom"):ut(i.resultsConfig||i.diceConfig)} - ${n} (${w("charts:subtitle.trialCount",{count:i.results.length})})`:`${i.hasMultipleDiceConfigs?w("charts:subtitle.custom"):ut(i.resultsConfig||i.diceConfig)} - ${w("charts:rollProgress.actual")}`,data:t,backgroundColor:l,borderColor:c,borderWidth:1,fill:!1,tension:0,pointRadius:0,pointHoverRadius:3,parsing:!1}),r.length>0){const e=Y?Mr(s,C,1):Nr(C,1);o.push({label:Y?`${i.hasMultipleDiceConfigs?w("charts:subtitle.custom"):ut(i.resultsConfig||i.diceConfig)} - ${n} (${w("charts:legend.movingAverage")})`:`${i.hasMultipleDiceConfigs?w("charts:subtitle.custom"):ut(i.resultsConfig||i.diceConfig)} - ${w("charts:legend.movingAverageWindow",{window:$})}`,data:r,backgroundColor:e,borderColor:e,borderWidth:2,fill:!1,tension:.3,pointRadius:0,pointHoverRadius:4,parsing:!1})}if(!Y&&null!==a){const r=t.length>0?t[0].x:1,n=t.length>0?t[t.length-1].x:e;o.push({type:"line",label:w("charts:legend.expectedValue",{value:a.toFixed(2)}),data:[{x:r,y:a},{x:n,y:a}],backgroundColor:"rgba(241, 13, 120, 0.2)",borderColor:C?"rgba(241, 13, 120, 0.8)":"rgb(241, 13, 120)",borderWidth:2,borderDash:[5,5],fill:!1,tension:0,pointRadius:0,parsing:!1})}return o})}},[X,C,Y,$,I,w]),J=q?.resultsConfig||q?.diceConfig,K=q?.hasMultipleDiceConfigs||!1,Q=K?w("charts:subtitle.custom"):J?ut(J):"",G=O&&L>1?` / ${w("charts:subtitle.aggregation",{interval:Ea(L)})}`:"",Z=Y?`${w("charts:title.rollProgressBase")}\n（${w("charts:title.comparison",{count:e.length})}${G}）`:`${w("charts:title.rollProgressBase")}\n（${Q} / ${w("charts:subtitle.trialCount",{count:q?.results.length||0})}${G}）`;a.useEffect(()=>{f&&y&&y(Z)},[f,Z,y]);const ee=a.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:f,position:"top",labels:{color:C?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:Z.split("\n"),color:C?"#D1D5DB":"#374151",font:{size:16}},tooltip:{mode:"index",intersect:!1}},scales:{x:{type:"linear",title:{display:!0,text:w("charts:axis.trialNumber"),color:C?"#D1D5DB":"#374151"},ticks:{color:C?"#9CA3AF":"#6B7280"},grid:{color:C?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===V.mode?V.min:"semi-auto"===V.mode&&void 0!==V.initialMin?V.initialMin:void 0,max:"manual"===V.mode?V.max:"semi-auto"===V.mode&&void 0!==V.initialMax?V.initialMax:void 0},y:{title:{display:!0,text:w("charts:axis.total"),color:C?"#D1D5DB":"#374151"},ticks:{color:C?"#9CA3AF":"#6B7280"},grid:{color:C?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===H.mode?H.min:"semi-auto"===H.mode&&void 0!==H.initialMin?H.initialMin:void 0,max:"manual"===H.mode?H.max:"semi-auto"===H.mode&&void 0!==H.initialMax?H.initialMax:void 0}}}),[Z,C,w,V,H,f]),te=a.useMemo(()=>v?fn(0,ee):ee,[ee,v]),re=()=>{if(k.current){Qa(k.current.canvas,`trial-progress_${Date.now()}.png`,j,C)}},ae=e=>{B(e),"semi-auto"!==e.mode&&(A.current=null),i?.(e)},ne=e=>{z(e),"semi-auto"!==e.mode&&(T.current=null),o?.(e)},ie=wn({chartType:I,onChartTypeChange:U,showChartTypeToggle:!1,showAggregationSettings:!0,useAggregation:O,aggregationInterval:L,onAggregationChange:e=>{P(e.useAggregation),F(e.aggregationInterval),r?.(e.useAggregation&&e.aggregationInterval>1?e.aggregationInterval:null)},currentDataPoints:q?.results?.length??0,isAggregated:O&&L>1,showMovingAverageSettings:!0,movingAverageWindow:$,onMovingAverageWindowChange:e=>{W(e),n?.(e)},showXAxisScaleSettings:!0,xAxisScale:V,onXAxisScaleChange:ae,showYAxisScaleSettings:!0,yAxisScale:H,onYAxisScaleChange:ne,showWidgetTypeSelector:!!g&&!!h,widgetType:g,onWidgetTypeChange:h,onOpenFullscreen:x,onDownloadImage:re});return q?s.jsxs("div",{className:"relative",style:f?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(f?"justify-end":"justify-between"),children:[!f&&s.jsx(En,{items:N,isDarkMode:C,onLegendClick:()=>{D(e=>e+1)}}),s.jsx(Sn,{chartType:I,onChartTypeChange:U,onDownloadImage:re,showChartTypeToggle:!1,showAggregationSettings:!0,useAggregation:O,aggregationInterval:L,onAggregationChange:e=>{P(e.useAggregation),F(e.aggregationInterval),r?.(e.useAggregation&&e.aggregationInterval>1?e.aggregationInterval:null)},currentDataPoints:q?.results?.length??0,isAggregated:O&&L>1,showMovingAverageSettings:!0,movingAverageWindow:$,onMovingAverageWindowChange:e=>{W(e),n?.(e)},showXAxisScaleSettings:!0,xAxisScale:V,onXAxisScaleChange:ae,showYAxisScaleSettings:!0,yAxisScale:H,onYAxisScaleChange:ne,showWidgetTypeSelector:!!g&&!!h,widgetType:g,onWidgetTypeChange:h,menuManager:ie.manager})]}),s.jsx("div",{className:"relative",style:f?{height:"calc(100% - 24px)"}:v?pn(v):{height:"400px"},children:s.jsx("div",{style:v&&!f?xn(v):{width:"100%",height:"100%"},children:s.jsx(b,{ref:k,data:_,options:te},`line-${d}`)})}),!f&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("p",{children:w("charts:description.rollProgress")}),!K&&s.jsx("p",{className:"mt-1",children:w("charts:description.expectedValueComparison")})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:w("charts:noData")})});i.memo(({diceSets:e,targetValue:t,onTargetValueChange:r,onChartTypeChange:n,onYAxisScaleChange:o,chartSettings:l,currentChartSettingsId:c,isNarrowLayout:d=!1,chartHeightSettings:u})=>{const{t:g}=$e(["charts","common"]),h=a.useRef(null),m=sn(),p=gn(),[x,f]=i.useState(t),v=a.useRef(null),w=l?.find(e=>e.id===c),{chartType:S,setChartType:k}=cn(w,"targetValueChartType"),{yAxisScale:C,setYAxisScale:j}=un(w,"targetValueChartYScale"),D=e=>{k(e),n?.(e)},N=e=>{j(e),"semi-auto"!==e.mode&&(v.current=null),o?.(e)},A=e[0];i.useEffect(()=>{const e=setTimeout(()=>{h.current&&Fn(h.current,d)},100);return()=>{clearTimeout(e),On()}},[e,m,x,d]),a.useEffect(()=>{if("semi-auto"!==C.mode)return void(v.current&&(v.current=null));if(void 0!==C.initialMin&&void 0!==C.initialMax)return void(v.current||(v.current={min:C.initialMin,max:C.initialMax}));const e=setTimeout(()=>{if(h.current&&h.current.scales&&h.current.scales.y){const e=h.current.scales.y.min,t=h.current.scales.y.max;void 0!==e&&void 0!==t&&(v.current={min:e,max:t},j({...C,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[C.mode]),i.useEffect(()=>{f(t)},[t]);const T=e=>{f(e),r?.(e)},M=e.length>1,E=a.useMemo(()=>e.map((e,t)=>{const r=e.results.length>0?Math.max(...e.results.map(e=>e.diceValues.length)):0,a=new Array(r).fill(0);return e.results.forEach(e=>{e.diceValues.forEach((e,t)=>{e===x&&a[t]++})}),{diceSet:e,counts:a,diceSetName:xt(e),diceCode:e.hasMultipleDiceConfigs?g("charts:subtitle.custom"):ut(e.resultsConfig||e.diceConfig),index:t}}),[e,x,g]),R=a.useMemo(()=>{const e=Math.max(...E.map(e=>e.counts.length)),t=E.map(({counts:e,diceSetName:t,index:r,diceSet:a})=>{const n=M?Mr(r,m,"bar"===S?.6:.05):Nr(m,"bar"===S?.5:.05),i=M?Mr(r,m,1):Nr(m,1);return{label:M?`${a.hasMultipleDiceConfigs?g("charts:subtitle.custom"):ut(a.resultsConfig||a.diceConfig)} - ${t} (${Ea(a.results.length)}${g("common:label.trial")})`:`${a.hasMultipleDiceConfigs?g("charts:subtitle.custom"):ut(a.resultsConfig||a.diceConfig)} - ${g("charts:targetStats.occurrences",{value:x})}`,data:e,backgroundColor:n,borderColor:i,borderWidth:"bar"===S?1:2,fill:"line"===S,tension:"line"===S?.3:void 0,pointRadius:"line"===S?4:void 0,pointHoverRadius:"line"===S?6:void 0}});return{labels:Array.from({length:e},(e,t)=>`${g("common:label.dice")}${t+1}`),datasets:t}},[E,m,S,x,M,g]),I=a.useMemo(()=>{if(M||!A||0===A.results.length)return null;const e=E[0].counts,t=e.reduce((e,t)=>e+t,0);return{totalCount:t,averagePerDice:t/e.length,maxCount:Math.max(...e),minCount:Math.min(...e)}},[E,M,A]),L=A?.resultsConfig||A?.diceConfig,O=A?.hasMultipleDiceConfigs||!1?g("charts:subtitle.custom"):L?ut(L):"",F=L?.diceFaces||6,P=M?`${g("charts:targetStats.title.base")}\n（${g("charts:subtitle.custom")}目: ${x} / ${g("charts:title.comparison",{count:e.length})}）`:`${g("charts:targetStats.title.base")}\n（${g("charts:subtitle.custom")}目: ${x} / ${O} / ${g("charts:subtitle.trialCount",{count:A?.results.length||0})}）`,$=a.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{position:"top",display:M,labels:M?{color:m?"#D1D5DB":"#374151",usePointStyle:!0,padding:d?15:8,generateLabels:e=>{const t=e.data;return t.datasets?t.datasets.map((t,r)=>{const a=e.getDatasetMeta(r),n=t.label||"",i=Array.isArray(t.backgroundColor)?t.backgroundColor[0]:t.backgroundColor,s=Array.isArray(t.borderColor)?t.borderColor[0]:t.borderColor;return{text:d?n:"",fillStyle:i,strokeStyle:s,lineWidth:t.borderWidth||1,hidden:!a.visible,index:r,datasetIndex:r,fontColor:m?"#D1D5DB":"#374151",_fullText:n}}):[]}}:{color:m?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},decimation:{enabled:!0,algorithm:"lttb"},title:{display:!0,text:P.split("\n"),font:{size:16}},tooltip:!M&&I?{callbacks:{afterLabel:e=>{const t=e.parsed.y;if(null===t)return"";const r=(t/A.results.length*100).toFixed(1);return g("charts:targetStats.occurrenceRate",{rate:r})}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:g("charts:targetStats.yAxis")},ticks:{precision:0},min:"manual"===C.mode?C.min:"semi-auto"===C.mode&&void 0!==C.initialMin?C.initialMin:void 0,max:"manual"===C.mode?C.max:"semi-auto"===C.mode&&void 0!==C.initialMax?C.initialMax:void 0},x:{title:{display:!0,text:g("common:label.dice")}}}}),[P,m,d,M,I,g,A,C]),W=a.useMemo(()=>u?fn(0,$):$,[$,u]),V=()=>{Za(h,"target",p,m)},B=wn({chartType:S,onChartTypeChange:D,showTargetValueSettings:!0,targetValue:x,minTargetValue:1,maxTargetValue:F,onTargetValueChange:T,showYAxisScaleSettings:!0,yAxisScale:C,onYAxisScaleChange:N,onDownloadImage:V});return A?s.jsxs("div",{className:"relative",children:[s.jsx(Sn,{chartType:S,onChartTypeChange:D,onDownloadImage:V,showTargetValueSettings:!0,targetValue:x,minTargetValue:1,maxTargetValue:F,onTargetValueChange:T,showYAxisScaleSettings:!0,yAxisScale:C,onYAxisScaleChange:N,menuManager:B.manager}),s.jsx("div",{className:"pt-6",style:u?pn(u):{height:"400px"},children:s.jsx("div",{style:u?xn(u):{width:"100%",height:"100%"},children:"bar"===S?s.jsx(y,{ref:h,data:R,options:W},`bar-${d}`):s.jsx(b,{ref:h,data:R,options:W},`line-${d}`)})}),!M&&I&&s.jsxs("div",{className:"mt-4 border rounded-lg p-3 text-sm "+(m?"bg-accent-dark-50 dark:bg-accent-dark-900/20 border-accent-dark-200 dark:border-accent-dark-800":"bg-accent-light-50 dark:bg-accent-light-900/20 border-accent-light-200 dark:border-accent-light-800"),children:[s.jsx("div",{className:"font-semibold mb-2 "+(m?"text-accent-dark-700 dark:text-accent-dark-300":"text-accent-light-700 dark:text-accent-light-300"),children:g("charts:targetStats.summary.title",{value:x})}),s.jsxs("div",{className:"space-y-1 "+(m?"text-accent-dark-600 dark:text-accent-dark-400":"text-accent-light-600 dark:text-accent-light-400"),children:[s.jsx("div",{children:g("charts:targetStats.summary.total",{count:I.totalCount})}),s.jsx("div",{children:g("charts:targetStats.summary.average",{average:I.averagePerDice.toFixed(2)})}),s.jsx("div",{children:g("charts:targetStats.summary.rate",{rate:(I.totalCount/(A.results.length*E[0].counts.length)*100).toFixed(2)})}),s.jsx("div",{children:g("charts:targetStats.summary.range",{max:I.maxCount,min:I.minCount})})]})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:g("charts:noData")})});const Hn=({diceSets:e,isDarkMode:t,recentRollsCount:r=1,onRecentRollsCountChange:n,widgetType:i,onWidgetTypeChange:o,highlightConditions:l=[],onHighlightConditionsChange:c,widget:d,onUpdateHiddenLegends:u})=>{const{t:g}=$e(["charts","common"]),[,h]=a.useState(0),m=a.useMemo(()=>{const r=d?.hiddenLegends||[],a=e.length>1,n=t?"#a78bfa":"#3b82f6";return e.map(e=>{const t=a?xt(e):ut(e.diceConfig),i=r.includes(t);return{label:t,color:n,chartType:"result",hidden:i,onClick:()=>{const e=[...r],a=e.indexOf(t);i&&-1!==a?e.splice(a,1):i||-1!==a||e.push(t),u?.(e)}}})},[e,d?.hiddenLegends,t,u]),p=a.useMemo(()=>{const t=d?.hiddenLegends||[],a=e.length>1;return e.filter(e=>{const r=a?xt(e):ut(e.diceConfig);return!t.includes(r)}).map(e=>{const t=Math.min(r,e.results.length);return{diceSet:e,recentResults:[...e.results].reverse().slice(0,t)}})},[e,r,d?.hiddenLegends]);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx(En,{items:m,isDarkMode:t,onLegendClick:()=>{h(e=>e+1)}}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(Sn,{chartType:"bar",onChartTypeChange:()=>{},showChartTypeToggle:!1,showRecentRollsCountSettings:!0,recentRollsCount:r,onRecentRollsCountChange:n,showHighlightConditionsSettings:!0,highlightConditions:l,onHighlightConditionsChange:c,showWidgetTypeSelector:!!i&&!!o,widgetType:i,onWidgetTypeChange:o})})]}),s.jsx("div",{className:"mb-3",children:s.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[s.jsx("span",{className:"font-semibold text-sm text-gray-900 dark:text-white",children:g("charts:recentRolls.highlightLabel")}),l.length>0?s.jsx("div",{className:"flex gap-2 flex-wrap",children:l.map((e,t)=>{let r="";if("single"===e.type)r=String(e.value);else if("range"===e.type)r=g("common:tableFilter.conditionValueRange",{min:e.min,max:e.max});else if("modulo"===e.type){let t="";t=e.offset>0?g("common:tableFilter.moduloOffsetPlus",{offset:e.offset}):e.offset<0?g("common:tableFilter.moduloOffsetMinus",{offset:Math.abs(e.offset)}):g("common:tableFilter.moduloOffsetZero"),r=g("common:tableFilter.conditionValueModulo",{divisor:e.divisor,offset:t})}else"max"===e.type?r=g("common:tableFilter.conditionValueMax"):"min"===e.type&&(r=g("common:tableFilter.conditionValueMin"));return s.jsx("div",{className:"text-xs border border-gray-300 dark:border-gray-700 bg-gray-300 dark:bg-gray-700 rounded-[5px]",children:s.jsx("span",{className:"inline-block px-2 py-1 rounded-[4px] font-bold bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300",children:r})},t)})}):s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:g("common:none")})]})}),s.jsx("div",{className:"space-y-4",children:p.map(({diceSet:e,recentResults:a})=>s.jsxs("div",{className:"@container p-3 "+(t?"border-t border-gray-600":"border-t border-gray-200"),children:[s.jsxs("h3",{className:"flex gap-2 items-baseline font-medium mb-3 "+(t?"text-gray-200":"text-gray-700"),children:[s.jsx("span",{className:"text-md",children:ut(e.diceConfig)}),s.jsxs("span",{className:"font-mono text-xs "+(t?"text-gray-400":"text-gray-500"),children:["(",xt(e),")"]})]}),0===a.length?s.jsx("p",{className:"text-sm "+(t?"text-gray-400":"text-gray-500"),children:g("charts:recentRolls.noResultsYet")}):(()=>{const n=e.diceConfig.diceCount;let i="grid-cols-1";return i=1===r?"grid-cols-1":2===r?1===n?"grid-cols-2":"grid-cols-1 @sm:grid-cols-2":1===n?"grid-cols-3":2===n?"grid-cols-3 @sm:grid-cols-3":n<=4?"grid-cols-1 @sm:grid-cols-3":"grid-cols-1 @sm:grid-cols-2 @lg:grid-cols-3",s.jsx("div",{className:`grid ${i} gap-4`,children:a.map(e=>s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("span",{className:"text-sm font-bold "+(t?"text-gray-300":"text-gray-600"),children:g("charts:recentRolls.trialNumber",{number:Ea(e.trialNumber)})}),e.diceValues.length>1&&s.jsxs("span",{className:"text-xs font-medium "+(t?"text-gray-400":"text-gray-500"),children:["/ ",g("charts:recentRolls.total"),":"," ",Ea(e.total)]})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.diceValues.map((r,a)=>{const n=Or(r,{highlightConditions:l,isDarkMode:t,alphaBorder:.8,alphaBackground:.3,allValues:e.diceValues});return s.jsx("div",{className:"flex items-center justify-center min-w-[3rem] w-[3rem] h-[3rem] px-2 py-1.5 rounded border text-sm font-medium "+(n?"":t?"bg-gray-700 border-gray-500 text-gray-100":"bg-white border-gray-300 text-gray-800"),style:n,children:r},a)})})]},e.trialNumber))})})()]},e.id))})]})},zn=({isOpen:e,onClose:t,widget:r,diceSets:n,chartSettings:o,currentChartSettingsId:l,onUpdateWidget:c})=>{const{t:d}=$e(["charts"]),u=a.useRef(null),[g,h]=i.useState(""),m=a.useCallback(e=>{r&&c(r.id,{hiddenLegends:e})},[r,c]);if(a.useEffect(()=>{if(!e||!u.current||!r)return;const t=u.current;if(t.options.plugins?.legend&&(t.options.plugins.legend.display=!0,t.options.plugins.legend.onClick=(e,t,r)=>{const a=t.datasetIndex;if(void 0===a)return;const n=r.chart,i=n.getDatasetMeta(a);i.hidden=null===i.hidden?!n.data.datasets[a].hidden:!i.hidden,n.update();const s=n.data.datasets,o=[];s.forEach((e,t)=>{n.getDatasetMeta(t).hidden&&o.push(e.label||"")}),m(o)}),r.hiddenLegends&&t.data.datasets){const e=r.hiddenLegends;t.data.datasets.forEach((r,a)=>{const n=r.label||"";t.getDatasetMeta(a).hidden=e.includes(n)})}t.resize(),t.update()},[e,r,m]),!r)return null;const p=e=>{c(r.id,{aggregationSettings:e})},x=e=>{c(r.id,{aggregationSettings:e})},f=e=>{c(r.id,{chartType:e})},y=e=>{c(r.id,{xAxisScale:e})},b=e=>{c(r.id,{yAxisScale:e})},v=e=>{c(r.id,{movingAverageWindow:e})},w=e=>{c(r.id,{distributionType:e.distributionType,showOnlyActualData:e.showOnlyActualData,quantileCount:e.quantileCount})},S=o?.find(e=>e.id===l),k=`${l}-${r.id}-fullscreen`,C=S?{...S,id:k,resultChart:"result"===r.type&&r.aggregationSettings||S.resultChart,individualDiceChart:"individual"===r.type&&r.aggregationSettings||S.individualDiceChart,rollProgressChart:"rollProgress"===r.type&&r.aggregationSettings||S.rollProgressChart,resultChartType:"result"===r.type&&r.chartType||S.resultChartType,individualDiceChartType:"individual"===r.type&&r.chartType||S.individualDiceChartType,rollProgressChartType:"rollProgress"===r.type&&r.chartType||S.rollProgressChartType,cumulativeChartType:"cumulative"===r.type&&r.chartType||S.cumulativeChartType,resultChartXScale:"result"===r.type&&r.xAxisScale||S.resultChartXScale,rollProgressChartXScale:"rollProgress"===r.type&&r.xAxisScale||S.rollProgressChartXScale,resultChartYScale:"result"===r.type&&r.yAxisScale||S.resultChartYScale,individualDiceChartYScale:"individual"===r.type&&r.yAxisScale||S.individualDiceChartYScale,rollProgressChartYScale:"rollProgress"===r.type&&r.yAxisScale||S.rollProgressChartYScale,cumulativeChartYScale:"cumulative"===r.type&&r.yAxisScale||S.cumulativeChartYScale,rollProgressMovingAverageWindow:"rollProgress"===r.type?r.movingAverageWindow??S.rollProgressMovingAverageWindow:S.rollProgressMovingAverageWindow,cumulativeDistributionType:"cumulative"===r.type&&r.distributionType||S.cumulativeDistributionType,cumulativeShowOnlyActualData:"cumulative"===r.type?r.showOnlyActualData??S.cumulativeShowOnlyActualData:S.cumulativeShowOnlyActualData,cumulativeQuantileCount:"cumulative"===r.type?r.quantileCount??S.cumulativeQuantileCount:S.cumulativeQuantileCount}:void 0,j=C?[C]:o,D=C?.id||l,N=g?g.replace(/\n/g," "):d("charts:menu.fullScreen");return s.jsxs(lr,{isOpen:e,onClose:t,size:"fullscreen",maxHeight:"90vh",children:[s.jsx(cr,{title:N,onClose:t}),s.jsx(dr,{children:s.jsx("div",{style:{width:"100%",height:"calc(98vh - 100px)"},children:(()=>{const e={width:"100%",height:"100%"};switch(r.type){case"result":return s.jsx("div",{style:e,children:s.jsx(Pn,{diceSets:n,onBinningSettingsChange:x,onChartTypeChange:f,onXAxisScaleChange:y,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:u,widget:r,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});case"cumulative":return s.jsx("div",{style:e,children:s.jsx(Vn,{diceSets:n,onChartTypeChange:f,onCumulativeSettingsChange:w,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:u,widget:r,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});case"rollProgress":return s.jsx("div",{style:e,children:s.jsx(Bn,{diceSets:n,onChartTypeChange:f,onAggregationChange:e=>{p({useAggregation:null!==e&&e>1,aggregationInterval:e||1})},onMovingAverageWindowChange:v,onXAxisScaleChange:y,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:u,widget:r,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});case"individual":return s.jsx("div",{style:e,children:s.jsx(Wn,{diceSets:n,onChartTypeChange:f,onAggregationSettingsChange:p,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:u,widget:r,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});default:return null}})()})})]})},Un=i.memo(({diceSet:e,onClose:t,onSave:r,isCreateMode:n=!1})=>{const{t:i}=$e(["dice","common","messages"]),[o,l]=a.useState(!1),[c,d]=a.useState(e.name),[u,g]=a.useState(String(e.diceConfig.diceCount??"")),[h,m]=a.useState(String(e.diceConfig.diceFaces??"")),[p,x]=a.useState(e.diceConfig.modifierSign),[f,y]=a.useState(String(e.diceConfig.modifierValue??"")),[b,v]=a.useState(String(e.trialCount??"")),w=e=>e.replace(/[^0-9]/g,""),S=(e,t,r)=>Math.min(Math.max(e,t),r),k=ut({diceCount:parseInt(u,10)||e.diceConfig.diceCount,diceFaces:parseInt(h,10)||e.diceConfig.diceFaces,modifierSign:p,modifierValue:parseInt(f,10)||e.diceConfig.modifierValue});return s.jsxs(lr,{isOpen:!0,onClose:t,size:"2xl",modalId:"dice-config-modal",children:[s.jsx(cr,{title:i(n?"dice:config.titleCreate":"dice:config.titleEdit"),onClose:t}),s.jsxs(dr,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("dice:config.name.label")}),s.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:k,maxLength:128,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("dice:config.count.label",{min:1,max:et})}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:u,onChange:e=>{const t=w(e.target.value);g(t)},onBlur:t=>{const r=t.target.value;if(""===r)g(String(e.diceConfig.diceCount));else{const e=S(parseInt(r,10),1,et);g(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("dice:config.sides.label",{min:1,max:tt})}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:h,onChange:e=>{const t=w(e.target.value);m(t)},onBlur:t=>{const r=t.target.value;if(""===r)m(String(e.diceConfig.diceFaces));else{const e=S(parseInt(r,10),1,tt);m(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("dice:config.modifier.label",{min:0,max:rt})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("select",{value:p,onChange:e=>x(e.target.value),className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500",children:[s.jsx("option",{value:"",children:i("dice:config.modifier.sign")}),s.jsx("option",{value:"+",children:"+"}),s.jsx("option",{value:"-",children:"-"})]}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:f,onChange:e=>{const t=w(e.target.value);y(t)},onBlur:t=>{const r=t.target.value;if(""===r)y(String(e.diceConfig.modifierValue));else{const e=S(parseInt(r,10),0,rt);y(String(e))}},disabled:!p,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 disabled:bg-gray-100 dark:disabled:bg-gray-600"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:i("dice:config.trial.label",{min:1,max:at})}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:b,onChange:e=>{const t=w(e.target.value);v(t)},onBlur:t=>{const r=t.target.value;if(""===r)v(String(e.trialCount));else{const e=S(parseInt(r,10),1,at);v(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]})]}),s.jsxs("div",{className:"mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg relative transition-colors",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[i("dice:config.notation.label"),":"]}),s.jsx("p",{className:"text-lg font-mono font-bold text-accent-light-600 dark:text-accent-dark-400",children:k}),s.jsx("button",{onClick:async()=>{try{await Ga(k),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){}},title:i(o?"dice:config.notation.copied":"dice:config.notation.copy"),className:"absolute top-2 right-2 p-1.5 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors group",children:o?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx(ct,{name:"clipboard",className:"h-4 w-4 text-gray-600 group-hover:text-gray-800 dark:text-gray-400 dark:group-hover:text-gray-200"})})]})]}),s.jsxs(ur,{align:"right",children:[s.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:i("common:button.cancel")}),s.jsx("button",{onClick:()=>{const a={};c!==e.name&&(a.name=c);const i={diceCount:S(parseInt(u,10)||e.diceConfig.diceCount,1,et),diceFaces:S(parseInt(h,10)||e.diceConfig.diceFaces,1,tt),modifierSign:p,modifierValue:S(parseInt(f,10)||e.diceConfig.modifierValue,0,rt)};i.diceCount===e.diceConfig.diceCount&&i.diceFaces===e.diceConfig.diceFaces&&i.modifierSign===e.diceConfig.modifierSign&&i.modifierValue===e.diceConfig.modifierValue||(a.diceConfig=i);const s=S(parseInt(b,10)||e.trialCount,1,at);s!==e.trialCount&&(a.trialCount=s),(n||Object.keys(a).length>0)&&r(e.id,a),t()},className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors",children:i(n?"common:button.create":"common:button.save")})]})]})}),qn=i.memo(({diceSets:e,selectedDiceSetIds:t,onToggleDiceSet:r,onClose:a,onApply:n,onDuplicateDiceSet:o,onDeleteDiceSet:l,onBulkDeleteDiceSets:c,onBulkDuplicateDiceSets:d,onUpdateDiceSet:u,onReorderDiceSets:g,onExportDiceSets:h,onImportDiceSets:m,onCreateDiceSet:p,onDeleteAllDiceSets:x})=>{const{t:f}=$e(["diceSets","common"]),[y,b]=i.useState(t),[v,w]=i.useState(null),[S,k]=i.useState(Jt()),[C,j]=i.useState(null),[D,N]=i.useState(!1),[A,T]=i.useState(null),[M,E]=i.useState(()=>{const e=localStorage.getItem("isMultiSelectMode"),r=(()=>{try{if(!e)return!1;const t=JSON.parse(e);return"boolean"==typeof t&&t}catch{return!1}})();return t.length>1||r}),R=i.useRef({});i.useEffect(()=>{localStorage.setItem("isMultiSelectMode",JSON.stringify(M))},[M]);const I=i.useCallback(()=>{const e=!S;k(e),Kt(e)},[S]);i.useEffect(()=>{y.length>1&&!M&&E(!0)},[y.length]),i.useEffect(()=>{b(t=>{const r=e.map(e=>e.id);return t.filter(e=>r.includes(e))})},[e]),e.forEach(e=>{R.current[e.id]||(R.current[e.id]=i.createRef())});const L=e=>{b(t=>M?t.includes(e)?t.filter(t=>t!==e):[...t,e]:t.includes(e)?t.filter(t=>t!==e):[e])};return s.jsxs(s.Fragment,{children:[s.jsxs(lr,{isOpen:!0,onClose:a,size:"2xl",maxHeight:"80vh",modalId:"compare-dicesets-modal",children:[s.jsx(cr,{title:f("diceSets:title"),onClose:a,closeButtonLabel:f("common:button.close"),actions:y.length>0?s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:f("diceSets:list.selected",{count:y.length})}):null,sticky:!1}),s.jsx("div",{className:"px-4 border-b border-gray-200 dark:border-gray-700",children:s.jsx(ei,{diceSets:e,compareDiceSetIds:y,onCreateDiceSet:()=>{if(!p)return;const e={id:"",name:"",diceConfig:{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:1,results:[],targetValue:1,createdAt:String(Date.now()),updatedAt:String(Date.now())};T(e),N(!0)},onToggleCompareDiceSet:L,onExportDiceSets:h,onImportDiceSets:m,onBulkDuplicateDiceSets:d,onBulkDeleteDiceSets:c,onDeleteAllDiceSets:x||(()=>{}),simpleMode:S,onToggleSimpleMode:I})}),s.jsx(dr,{scrollable:!0,padding:!1,className:"shrink p-4",children:s.jsx(rr,{items:e,selectedIds:y,onToggleItem:L,emptyMessage:f("diceSets:empty"),showSelectionCount:!1,enableDragAndDrop:!!g,onReorder:g,renderItem:(t,r,a,n)=>s.jsx(Zn,{diceSet:t,isSelected:r,selectedDiceSetIds:y,onToggle:()=>L(t.id),showCheckbox:!1,showDragHandle:!!g,dragHandleProps:n,simpleMode:S,diceSetsLength:e.length,onSetEditingDiceSetId:j,onDuplicateDiceSet:o,onDeleteDiceSet:l,openMenuId:v,onOpenMenu:w,menuButtonRef:R.current[t.id]})})}),s.jsx(ur,{children:s.jsx("button",{onClick:()=>{n?n(y):(t.forEach(e=>{y.includes(e)||r(e)}),y.forEach(e=>{t.includes(e)||r(e)})),a()},className:"w-full px-6 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded transition-colors",children:f("common:button.apply")})})]}),C&&s.jsx(Un,{diceSet:e.find(e=>e.id===C),onClose:()=>j(null),onSave:u}),D&&A&&s.jsx(Un,{diceSet:A,onClose:()=>{N(!1),T(null)},onSave:(e,t)=>{N(!1),T(null),p&&p(t)},isCreateMode:!0})]})});function Yn(e){const t=bt(),r=e;return t.map(e=>{const t={...e};switch(e.type){case"result":r.resultChart&&(t.aggregationSettings=r.resultChart),r.resultChartType&&(t.chartType=r.resultChartType),r.resultChartXScale&&(t.xAxisScale=r.resultChartXScale),r.resultChartYScale&&(t.yAxisScale=r.resultChartYScale);break;case"cumulative":r.cumulativeChartType&&(t.chartType=r.cumulativeChartType),r.cumulativeDistributionType&&(t.distributionType=r.cumulativeDistributionType),void 0!==r.cumulativeShowOnlyActualData&&(t.showOnlyActualData=r.cumulativeShowOnlyActualData),void 0!==r.cumulativeQuantileCount&&(t.quantileCount=r.cumulativeQuantileCount),r.cumulativeChartXScale&&(t.xAxisScale=r.cumulativeChartXScale),r.cumulativeChartYScale&&(t.yAxisScale=r.cumulativeChartYScale);break;case"rollProgress":r.rollProgressChart&&(t.aggregationSettings=r.rollProgressChart),r.rollProgressChartType&&(t.chartType=r.rollProgressChartType),r.rollProgressMovingAverageWindow&&(t.movingAverageWindow=r.rollProgressMovingAverageWindow),r.rollProgressChartXScale&&(t.xAxisScale=r.rollProgressChartXScale),r.rollProgressChartYScale&&(t.yAxisScale=r.rollProgressChartYScale);break;case"individual":r.individualDiceChart&&(t.aggregationSettings=r.individualDiceChart),r.individualDiceChartType&&(t.chartType=r.individualDiceChartType),r.individualDiceChartXScale&&(t.xAxisScale=r.individualDiceChartXScale),r.individualDiceChartYScale&&(t.yAxisScale=r.individualDiceChartYScale)}return t})}qn.displayName="CompareDiceSetsModal";const Xn=({mode:e,initialSettings:t={},initialName:r="",compareDiceSetIds:n,currentDiceSetIds:i,diceSets:o,onSubmit:l,onClose:c})=>{const{t:d}=$e(["charts","common","messages","settings"]),[u,g]=a.useState(r),[h,m]=a.useState(""),[p,x]=a.useState(!1),[f,y]=a.useState(()=>{return(e=t).widgets&&e.widgets.length>0?e:{...e,widgets:Yn(e)};var e}),b=async()=>{if(u.trim()){x(!0),m("");try{const{id:e,name:t,...r}=f;let a=r;if(a.rememberSelectedDiceSet){a={...a,selectedDiceSetIds:[...i||n||[]]};const e=new Set(o.map(e=>e.id));a.selectedDiceSetIds&&(a.selectedDiceSetIds=a.selectedDiceSetIds.filter(t=>e.has(t)))}await l(u.trim(),a),c()}catch(e){m(e instanceof Error?e.message:d("settings:chartSettings.errors.operationFailed"))}finally{x(!1)}}else m(d("settings:chartSettings.errors.nameRequired"))},v=()=>{switch(e){case"create":return d("common:button.create");case"edit":return d("settings:chartSettings.save");case"duplicate":return d("settings:chartSettings.duplicate")}},w=f.rememberSelectedDiceSet&&f.selectedDiceSetIds?f.selectedDiceSetIds:[],S=o.filter(e=>w.includes(e.id));return s.jsxs(lr,{isOpen:!0,onClose:c,size:"2xl",maxHeight:"80vh",children:[s.jsx(cr,{title:(()=>{switch(e){case"create":return d("charts:options.createNew");case"edit":return d("settings:chartSettings.editTitle");case"duplicate":return d("settings:chartSettings.duplicateTitle")}})(),onClose:c}),s.jsxs(dr,{scrollable:!0,children:[h&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:h})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:d("settings:chartSettings.nameLabel")}),s.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"===e.key&&b()},placeholder:d("settings:chartSettings.namePlaceholder"),maxLength:128,autoFocus:!0,disabled:p,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent disabled:opacity-50"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d("settings:chartSettings.maxLength")})]}),s.jsxs("div",{className:"space-y-4 pt-2 border-t border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"remember-dice-set",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:d("settings:chartSettings.rememberDiceSet.label")}),s.jsx(pr,{checked:f.rememberSelectedDiceSet??!1,onChange:e=>{y(t=>({...t,rememberSelectedDiceSet:e,selectedDiceSetIds:e?[...i||n||[]]:t.selectedDiceSetIds}))},label:d("settings:chartSettings.rememberDiceSet.label")})]}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:d("settings:chartSettings.rememberDiceSet.description")})]}),S.length>0&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700",children:[s.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:d("settings:chartSettings.targetDiceSets","Target Dice Sets:")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(e=>s.jsx("div",{className:"\n                        inline-flex items-center gap-1.5 px-2.5 py-1 \n                        bg-white dark:bg-gray-800\n                        text-gray-700 dark:text-gray-300\n                        rounded-full text-sm border border-gray-200 dark:border-gray-700\n                        shadow-sm\n                    ",children:s.jsxs("span",{className:"font-medium",children:[void 0!==e.numericUid&&s.jsxs("span",{className:"mr-1.5 text-xs text-gray-400 dark:text-gray-500 font-normal",children:["#",e.numericUid]}),ut(e.diceConfig)]})},e.id))})]})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:d("settings:chartSettings.chartOptions")}),s.jsx(Dn,{settings:f,onChange:e=>{y(t=>({...t,...e}))},showAllCharts:!0})]})]})]}),s.jsxs(ur,{align:"right",children:[s.jsx("button",{onClick:c,disabled:p,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:d("settings:chartSettings.cancel")}),s.jsx("button",{onClick:b,disabled:p||!u.trim(),className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-medium rounded-lg transition-colors disabled:opacity-50",title:p?d("common:label.processing"):v(),children:v()})]})]})},_n=({condition:e,diceCount:t,onChange:r,onRemove:n,onAdd:i,error:o,dragHandleProps:l,onDragOver:c,onDrop:d,onTouchStart:u,onTouchMove:g,onTouchEnd:h,onTouchCancel:m,style:p,isDragging:x,isDropTarget:f})=>{const{t:y}=$e(),[b,v]=a.useState(!1),[w,S]=a.useState(!1),k=a.useRef(null),C=a.useRef(null),j=[{value:"trialNumber",label:y("filterColumn.trialNumber")},...Array.from({length:t},(e,t)=>({value:`dice-${t}`,label:y("filterColumn.dice",{index:t+1})})),{value:"total",label:y("filterColumn.total")}],D=[{value:"equals",label:y("filterOperator.equals")},{value:"notEquals",label:y("filterOperator.notEquals")},{value:"greaterThan",label:y("filterOperator.greaterThan")},{value:"lessThan",label:y("filterOperator.lessThan")}];return s.jsxs("div",{className:`flex flex-col gap-2 p-2 rounded ${f?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500":""} ${x?"opacity-50":""}`,style:p,draggable:!1,onDragOver:c,onDrop:d,onTouchStart:u,onTouchMove:g,onTouchEnd:h,onTouchCancel:m,children:[s.jsxs("div",{className:"flex items-center justify-between gap-1",children:[s.jsx(ar,{dragHandleProps:l,onTouchStart:u,onTouchMove:g,onTouchEnd:h,isDragging:x}),s.jsxs("div",{className:"flex gap-2 flex-wrap flex-1",children:[s.jsxs("div",{className:"sm:flex-1 relative w-full sm:w-auto",children:[s.jsx(fr,{buttonRef:k,displayValue:j.find(t=>t.value===e.column)?.label,isOpen:b,onClick:()=>v(!b),className:"w-full pl-3 pr-1 py-2 gap-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 flex items-center justify-between","aria-label":y("aria.filterTargetColumn")}),s.jsx(xr,{isOpen:b,triggerRef:k,options:j,value:e.column,onChange:t=>{r({...e,column:t}),v(!1)},onClose:()=>v(!1),"aria-label":y("aria.filterTargetColumn")})]}),s.jsxs("div",{className:"relative",children:[s.jsx(fr,{buttonRef:C,displayValue:y(`filterOperatorSymbol.${e.operator}`),isOpen:w,onClick:()=>S(!w),className:"w-full pl-3 pr-1 py-2 gap-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 flex items-center justify-between","aria-label":y("aria.filterOperator")}),s.jsx(xr,{isOpen:w,triggerRef:C,options:D,value:e.operator,onChange:t=>{r({...e,operator:t}),S(!1)},onClose:()=>S(!1),"aria-label":y("aria.filterOperator")})]}),s.jsx("input",{type:"number",value:e.value,onChange:t=>r({...e,value:parseFloat(t.target.value)||0}),className:"flex-1 sm:flex-initial w-24 px-3 py-2 text-sm border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 "+(o?"border-red-500":"border-gray-300 dark:border-gray-600"),"aria-label":y("aria.filterValue")})]}),s.jsxs("div",{className:"flex gap-0 flex-wrap",children:[s.jsx("button",{onClick:i,className:"p-2 text-accent-light-500 dark:text-accent-dark-400 hover:bg-accent-light-50 dark:hover:bg-accent-dark-900/20 rounded transition-colors","aria-label":y("aria.addFilterCondition"),title:"この項目の下に条件を追加",children:s.jsx(ct,{name:"plus-circle",className:"w-5 h-5"})}),s.jsx("button",{onClick:n,className:"px-3 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors","aria-label":y("aria.removeFilterCondition"),children:"✕"})]})]}),o&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:o})]})},Jn=({isOpen:e,onClose:t,filterSet:r,diceCount:n,diceSets:i=[],currentDiceSetIds:o,onSave:l,mode:c})=>{const{t:d}=$e(),[u,g]=a.useState(r.name),[h,m]=a.useState(r.rememberSelectedDiceSet??!1),[p,x]=a.useState(r.rememberSelectedDiceSet&&r.selectedDiceSetIds?r.selectedDiceSetIds:[]),[f,y]=a.useState([]),[b,v]=a.useState("and"),[w,S]=a.useState(!1),k=a.useRef(null),C=Wr({items:f,onReorder:y,enabled:f.length>1}),[j,D]=a.useState([]),[N,A]=a.useState(r.showOnlyHighlighted||!1),[T,M]=a.useState([]),[E,R]=a.useState({}),I=Wr({items:j,onReorder:D,enabled:j.length>1});a.useEffect(()=>{if(r.filterExpression)if("condition"===r.filterExpression.type)y([r.filterExpression.condition]),v("and");else if("and"===r.filterExpression.type||"or"===r.filterExpression.type){v(r.filterExpression.type);const e=(r.filterExpression.expressions||[]).filter(e=>"condition"===e.type).map(e=>e.condition);y(e)}if(r.highlightConditions&&r.highlightConditions.length>0){const e=r.highlightConditions.map(e=>{const t=Cr(e),r=e.color||"accent";let a="";return"single"===e.type?a=String(e.value):"range"===e.type?a=`${e.min}-${e.max}`:"modulo"===e.type?a=0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"max"===e.type?a="max":"min"===e.type&&(a="min"),{targets:t,input:a,color:r,error:void 0}});D(e)}else D([])},[r]),a.useEffect(()=>{e&&M(function(){try{const e=localStorage.getItem(Ut);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}}())},[e]);const L=a.useCallback(()=>{y([...f,{column:"total",operator:"equals",value:0}])},[f]),O=a.useCallback(e=>{const t=[...f];t.splice(e+1,0,{column:"total",operator:"equals",value:0}),y(t)},[f]),F=a.useCallback(e=>{y(f.filter((t,r)=>r!==e)),R(t=>{const r={...t};return delete r[e],r})},[f]),P=a.useCallback((e,t)=>{const r=[...f];r[e]=t,y(r);const a=function(e,t){const r=[];if(e.column.startsWith("dice-")){const a=parseInt(e.column.substring(5),10);(isNaN(a)||a<0||a>=t)&&r.push(`ダイスインデックスが範囲外です（0-${t-1}）`)}return isNaN(e.value)&&r.push("フィルター値は数値である必要があります"),r}(t,n);R(t=>{const r={...t};return a.length>0?r[e]=a.join(", "):delete r[e],r})},[f,n]),$=a.useCallback(()=>{D([...j,{targets:["total"],input:"",color:"accent",error:void 0}])},[j]),W=a.useCallback(e=>{const t=[...j];t.splice(e+1,0,{targets:["total"],input:"",color:"accent",error:void 0}),D(t)},[j]),V=a.useCallback(e=>{D(j.filter((t,r)=>r!==e))},[j]),B=a.useCallback((e,t,r,a)=>{const n=[...j];n[e]={targets:t,input:r,color:a,error:void 0},D(n)},[j]),H=a.useCallback(()=>{if(Object.keys(E).length>0)return;if(0===u.length||u.length>50)return;let e;f.length>0&&(e=1===f.length?{type:"condition",condition:f[0]}:{type:b,expressions:f.map(e=>({type:"condition",condition:e}))});const a=[],n=[];if(j.forEach((e,t)=>{if(!e.input.trim())return;const r=kr(e.input);r.error?n.push({index:t,error:r.error}):r.conditions.forEach(t=>{a.push({...t,targets:e.targets,color:e.color})})}),n.length>0){const e=[...j];return n.forEach(({index:t,error:r})=>{e[t]={...e[t],error:r}}),void D(e)}const i=(new Date).toISOString(),s={...r,name:u,filterExpression:e,highlightConditions:a.length>0?a:void 0,showOnlyHighlighted:N&&a.length>0,rememberSelectedDiceSet:h,selectedDiceSetIds:h?p:void 0,updatedAt:i,..."create"===c&&{createdAt:i}};l(s),t()},[u,f,b,j,N,h,r,c,E,l,t,p]),z=a.useCallback(e=>{const t=e.filterExpression;if("condition"===t.type)y([t.condition]),v("and");else if("and"===t.type||"or"===t.type){v(t.type);const e=t.expressions.filter(e=>"condition"===e.type).map(e=>e.condition);y(e)}},[]),U=r.id===Ze,q=u.length>0&&u.length<=50&&0===Object.keys(E).length,Y=a.useMemo(()=>{const e=h?p:[];return i.filter(t=>e.includes(t.id))},[i,h,p]);return s.jsxs(lr,{isOpen:e,onClose:t,size:"2xl",maxHeight:"80vh",children:[s.jsx(cr,{title:d("tableFilter.editorTitle"),onClose:t}),s.jsx(dr,{scrollable:!0,padding:!0,children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:d("tableFilter.filterSetName")}),s.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),maxLength:50,placeholder:d("tableFilter.filterSetNamePlaceholder"),disabled:U,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":d("aria.filterSetName")}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[u.length," / 50"]})]}),s.jsxs("div",{className:"space-y-4 pt-2 border-t border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"remember-dice-set",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:d("settings:chartSettings.rememberDiceSet.label")}),s.jsx(pr,{checked:h,onChange:e=>{m(e),e&&x(o||[])},label:d("settings:chartSettings.rememberDiceSet.label")})]}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:d("settings:chartSettings.rememberDiceSet.description")})]}),Y.length>0&&s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 border border-gray-200 dark:border-gray-700",children:[s.jsx("p",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 mb-2",children:d("settings:chartSettings.targetDiceSets","Target Dice Sets:")}),s.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(e=>s.jsx("div",{className:"\n                        inline-flex items-center gap-1.5 px-2.5 py-1 \n                        bg-white dark:bg-gray-800\n                        text-gray-700 dark:text-gray-300\n                        rounded-full text-sm border border-gray-200 dark:border-gray-700\n                        shadow-sm\n                    ",children:s.jsxs("span",{className:"font-medium",children:[void 0!==e.numericUid&&s.jsxs("span",{className:"mr-1.5 text-xs text-gray-400 dark:text-gray-500 font-normal",children:["#",e.numericUid]}),ut(e.diceConfig)]})},e.id))})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:d("label.filterCondition")}),s.jsxs("button",{onClick:L,className:"px-2 py-1 text-xs bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 transition-colors","aria-label":d("aria.addFilterCondition"),children:["+ ",d("label.addCondition")]})]}),f.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"space-y-2 mb-3",children:f.map((e,t)=>s.jsx(_n,{index:t,condition:e,diceCount:n,onChange:e=>P(t,e),onRemove:()=>F(t),onAdd:()=>O(t),error:E[t],dragHandleProps:C.getDragHandleProps(t),onDragOver:e=>C.handleDragOver(e,t),onDrop:e=>C.handleDrop(e,t),onTouchStart:e=>C.handleTouchStart(e,t),onTouchMove:e=>C.handleTouchMove(e,t),onTouchEnd:()=>C.handleTouchEnd(t),onTouchCancel:()=>C.handleTouchCancel(t),style:C.getItemStyle(t),isDragging:C.isItemDragging(t),isDropTarget:C.isItemDropTarget(t)},t))}),f.length>1&&s.jsxs("fieldset",{className:"border border-gray-300 dark:border-gray-600 rounded p-3",children:[s.jsx("legend",{className:"px-2 text-sm font-medium text-gray-700 dark:text-gray-300",children:d("label.conditionType")}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"and",checked:"and"===b,onChange:e=>v(e.target.value),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:d("label.andCondition")})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",value:"or",checked:"or"===b,onChange:e=>v(e.target.value),className:"mr-2"}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:d("label.orCondition")})]})]})]})]}),T.length>0&&s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-400 mb-1",children:d("label.fromHistory")}),s.jsx(fr,{buttonRef:k,displayValue:d("label.fromHistory"),isOpen:w,onClick:()=>S(!w),className:"w-full pl-3 pr-1 py-2 gap-2 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 flex items-center justify-between"}),s.jsx(xr,{isOpen:w,triggerRef:k,options:T.map((e,t)=>({value:e.id,label:`履歴 ${t+1} (${new Date(e.usedAt).toLocaleDateString()})`})),value:"",onChange:e=>{const t=T.find(t=>t.id===e);t&&z(t),S(!1)},onClose:()=>S(!1)})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:d("label.highlight")}),s.jsxs("button",{onClick:$,className:"px-2 py-1 text-xs bg-accent-light-500 hover:bg-accent-light-600 dark:bg-accent-dark-500 dark:hover:bg-accent-dark-600 text-white rounded",children:["+ ",d("common:aria.addFilterCondition")]})]}),s.jsx("div",{className:"space-y-2",children:j.map((e,t)=>{const r=[{value:"total",label:d("common:filterColumn.total")},...Array.from({length:n},(e,t)=>({value:`dice-${t}`,label:d("common:filterColumn.dice",{index:t+1})}))];return s.jsx($r,{targets:e.targets,input:e.input,color:e.color,targetOptions:r,onChange:(e,r,a)=>B(t,e,r,a),onRemove:()=>V(t),onAdd:()=>W(t),error:e.error,dragHandleProps:I.getDragHandleProps(t),onDragOver:e=>I.handleDragOver(e,t),onDrop:e=>I.handleDrop(e,t),onTouchStart:e=>I.handleTouchStart(e,t),onTouchMove:e=>I.handleTouchMove(e,t),onTouchEnd:()=>I.handleTouchEnd(t),onTouchCancel:()=>I.handleTouchCancel(t),style:I.getItemStyle(t),isDragging:I.isItemDragging(t),isDropTarget:I.isItemDropTarget(t),showTargetSelector:!0,showMaxMinBadges:!1,t:d},t)})}),s.jsx("p",{className:"mt-2 text-xs text-gray-500 dark:text-gray-400",children:"カンマまたはスペース区切りで複数指定可能（例：2,5,8）。範囲指定はハイフン（例：50-100）。倍数指定も可能（例：2n, 5n+3）。最大値/最小値指定はmax/min"})]}),j.some(e=>e.input.trim())&&s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:d("label.showOnlyHighlighted")}),s.jsx(pr,{checked:N,onChange:A,label:d("label.showOnlyHighlighted"),size:"medium"})]})]})}),s.jsxs(ur,{align:"right",children:[s.jsx("button",{onClick:t,className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:d("button.cancel")}),s.jsx("button",{onClick:H,disabled:!q,className:"px-4 py-2 text-sm bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d("button.save")})]})]})};function Kn(e,t,r){return"condition"===e.type?function(e,t,r){const{column:a,operator:n,value:i}=e;let s;if("trialNumber"===a)s=t.trialNumber;else if("total"===a)s=t.total;else if("modifier"===a)s=r;else{if(!a.startsWith("dice-"))return!1;{const e=parseInt(a.substring(5),10);if(e<0||e>=t.diceValues.length)return!1;s=t.diceValues[e]}}return function(e,t,r){switch(e){case"equals":return t===r;case"notEquals":return t!==r;case"greaterThan":return t>r;case"lessThan":return t<r;case"greaterOrEqual":return t>=r;case"lessOrEqual":return t<=r;default:return!1}}(n,s,i)}(e.condition,t,r):"and"===e.type?0===e.expressions.length||e.expressions.every(e=>Kn(e,t,r)):"or"===e.type&&(0!==e.expressions.length&&e.expressions.some(e=>Kn(e,t,r)))}function Qn(e){if(!e.id||"string"!=typeof e.name)throw new Error("フィルターセットの必須フィールドが不足しています");return{...e,id:crypto.randomUUID(),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}const Gn=({isOpen:e,onClose:t,filterSets:r,currentFilterSetId:n,diceCount:o,onCreateFilterSet:l,onUpdateFilterSet:c,onDeleteFilterSet:d,onReorderFilterSets:u,onSelectFilterSet:g})=>{const{t:h}=$e(["common"]),[m,p]=a.useState(""),[x,f]=a.useState(!1),[y,b]=a.useState([]),[v,w]=a.useState(null),[S,k]=a.useState(!1),C=a.useRef({}),j=a.useRef(null),D=a.useRef(null),[N,A]=a.useState({isOpen:!1,mode:"create"});r.forEach(e=>{C.current[e.id]||(C.current[e.id]=i.createRef())}),a.useEffect(()=>{const e=e=>{j.current&&!j.current.contains(e.target)&&k(!1)};if(S)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[S]);const T=a.useCallback(e=>{b(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),M=a.useCallback(e=>{const t=e.map((e,t)=>({...e,sortOrder:t}));u(t)},[u]),E=a.useCallback(()=>{const e=Bt(h("tableFilter.newFilterSet"));A({isOpen:!0,mode:"create",filterSet:e})},[h]),R=a.useCallback(e=>{const t=r.find(t=>t.id===e);t&&A({isOpen:!0,mode:"edit",filterSet:t}),w(null)},[r]),I=a.useCallback(async e=>{const t=r.find(t=>t.id===e);if(!t)return;const a=(new Date).toISOString(),n={...t,id:crypto.randomUUID(),name:`${t.name}${h("tableFilter.copySuffix")}`,createdAt:a,updatedAt:a,sortOrder:void 0};f(!0),p("");try{await l(n)}catch(i){p(i instanceof Error?i.message:h("tableFilter.importError",{error:h("error.unknown","不明なエラー")}))}finally{f(!1)}w(null)},[r,l,h]),L=a.useCallback(async e=>{if(e===Ze)return void p(h("error.deleteDefault","デフォルト設定は削除できません"));const t=r.find(t=>t.id===e);if(t&&confirm(h("tableFilter.confirmDelete",{name:t.name}))){f(!0),p("");try{await d(e)}catch(a){p(a instanceof Error?a.message:h("error.deleteFailed","削除に失敗しました"))}finally{f(!1)}w(null)}},[r,d,h]),O=a.useCallback(e=>{const t=r.find(t=>t.id===e);if(!t)return;const a=function(e){const t={version:"1.0",exportedAt:(new Date).toISOString(),filterSet:e};return JSON.stringify(t,null,2)}(t),n=new Blob([a],{type:"application/json"}),i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=function(e){const t=(new Date).toISOString().replace(/[:.]/g,"-").substring(0,19);return`filterset-${e.replace(/[^a-zA-Z0-9-_]/g,"_").substring(0,30)}-${t}.json`}(t.name),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),w(null)},[r]),F=a.useCallback(()=>{D.current?.click()},[]),P=a.useCallback(()=>{const e=y.length>0?r.filter(e=>y.includes(e.id)):r;if(0===e.length)return;const t=function(e){const t={version:"1.0",exportedAt:(new Date).toISOString(),filterSets:e};return JSON.stringify(t,null,2)}(e),a=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n;const s=y.length>0?"table-filter-sets-selected":"table-filter-sets-all",o=(new Date).toISOString().split("T")[0];i.download=`${s}_${o}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n),k(!1)},[r,y]),$=a.useCallback(async e=>{const t=e.target.files?.[0];if(t){f(!0),p("");try{const e=function(e){try{const t=JSON.parse(e);if(t.version&&t.exportedAt&&t.filterSet)return[Qn(t.filterSet)];if(t.version&&t.exportedAt&&Array.isArray(t.filterSets))return t.filterSets.map(e=>Qn(e));throw new Error("無効なフィルターセット形式です")}catch(m){if(m instanceof Error)throw new Error(`インポート失敗: ${m.message}`);throw new Error("インポート失敗: 不明なエラー")}}(await t.text());for(const t of e)await l(t);p("")}catch(r){p(h("tableFilter.importError",{error:r instanceof Error?r.message:h("tableFilter.invalidFileFormat")}))}finally{f(!1),D.current&&(D.current.value="")}}},[l,h]),W=a.useCallback(async()=>{if(0!==y.length){f(!0),p("");try{for(const e of y){const t=r.find(t=>t.id===e);if(!t)continue;const a=(new Date).toISOString(),n={...t,id:crypto.randomUUID(),name:`${t.name}${h("tableFilter.copySuffix")}`,createdAt:a,updatedAt:a,sortOrder:void 0};await l(n)}b([])}catch(e){p(e instanceof Error?e.message:h("error.bulkDuplicateFailed","一括複製に失敗しました"))}finally{f(!1)}k(!1)}else p(h("error.noDuplicateSelection","複製する項目が選択されていません"))},[y,r,l,h]),V=a.useCallback(async()=>{const e=y.filter(e=>e!==Ze);if(0!==e.length){if(confirm(h("tableFilter.confirmDeleteMultiple",{count:e.length}))){f(!0),p("");try{for(const t of e)await d(t);b([])}catch(t){p(t instanceof Error?t.message:h("error.bulkDeleteFailed","一括削除に失敗しました"))}finally{f(!1)}k(!1)}}else p(h("error.noSelection","削除可能な項目が選択されていません"))},[y,d,h]),B=a.useCallback(async()=>{const e=r.filter(e=>e.id!==Ze);if(0!==e.length&&confirm(h("tableFilter.confirmDeleteAll","デフォルト以外のすべてのフィルターセットを削除してもよろしいですか？"))){f(!0),p("");try{for(const t of e)await d(t.id);b([])}catch(t){p(t instanceof Error?t.message:h("error.deleteAllFailed","全削除に失敗しました"))}finally{f(!1)}k(!1)}},[r,d,h]),H=a.useCallback(async e=>{f(!0),p("");try{"create"===N.mode?await l(e):await c(e),A({isOpen:!1,mode:"create"})}catch(t){p(t instanceof Error?t.message:h("error.saveFailed","保存に失敗しました"))}finally{f(!1)}},[N.mode,l,c,h]),z=a.useCallback(e=>{const t=e.id===Ze,r=[];return e.id===n||r.push({id:"select",label:h("actions.select","選択"),onClick:()=>{g(e.id),w(null)}}),r.push({id:"edit",label:h("menu.edit"),customIcon:s.jsx(ct,{name:"edit",className:"w-4 h-4"}),onClick:()=>R(e.id),disabled:t}),r.push({id:"duplicate",label:h("menu.duplicate"),customIcon:s.jsx(ct,{name:"copy",className:"w-4 h-4"}),onClick:()=>I(e.id)}),t||r.push({id:"export",label:h("button.export"),customIcon:s.jsx(ct,{name:"export",className:"w-4 h-4"}),onClick:()=>O(e.id)}),r.push({id:"delete",label:h("menu.delete"),customIcon:s.jsx(ct,{name:"trash",className:"w-4 h-4"}),onClick:()=>L(e.id),disabled:t,danger:!0,separator:!0}),r},[n,h,g,R,I,O,L]);return s.jsxs(s.Fragment,{children:[s.jsxs(lr,{isOpen:e,onClose:t,size:"2xl",maxHeight:"80vh",children:[s.jsx(cr,{title:h("tableFilter.managerTitle"),onClose:t,actions:y.length>0?s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs px-2 py-1 rounded-full",children:h("selection.selected",{count:y.length})}):null}),s.jsx("div",{className:"px-6 py-2 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsxs("button",{onClick:E,disabled:x,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",children:["+ ",h("tableFilter.createNew")]}),s.jsxs("div",{className:"relative",ref:j,children:[s.jsx("button",{onClick:()=>k(!S),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:h("tableFilter.moreOptions"),children:s.jsx(ct,{name:"dots-vertical",className:"w-5 h-5"})}),S&&s.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[s.jsxs("button",{onClick:F,disabled:x,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"import",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:h("button.import")})]}),s.jsxs("button",{onClick:P,disabled:x||0===r.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"export",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:y.length>0?h("actions.exportSelected"):h("button.export")})]}),s.jsxs("button",{onClick:()=>b([]),disabled:0===y.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white border-t border-gray-200 dark:border-gray-600 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"close",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:h("selection.deselect")})]}),s.jsxs("button",{onClick:W,disabled:0===y.length||x,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"copy",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:h("actions.duplicateSelected")})]}),s.jsxs("button",{onClick:V,disabled:0===y.length||x,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"trash",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:h("actions.deleteSelected")})]}),s.jsxs("button",{onClick:B,disabled:0===r.filter(e=>e.id!==Ze).length||x,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"trash",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:h("tableFilter.deleteAll","すべて削除")})]})]})]})]})}),s.jsxs(dr,{scrollable:!0,padding:!1,className:"p-4",children:[m&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:m})}),s.jsx("div",{children:s.jsx(rr,{items:r,selectedIds:y,onToggleItem:T,onSelectionChange:b,enableDragAndDrop:!0,onReorder:M,renderItem:(e,t,r,a,i)=>{const o=e.id===Ze,l=e.id===n;return s.jsxs(nr,{isSelected:t,onToggle:i?.onClick||(()=>T(e.id)),showCheckbox:!1,showDragHandle:!o,dragHandleProps:a,clickable:!0,actions:s.jsxs(s.Fragment,{children:[s.jsx(hr,{buttonRef:C.current[e.id],onClick:t=>{t.stopPropagation(),w(v===e.id?null:e.id)}}),s.jsx(gr,{isOpen:v===e.id,buttonRef:C.current[e.id],items:z(e),onClose:()=>w(null)})]}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),o&&s.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["(",h("tableFilter.defaultFilterSet"),")"]}),l&&s.jsx("span",{className:"px-2 py-0.5 text-xs bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded",children:h("tableFilter.currentFilterSet")})]}),s.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 flex gap-2",children:[e.filterExpression&&s.jsx("span",{children:h("tableFilter.filterConditionPresent","フィルター条件あり")}),e.highlightConditions&&e.highlightConditions.length>0&&s.jsxs("span",{children:[e.filterExpression?"• ":"",h("tableFilter.highlightPresent","ハイライトあり")]})]})]})}})})]})]}),s.jsx("input",{ref:D,type:"file",accept:".json",onChange:$,className:"hidden"}),N.isOpen&&N.filterSet&&s.jsx(Jn,{isOpen:N.isOpen,onClose:()=>A({isOpen:!1,mode:"create"}),filterSet:N.filterSet,diceCount:o,onSave:H,mode:N.mode})]})},Zn=i.memo(({diceSet:e,isSelected:t,selectedDiceSetIds:r,onToggle:n,showDragHandle:o=!1,dragHandleProps:l,showCheckbox:c=!1,diceSetsLength:d,onSetEditingDiceSetId:u,onDuplicateDiceSet:g,onDeleteDiceSet:h,openMenuId:m,onOpenMenu:p,menuButtonRef:x,onDragStart:f,simpleMode:y=!1})=>{const[b,v]=a.useState(!1),w=((e,t,r,a,n)=>{const{t:i}=$e();return[{id:"dice-config",label:i("common:menu.edit"),icon:"edit",onClick:()=>r(e.id)},{id:"duplicate",label:i("common:menu.duplicate"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),onClick:()=>a(e.id),disabled:t>=We,title:t>=We?i("diceSets:limit.reached",{max:We}):""},{id:"delete",label:i("common:menu.delete"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:()=>{window.confirm(i("diceSets:confirm.delete"))&&n(e.id)},danger:!0,separator:!0}]})(e,d,u,g,h),S=i.useMemo(()=>{if(o&&l)return{...l,onDragStart:a=>{if(l.onDragStart?.(a),f)f(a,e);else{let n=[e.id];t&&r&&r.length>0&&(n=Array.from(new Set([...r,e.id]))),a.dataTransfer.setData("application/json",JSON.stringify({type:"diceSet",id:e.id,ids:n})),a.dataTransfer.effectAllowed&&"none"!==a.dataTransfer.effectAllowed||(a.dataTransfer.effectAllowed="copy")}}}},[o,l,f,e,t,r]);return s.jsxs(nr,{isSelected:t,onToggle:n,showDragHandle:o,dragHandleProps:S,showCheckbox:c,draggable:!o,onDragStart:o?void 0:a=>{if(f)f(a,e);else{let n=[e.id];t&&r&&r.length>0&&(n=Array.from(new Set([...r,e.id]))),a.dataTransfer.setData("application/json",JSON.stringify({type:"diceSet",id:e.id,ids:n})),a.dataTransfer.effectAllowed="copy"}},className:y?"py-0":"",actions:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:t=>{t.stopPropagation(),u(e.id)},className:`\n              ${t?"text-accent-light-800/75 dark:text-accent-dark-400 hover:bg-accent-light-500/20 dark:hover:bg-accent-dark-700/50":"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"}\n              p-2 rounded transition-colors\n              `,title:"編集","aria-label":"編集",children:s.jsx(ct,{name:"edit",className:"w-4 h-4"})}),s.jsx(hr,{buttonRef:x,isSelected:t,onClick:t=>{t.stopPropagation(),p(m===e.id?null:e.id)}}),s.jsx(gr,{isOpen:m===e.id,buttonRef:x,items:w,onClose:()=>p(null)})]}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-100 truncate",children:ut(e.diceConfig)}),s.jsx("button",{onClick:async t=>{t.stopPropagation();const r=ut(e.diceConfig);await Ga(r),v(!0),setTimeout(()=>v(!1),2e3)},className:`\n            ${t?"text-accent-light-800/75 dark:text-accent-dark-400 hover:bg-accent-light-500/20 dark:hover:bg-accent-dark-700/50":"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"}\n            flex-shrink-0 p-1 rounded transition-colors\n            `,title:b?"コピーしました":"ダイス記法をコピー","aria-label":"ダイス記法をコピー",children:b?s.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx(ct,{name:"clipboard",className:"w-4 h-4"})})]}),!y&&s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:xt(e)})]})});Zn.displayName="DiceSetListItem";const ei=i.memo(({diceSets:e,compareDiceSetIds:t,onCreateDiceSet:r,onToggleCompareDiceSet:a,onExportDiceSets:n,onImportDiceSets:o,onBulkDuplicateDiceSets:l,onBulkDeleteDiceSets:c,onDeleteAllDiceSets:d,simpleMode:u,onToggleSimpleMode:g})=>{const{t:h}=$e(["diceSets","common"]),[m,p]=i.useState(!1),x=i.useRef(null),f=i.useRef(null);i.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&p(!1)};if(m)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[m]);const y=e=>{e(),p(!1)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between gap-2 my-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:r,disabled:e.length>=We,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",title:e.length>=We?h("diceSets:limit.reached",{max:We}):h("diceSets:tooltip.create"),children:["+ ",h("diceSets:action.createShort")]}),s.jsx("button",{onClick:g,className:"w-10 h-10 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded transition-colors inline-flex items-center justify-center ml-1",title:u?"詳細表示に切り替え":"簡易表示に切り替え","aria-label":u?"詳細表示に切り替え":"簡易表示に切り替え",children:s.jsx(ct,{name:u?"view-list-detailed":"view-list-compact",className:"w-5 h-5"})})]}),s.jsxs("div",{className:"relative",ref:f,children:[s.jsx("button",{onClick:()=>p(!m),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:h("charts:menu.options"),children:s.jsx(ct,{name:"dots-vertical",className:"w-5 h-5"})}),m&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[s.jsxs("label",{htmlFor:"dice-set-file-import",className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 cursor-pointer",children:[s.jsx(ct,{name:"import",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.import")})]}),s.jsxs("button",{onClick:()=>y(()=>n(t.length>0?t:void 0)),disabled:0===e.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"export",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:t.length>0?h("common:actions.exportSelected","選択項目をエクスポート"):h("diceSets:action.export")})]}),s.jsxs("button",{onClick:()=>{t.forEach(e=>a(e))},disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:h("diceSets:action.clearSelection"),children:[s.jsx(ct,{name:"close",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.clearSelection")})]}),s.jsxs("button",{onClick:()=>y(()=>l(t)),disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"copy",className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.bulkDuplicateShort")})]}),s.jsxs("button",{onClick:()=>y(()=>c(t)),disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"trash",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.bulkDeleteShort")})]}),s.jsxs("button",{onClick:()=>{0!==e.length&&window.confirm(h("diceSets:confirm.deleteAll"))&&(d(),p(!1))},disabled:0===e.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(ct,{name:"trash",className:"w-5 h-5"}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.deleteAllShort")})]})]})]})]}),s.jsx("input",{id:"dice-set-file-import",ref:x,type:"file",accept:".json,application/json",onChange:e=>{const t=e.target.files?.[0];t&&(o(t),x.current&&(x.current.value="")),p(!1)},className:"hidden"})]})});ei.displayName="DiceSetListActionBar";const ti=i.lazy(()=>D(()=>import("./index-E9JDBaEh.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.SettingsModal}))),ri=i.memo(({diceSets:e,compareDiceSetIds:t,onToggleCompareDiceSet:r,onCreateDiceSet:a,onDuplicateDiceSet:n,onDeleteDiceSet:o,onDeleteAllDiceSets:l,onBulkDeleteDiceSets:c,onBulkDuplicateDiceSets:d,onReorderDiceSets:u,onExportDiceSets:g,onImportDiceSets:h,onUpdateDiceSet:m,onSetCompareDiceSetIds:p,darkMode:x,onToggleDarkMode:f,onAboutClick:y,onChangelogClick:b,themeMode:v,onChangeThemeMode:w,transparentExport:S,onChangeTransparentExport:k,diceSetsCount:C,chartSettingsCount:j,onItemDragStateChange:D,chartHeightSettings:N,onChangeChartHeightSettings:A})=>{const{t:T}=$e(["diceSets","common"]),[M,E]=i.useState(null),[R,I]=i.useState(Jt()),[L,O]=i.useState(null),[F,P]=i.useState(!1),[$,W]=i.useState(null),[V,B]=i.useState(!1),H=T("common:siteName"),z=i.useCallback(()=>{const e=!R;I(e),Kt(e)},[R]),U=i.useRef({});i.useEffect(()=>{e.forEach(e=>{U.current[e.id]||(U.current[e.id]=i.createRef())})},[e]);const q=i.useCallback((e,t)=>{const r=document.createElement("div");r.style.position="absolute",r.style.top="-9999px",r.style.left="-9999px",r.style.width="240px",r.style.backgroundColor=document.documentElement.classList.contains("dark")?"rgb(76 29 149 / 0.5)":"rgb(239 246 255 / 1)",r.style.opacity="1",r.style.border=document.documentElement.classList.contains("dark")?"2px solid rgb(139 92 246 / 1)":"2px solid rgb(59 130 246 / 1)",r.style.borderRadius="8px",r.style.padding="8px",r.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",r.style.zIndex="10000",r.style.display="flex",r.style.flexDirection="column",r.style.gap="4px";if(t.slice(0,5).forEach(e=>{const t=document.createElement("div");t.style.fontSize="12px",t.style.fontWeight="500",t.style.color=document.documentElement.classList.contains("dark")?"#e5e7eb":"#374151",t.style.padding="4px 8px",t.style.backgroundColor=document.documentElement.classList.contains("dark")?"rgb(76 29 149 / 0.5)":"rgb(219 234 254 / 1)",t.style.borderRadius="4px",t.style.whiteSpace="nowrap",t.style.overflow="hidden",t.style.textOverflow="ellipsis",t.textContent=ut(e.diceConfig),r.appendChild(t)}),t.length>5){const e=document.createElement("div");e.style.fontSize="11px",e.style.textAlign="center",e.style.color="#6b7280",e.style.marginTop="2px",e.textContent=`+ ${t.length-5} more`,r.appendChild(e)}if(t.length>1){const e=document.createElement("div");e.style.position="absolute",e.style.top="-8px",e.style.right="-8px",e.style.backgroundColor="#ec4899",e.style.color="white",e.style.fontSize="12px",e.style.fontWeight="bold",e.style.height="20px",e.style.minWidth="20px",e.style.borderRadius="10px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.padding="0 6px",e.style.boxShadow="0 1px 3px rgba(0,0,0,0.3)",e.textContent=t.length.toString(),r.appendChild(e)}document.body.appendChild(r),e.dataTransfer.setDragImage(r,0,0),requestAnimationFrame(()=>{setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},100)})},[]),Y=i.useCallback((r,a)=>{let n=[a.id],i=[a];t.includes(a.id)&&t.length>1&&(n=t,i=e.filter(e=>t.includes(e.id))),r.dataTransfer.setData("application/json",JSON.stringify({type:"diceSet",id:a.id,ids:n})),r.dataTransfer.effectAllowed="copyMove",i.length>0&&q(r,i)},[t,e,q]);return s.jsxs("div",{className:"bg-white dark:bg-gray-800 border-r-gray-300 dark:border-r-gray-600 border-r pt-4 h-full flex flex-col transition-colors",children:[s.jsxs("div",{className:"flex items-center justify-between px-4 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center flex-1 gap-1 min-w-0 text-gray-900 dark:text-gray-100",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(ct,{name:"site-logo",className:"w-6 h-6",strokeWidth:1})}),s.jsx("h1",{className:"text-sm font-bold truncate",children:H})]}),t.length>0&&s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:T("diceSets:list.selected",{count:t.length})})]}),s.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[Ea(e.length),"/",Ea(We)]})]}),s.jsx("div",{className:"px-4 border-b border-b-gray-200 dark:border-b-gray-700",children:s.jsx(ei,{diceSets:e,compareDiceSetIds:t,onCreateDiceSet:()=>{const e={id:"",name:T("dice:config.name.placeholder"),diceConfig:{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:1,results:[],targetValue:1,createdAt:String(Date.now()),updatedAt:String(Date.now())};W(e),P(!0)},onToggleCompareDiceSet:r,onExportDiceSets:g,onImportDiceSets:h,onBulkDuplicateDiceSets:d,onBulkDeleteDiceSets:c,onDeleteAllDiceSets:l,simpleMode:R,onToggleSimpleMode:z})}),s.jsx(rr,{className:"pt-4 px-4 overflow-y-auto select-none flex-1",items:e,selectedIds:t,onToggleItem:r,onSelectionChange:p,emptyMessage:T("diceSets:empty"),showSelectionCount:!1,enableDragAndDrop:!0,onItemDragStateChange:D,disableDragPreview:!0,onReorder:u,renderItem:(a,i,l,c,d)=>s.jsx(Zn,{diceSet:a,isSelected:i,selectedDiceSetIds:t,onToggle:e=>{d?.onClick?d.onClick(e):r(a.id)},showDragHandle:!0,dragHandleProps:c,showCheckbox:!1,diceSetsLength:e.length,onSetEditingDiceSetId:O,onDuplicateDiceSet:n,onDeleteDiceSet:o,openMenuId:M,onOpenMenu:E,simpleMode:R,menuButtonRef:U.current[a.id],onDragStart:Y})}),s.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 grid grid-cols-3 gap-2 flex-shrink-0 bg-gray-50 dark:bg-gray-800",children:[s.jsx("a",{href:"/dice/help/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300",title:T("common:label.help"),children:s.jsx(ct,{name:"help",className:"w-5 h-5"})}),s.jsx("button",{onClick:f,className:"flex items-center justify-center p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300",title:T("common:label.toggleTheme"),children:s.jsx(ct,{name:x?"moon":"sun",className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>B(!0),className:"flex items-center justify-center p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300",title:T("common:label.settings"),children:s.jsx(ct,{name:"settings",className:"w-5 h-5"})})]}),V&&s.jsx(i.Suspense,{fallback:null,children:s.jsx(ti,{isOpen:V,onClose:()=>B(!1),darkMode:v||"system",onChangeDarkMode:w||(()=>{}),transparentExport:S||!1,onChangeTransparentExport:k||(()=>{}),onExportData:g||(()=>{}),onImportData:h,diceSetsCount:C||0,chartSettingsCount:j||0,onAboutClick:y,onChangelogClick:b,chartHeightSettings:N,onChangeChartHeightSettings:A})}),L&&s.jsx(Un,{diceSet:e.find(e=>e.id===L),onClose:()=>O(null),onSave:m}),F&&$&&s.jsx(Un,{diceSet:$,onClose:()=>{P(!1),W(null)},onSave:(e,t)=>{P(!1),W(null),a(t)},isCreateMode:!0})]})});function ai(e,t,r){let a,n=r.initialDeps??[],i=!0;function s(){var s,o,l;let c;r.key&&(null==(s=r.debug)?void 0:s.call(r))&&(c=Date.now());const d=e();if(!(d.length!==n.length||d.some((e,t)=>n[t]!==e)))return a;let u;if(n=d,r.key&&(null==(o=r.debug)?void 0:o.call(r))&&(u=Date.now()),a=t(...d),r.key&&(null==(l=r.debug)?void 0:l.call(r))){Math.round(100*(Date.now()-c)),Math.round(100*(Date.now()-u))}return!(null==r?void 0:r.onChange)||i&&r.skipInitialOnChange||r.onChange(a),i=!1,a}return s.updateDeps=e=>{n=e},s}function ni(e,t){if(void 0===e)throw new Error("Unexpected undefined");return e}ri.displayName="DiceSetList";const ii=(e,t,r)=>{let a;return function(...n){e.clearTimeout(a),a=e.setTimeout(()=>t.apply(this,n),r)}},si=e=>{const{offsetWidth:t,offsetHeight:r}=e;return{width:t,height:r}},oi=e=>e,li=e=>{const t=Math.max(e.startIndex-e.overscan,0),r=Math.min(e.endIndex+e.overscan,e.count-1),a=[];for(let n=t;n<=r;n++)a.push(n);return a},ci=(e,t)=>{const r=e.scrollElement;if(!r)return;const a=e.targetWindow;if(!a)return;const n=e=>{const{width:r,height:a}=e;t({width:Math.round(r),height:Math.round(a)})};if(n(si(r)),!a.ResizeObserver)return()=>{};const i=new a.ResizeObserver(t=>{const a=()=>{const e=t[0];if(null==e?void 0:e.borderBoxSize){const t=e.borderBoxSize[0];if(t)return void n({width:t.inlineSize,height:t.blockSize})}n(si(r))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(a):a()});return i.observe(r,{box:"border-box"}),()=>{i.unobserve(r)}},di={passive:!0},ui="undefined"==typeof window||"onscrollend"in window,gi=(e,t)=>{const r=e.scrollElement;if(!r)return;const a=e.targetWindow;if(!a)return;let n=0;const i=e.options.useScrollendEvent&&ui?()=>{}:ii(a,()=>{t(n,!1)},e.options.isScrollingResetDelay),s=a=>()=>{const{horizontal:s,isRtl:o}=e.options;n=s?r.scrollLeft*(o?-1:1):r.scrollTop,i(),t(n,a)},o=s(!0),l=s(!1);r.addEventListener("scroll",o,di);const c=e.options.useScrollendEvent&&ui;return c&&r.addEventListener("scrollend",l,di),()=>{r.removeEventListener("scroll",o),c&&r.removeEventListener("scrollend",l)}},hi=(e,t,r)=>{if(null==t?void 0:t.borderBoxSize){const e=t.borderBoxSize[0];if(e){return Math.round(e[r.options.horizontal?"inlineSize":"blockSize"])}}return e[r.options.horizontal?"offsetWidth":"offsetHeight"]},mi=(e,{adjustments:t=0,behavior:r},a)=>{var n,i;const s=e+t;null==(i=null==(n=a.scrollElement)?void 0:n.scrollTo)||i.call(n,{[a.options.horizontal?"left":"top"]:s,behavior:r})};class pi{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var r;null==(r=t())||r.disconnect(),e=null},observe:e=>{var r;return null==(r=t())?void 0:r.observe(e,{box:"border-box"})},unobserve:e=>{var r;return null==(r=t())?void 0:r.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,r])=>{void 0===r&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:oi,rangeExtractor:li,onChange:()=>{},measureElement:hi,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,r;null==(r=(t=this.options).onChange)||r.call(t,this,e)},this.maybeNotify=ai(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{const r=new Map,a=new Map;for(let n=t-1;n>=0;n--){const t=e[n];if(r.has(t.lane))continue;const i=a.get(t.lane);if(null==i||t.end>i.end?a.set(t.lane,t):t.end<i.end&&r.set(t.lane,!0),r.size===this.options.lanes)break}return a.size===this.options.lanes?Array.from(a.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=ai(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,t,r,a,n,i)=>(void 0!==this.prevLanes&&this.prevLanes!==i&&(this.lanesChangedFlag=!0),this.prevLanes=i,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:r,getItemKey:a,enabled:n,lanes:i}),{key:!1}),this.getMeasurements=ai(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:r,getItemKey:a,enabled:n,lanes:i},s)=>{if(!n)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(const d of this.laneAssignments.keys())d>=e&&this.laneAssignments.delete(d);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0!==this.measurementsCache.length||this.lanesSettling||(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const o=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);const l=this.measurementsCache.slice(0,o),c=new Array(i).fill(void 0);for(let d=0;d<o;d++){const e=l[d];e&&(c[e.lane]=d)}for(let d=o;d<e;d++){const e=a(d),n=this.laneAssignments.get(d);let i,o;if(void 0!==n&&this.options.lanes>1){i=n;const e=c[i],a=void 0!==e?l[e]:void 0;o=a?a.end+this.options.gap:t+r}else{const e=1===this.options.lanes?l[d-1]:this.getFurthestMeasurement(l,d);o=e?e.end+this.options.gap:t+r,i=e?e.lane:d%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(d,i)}const u=s.get(e),g="number"==typeof u?u:this.options.estimateSize(d),h=o+g;l[d]={index:d,start:o,size:g,end:h,key:e,lane:i},c[i]=d}return this.measurementsCache=l,l},{key:!1,debug:()=>this.options.debug}),this.calculateRange=ai(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,r,a)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:r,lanes:a}){const n=e.length-1,i=t=>e[t].start;if(e.length<=a)return{startIndex:0,endIndex:n};let s=xi(0,n,i,r),o=s;if(1===a)for(;o<n&&e[o].end<r+t;)o++;else if(a>1){const i=Array(a).fill(0);for(;o<n&&i.some(e=>e<r+t);){const t=e[o];i[t.lane]=t.end,o++}const l=Array(a).fill(r+t);for(;s>=0&&l.some(e=>e>=r);){const t=e[s];l[t.lane]=t.start,s--}s=Math.max(0,s-s%a),o=Math.min(n,o+(a-1-o%a))}return{startIndex:s,endIndex:o}}({measurements:e,outerSize:t,scrollOffset:r,lanes:a}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=ai(()=>{let e=null,t=null;const r=this.calculateRange();return r&&(e=r.startIndex,t=r.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,r,a,n)=>null===a||null===n?[]:e({startIndex:a,endIndex:n,overscan:t,count:r}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const t=this.options.indexAttribute,r=e.getAttribute(t);return r?parseInt(r,10):-1},this._measureElement=(e,t)=>{const r=this.indexFromElement(e),a=this.measurementsCache[r];if(!a)return;const n=a.key,i=this.elementsCache.get(n);i!==e&&(i&&this.observer.unobserve(i),this.observer.observe(e),this.elementsCache.set(n,e)),e.isConnected&&this.resizeItem(r,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{const r=this.measurementsCache[e];if(!r)return;const a=t-(this.itemSizeCache.get(r.key)??r.size);0!==a&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(r,a,this):r.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=a,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(r.index),this.itemSizeCache=new Map(this.itemSizeCache.set(r.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=ai(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{const r=[];for(let a=0,n=e.length;a<n;a++){const n=t[e[a]];r.push(n)}return r},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const t=this.getMeasurements();if(0!==t.length)return ni(t[xi(0,t.length-1,e=>ni(t[e]).start,e)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{const e=this.scrollElement.document.documentElement;return this.options.horizontal?e.scrollWidth-this.scrollElement.innerWidth:e.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(e,t,r=0)=>{if(!this.scrollElement)return 0;const a=this.getSize(),n=this.getScrollOffset();"auto"===t&&(t=e>=n+a?"end":"start"),"center"===t?e+=(r-a)/2:"end"===t&&(e-=a);const i=this.getMaxScrollOffset();return Math.max(Math.min(i,e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const r=this.measurementsCache[e];if(!r)return;const a=this.getSize(),n=this.getScrollOffset();if("auto"===t)if(r.end>=n+a-this.options.scrollPaddingEnd)t="end";else{if(!(r.start<=n+this.options.scrollPaddingStart))return[n,t];t="start"}if("end"===t&&e===this.options.count-1)return[this.getMaxScrollOffset(),t];const i="end"===t?r.end+this.options.scrollPaddingEnd:r.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(i,t,r.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:r}={})=>{"smooth"===r&&this.isDynamicMode(),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:r})},this.scrollToIndex=(e,{align:t="auto",behavior:r}={})=>{"smooth"===r&&this.isDynamicMode(),e=Math.max(0,Math.min(e,this.options.count-1)),this.currentScrollToIndex=e;let a=0;const n=t=>{if(!this.targetWindow)return;const a=this.getOffsetForIndex(e,t);if(!a)return;const[n,s]=a;this._scrollToOffset(n,{adjustments:void 0,behavior:r}),this.targetWindow.requestAnimationFrame(()=>{const t=()=>{if(this.currentScrollToIndex!==e)return;const t=this.getScrollOffset(),r=this.getOffsetForIndex(e,s);var a,n;r&&(a=r[0],n=t,Math.abs(a-n)<1.01||i(s))};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(t):t()})},i=t=>{this.targetWindow&&this.currentScrollToIndex===e&&(a++,a<10&&this.targetWindow.requestAnimationFrame(()=>n(t)))};n(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode(),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;const t=this.getMeasurements();let r;if(0===t.length)r=this.options.paddingStart;else if(1===this.options.lanes)r=(null==(e=t[t.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let a=t.length-1;for(;a>=0&&e.some(e=>null===e);){const r=t[a];null===e[r.lane]&&(e[r.lane]=r.end),a--}r=Math.max(...e.filter(e=>null!==e))}return Math.max(r-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:r})=>{this.options.scrollToFn(e,{behavior:r,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}const xi=(e,t,r,a)=>{for(;e<=t;){const n=(e+t)/2|0,i=r(n);if(i<a)e=n+1;else{if(!(i>a))return n;t=n-1}}return e>0?e-1:0};const fi="undefined"!=typeof document?a.useLayoutEffect:a.useEffect;function yi(e){return function({useFlushSync:e=!0,...t}){const r=a.useReducer(()=>({}),{})[1],n={...t,onChange:(a,n)=>{var i;e&&n?or.flushSync(r):r(),null==(i=t.onChange)||i.call(t,a,n)}},[i]=a.useState(()=>new pi(n));return i.setOptions(n),fi(()=>i._didMount(),[]),fi(()=>i._willUpdate()),i}({observeElementRect:ci,observeElementOffset:gi,scrollToFn:mi,...e})}const bi=80,vi={},wi=i.memo(({diceSet:e,onSortConfigChange:t,onColumnWidthsChange:r,externalFilterSets:n,externalCurrentFilterSetId:o})=>{const{t:l}=$e(["charts","common"]),{results:c}=e,d=a.useRef(null),u=a.useMemo(()=>c.reduce((e,t)=>Math.max(e,t.diceValues.length),0),[c]),{columnWidths:g,handleResizeStart:h}=(({initialWidths:e={},onColumnWidthsChange:t})=>{const[r,n]=a.useState(e),[i,s]=a.useState(!1),o=a.useRef(null),l=a.useRef(r);a.useEffect(()=>{l.current=r},[r]),a.useEffect(()=>{n(e||{})},[e]);const c=a.useCallback((e,t,r)=>{t.preventDefault(),t.stopPropagation();const a=Array.isArray(e)?e:[e],n=r||(Array.isArray(e)?e[0]:e),i={};a.forEach(e=>{i[e]=l.current[e]||bi}),o.current={columnKeys:a,startX:t.pageX,startWidths:i,activeKey:n},s(!0),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},[]);return a.useEffect(()=>{if(!i)return;const e=e=>{if(!o.current)return;const{columnKeys:t,startX:r,startWidths:a,activeKey:i}=o.current,s=e.pageX-r,l=a[i]||bi,c=Math.max(40,l+s);n(e=>{const r={...e};let a=!1;return t.forEach(e=>{r[e]!==c&&(r[e]=c,a=!0)}),a?r:e})},r=()=>{s(!1),o.current=null,document.body.style.cursor="",document.body.style.userSelect="",t&&t(l.current)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",r),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r)}},[i,t]),{columnWidths:r,handleResizeStart:c,isResizing:i}})({initialWidths:e.columnWidths||vi,onColumnWidthsChange:t=>r?.(e.id,t)}),[m,p]=a.useState(e.sortConfig||{column:"trialNumber",direction:"desc"}),[x,f]=a.useState(null),[y,b]=a.useState(null),[v,w]=a.useState(!1);a.useEffect(()=>{f(null),b(null),w(!1)},[e.id]);const S=a.useMemo(()=>{const e=[{key:"trialNumber",label:l("common:filterColumn.trialNumber"),index:0}];for(let t=0;t<u;t++)e.push({key:`dice-${t}`,label:l("common:filterColumn.dice",{index:t+1}),index:e.length});return e.push({key:"modifier",label:l("common:filterColumn.modifier"),index:e.length}),e.push({key:"total",label:l("common:filterColumn.total"),index:e.length}),e},[u,l]),k=a.useMemo(()=>x&&y?{startCol:Math.min(x.col,y.col),endCol:Math.max(x.col,y.col),startRow:Math.min(x.row,y.row),endRow:Math.max(x.row,y.row)}:null,[x,y]),[C,j]=a.useState([]),[D,N]=a.useState(null),A=function(){const e=localStorage.getItem(qt),t=e?parseInt(e,10):25;return[25,50,75,100].includes(t)?t:25}(),[T,M]=a.useState(()=>document.documentElement.classList.contains("dark"));a.useEffect(()=>{const e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"class"===e.attributeName&&M(document.documentElement.classList.contains("dark"))})});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]);const E=void 0!==n,R=E?n:C,I=E?o:D;a.useEffect(()=>{if(E)return;if(C.length>0)return;(async()=>{let e=await $t();if(0===e.length){const t=Vt();await Wt(t),e=[t]}j(e),e.length>0&&!D&&N(e[0].id)})()},[E,C.length,D]);const L=a.useMemo(()=>R.find(e=>e.id===I),[R,I]);a.useEffect(()=>{p(e.sortConfig||{column:"trialNumber",direction:"desc"})},[e.id,e.sortConfig]);const O=a.useMemo(()=>{const e=[...c];return e.sort((e,t)=>{let r,a;if("trialNumber"===m.column)r=e.trialNumber,a=t.trialNumber;else if("total"===m.column)r=e.total,a=t.total;else if("modifier"===m.column){const n=e.diceValues.reduce((e,t)=>e+t,0),i=t.diceValues.reduce((e,t)=>e+t,0);r=e.total-n,a=t.total-i}else{if(!m.column.startsWith("dice-"))return 0;{const n=parseInt(m.column.split("-")[1]);r=e.diceValues[n]??-1/0,a=t.diceValues[n]??-1/0}}return"asc"===m.direction?r-a:a-r}),e},[c,m]),F=a.useMemo(()=>{if(!L||!L.filterExpression)return O;const t=function(e,t,r){if(!t)return e;const a="+"===r.modifierSign?r.modifierValue:"-"===r.modifierSign?-r.modifierValue:0;return e.filter(e=>Kn(t,e,a))}(O,L.filterExpression,e.diceConfig);return L.showOnlyHighlighted&&L.highlightConditions&&L.highlightConditions.length>0?t.filter(e=>{const t=e.diceValues.reduce((e,t)=>e+t,0),r=e.total-t,a=jr(e.total,L.highlightConditions.filter(e=>!e.target||"all"===e.target||"total"===e.target),e.diceValues),n=e.diceValues.some((t,r)=>jr(t,L.highlightConditions.filter(e=>!e.target||"all"===e.target||e.target===`dice-${r}`),e.diceValues)),i=jr(r,L.highlightConditions.filter(e=>"modifier"===e.target),e.diceValues);return a||n||i}):t},[O,L,e.diceConfig]),P=yi({count:Math.max(F.length,A),getScrollElement:()=>d.current,estimateSize:()=>35,overscan:5}),$=e=>{const r=m.column===e,a="asc"===m.direction;return s.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),(e=>{const r={column:e,direction:m.column===e&&"asc"===m.direction?"desc":"asc"};p(r),t&&t(r)})(e)},onMouseDown:e=>e.stopPropagation(),className:"ml-1 px-3 py-1 rounded cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors inline-block align-middle "+(r?"text-gray-800 dark:text-gray-100":"text-gray-400 dark:text-gray-500"),"aria-label":l("common:action.sort"),children:s.jsx(ct,{name:r&&!a?"chevron-down":"chevron-up",className:"w-3 h-3"})})},W=(e,t,r)=>{0===r.button&&(w(!0),r.shiftKey&&x||f({col:e,row:t}),b({col:e,row:t}))},V=(e,t)=>{0===t.button&&0!==F.length&&(w(!0),t.shiftKey&&x?(f({col:x.col,row:0}),b({col:e,row:F.length-1})):(f({col:e,row:0}),b({col:e,row:F.length-1})))},B=(e,t)=>{v&&b({col:e,row:t})},H=e=>{v&&F.length>0&&b({col:e,row:F.length-1})};a.useEffect(()=>{if(!v)return;const e=()=>{w(!1)};return document.addEventListener("mouseup",e),()=>document.removeEventListener("mouseup",e)},[v]),a.useEffect(()=>{const e=async e=>{if((e.ctrlKey||e.metaKey)&&"c"===e.key){if(!k)return;if("INPUT"===document.activeElement?.tagName||"TEXTAREA"===document.activeElement?.tagName)return;e.preventDefault();const r=[];for(let e=k.startRow;e<=k.endRow;e++){const t=F[e];if(!t)continue;const a=[];for(let e=k.startCol;e<=k.endCol;e++){const r=S.find(t=>t.index===e);if(!r)continue;let n="";if("trialNumber"===r.key)n=t.trialNumber.toString();else if("total"===r.key)n=t.total.toString();else if("modifier"===r.key){const e=t.diceValues.reduce((e,t)=>e+t,0);n=(t.total-e).toString()}else if(r.key.startsWith("dice-")){const e=parseInt(r.key.split("-")[1]);n=(t.diceValues[e]??"").toString()}a.push(n)}r.push(a.join("\t"))}const a=r.join("\n");try{await navigator.clipboard.writeText(a)}catch(t){}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[k,F,S]);const z=(e,t)=>{const r=S.find(t=>t.key===e);if(r&&k&&r.index>=k.startCol&&r.index<=k.endCol){const r=S.filter(e=>e.index>=k.startCol&&e.index<=k.endCol).map(e=>e.key);h(r,t,e)}else h(e,t,e)},U=(e,t)=>!!k&&(e>=k.startCol&&e<=k.endCol&&t>=k.startRow&&t<=k.endRow),q=(e,t)=>{if(!k||!U(e,t))return{};const r=`2px solid ${Nr(T,1)}`,a={};return t===k.startRow&&(a.borderTop=r),t===k.endRow&&(a.borderBottom=r),e===k.startCol&&(a.borderLeft=r),e===k.endCol&&(a.borderRight=r),a},Y=e=>!!k&&(e>=k.startCol&&e<=k.endCol),X=a.useMemo(()=>{let e=0;e+=g.trialNumber||bi,e+=g.modifier||bi,e+=g.total||bi;for(let t=0;t<u;t++)e+=g[`dice-${t}`]||bi;return e},[g,u]);return 0===c.length?s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:l("common:label.noData")}):s.jsx("div",{className:"flex flex-col w-full h-full",children:s.jsxs("div",{ref:d,className:"overflow-auto relative flex-1 min-h-0",children:[s.jsxs("div",{className:"sticky top-0 z-20 text-xs flex bg-gray-100 dark:bg-gray-700 border-b border-gray-300 dark:border-gray-600",style:{width:X>0?X:"auto",minWidth:"100%"},children:[s.jsxs("div",{className:"flex-shrink-0 relative border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 select-none overflow-hidden cursor-pointer "+(Y(0)?"bg-accent-light-100 dark:bg-accent-dark-900/50":""),style:{width:g.trialNumber||bi},onMouseDown:e=>V(0,e),onMouseEnter:()=>H(0),children:[l("common:filterColumn.trialNumberShort"),s.jsx("br",{}),$("trialNumber"),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-col-resize hover:bg-accent-light-400 dark:hover:bg-accent-dark-500 opacity-0 hover:opacity-100 transition-opacity z-10",onMouseDown:e=>z("trialNumber",e),onClick:e=>e.stopPropagation()})]}),Array.from({length:u},(e,t)=>s.jsxs("div",{className:"flex-shrink-0 relative border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 select-none overflow-hidden cursor-pointer "+(Y(t+1)?"bg-accent-light-100 dark:bg-accent-dark-900/50":""),style:{width:g[`dice-${t}`]||bi},onMouseDown:e=>V(t+1,e),onMouseEnter:()=>H(t+1),children:[s.jsx(ct,{name:"dice",className:"w-3 h-3 inline mr-1"}),t+1,s.jsx("br",{}),$(`dice-${t}`),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-col-resize hover:bg-accent-light-400 dark:hover:bg-accent-dark-500 opacity-0 hover:opacity-100 transition-opacity z-10",onMouseDown:e=>z(`dice-${t}`,e),onClick:e=>e.stopPropagation()})]},t)),s.jsxs("div",{className:"flex-shrink-0 relative border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 select-none overflow-hidden cursor-pointer "+(Y(u+1)?"bg-accent-light-100 dark:bg-accent-dark-900/50":""),style:{width:g.modifier||bi},onMouseDown:e=>V(u+1,e),onMouseEnter:()=>H(u+1),children:[l("common:filterColumn.modifierShort"),s.jsx("br",{}),$("modifier"),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-col-resize hover:bg-accent-light-400 dark:hover:bg-accent-dark-500 opacity-0 hover:opacity-100 transition-opacity z-10",onMouseDown:e=>z("modifier",e),onClick:e=>e.stopPropagation()})]}),s.jsxs("div",{className:"flex-shrink-0 relative border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-center font-bold text-gray-800 dark:text-gray-100 select-none overflow-hidden cursor-pointer "+(Y(u+2)?"bg-accent-light-100 dark:bg-accent-dark-900/50":""),style:{width:g.total||bi},onMouseDown:e=>V(u+2,e),onMouseEnter:()=>H(u+2),children:[l("common:filterColumn.total"),s.jsx("br",{}),$("total"),s.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-col-resize hover:bg-accent-light-400 dark:hover:bg-accent-dark-500 opacity-0 hover:opacity-100 transition-opacity z-10",onMouseDown:e=>z("total",e),onClick:e=>e.stopPropagation()})]}),s.jsx("div",{className:"flex-grow p-0"})]}),s.jsx("div",{style:{height:`${P.getTotalSize()}px`,width:X>0?X:"100%",position:"relative"},children:P.getVirtualItems().map(e=>{const t=e.index,r=t===Math.max(F.length,A)-1;if(t>=F.length)return s.jsxs("div",{"data-index":e.index,ref:P.measureElement,className:`absolute top-0 left-0 flex w-full border-b ${r?"border-b-0":""} border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50`,style:{transform:`translateY(${e.start}px)`},children:[s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2",style:{width:g.trialNumber||bi},children:" "}),Array.from({length:u},(e,t)=>s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2",style:{width:g[`dice-${t}`]||bi},children:" "},t)),s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2",style:{width:g.modifier||bi},children:" "}),s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2",style:{width:g.total||bi},children:" "}),s.jsx("div",{className:"flex-grow p-0"})]},e.key);const a=F[t],n=a.diceValues.reduce((e,t)=>e+t,0),o=a.total-n,l=0===o?"0":o>0?`+${o}`:o.toString(),c=U(0,t),d=q(0,t),h=Nr(T,.3),m=`linear-gradient(${h}, ${h})`;return s.jsxs("div",{"data-index":e.index,ref:P.measureElement,className:`absolute top-0 left-0 flex w-full border-b ${r?"border-b-0":""} border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50`,style:{transform:`translateY(${e.start}px)`},children:[s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300 select-none cursor-cell",style:{width:g.trialNumber||bi,backgroundImage:c?m:void 0,...d},onMouseDown:e=>W(0,t,e),onMouseEnter:()=>B(0,t),children:Ea(a.trialNumber)}),Array.from({length:u},(e,r)=>{const n=r+1,i=U(n,t),o=q(n,t);if(void 0===a.diceValues[r])return s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300 select-none cursor-cell",style:{width:g[`dice-${r}`]||bi,backgroundImage:i?m:void 0,...o},onMouseDown:e=>W(n,t,e),onMouseEnter:()=>B(n,t),children:"-"},r);const l=L?.highlightConditions?.filter(e=>Cr(e).includes(`dice-${r}`))||[],c=Or(a.diceValues[r],{highlightConditions:l,isDarkMode:T,alphaBackground:.3,allValues:a.diceValues});return s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-right select-none cursor-cell "+(c?"font-bold":"text-gray-700 dark:text-gray-300"),style:{width:g[`dice-${r}`]||bi,...c,backgroundImage:i?m:void 0,...o},onMouseDown:e=>W(n,t,e),onMouseEnter:()=>B(n,t),children:a.diceValues[r]},r)}),(()=>{const e=u+1,r=U(e,t),n=q(e,t),i=L?.highlightConditions?.filter(e=>Cr(e).includes("modifier"))||[],c=Or(o,{highlightConditions:i,isDarkMode:T,alphaBackground:.3,allValues:a.diceValues});return s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-right select-none cursor-cell "+(c?"font-bold":"text-gray-700 dark:text-gray-300"),style:{width:g.modifier||bi,...c,backgroundImage:r?m:void 0,...n},onMouseDown:r=>W(e,t,r),onMouseEnter:()=>B(e,t),children:l})})(),(()=>{const e=u+2,r=U(e,t),n=q(e,t),o=L?.highlightConditions?.filter(e=>Cr(e).includes("total"))||[],l=Or(a.total,{highlightConditions:o,isDarkMode:T,alphaBackground:.3,allValues:a.diceValues});return s.jsxs(i.Fragment,{children:[s.jsx("div",{className:"flex-shrink-0 border-r border-gray-300 dark:border-gray-600 px-4 py-2 text-right font-bold select-none cursor-cell "+(l?"":"text-gray-700 dark:text-gray-300"),style:{width:g.total||bi,...l,backgroundImage:r?m:void 0,...n},onMouseDown:r=>W(e,t,r),onMouseEnter:()=>B(e,t),children:a.total}),s.jsx("div",{className:"flex-grow p-0"})]},"total-and-spacer")})()]},e.key)})})]})})}),Si=(e,t)=>e.type===t.type&&("condition"===e.type&&"condition"===t.type?((e,t)=>e.column===t.column&&e.operator===t.operator&&e.value===t.value)(e.condition,t.condition):("and"===e.type&&"and"===t.type||"or"===e.type&&"or"===t.type)&&(e.expressions.length===t.expressions.length&&e.expressions.every((e,r)=>Si(e,t.expressions[r])))),ki=({filterSet:e})=>{const{t:t}=$e(["charts","common"]),[r,n]=a.useState(!1),[i,o]=a.useState("left"),l=a.useRef(null),c=a.useRef(null);a.useLayoutEffect(()=>{if(r&&c.current&&l.current){const e=c.current.getBoundingClientRect(),t=l.current.getBoundingClientRect(),r=window.innerWidth;if(e.left+t.width>r-10){const r=e.right-t.width<10;o(r?"center":"right")}else o("left")}},[r]),a.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&c.current&&!c.current.contains(e.target)&&n(!1)};return r&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r]);const d=(e,r,a)=>{let n;if("trialNumber"===e)n=t("common:filterColumn.trialNumber");else if("total"===e)n=t("common:filterColumn.total");else if("modifier"===e)n=t("common:filterColumn.modifier");else if(e.startsWith("dice-")){const r=parseInt(e.split("-")[1])+1;n=t("common:filterColumn.dice",{index:r})}else n=e;const i=t(`common:filterOperatorSymbol.${r}`);return s.jsxs("div",{className:"flex items-center gap-2 text-xs border border-gray-300 dark:border-gray-700 bg-gray-300 dark:bg-gray-700 rounded-[5px]",children:[s.jsx("span",{className:"pl-2  text-gray-600 dark:text-gray-100",children:n}),s.jsxs("span",{className:"px-2 py-1 rounded-tr-[4px] rounded-br-[4px] font-bold bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300",children:[i," ",a]})]})},u=(e,r=0)=>{if("condition"===e.type){const{column:t,operator:r,value:a}=e.condition;return s.jsx("div",{className:"flex ",children:s.jsx("div",{className:"flex gap-2 flex-wrap",children:s.jsx("div",{className:"",children:d(t,r,a)})})})}const a="and"===e.type?"common:label.andCondition":"common:label.orCondition",n=e.expressions.filter((e,t,r)=>t===r.findIndex(t=>Si(t,e)));return s.jsx("div",{className:"flex ",children:s.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.jsx("div",{className:"text-xs font-semibold px-2 py-1 rounded-[5px] border border-gray-300 dark:border-gray-700 bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-100 self-start",children:t(a)}),n.map((e,t)=>s.jsx("div",{className:"",children:u(e,r+1)},t))]})})},g=e=>{const r=Cr(e);let a,n;if(1===r.length){const e=r[0];if("total"===e)a=t("common:filterColumn.total");else if("modifier"===e)a=t("common:filterColumn.modifier");else if(e.startsWith("dice-")){const r=parseInt(e.split("-")[1])+1;a=t("common:filterColumn.dice",{index:r})}else a=e}else{a=r.map(e=>{if("total"===e)return t("common:filterColumn.total");if("modifier"===e)return t("common:filterColumn.modifier");if(e.startsWith("dice-")){const r=parseInt(e.split("-")[1])+1;return t("common:filterColumn.dice",{index:r})}return e}).join(", ")}if("single"===e.type)n=t("common:tableFilter.conditionValueSingle",{value:e.value});else if("range"===e.type)n=t("common:tableFilter.conditionValueRange",{min:e.min,max:e.max});else if("modulo"===e.type){let r="";r=e.offset>0?t("common:tableFilter.moduloOffsetPlus",{offset:e.offset}):e.offset<0?t("common:tableFilter.moduloOffsetMinus",{offset:Math.abs(e.offset)}):t("common:tableFilter.moduloOffsetZero"),n=t("common:tableFilter.conditionValueModulo",{divisor:e.divisor,offset:r})}else n="max"===e.type?t("common:tableFilter.conditionValueMax"):"min"===e.type?t("common:tableFilter.conditionValueMin"):"";const i=Rr(e.color),o=e=>e.replace(/[^\d,]/g,""),l={"--hl-r-light":o(i.light),"--hl-r-dark":o(i.dark),"--hl-text-light":i.textLight,"--hl-text-dark":i.textDark};return s.jsxs("div",{className:"flex items-center gap-2 text-xs border rounded-[5px] border-[rgb(var(--hl-r-light))] dark:border-[rgb(var(--hl-r-dark))] bg-[rgba(var(--hl-r-light),0.15)] dark:bg-[rgba(var(--hl-r-dark),0.2)]",style:l,children:[s.jsx("span",{className:"pl-2 text-[var(--hl-text-light)] dark:text-[var(--hl-text-dark)] font-medium",children:a}),s.jsx("span",{className:"px-2 py-1 rounded-tr-[4px] rounded-br-[4px] font-bold bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 border-l border-[rgba(var(--hl-r-light),0.3)] dark:border-[rgba(var(--hl-r-dark),0.3)]",children:n})]})},h=a.useMemo(()=>e.highlightConditions?e.highlightConditions.filter((e,t,r)=>t===r.findIndex(t=>((e,t)=>{if(e.type!==t.type)return!1;const r=Cr(e),a=Cr(t);return r.length===a.length&&!!r.every((e,t)=>e===a[t])&&("single"===e.type&&"single"===t.type?e.value===t.value:"range"===e.type&&"range"===t.type?e.min===t.min&&e.max===t.max:"modulo"!==e.type||"modulo"!==t.type||e.divisor===t.divisor&&e.offset===t.offset)})(t,e))):[],[e.highlightConditions]);if(!(e.filterExpression||e.highlightConditions&&0!==e.highlightConditions.length))return null;const m=!!e.filterExpression,p=e.highlightConditions&&e.highlightConditions.length>0;return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"relative",children:[s.jsxs("button",{ref:c,onClick:()=>n(!r),className:"flex items-center gap-2 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent shadow-sm","aria-label":t("common:tableFilter.activeConditions","Active Conditions"),children:[s.jsx("span",{className:"truncate max-w-[200px]",children:t("common:tableFilter.conditions","Conditions")}),s.jsx(ct,{name:"chevron-down",className:"w-3 h-3 transition-transform "+(r?"rotate-180":"")})]}),r&&s.jsxs("div",{ref:l,className:"absolute top-full mt-2 z-[100] min-w-[300px] max-w-[90vw] overflow-hidden bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 space-y-4 "+("right"===i?"right-0":"center"===i?"left-1/2 -translate-x-1/2":"left-0"),children:[m&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"sticky top-0 bg-gray-50 dark:bg-gray-900/50 px-3 py-1.5 text-xs font-semibold text-gray-500 dark:text-gray-400",children:t("common:tableFilter.activeFilters")}),s.jsx("div",{className:"px-4 text-sm overflow-x-auto",children:u(e.filterExpression)})]}),p&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"sticky top-0 bg-gray-50 dark:bg-gray-900/50 px-3 py-1.5 text-xs font-semibold text-gray-500 dark:text-gray-400",children:t("common:tableFilter.activeHighlights")}),s.jsx("div",{className:"px-4 pb-4 text-sm",children:s.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.showOnlyHighlighted&&s.jsx("div",{className:"text-xs font-semibold px-2 py-1 rounded-[5px] border border-gray-300 dark:border-gray-700 bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-100 self-start",children:t("common:tableFilter.showOnlyHighlighted")}),h.map((e,t)=>s.jsx("div",{className:"",children:g(e)},t))]})})]})]})]})})},Ci=({widgetDiceSetIds:e,onWidgetDiceSetIdsChange:t,diceSets:r,className:n="",label:i,emptyMessage:o})=>{const{t:l}=$e(["diceSets","common"]),[c,d]=a.useState(!1),[u,g]=a.useState(null),h=a.useRef(null),m=a.useRef(null),p=a.useRef(null),x=r=>{t(e.filter(e=>e!==r))},f=e.map(e=>r.find(t=>t.id===e)).filter(e=>!!e);a.useEffect(()=>{if(!p.current||0===e.length)return void g(null);const t=()=>{const e=p.current;if(!e)return;const t=e.offsetWidth-100-8;let r=0,a=0;const n=document.createElement("div");n.style.visibility="hidden",n.style.position="absolute",e.appendChild(n);for(let i=0;i<f.length;i++){const e=f[i],s=document.createElement("div");s.className="inline-flex items-center gap-1.5 pl-2.5 pr-1.5 py-1 rounded-full text-sm border shadow-sm whitespace-nowrap",s.innerHTML=`\n          <span class="truncate max-w-[120px] font-medium">\n            ${void 0!==e.numericUid?`<span class="mr-1 text-xs">#${e.numericUid}</span>`:""}\n            ${ut(e.diceConfig)}\n          </span>\n          <span class="p-0.5 w-3.5 h-3.5"></span>\n        `,n.appendChild(s);const o=s.offsetWidth;if(!(r+o+(a>0?8:0)<=t))break;r+=o+(a>0?8:0),a++}e.removeChild(n),a>=f.length?g(null):g(Math.max(1,a))};t();const r=new ResizeObserver(t);return r.observe(p.current),()=>{r.disconnect()}},[e,f]),a.useEffect(()=>{const e=e=>{c&&h.current&&!h.current.contains(e.target)&&m.current&&!m.current.contains(e.target)&&d(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[c]);const y=null!==u?f.slice(0,u):f,b=null!==u?f.slice(u):[];return s.jsxs("div",{className:`relative flex items-center gap-2 ${n}`,children:[s.jsxs("div",{className:"flex items-center justify-start gap-2",children:[s.jsx("h3",{className:"hidden lg:flex text-sm font-semibold text-gray-700 dark:text-gray-300 items-center gap-2",children:i||s.jsxs(s.Fragment,{children:[s.jsx(ct,{name:"diceSets",className:"w-4 h-4"}),s.jsx("span",{children:l("diceSets:label.deck","Deck")})]})}),s.jsx("div",{className:"flex lg:hidden",children:s.jsx(mr,{multiple:!0,value:e,onChange:t,options:r.map(e=>({id:e.id,label:ut(e.diceConfig)})),triggerLabel:i||s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{children:l("diceSets:label.deck","Deck")})}),placeholder:l("diceSets:action.selectDiceSet","Select Dice Sets"),buttonClassName:"flex items-center gap-2 p-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent",menuClassName:"w-72 max-h-96 left-0"})})]}),s.jsx("div",{ref:p,className:"\n                hidden lg:flex flex-1 transition-colors items-center\n            ",children:0===e.length?s.jsx("div",{className:"h-full py-2 flex items-center justify-center text-sm text-gray-400 dark:text-gray-500 text-center pointer-events-none",children:o||l("diceSets:guidance.dropToAddToDeck","サイドバーからダイスセットをドラッグ＆ドロップして追加")}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:y.map(e=>s.jsxs("div",{className:"\n                                inline-flex items-center gap-1.5 pl-2.5 pr-1.5 py-1 \n                                bg-accent-light-100 dark:bg-accent-dark-900/50\n                                text-accent-light-800 dark:text-accent-dark-100\n                                rounded-full text-sm border border-accent-light-200 dark:border-accent-dark-700\n                                shadow-sm\n                            ",children:[s.jsxs("span",{className:"truncate max-w-[120px] font-medium",children:[void 0!==e.numericUid&&s.jsxs("span",{className:"mr-1 text-xs text-accent-light-600/50 dark:text-accent-dark-400",children:["#",e.numericUid]}),ut(e.diceConfig)]}),s.jsx("button",{onClick:()=>x(e.id),className:"p-0.5 rounded-full hover:bg-accent-light-200 dark:hover:bg-accent-dark-700/80 text-accent-light-600 dark:text-accent-dark-400 transition-colors",children:s.jsx(ct,{name:"close",className:"w-3.5 h-3.5"})})]},e.id))}),b.length>0&&s.jsxs("div",{className:"relative ml-2",children:[s.jsxs("button",{ref:m,onClick:()=>d(!c),className:"\n                                    inline-flex items-center gap-1.5 px-3 py-1 \n                                    bg-gray-100 dark:bg-gray-700\n                                    text-gray-700 dark:text-gray-300\n                                    rounded-full text-sm border border-gray-300 dark:border-gray-600\n                                    shadow-sm hover:bg-gray-200 dark:hover:bg-gray-600\n                                    transition-colors whitespace-nowrap\n                                ",children:[l("diceSets:deck.showMore",{count:b.length}),s.jsx(ct,{name:"chevron-down",className:"w-3 h-3 transition-transform "+(c?"rotate-180":"")})]}),c&&s.jsxs("div",{ref:h,className:"absolute right-0 top-full mt-2 z-[100] w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto",children:[s.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-800 p-3 border-b border-gray-100 dark:border-gray-700 font-semibold text-sm text-gray-700 dark:text-gray-200",children:l("diceSets:deck.allItems","デッキ一覧")}),s.jsx("div",{className:"p-2 space-y-1",children:f.map(e=>s.jsxs("div",{className:"\n                                                    flex items-center gap-2 pl-2.5 pr-1 py-0.5\n                                                    bg-accent-light-50 dark:bg-accent-dark-900/30\n                                                    text-accent-light-800 dark:text-accent-dark-100\n                                                    rounded-full text-sm border border-accent-light-200 dark:border-accent-dark-700\n                                                    hover:bg-accent-light-100 dark:hover:bg-accent-dark-900/50\n                                                    transition-colors\n                                                ",children:[s.jsxs("span",{className:"flex-1 truncate font-medium",children:[void 0!==e.numericUid&&s.jsxs("span",{className:"mr-1 text-xs text-accent-light-600/50 dark:text-accent-dark-400",children:["#",e.numericUid]}),ut(e.diceConfig)]}),s.jsx("button",{onClick:()=>x(e.id),className:"\n                                                        p-1.5 rounded-full\n                                                        hover:bg-accent-light-200 dark:hover:bg-accent-dark-700/80 \n                                                        text-accent-light-600 dark:text-accent-dark-400 \n                                                        transition-colors flex-shrink-0\n                                                    ","aria-label":l("common:action.delete","Delete"),children:s.jsx(ct,{name:"close",className:"w-4 h-4"})})]},e.id))})]})]})]})})]})},ji=({widget:e,index:t,widgets:r,displayedDiceSets:a,chartSettings:n,currentChartSettingsId:i,chartHeightSettings:o,chartLayout:l,dragHandleProps:c,isDragging:d,isDropTarget:u,draggedIndex:g,currentDraggingIndex:h,isTouchDragging:m,chartRef:p,setChartContainerRef:x,onChangeType:f,onDuplicate:y,onRemove:b,onUpdateSettings:v,onOpenFullscreen:w,onDragOver:S,onDrop:k,onTouchStart:C,onTouchMove:j,onTouchEnd:D,onUpdateHiddenLegends:N})=>{const{t:A}=$e(["charts"]),T=sn(),M="4row1col"===l||"2row1col3col"===l&&0===t,E=n?.find(e=>e.id===i),R=e=>{v({aggregationSettings:e})},I=e=>{v({aggregationSettings:e})},L=e=>{v({chartType:e})},O=e=>{v({xAxisScale:e})},F=e=>{v({yAxisScale:e})},P=e=>{v({movingAverageWindow:e})},$=e=>{v({distributionType:e.distributionType,showOnlyActualData:e.showOnlyActualData,quantileCount:e.quantileCount})},W=e=>{v({recentRollsCount:e})},V=e=>{v({highlightConditions:e})},B=`relative px-4 pb-3 border border-gray-200 dark:border-gray-700 transition-all rounded-lg ${d?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500 ring-offset-2 dark:ring-offset-gray-800 opacity-70 bg-gray-50 dark:bg-gray-700/30":""} ${u?g<t?"mb-4":"mt-4":""}`,H=`${i}-${e.id}`,z=E?{...E,id:H,resultChart:"result"===e.type&&e.aggregationSettings||E.resultChart,individualDiceChart:"individual"===e.type&&e.aggregationSettings||E.individualDiceChart,rollProgressChart:"rollProgress"===e.type&&e.aggregationSettings||E.rollProgressChart,resultChartType:"result"===e.type&&e.chartType||E.resultChartType,individualDiceChartType:"individual"===e.type&&e.chartType||E.individualDiceChartType,rollProgressChartType:"rollProgress"===e.type&&e.chartType||E.rollProgressChartType,cumulativeChartType:"cumulative"===e.type&&e.chartType||E.cumulativeChartType,resultChartXScale:"result"===e.type&&e.xAxisScale||E.resultChartXScale,rollProgressChartXScale:"rollProgress"===e.type&&e.xAxisScale||E.rollProgressChartXScale,resultChartYScale:"result"===e.type&&e.yAxisScale||E.resultChartYScale,individualDiceChartYScale:"individual"===e.type&&e.yAxisScale||E.individualDiceChartYScale,rollProgressChartYScale:"rollProgress"===e.type&&e.yAxisScale||E.rollProgressChartYScale,cumulativeChartYScale:"cumulative"===e.type&&e.yAxisScale||E.cumulativeChartYScale,rollProgressMovingAverageWindow:"rollProgress"===e.type?e.movingAverageWindow??E.rollProgressMovingAverageWindow:E.rollProgressMovingAverageWindow,cumulativeDistributionType:"cumulative"===e.type&&e.distributionType||E.cumulativeDistributionType,cumulativeShowOnlyActualData:"cumulative"===e.type?e.showOnlyActualData??E.cumulativeShowOnlyActualData:E.cumulativeShowOnlyActualData,cumulativeQuantileCount:"cumulative"===e.type?e.quantileCount??E.cumulativeQuantileCount:E.cumulativeQuantileCount}:void 0,U=z?[z]:n,q=z?H:i,Y=null!=h&&!(h===t)&&!u,X=null!=h&&h<t?"bottom":"top";return s.jsxs("div",{ref:x,className:B,onDragOver:S,onDrop:k,children:[u&&s.jsx("div",{className:`absolute left-0 right-0 h-1 bg-accent-light-500 dark:bg-accent-dark-500 rounded-full ${(g??h)<t?"-bottom-1":"-top-1"} z-10`}),Y&&s.jsx("div",{className:`absolute left-0 right-0 h-0.5 bg-gray-300 dark:bg-gray-600 rounded-full ${"bottom"===X?"-bottom-1":"-top-1"} z-0 transition-opacity duration-200 pointer-events-none`}),s.jsxs("div",{className:"flex items-center gap-1 py-2 border-b border-gray-200 dark:border-gray-600 mb-2",children:[s.jsx(ar,{dragHandleProps:c,onTouchStart:C,onTouchMove:j,onTouchEnd:D,isDragging:m&&d}),s.jsxs("div",{className:"flex items-center gap-1.5 px-2",children:[s.jsx(ct,{name:(e=>{switch(e){case"result":return"chart-total-distribution";case"cumulative":return"chart-cumulative-distribution";case"rollProgress":return"chart-roll-progress";case"individual":return"chart-individual-dice";case"recentRolls":return"dice";default:return"chart-bar"}})(e.type),className:"w-4 h-4 text-gray-600 dark:text-gray-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:(()=>{if(e.customName)return e.customName;const a=r.filter((r,a)=>a<=t&&r.type===e.type).length;return vt(e.type,a,A)})()})]}),s.jsx("div",{className:"flex-grow"}),s.jsx("button",{onClick:y,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors",title:A("charts:widget.duplicate"),children:s.jsx(ct,{name:"copy",className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),(_=e.type,"recentRolls"!==_&&s.jsx("button",{onClick:()=>w?.(),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors hidden lg:inline-flex",title:A("charts:menu.fullScreen"),children:s.jsx(ct,{name:"fullscreen",className:"w-4 h-4 text-gray-600 dark:text-gray-300"})})),s.jsx("button",{onClick:b,className:"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors",title:A("charts:widget.remove"),children:s.jsx(ct,{name:"close",className:"w-4 h-4 text-red-600 dark:text-red-400"})})]}),s.jsx("div",{className:"w-full",children:(()=>{switch(e.type){case"result":return s.jsx(Pn,{diceSets:a,onBinningSettingsChange:I,onChartTypeChange:L,onXAxisScaleChange:O,onYAxisScaleChange:F,chartSettings:U,currentChartSettingsId:q,chartHeightSettings:o,isNarrowLayout:M,chartRef:p,widgetType:e.type,onWidgetTypeChange:f,widget:e,onUpdateHiddenLegends:N});case"cumulative":return s.jsx(Vn,{diceSets:a,onChartTypeChange:L,onYAxisScaleChange:F,chartSettings:U,currentChartSettingsId:q,chartHeightSettings:o,onCumulativeSettingsChange:$,isNarrowLayout:M,chartRef:p,widgetType:e.type,onWidgetTypeChange:f,widget:e,onUpdateHiddenLegends:N,onOpenFullscreen:w});case"rollProgress":return s.jsx(Bn,{diceSets:a,onChartTypeChange:L,onAggregationChange:e=>{R({useAggregation:null!==e&&e>1,aggregationInterval:e||1})},onMovingAverageWindowChange:P,onXAxisScaleChange:O,onYAxisScaleChange:F,chartSettings:U,currentChartSettingsId:q,chartHeightSettings:o,isNarrowLayout:M,chartRef:p,widgetType:e.type,onWidgetTypeChange:f,widget:e,onUpdateHiddenLegends:N,onOpenFullscreen:w});case"individual":return s.jsx(Wn,{diceSets:a,onChartTypeChange:L,onAggregationSettingsChange:R,onYAxisScaleChange:F,chartSettings:U,currentChartSettingsId:q,chartHeightSettings:o,isNarrowLayout:M,chartRef:p,widgetType:e.type,onWidgetTypeChange:f,widget:e,onUpdateHiddenLegends:N,onOpenFullscreen:w});case"recentRolls":return s.jsx(Hn,{diceSets:a,isDarkMode:T,recentRollsCount:e.recentRollsCount||1,onRecentRollsCountChange:W,widgetType:e.type,onWidgetTypeChange:f,highlightConditions:e.highlightConditions,onHighlightConditionsChange:V,widget:e,onUpdateHiddenLegends:N})}})()})]});var _},Di=({isOpen:e,onClose:t,menuRef:r,buttonRef:n,activeTab:i,chartLayout:o,onLayoutChange:l,widgetsCount:c,onAddWidget:d,onResetToDefault:u,chartSettings:g,onManageChartSettings:h,onManageTableFilters:m,onDownloadCSV:p,onReset:x})=>{const{t:f}=$e(["charts","common"]),[y,b]=a.useState({top:0,left:0});a.useEffect(()=>{if(e&&n?.current){const e=n.current.getBoundingClientRect(),t=256,r=window.innerHeight;let a=e.right-t;a<8&&(a=Math.max(8,e.left));let i=e.bottom+4;const s=400;i+s>r-8&&(i=e.top-s-4,i<8&&(i=e.bottom+4)),b({top:i,left:a})}},[e,n]),a.useEffect(()=>{if(!e||!n?.current)return;const t=()=>{if(n.current){const e=n.current.getBoundingClientRect(),t=256,r=window.innerHeight;let a=e.right-t;a<8&&(a=Math.max(8,e.left));let i=e.bottom+4;const s=400;i+s>r-8&&(i=e.top-s-4,i<8&&(i=e.bottom+4)),b({top:i,left:a})}};return window.addEventListener("scroll",t,!0),window.addEventListener("resize",t),()=>{window.removeEventListener("scroll",t,!0),window.removeEventListener("resize",t)}},[e,n]);const v=e=>{l(e),t()},w=e=>{e(),t()};return e?or.createPortal(s.jsxs("div",{ref:r,className:"fixed w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[9999] overflow-hidden border border-gray-200 dark:border-gray-600 max-h-[80vh] overflow-y-auto",style:{top:`${y.top}px`,left:`${y.left}px`},children:["table"!==i&&s.jsx("div",{className:"hidden lg:block px-4 py-4 border-b border-gray-200 dark:border-gray-600",children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[f("charts:view.layout","レイアウト"),":"]}),s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsx("button",{onClick:()=>v("4row1col"),className:"px-3 py-1.5 text-sm rounded-md transition-colors flex flex-1 justify-center items-center gap-1.5 "+("4row1col"===o?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),title:f("charts:view.layoutType.4row1col"),children:s.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("rect",{x:"4",y:"3",width:"16",height:"4",rx:"1"}),s.jsx("rect",{x:"4",y:"10",width:"16",height:"4",rx:"1"}),s.jsx("rect",{x:"4",y:"17",width:"16",height:"4",rx:"1"})]})}),s.jsx("button",{onClick:()=>v("2row2col"),className:"px-3 py-1.5 text-sm rounded-md transition-colors flex flex-1 justify-center items-center gap-1.5 "+("2row2col"===o?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),title:f("charts:view.layoutType.2row2col"),children:s.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("rect",{x:"3",y:"3",width:"8",height:"8",rx:"1"}),s.jsx("rect",{x:"13",y:"3",width:"8",height:"8",rx:"1"}),s.jsx("rect",{x:"3",y:"13",width:"8",height:"8",rx:"1"}),s.jsx("rect",{x:"13",y:"13",width:"8",height:"8",rx:"1"})]})}),s.jsx("button",{onClick:()=>v("2row1col3col"),className:"px-3 py-1.5 text-sm rounded-md transition-colors flex flex-1 justify-center items-center gap-1.5 "+("2row1col3col"===o?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),title:f("charts:view.layoutType.2row1col3col"),children:s.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"5",rx:"1"}),s.jsx("rect",{x:"3",y:"11",width:"5",height:"10",rx:"1"}),s.jsx("rect",{x:"9.5",y:"11",width:"5",height:"10",rx:"1"}),s.jsx("rect",{x:"16",y:"11",width:"5",height:"10",rx:"1"})]})})]})]})}),"table"!==i&&s.jsxs("button",{onClick:()=>{d(),t()},disabled:c>=ot,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",title:f(c>=ot?"charts:widget.limitReached":"charts:widget.add"),children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:f("charts:widget.add")})]}),"table"!==i&&s.jsxs("button",{onClick:()=>{u(),t()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",title:f("charts:widget.resetToDefault"),children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),s.jsx("span",{children:f("charts:widget.resetToDefault")})]}),"table"!==i&&g&&g.length>0&&h&&s.jsxs("button",{onClick:h,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600",title:f("charts:view.manage"),children:[s.jsx(ct,{name:"settings",className:"w-5 h-5"}),s.jsx("span",{children:f("charts:view.manage")})]}),"table"===i&&m&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>w(m),className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsx(ct,{name:"filter",className:"w-5 h-5"}),s.jsx("span",{children:f("common:tableFilter.manageFilters")})]}),s.jsxs("button",{onClick:()=>w(p),className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsx(ct,{name:"download"}),s.jsx("span",{className:"text-sm",children:f("charts:menu.csvDownload")})]})]}),s.jsxs("button",{onClick:()=>w(x),className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600",children:[s.jsx(ct,{name:"trash"}),s.jsx("span",{className:"text-sm",children:f("charts:menu.rollReset")})]})]}),document.body):null};function Ni(e,t){return"default"===e.id?t("charts:preset.default"):pt(e.name)}const Ai=({chartSettings:e,currentChartSettingsId:t,onSelectChartSettings:r,onCreateChartSettings:a,onSaveChartSettings:n,onEditChartSettings:i,hasPendingChanges:o=!1,widgets:l})=>{const{t:c}=$e(["charts","common"]),d=e.filter(e=>St(e.id)),u=e.filter(e=>!St(e.id)),g=[...d.map(e=>({id:e.id,label:Ni(e,c),group:c("charts:view.presetGroup")})),...u.map(e=>({id:e.id,label:pt(e.name),group:c("charts:view.customGroup")}))],h=[c("charts:view.presetGroup"),c("charts:view.customGroup")],m=a?s.jsxs("button",{onClick:()=>a(),className:"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[s.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:s.jsx(ct,{name:"plus",className:"w-4 h-4 text-accent-light-500 dark:text-accent-dark-500"})}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:c("charts:view.saveCurrentView")})]}):void 0;return s.jsxs("div",{className:"relative inline-flex justify-start items-center gap-2",children:[s.jsx(mr,{value:t,onChange:r,options:g,placeholder:c("charts:view.selectView"),headerContent:m,groupOrder:h,buttonClassName:"h-8 px-3 py-1.5 text-sm border-gray-300 dark:border-gray-600 border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",menuClassName:"w-72 max-h-96"}),t&&!St(t)&&i&&s.jsx("button",{onClick:()=>{const r=e.find(e=>e.id===t);r&&i?.({...r,widgets:l})},className:"px-2 py-1.5 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:outline-none transition-colors inline-flex items-center gap-1.5",title:c("common:action.edit"),children:s.jsx(ct,{name:"edit",className:"w-4 h-4"})}),n&&t&&!St(t)&&s.jsx("button",{onClick:()=>n(t),disabled:!o,className:"px-2 py-1.5 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:outline-none transition-colors inline-flex items-center gap-1.5",title:c(o?"charts:view.overwrite":"common:label.noChanges"),children:s.jsx(ct,{name:"save",className:"w-4 h-4"})})]})},Ti=({type:e,onShowCompareModal:t,onReroll:r,onAddRoll:a,isSimulating:n=!1,diceSets:i=[],selectedDiceSetIds:o=[],targetDiceSetType:l="selected",onTargetDiceSetTypeChange:c})=>{const{t:d}=$e(["charts","diceSets"]);return"no-dice-set"===e?s.jsx("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-lg mb-6",children:d("diceSets:selectPrompt")}),s.jsxs("button",{onClick:()=>t?.(),className:"px-6 py-3 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors inline-flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),s.jsx("span",{children:d("diceSets:action.selectDiceSet")})]})]})}):s.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:d("charts:result.title")}),s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-400 dark:text-gray-500 mb-6",children:d("charts:message.startRoll")}),s.jsx(Ba,{onReroll:r||(()=>{}),onAddRoll:a||(()=>{}),hasResults:!1,isSimulating:n,variant:"large",diceSets:i,selectedDiceSetIds:o,targetDiceSetType:l,onTargetDiceSetTypeChange:c})]})]})},Mi=({diceSet:e,diceSets:t,compareDiceSetIds:r,onResetResults:n,onReroll:o,onAddRoll:l,isSimulating:c,simulationProgress:d=0,onSortConfigChange:u,onColumnWidthsChange:g,chartSettings:h,currentChartSettingsId:m,onSelectChartSettings:p,onManageChartSettings:x,onCreateNewSettings:f,onSaveChartSettings:y,onUpdateChartSettings:b,hasPendingChanges:v=!1,onWidgetsChange:w,chartHeightSettings:S,selectedDiceSetIds:k=[],targetDiceSetType:C="selected",onTargetDiceSetTypeChange:j,onShowCompareModal:D,widgetDiceSetIds:N,onWidgetDiceSetIdsChange:A,activeSheetDiceSetId:T,onActiveSheetDiceSetIdChange:M,activeTab:E,onActiveTabChange:R,isExternalDragging:I=!1})=>{const{t:L}=$e(["charts","common","diceSets"]),O=sn(),[F,P]=a.useState(()=>{const e=localStorage.getItem("resultSectionActiveTab");return"table"===e||"chart"===e?e:"chart"}),$=void 0!==E?E:F,W=a.useMemo(()=>"table"===$&&T?[T]:k,[$,T,k]),V=e=>{R?R(e):P(e),localStorage.setItem("resultSectionActiveTab",e)},[B,H]=a.useState(!1),[z,U]=a.useState(!1),[q,Y]=a.useState(()=>localStorage.getItem("selectedTableDiceSetId")||""),[X,_]=a.useState(!1),[J,K]=a.useState({isOpen:!1}),[Q,G]=a.useState(!1),[Z,ee]=a.useState(null),[te,re]=a.useState(!1),[ae,ne]=a.useState([]),[ie,se]=a.useState(()=>"undefined"!=typeof localStorage?localStorage.getItem("currentTableFilterSetId"):null);a.useEffect(()=>{ie&&localStorage.setItem("currentTableFilterSetId",ie)},[ie]);const oe=a.useRef(N);a.useEffect(()=>{oe.current=N},[N]);const le=a.useRef(void 0);a.useEffect(()=>{if(ie&&le.current!==ie){const e=ae.find(e=>e.id===ie);if(e?.rememberSelectedDiceSet&&e.selectedDiceSetIds&&e.selectedDiceSetIds.length>0){const r=e.selectedDiceSetIds.filter(e=>t.some(t=>t.id===e));r.length>0&&M&&T!==r[0]&&M(r[0])}le.current=ie}},[ie,ae,t,M,T]);const ce=a.useRef(null),de=a.useRef(null),[ue,ge]=a.useState(!1),he=a.useRef(new Map),[me,pe]=a.useState(0),[xe,fe]=a.useState(()=>{const e=localStorage.getItem("widgets");if(e)try{const t=JSON.parse(e);if(Array.isArray(t)&&t.every(e=>e.id&&e.type))return t}catch{}const t=localStorage.getItem("chartOrder");if(t)try{const e=JSON.parse(t);if(Array.isArray(e)){const t=e.map(e=>({id:yt(),type:e}));return localStorage.removeItem("chartOrder"),t}}catch{}return bt()}),[ye,be]=a.useState("0"),[ve,we]=a.useState(()=>{const e=localStorage.getItem("chartLayout");return"4row1col"===e||"2row2col"===e||"2row1col3col"===e?e:"4row1col"}),[Se,ke]=a.useState(null),[Ce,je]=a.useState(null),[De,Ne]=a.useState(null),[Ae,Te]=a.useState(null),Me=a.useRef(new Map),Ee=a.useRef(null),[Re,Ie]=a.useState(!1),Le=a.useRef(0),Oe=a.useRef(new Map);a.useEffect(()=>{if(null!==De){const e=()=>{Ne(null)};return window.addEventListener("mouseup",e),window.addEventListener("dragend",e),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("dragend",e)}}},[De]),a.useEffect(()=>{localStorage.setItem("widgets",JSON.stringify(xe)),w?.(xe)},[xe,w]);const Fe=a.useRef(void 0);a.useEffect(()=>{if(Fe.current!==m&&(Fe.current=m,m&&h)){const e=h.find(e=>e.id===m);e?.widgets&&e.widgets.length>0&&fe(e.widgets)}},[m,h]),a.useEffect(()=>{localStorage.setItem("chartLayout",ve)},[ve]),a.useEffect(()=>{(async()=>{let e=await $t();if(0===e.length){const t=Vt();await Wt(t),e=[t]}ne(e),se(t=>t&&e.some(e=>e.id===t)?t:e.length>0?e[0].id:null)})()},[]);const Pe=e=>(Me.current.has(e)||Me.current.set(e,i.createRef()),Me.current.get(e)),We=()=>{je(null),Te(null)},Ve=e=>{if(null===Ce||!Re)return;e.preventDefault();const t=e.touches[0].clientY;let r=null;Oe.current.forEach((e,a)=>{if(e&&a!==Ce){const n=e.getBoundingClientRect(),i=n.top+n.height/2;(t>n.top&&t<n.bottom||Ce<a&&t>i&&t<n.bottom+50||Ce>a&&t<i&&t>n.top-50)&&(r=a)}}),Te(r)},Be=()=>{if(null!==Ce&&null!==Ae&&Ce!==Ae){const e=[...xe],[t]=e.splice(Ce,1);e.splice(Ae,0,t),fe(e),pe(e=>e+1)}je(null),Te(null),Ie(!1)};a.useEffect(()=>{q&&!t.find(e=>e.id===q)&&Y("")},[t,q]),a.useEffect(()=>{localStorage.setItem("resultSectionActiveTab",$)},[$]),a.useEffect(()=>{q&&localStorage.setItem("selectedTableDiceSetId",q)},[q]);const He=a.useMemo(()=>{const e=t.find(e=>e.id===q);return e||null},[q,t]);a.useEffect(()=>{void 0!==T&&T!==q&&(null===T?Y(""):t.some(e=>e.id===T)&&Y(T))},[T,t,q]);const ze=e=>{e.preventDefault(),e.stopPropagation(),ge(!1);try{const t=JSON.parse(e.dataTransfer.getData("application/json"));let r=null;"diceSet"===t.type&&(t.id?r=t.id:t.ids&&Array.isArray(t.ids)&&t.ids.length>0&&(r=t.ids[0]),r&&(Y(r),M?.(r)))}catch(t){}};a.useEffect(()=>{const e=e=>{ce.current&&!ce.current.contains(e.target)&&de.current&&!de.current.contains(e.target)&&H(!1)};if(B)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[B]);const Ue=a.useMemo(()=>{const e=void 0!==N?N:r;if(!e||0===e.length)return[];const a=new Set(e);return t.filter(e=>a.has(e.id))},[N,r,t]),qe=a.useMemo(()=>{if(void 0!==N){if(0===N.length)return[];const e=new Set(N);return t.filter(t=>e.has(t.id))}return Ue.length>0?Ue:e?[e]:[]},[N,Ue,e,t]),Ye=a.useMemo(()=>{const e={};return he.current.forEach((t,r)=>{e[r]=t}),function(e){const t=[];if(e.result?.current){const r=mn("result",e.result);t.push(...r)}if(e.cumulative?.current){const r=mn("cumulative",e.cumulative);t.push(...r)}if(e.rollProgress?.current){const r=mn("rollProgress",e.rollProgress);t.push(...r)}if(e.individual?.current){const r=mn("individual",e.individual);t.push(...r)}return t}(e)},[me]);a.useEffect(()=>{const e=setTimeout(()=>{pe(e=>e+1)},500);return()=>clearTimeout(e)},[qe,xe,ve]);const Xe=()=>{if(xe.length>=ot)return void alert(L("charts:widget.limitReached",{max:ot}));const e={id:yt(),type:"result"};fe([...xe,e]),pe(e=>e+1)},_e=(e,t)=>{const r=[...xe];r[e]={...r[e],...t},fe(r),pe(e=>e+1)},Je=async e=>{await Wt(e);const t=await $t();ne(t),se(e.id)},Ke=(e,t)=>{const r={ref:Pe(t),onDragStart:e=>((e,t)=>{je(t),e.dataTransfer.effectAllowed="move",Ee.current&&e.dataTransfer.setDragImage(Ee.current,-10,20)})(e,t),onDragEnd:We,onMouseDown:()=>Ne(t)},a=Ce===t||De===t,n=Ae===t&&null!==Ce&&Ce!==t,o=(l=e.id,he.current.has(l)||he.current.set(l,i.createRef()),he.current.get(l));var l;const c=S?`${S.mode}-${S.aspectRatioWidth}-${S.aspectRatioHeight}-${S.fixedHeight}`:"default";return s.jsx(ji,{widget:e,index:t,widgets:xe,displayedDiceSets:qe,chartSettings:h,currentChartSettingsId:m,chartHeightSettings:S,chartLayout:ve,dragHandleProps:r,isDragging:a,isDropTarget:n,draggedIndex:Ce,currentDraggingIndex:Ce??De,isTouchDragging:Re,chartRef:o,setChartContainerRef:e=>{Oe.current.set(t,e)},onChangeType:e=>((e,t)=>{const r=[...xe];r[e]={...r[e],type:t},fe(r),pe(e=>e+1)})(t,e),onDuplicate:()=>(e=>{if(xe.length>=ot)return void alert(L("charts:widget.limitReached",{max:ot}));const t=xe[e],r={...t,id:yt(),customName:void 0,aggregationSettings:t.aggregationSettings?{...t.aggregationSettings}:void 0,xAxisScale:t.xAxisScale?{...t.xAxisScale}:void 0},a=[...xe];a.splice(e+1,0,r),fe(a),pe(e=>e+1)})(t),onRemove:()=>(e=>{if(xe.length<=1)return void alert(L("charts:widget.minLimitReached"));const t=parseInt(ye);if(t===e){const t=Math.max(0,e-1);be(t.toString()),setTimeout(()=>{const e=document.querySelector(`[data-tab-index="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},100)}else t>e&&be((t-1).toString());const r=xe.filter((t,r)=>r!==e);fe(r),pe(e=>e+1)})(t),onUpdateSettings:e=>_e(t,e),onOpenFullscreen:()=>ke(e),onDragOver:e=>((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",null!==Ce&&Ce!==t&&Te(t)})(e,t),onDrop:e=>((e,t)=>{if(e.preventDefault(),null===Ce||Ce===t)return;const r=[...xe],[a]=r.splice(Ce,1);r.splice(t,0,a),fe(r),je(null),Te(null),pe(e=>e+1)})(e,t),onTouchStart:e=>((e,t)=>{e.stopPropagation(),Le.current=e.touches[0].clientY,je(t),Ie(!0)})(e,t),onTouchMove:Ve,onTouchEnd:Be,onUpdateHiddenLegends:e=>_e(t,{hiddenLegends:e})},`${e.id}-${c}`)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{ref:Ee,className:"fixed -left-[9999px] -top-[9999px] bg-accent-light-500 dark:bg-accent-dark-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",style:{zIndex:9999,opacity:1},children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),s.jsx("span",{className:"font-medium text-sm",children:L("common:selection.moving")})]}),s.jsxs("div",{className:"lg:pt-2 pr-4 text-sm flex justify-between border-b border-gray-200 dark:border-gray-600",children:[s.jsxs("div",{className:"flex justify-start start",children:[s.jsxs("button",{onClick:()=>V("chart"),className:"px-6 py-2 font-medium transition-colors flex items-center gap-2 "+("chart"===$?"text-accent-light-600 dark:text-accent-dark-400 border-b-2 border-accent-light-600 dark:border-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[s.jsx(ct,{name:"chart-bar",className:"w-4 h-4"}),s.jsx("span",{className:"inline",children:L("charts:view.chart")})]}),s.jsxs("button",{onClick:()=>V("table"),className:"px-6 py-2 font-medium transition-colors flex items-center gap-2 "+("table"===$?"text-accent-light-600 dark:text-accent-dark-400 border-b-2 border-accent-light-600 dark:border-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[s.jsx(ct,{name:"table",className:"w-4 h-4"}),s.jsx("span",{className:"inline",children:L("charts:view.table")})]})]}),s.jsx("div",{className:"flex gap-2 items-center",children:s.jsxs("div",{className:"relative",children:[s.jsx("button",{ref:de,onClick:()=>{H(!B)},className:"w-10 h-10 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white  rounded-tl-lg rounded-tr-lg  transition-colors inline-flex items-center justify-center",title:L("charts:menu.options"),children:s.jsx(ct,{name:"dots-vertical",className:"w-5 h-5"})}),s.jsx(Di,{isOpen:B,onClose:()=>H(!1),menuRef:ce,buttonRef:de,activeTab:$,chartLayout:ve,onLayoutChange:we,widgetsCount:xe.length,onAddWidget:Xe,onResetToDefault:()=>{window.confirm(L("charts:widget.confirmReset"))&&(fe(bt()),pe(e=>e+1))},chartSettings:h,onManageChartSettings:x,onManageTableFilters:()=>G(!0),onDownloadCSV:()=>{if(e)try{!function(e){const{results:t,name:r,diceConfig:a,resultsConfig:n}=e;if(0===t.length)throw new Error("ダウンロードする結果がありません");const i=t.reduce((e,t)=>Math.max(e,t.diceValues.length),0),s=["試行回数"];for(let m=1;m<=i;m++)s.push(`${m}個目`);s.push("修正値"),s.push("合計値");const o=[s];t.forEach(e=>{const t=[e.trialNumber.toString()];for(let n=0;n<i;n++)t.push(void 0!==e.diceValues[n]?e.diceValues[n].toString():"");const r=e.diceValues.reduce((e,t)=>e+t,0),a=e.total-r;t.push(a.toString()),t.push(e.total.toString()),o.push(t)});const l=o.map(e=>e.join(",")).join("\n"),c=new Blob(["\ufeff"+l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),u=document.createElement("a");u.href=d;const g=ut(n||a),h=(r||"名称未設定").replace(/[<>:"/\\|?*\x00-\x1F]/g,"_").trim();u.download=`${h}_${g}_${t.length}trials.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d)}(e)}catch(t){alert(L("charts:menu.csvDownloadFailed"))}},onReset:()=>{window.confirm(L("charts:menu.confirmReset"))&&n()}})]})})]}),"table"===$?s.jsx(s.Fragment,{children:s.jsxs("div",{className:"px-4 py-2 border-b bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700 flex justify-between items-center gap-4 w-full",children:[s.jsx("div",{className:"min-w-0",onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:ze,children:s.jsx(Ci,{widgetDiceSetIds:He?[He.id]:[],onWidgetDiceSetIdsChange:e=>{const t=e=>{Y(e||""),M&&M(e)};if(0===e.length)t(null);else{const r=He?.id,a=e.find(e=>e!==r);t(a||e[0])}},diceSets:t,label:s.jsx("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:s.jsx("span",{className:"text-sm",children:L("diceSets:dice")})}),emptyMessage:L("diceSets:guidance.dropToViewSheet","Drop a dice set here to view results"),className:"w-full"})}),s.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[ie&&ae.length>0&&(()=>{const e=ae.find(e=>e.id===ie);return e?s.jsx(ki,{filterSet:e}):null})(),ae.length>0&&s.jsxs("div",{className:"inline-flex items-center gap-2",children:[s.jsx(mr,{value:ie||void 0,onChange:se,options:ae.map(e=>({id:e.id,label:e.name,group:L("common:tableFilter.filterSet")})),placeholder:L("common:tableFilter.selectFilterSet"),triggerLabel:s.jsx("span",{children:L("common:tableFilter.filter")}),headerContent:s.jsx("div",{className:"border-b border-gray-100 dark:border-gray-700",children:s.jsxs("button",{onClick:()=>re(!0),className:"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-left",children:[s.jsx("div",{className:"w-5 h-5 flex items-center justify-center",children:s.jsx(ct,{name:"plus",className:"w-4 h-4 text-accent-light-500 dark:text-accent-dark-500"})}),s.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:L("common:tableFilter.createNew")})]})}),buttonClassName:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",menuClassName:"w-64 max-h-96"}),s.jsx("button",{onClick:()=>{const e=ae.find(e=>e.id===ie);if(e)ee(e);else if(ae.length>0){const e=ae[0];ee(e),se(e.id)}},className:"px-2 py-1.5 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:outline-none transition-colors inline-flex items-center gap-1.5",title:L("charts:menu.editTableFilter"),children:s.jsx(ct,{name:"edit",className:"w-4 h-4"})})]})]})]})}):s.jsxs("div",{className:"px-4 py-2 flex justify-between border-b bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700",children:[N&&A&&s.jsx(Ci,{widgetDiceSetIds:N,onWidgetDiceSetIdsChange:A,diceSets:t,label:s.jsx("div",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-300",children:s.jsx("span",{className:"text-sm",children:L("diceSets:dice")})}),className:"flex-1"}),h&&h.length>0&&p&&s.jsx(Ai,{chartSettings:h,currentChartSettingsId:m,onSelectChartSettings:p,onCreateChartSettings:()=>_(!0),onSaveChartSettings:y,onEditChartSettings:e=>{K({isOpen:!0,settingsId:e.id,initialSettings:e,initialName:e.name}),be("0")},hasPendingChanges:v,widgets:xe})]}),s.jsxs("div",{className:"flex-1 flex flex-col min-h-0 relative",onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect=null===Ce?"copy":"move"},onDragEnter:e=>{e.preventDefault(),null===Ce&&ge(!0)},onDragLeave:e=>{e.preventDefault(),null===Ce&&(e.currentTarget.contains(e.relatedTarget)||ge(!1))},onDrop:e=>{null===Ce&&("table"===$?ze(e):(e=>{if(e.preventDefault(),e.stopPropagation(),ge(!1),N&&A)try{const t=JSON.parse(e.dataTransfer.getData("application/json"));if("diceSet"===t.type){const e=[...N];let r=!1;t.ids&&Array.isArray(t.ids)?t.ids.forEach(t=>{e.includes(t)||(e.push(t),r=!0)}):t.id&&!e.includes(t.id)&&(e.push(t.id),r=!0),r&&A(e)}}catch(t){}})(e))},children:[(ue||I)&&null===Ce&&s.jsxs("div",{className:"absolute inset-0 bg-accent-light-500/10 dark:bg-accent-dark-500/10 z-50 flex items-center justify-center pointer-events-none transition-opacity duration-200 "+(I?"opacity-100":""),children:[s.jsx("div",{className:"absolute inset-4 border-4 border-dashed border-accent-light-500 dark:border-accent-dark-500 rounded-lg animate-pulse"}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl flex flex-col items-center animate-bounce-slight opacity-90 border border-gray-100 dark:border-gray-700",children:[s.jsx(ct,{name:"table"===$?"table":"plus-circle",className:"w-12 h-12 text-accent-light-600 dark:text-accent-dark-400 mb-3"}),s.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:"table"===$?L("diceSets:guidance.dropToSwitch","Drop to switch sheet"):L("diceSets:guidance.dropToAddToDeck","Drop to add to deck")})]})]}),s.jsx("div",{className:("table"!==$?"px-4 pb-10 overflow-y-auto ":"overflow-hidden ")+"flex-1 flex flex-col min-h-0",children:"table"===$?s.jsx(s.Fragment,{children:He?0===He.results.length?s.jsx(Ti,{type:"no-results",onReroll:o,onAddRoll:l,isSimulating:c,diceSets:t,selectedDiceSetIds:W,targetDiceSetType:C,onTargetDiceSetTypeChange:j}):s.jsx(wi,{diceSet:He,onSortConfigChange:u,onColumnWidthsChange:g,externalFilterSets:ae,externalCurrentFilterSetId:ie,onCurrentFilterSetIdChange:se}):s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center m-4 rounded-lg bg-gray-50 dark:bg-gray-800/50 border-2 border-dashed border-gray-300 dark:border-gray-600",onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:e=>{e.preventDefault();try{const t=JSON.parse(e.dataTransfer.getData("application/json"));"diceSet"===t.type&&t.id&&M&&M(t.id)}catch(t){}},children:[s.jsx(ct,{name:"table",className:"w-12 h-12 text-gray-300 dark:text-gray-600 mb-4"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:L("diceSets:guidance.dropToViewSheet","Drop a dice set here to view results")}),s.jsxs("div",{className:"relative mt-4 lg:hidden z-10",children:[s.jsx("button",{onClick:()=>U(!z),className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-600 text-white rounded-lg shadow hover:bg-accent-light-600 dark:hover:bg-accent-dark-500 transition-colors",children:L("diceSets:action.selectDiceSet")}),z&&s.jsx("div",{className:"absolute top-12 left-1/2 transform -translate-x-1/2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 z-50 max-h-60 overflow-y-auto",children:0===t.length?s.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:L("diceSets:message.noDiceSets")}):t.map(e=>s.jsx("button",{onClick:()=>{M&&M(e.id),U(!1)},className:"w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-200 border-b border-gray-100 dark:border-gray-700 last:border-0 truncate",children:e.name},e.id))})]})]})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-4 sticky top-1 md:top-[60px] z-[15]",children:s.jsx(Mn,{items:Ye,isDarkMode:O,onLegendClick:()=>pe(e=>e+1)})}),"4row1col"===ve?s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[xe.map((e,t)=>Ke(e,t)),xe.length<ot&&s.jsx("button",{onClick:Xe,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 hover:border-accent-light-400 dark:hover:border-accent-dark-400 hover:bg-gray-50 dark:hover:bg-gray-750 transition-all min-h-[200px] flex items-center justify-center group","aria-label":L("charts:widget.add"),children:s.jsx(ct,{name:"plus",className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-accent-light-500 dark:group-hover:text-accent-dark-400 transition-colors"})})]}):"2row2col"===ve?s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[xe.map((e,t)=>Ke(e,t)),xe.length<ot&&s.jsx("button",{onClick:Xe,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 hover:border-accent-light-400 dark:hover:border-accent-dark-400 hover:bg-gray-50 dark:hover:bg-gray-750 transition-all min-h-[200px] flex items-center justify-center group","aria-label":L("charts:widget.add"),children:s.jsx(ct,{name:"plus",className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-accent-light-500 dark:group-hover:text-accent-dark-400 transition-colors"})})]}):s.jsxs("div",{children:[s.jsx("div",{className:"mb-4",children:Ke(xe[0],0)}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[xe.slice(1).map((e,t)=>Ke(e,t+1)),xe.length<ot&&s.jsx("button",{onClick:Xe,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 hover:border-accent-light-400 dark:hover:border-accent-dark-400 hover:bg-gray-50 dark:hover:bg-gray-750 transition-all min-h-[200px] flex items-center justify-center group","aria-label":L("charts:widget.add"),children:s.jsx(ct,{name:"plus",className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-accent-light-500 dark:group-hover:text-accent-dark-400 transition-colors"})})]})]})]})})]}),s.jsx("div",{className:"hidden lg:block",children:s.jsx(Ba,{onReroll:o,onAddRoll:l,hasResults:!0,isSimulating:c,simulationProgress:d,variant:"floating",diceSets:t,selectedDiceSetIds:W,targetDiceSetType:C,onTargetDiceSetTypeChange:j})}),X&&f&&s.jsx(Xn,{mode:"create",initialSettings:{widgets:xe},compareDiceSetIds:r,currentDiceSetIds:N,diceSets:t,onSubmit:async(e,t)=>{await f(e,t),_(!1)},onClose:()=>_(!1)}),J.isOpen&&b&&J.settingsId&&s.jsx(Xn,{mode:"edit",initialSettings:J.initialSettings,initialName:J.initialName,compareDiceSetIds:r,currentDiceSetIds:N,diceSets:t,onSubmit:async(e,t)=>{try{t.widgets&&fe(t.widgets);const r={...t,name:e};await b(J.settingsId,r),K({isOpen:!1})}catch(r){throw r}},onClose:()=>K({isOpen:!1})},J.settingsId),s.jsx(zn,{isOpen:!!Se,onClose:()=>ke(null),widget:Se,diceSets:qe,chartSettings:h,currentChartSettingsId:m,onUpdateWidget:(e,t)=>{const r=xe.findIndex(t=>t.id===e);-1!==r&&_e(r,t)}}),Q&&He&&s.jsx(Gn,{isOpen:Q,onClose:async()=>{G(!1);const e=await $t();ne(e)},filterSets:ae,currentFilterSetId:ie||"",diceCount:He.results.length>0?He.results[0].diceValues.length:0,onCreateFilterSet:Je,onUpdateFilterSet:async e=>{await Wt(e);const t=await $t();ne(t)},onDeleteFilterSet:async e=>{await async function(e){return Mt.deleteTableFilterSet(e)}(e);const t=await $t();ne(t),ie===e&&se(t.length>0?t[0].id:null)},onReorderFilterSets:async e=>{await async function(e){return Mt.saveTableFilterSets(e)}(e);const t=await $t();ne(t)},onSelectFilterSet:se}),Z&&He&&s.jsx(Jn,{isOpen:!0,onClose:()=>ee(null),filterSet:Z,diceCount:He.results.length>0?He.results[0].diceValues.length:0,diceSets:t,currentDiceSetIds:T?[T]:[],onSave:async e=>{await Wt(e);const t=await $t();ne(t),ee(null)},mode:"edit"}),te&&He&&s.jsx(Jn,{isOpen:!0,onClose:()=>re(!1),filterSet:Bt(L("common:tableFilter.newFilterSet")),diceCount:He.results.length>0?He.results[0].diceValues.length:0,diceSets:t,currentDiceSetIds:T?[T]:[],onSave:async e=>{await Je(e),re(!1)},mode:"create"})]})},Ei=a.lazy(()=>D(()=>import("./index-E9JDBaEh.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.AboutPage}))),Ri=a.lazy(()=>D(()=>import("./index-E9JDBaEh.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.ChangelogModal})));function Ii(){const{t:e,i18n:t}=$e();a.useEffect(()=>{document.title=e("common:siteName")},[e,t.language]);const[r,n]=a.useState([]),[i,o]=a.useState(()=>{try{const e=localStorage.getItem("compareDiceSetIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}}),[l,c]=a.useState(null),[d,u]=a.useState(!1),[g,h]=a.useState(0),[m,p]=a.useState(()=>{const e=localStorage.getItem("mobileView");return"diceSets"===e||"results"===e?e:"results"}),[x,f]=a.useState(!0),[y,b]=a.useState(!1),[v,w]=a.useState(!1),[S,k]=a.useState("selected"),[C,j]=a.useState(()=>{try{const e=localStorage.getItem("widgetDiceSetIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}}),[D,N]=a.useState(()=>localStorage.getItem("activeSheetDiceSetId")),[A,T]=a.useState(()=>{const e=localStorage.getItem("resultSectionActiveTab");return"table"===e||"chart"===e?e:"chart"}),[M,E]=a.useState(Gt),R=a.useCallback(e=>{E(e),(e=>{try{localStorage.setItem(zt,JSON.stringify(e))}catch(Li){}})(e)},[]),{chartSettings:I,currentSettingsId:L,setCurrentSettingsId:O,createSettings:F,duplicateSettings:P,updateSettings:$,deleteSettings:W,renameSettings:V,importSettings:B,reorderSettings:H}=on(),[z,U]=a.useState({}),[q,Y]=a.useState({}),[X,_]=a.useState(void 0),[J,K]=a.useState({}),[Q,G]=a.useState({}),[Z,ee]=a.useState({}),[te,re]=a.useState(void 0),[ae,ne]=a.useState(()=>"undefined"!=typeof window&&window.innerWidth<1024),[ie,se]=a.useState(()=>{const e=localStorage.getItem("themeMode");if("light"===e||"dark"===e||"system"===e)return e;const t=localStorage.getItem("darkMode");if(t)try{const e=JSON.parse(t);if("boolean"==typeof e)return localStorage.removeItem("darkMode"),e?"dark":"light"}catch{}return"system"}),[oe,le]=a.useState(()=>!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches),ce="system"===ie?oe:"dark"===ie,[de,ue]=a.useState(()=>"true"===localStorage.getItem("transparentExport")),[ge,he]=a.useState(()=>"#about"===window.location.hash),[me,pe]=a.useState(()=>"#changelog"===window.location.hash),[xe,fe]=a.useState(!1);a.useEffect(()=>{if("undefined"!=typeof window&&window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{le(e.matches)};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[]),a.useEffect(()=>{ce?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},[ce]),a.useEffect(()=>{localStorage.setItem("themeMode",ie)},[ie]),a.useEffect(()=>{const e=()=>{ne(window.innerWidth<1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{const e=()=>{he("#about"===window.location.hash),pe("#changelog"===window.location.hash)};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[]),a.useEffect(()=>{ge?"#about"!==window.location.hash&&(window.location.hash="#about"):"#about"===window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search)},[ge]),a.useEffect(()=>{me?"#changelog"!==window.location.hash&&(window.location.hash="#changelog"):"#changelog"===window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search)},[me]);const ye=a.useCallback(()=>{se(e=>"system"===e?oe?"light":"dark":"light"===e?"dark":"light")},[oe]),be=a.useCallback(e=>{se(e)},[]),ve=a.useCallback(e=>{ue(e),localStorage.setItem("transparentExport",e.toString()),window.dispatchEvent(new Event("transparentExportChanged"))},[]);a.useEffect(()=>{U({})},[L]);const we=a.useMemo(()=>r.map(e=>e.id).sort().join(","),[r]),Se=a.useRef(void 0),ke=a.useRef(C);a.useEffect(()=>{ke.current=C},[C]),a.useEffect(()=>{if(0!==I.length&&Se.current!==L){const e=I.find(e=>e.id===L);if(e?.rememberSelectedDiceSet&&e.selectedDiceSetIds){const t=new Set(r.map(e=>e.id)),a=e.selectedDiceSetIds.filter(e=>t.has(e));if(a.length>0){const e=ke.current;(()=>{if(e.length!==a.length)return!0;const t=[...e].sort(),r=[...a].sort();return!1===t.every((e,t)=>e===r[t])})()&&(j(a),N(e=>e&&a.includes(e)?e:a[0]))}}Se.current=L}},[L,I,we]),a.useEffect(()=>{localStorage.setItem("compareDiceSetIds",JSON.stringify(i))},[i]),a.useEffect(()=>{localStorage.setItem("widgetDiceSetIds",JSON.stringify(C))},[C]),a.useEffect(()=>{D?localStorage.setItem("activeSheetDiceSetId",D):localStorage.removeItem("activeSheetDiceSetId")},[D]),a.useEffect(()=>{localStorage.setItem("mobileView",m)},[m]);const Ce=a.useMemo(()=>0===i.length?null:r.find(e=>e.id===i[0])||null,[r,i]),je=a.useMemo(()=>D&&r.find(e=>e.id===D)||null,[r,D]);a.useEffect(()=>{let t=!0;return(async()=>{try{await async function(){return Mt.migrateFromLocalStorage()}()&&c({type:"success",text:e("messages:success.migrated")});const r=await async function(){return Mt.loadDiceSets()}();let a=!1;const i=await Promise.all(r.map(async e=>{const t={targetValue:e.targetValue??1};return void 0===e.numericUid&&(t.numericUid=await Ft(),a=!0),{...e,...t}}));if(a&&await Rt(i),t){n(i);const e=(()=>{try{const e=localStorage.getItem("compareDiceSetIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}})(),t=e.filter(e=>i.some(t=>t.id===e));t.length>0&&JSON.stringify(t)!==JSON.stringify(e)?o(t):0===t.length&&i.length>0&&0===e.length&&o([i[0].id])}}catch(r){t&&c({type:"error",text:e("messages:error.loadFailed")})}finally{t&&f(!1)}})(),()=>{t=!1}},[e]);const De=a.useCallback(async t=>{if(r.length>=We)return void c({type:"error",text:e("messages:error.diceSetLimitReached",{max:We})});const a={id:gt(),numericUid:await Ft(),name:t?.name||e("common:unnamed"),diceConfig:t?.diceConfig||{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:t?.trialCount||1,results:[],targetValue:1,createdAt:ht(),updatedAt:ht()};try{await Et(a),n(e=>[...e,a]),o([a.id]),c({type:"success",text:e("messages:success.diceSetCreated")})}catch{c({type:"error",text:e("messages:error.diceSetCreateFailed")})}},[r.length,e]),Ne=a.useCallback(async t=>{try{await It(t),n(e=>e.filter(e=>e.id!==t)),o(e=>{const a=e.filter(e=>e!==t);if(0===a.length&&r.length>1){const e=r.find(e=>e.id!==t);return e?[e.id]:[]}return a}),c({type:"success",text:e("messages:success.diceSetDeleted")})}catch{c({type:"error",text:e("messages:error.diceSetDeleteFailed")})}},[r,e]),Ae=a.useCallback(async()=>{try{const t=r.map(e=>e.id);await Promise.all(t.map(e=>It(e))),n([]),o([]),c({type:"success",text:e("messages:success.bulkDeleted",{count:t.length})})}catch{c({type:"error",text:e("messages:error.bulkDeleteFailed")})}},[r,e]),Te=a.useCallback(async t=>{n(t);try{await Rt(t)}catch{c({type:"error",text:e("messages:error.diceSetUpdateFailed")})}},[e]),Me=a.useCallback(async t=>{if(r.length>=We)return void c({type:"error",text:e("messages:error.diceSetLimitReached",{max:We})});const a=r.find(e=>e.id===t);if(!a)return;const i={...a,id:gt(),numericUid:await Ft(),name:a.name,results:[],targetValue:a.targetValue??1,createdAt:ht(),updatedAt:ht()};try{await Et(i),n(e=>[...e,i]),c({type:"success",text:e("messages:success.diceSetDuplicated")})}catch{c({type:"error",text:e("messages:error.diceSetDuplicateFailed")})}},[r,e]),Ee=a.useCallback(async t=>{if(0===t.length)return;const a=e("diceSets:confirm.bulkDeleteWarning",{count:t.length});if(window.confirm(a))try{await Promise.all(t.map(e=>It(e))),n(e=>e.filter(e=>!t.includes(e.id))),o(e=>{const a=e.filter(e=>!t.includes(e));if(0===a.length&&r.length>t.length){const e=r.find(e=>!t.includes(e.id));return e?[e.id]:[]}return a}),c({type:"success",text:e("messages:success.bulkDeleted",{count:t.length})})}catch{c({type:"error",text:e("messages:error.bulkDeleteFailed")})}},[r,e]),Re=a.useCallback(async t=>{if(0===t.length)return;const a=We-r.length;if(t.length>a)c({type:"error",text:e("messages:error.bulkDuplicateLimitReached",{count:a})});else try{const a=[];for(const e of t){const t=r.find(t=>t.id===e);if(!t)continue;const n={...t,id:gt(),numericUid:await Ft(),name:t.name,results:[],targetValue:t.targetValue??1,createdAt:ht(),updatedAt:ht()};await Et(n),a.push(n)}n(e=>[...e,...a]),c({type:"success",text:e("messages:success.bulkDuplicated",{count:a.length})})}catch{c({type:"error",text:e("messages:error.bulkDuplicateFailed")})}},[r,e]),Ie=a.useCallback(async t=>{try{await Et(t),n(e=>e.map(e=>e.id===t.id?t:e))}catch{c({type:"error",text:e("messages:error.diceSetUpdateFailed")})}},[e]),Le=a.useCallback((t,a)=>{const i=r.find(e=>e.id===t);if(!i)return;const s={...i,...void 0!==a.name&&{name:a.name},...void 0!==a.diceConfig&&{diceConfig:a.diceConfig},...void 0!==a.trialCount&&{trialCount:a.trialCount},updatedAt:ht()};n(e=>e.map(e=>e.id===s.id?s:e)),Et(s).then(()=>{c({type:"success",text:e("messages:success.diceSetUpdated")})}).catch(t=>{c({type:"error",text:e("messages:error.diceSetUpdateFailed")})})},[r,e]),Oe=a.useCallback(async()=>{const t="selected"===S?r.filter(e=>{if("table"===A&&D&&(!ae||"results"===m))return e.id===D;return(C.length>0?C:i).includes(e.id)}):r.filter(e=>e.id===S);if(0===t.length)return!1;const a=[];for(const r of t){const t=Sr(r.diceConfig,r.trialCount);t.length>0&&a.push({diceSetName:r.name,errors:t.map(e=>e.message)}),r.trialCount>nt&&a.push({diceSetName:r.name,errors:[e("messages:error.trialCountExceeded",{max:nt.toLocaleString()})]})}if(a.length>0){const e=a.map(({diceSetName:e,errors:t})=>`${e}: ${t.join(", ")}`).join("\n");return c({type:"error",text:e}),!1}u(!0),h(0);try{const r=t.reduce((e,t)=>e+t.trialCount,0);let a=0;const i=[],o=[];for(const n of t)try{const e=await dt(n.diceConfig,n.trialCount,e=>{const t=n.trialCount*e/100;h((a+t)/r*100)}),t={...n,results:e,resultsConfig:{...n.diceConfig},hasMultipleDiceConfigs:!1,targetValue:n.targetValue,updatedAt:ht()};await Et(t),i.push(t),a+=n.trialCount}catch(s){const t=s instanceof Error?s.message:e("messages:error.generic");o.push(`${n.name}: ${t}`),a+=n.trialCount}return n(e=>e.map(e=>i.find(t=>t.id===e.id)||e)),o.length>0&&c({type:"warning",text:e("messages:error.partialSuccess",{completed:i.length,failed:o.length,errors:o.join("\n")})}),!0}catch(s){const t=s instanceof Error?s.message:e("messages:error.rollFailed");return c({type:"error",text:t}),!1}finally{u(!1),h(0)}},[r,i,S,e,C,A,D,ae,m]),Fe=a.useCallback(async()=>{const t="selected"===S?r.filter(e=>{if("table"===A&&D&&(!ae||"results"===m))return e.id===D;return(C.length>0?C:i).includes(e.id)}):r.filter(e=>e.id===S);if(0===t.length)return!1;const a=[];for(const r of t){const t=Sr(r.diceConfig,r.trialCount);t.length>0&&a.push({diceSetName:r.name,errors:t.map(e=>e.message)});r.results.length+r.trialCount>nt&&a.push({diceSetName:r.name,errors:[e("messages:error.maxRecordsExceeded",{max:nt.toLocaleString()})]})}if(a.length>0){const e=a.map(({diceSetName:e,errors:t})=>`${e}: ${t.join(", ")}`).join("\n");return c({type:"error",text:e}),!1}u(!0),h(0);try{const r=t.reduce((e,t)=>e+t.trialCount,0);let a=0;const i=[],o=[];for(const n of t)try{const e=await dt(n.diceConfig,n.trialCount,e=>{const t=n.trialCount*e/100;h((a+t)/r*100)}),t=n.results.length>0?n.results[n.results.length-1].trialNumber+1:1,s=e.map((e,r)=>({...e,trialNumber:t+r})),o=[...n.results,...s],l=n.resultsConfig&&!mt(n.resultsConfig,n.diceConfig),c={...n,results:o,resultsConfig:n.resultsConfig||{...n.diceConfig},hasMultipleDiceConfigs:n.hasMultipleDiceConfigs||l,updatedAt:ht()};await Et(c),i.push(c),a+=n.trialCount}catch(s){const t=s instanceof Error?s.message:e("messages:error.generic");o.push(`${n.name}: ${t}`),a+=n.trialCount}return n(e=>e.map(e=>i.find(t=>t.id===e.id)||e)),o.length>0&&c({type:"warning",text:e("messages:error.partialSuccess",{completed:i.length,failed:o.length,errors:o.join("\n")})}),!0}catch(s){const t=s instanceof Error?s.message:e("messages:error.rollFailed");return c({type:"error",text:t}),!1}finally{u(!1),h(0)}},[r,i,S,e,C,A,D,ae,m]),Pe=a.useCallback(async()=>{const t="selected"===S?r.filter(e=>{if("table"===A&&D&&(!ae||"results"===m))return e.id===D;return(C.length>0?C:i).includes(e.id)}):Ce?[Ce]:[];if(0===t.length)return;const a=[];for(const e of t){const t={...e,results:[],updatedAt:ht()};await Et(t),a.push(t)}n(e=>e.map(e=>a.find(t=>t.id===e.id)||e)),c({type:"info",text:e("messages:info.resetResults")})},[r,i,C,S,Ce,e,A,D,ae,m]),Ve=a.useCallback(e=>{re(e)},[]),He=a.useCallback(async t=>{if(t===Be)throw new Error(e("messages:error.cannotModifyDefault"));const r={};z.resultChart&&(r.resultChart=z.resultChart),z.individualDiceChart&&(r.individualDiceChart=z.individualDiceChart),z.rollProgressChart&&(r.rollProgressChart=z.rollProgressChart),q.resultChartType&&(r.resultChartType=q.resultChartType),q.individualDiceChartType&&(r.individualDiceChartType=q.individualDiceChartType),q.targetValueChartType&&(r.targetValueChartType=q.targetValueChartType),q.rollProgressChartType&&(r.rollProgressChartType=q.rollProgressChartType),q.cumulativeChartType&&(r.cumulativeChartType=q.cumulativeChartType),void 0!==X&&(r.rollProgressMovingAverageWindow=X),void 0!==J.distributionType&&(r.cumulativeDistributionType=J.distributionType),void 0!==J.showOnlyActualData&&(r.cumulativeShowOnlyActualData=J.showOnlyActualData),void 0!==J.quantileCount&&(r.cumulativeQuantileCount=J.quantileCount),Q.resultChartXScale&&(r.resultChartXScale=Q.resultChartXScale),Q.individualDiceChartXScale&&(r.individualDiceChartXScale=Q.individualDiceChartXScale),Q.rollProgressChartXScale&&(r.rollProgressChartXScale=Q.rollProgressChartXScale),Q.targetValueChartXScale&&(r.targetValueChartXScale=Q.targetValueChartXScale),Q.cumulativeChartXScale&&(r.cumulativeChartXScale=Q.cumulativeChartXScale),Z.resultChartYScale&&(r.resultChartYScale=Z.resultChartYScale),Z.individualDiceChartYScale&&(r.individualDiceChartYScale=Z.individualDiceChartYScale),Z.rollProgressChartYScale&&(r.rollProgressChartYScale=Z.rollProgressChartYScale),Z.targetValueChartYScale&&(r.targetValueChartYScale=Z.targetValueChartYScale),Z.cumulativeChartYScale&&(r.cumulativeChartYScale=Z.cumulativeChartYScale),void 0!==te&&(r.widgets=te);const a=I.find(e=>e.id===t);a?.rememberSelectedDiceSet&&(r.selectedDiceSetIds=C),Object.keys(r).length>0&&(await $(t,r),U({}),Y({}),_(void 0),K({}),G({}),ee({}),re(void 0),c({type:"success",text:e("messages:success.settingsSaved")}))},[z,q,X,J,Q,Z,te,$,e,I,C]),ze=a.useCallback(()=>{U({}),Y({}),_(void 0),K({}),G({}),ee({})},[]),Ue=a.useMemo(()=>Object.keys(z).length>0||Object.keys(q).length>0||void 0!==X||Object.keys(J).length>0||Object.keys(Q).length>0||Object.keys(Z).length>0||void 0!==te,[z,q,X,J,Q,Z,te]),qe=a.useCallback(e=>{if(!Ce)return;const t={...Ce,sortConfig:e,updatedAt:ht()};Ie(t)},[Ce,Ie]),Ye=a.useCallback((e,t)=>{const a=r.find(t=>t.id===e);if(!a)return;const n={...a,columnWidths:t,updatedAt:ht()};Ie(n)},[r,Ie]),Xe=a.useCallback(e=>{o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),_e=a.useCallback(e=>{o(e)},[]),Je=a.useCallback(t=>{try{!function(e){if(0===e.length)throw new Error("エクスポートするデータがありません");const t=e.map(({numericUid:e,...t})=>t),r=JSON.stringify(t,null,2),a=new Blob([r],{type:"application/json;charset=utf-8;"}),n=URL.createObjectURL(a),i=document.createElement("a");i.href=n;const s=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5);i.download=`dice-sim-dice-sets_${s}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}(t&&t.length>0?r.filter(e=>t.includes(e.id)):r),c({type:"success",text:e("messages:success.dataExported")})}catch(a){a instanceof Error?c({type:"error",text:a.message}):c({type:"error",text:e("messages:error.exportFailed")})}},[r,e]),Ke=a.useCallback(async t=>{try{const{diceSets:i,chartSettings:s}=await function(e){return new Promise((t,r)=>{const a=new FileReader;a.onload=e=>{try{const a=e.target?.result;let n=JSON.parse(a);if(n.sessions&&!n.diceSets&&(n={...n,diceSets:n.sessions},delete n.sessions),n.version&&n.diceSets&&n.chartSettings){if(!Array.isArray(n.diceSets))return void r(new Error("バックアップファイルの形式が正しくありません（diceSetsが配列である必要があります）"));if(!Array.isArray(n.chartSettings))return void r(new Error("バックアップファイルの形式が正しくありません（chartSettingsが配列である必要があります）"));if(n.diceSets.length>We)return void r(new Error("ダイスセットの数が上限（20件）を超えています。不正なデータの可能性があります。"));const e=n.diceSets.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const r=e;if(!r.id||"string"!=typeof r.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(void 0===r.name||null===r.name||"string"!=typeof r.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(r.name.length>it)throw new Error(`ダイスセット${t+1}: 名前が長すぎます（最大128文字）`);if(Ka(r.diceConfig,t),"number"!=typeof r.trialCount||r.trialCount<1||r.trialCount>at)throw new Error(`ダイスセット${t+1}: 試行回数が不正です`);if(!Array.isArray(r.results))throw new Error(`ダイスセット${t+1}: 結果が不正です`);if(!Ja(r.createdAt))throw new Error(`ダイスセット${t+1}: 作成日時が不正です`);if(!Ja(r.updatedAt))throw new Error(`ダイスセット${t+1}: 更新日時が不正です`);return{id:r.id,name:r.name,diceConfig:r.diceConfig,trialCount:r.trialCount,results:r.results,resultsConfig:r.resultsConfig,hasMultipleDiceConfigs:r.hasMultipleDiceConfigs||!1,aggregationSettings:r.aggregationSettings,targetValue:"number"==typeof r.targetValue?r.targetValue:1,resultsTargetValue:r.resultsTargetValue,createdAt:r.createdAt,updatedAt:r.updatedAt,sortOrder:r.sortOrder}}),a=n.chartSettings.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`ダッシュボード設定${t+1}: データが不正です`);const r=e;if(!r.id||"string"!=typeof r.id)throw new Error(`ダッシュボード設定${t+1}: IDが不正です`);if(!r.name||"string"!=typeof r.name)throw new Error(`ダッシュボード設定${t+1}: 名前が不正です`);if(r.name.length>it)throw new Error(`ダッシュボード設定${t+1}: 名前が長すぎます`);if(!Ja(r.createdAt))throw new Error(`ダッシュボード設定${t+1}: 作成日時が不正です`);if(!Ja(r.updatedAt))throw new Error(`ダッシュボード設定${t+1}: 更新日時が不正です`);return{id:r.id,name:r.name,resultChart:r.resultChart,individualDiceChart:r.individualDiceChart,rollProgressChart:r.rollProgressChart,resultChartType:r.resultChartType,individualDiceChartType:r.individualDiceChartType,targetValueChartType:r.targetValueChartType,rollProgressMovingAverageWindow:r.rollProgressMovingAverageWindow,cumulativeDistributionType:r.cumulativeDistributionType,cumulativeShowOnlyActualData:r.cumulativeShowOnlyActualData,cumulativeQuantileCount:r.cumulativeQuantileCount,createdAt:r.createdAt,updatedAt:r.updatedAt,sortOrder:r.sortOrder}});t({diceSets:e,chartSettings:a})}else if(Array.isArray(n)){const e=n.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const r=e;if(!r.id||"string"!=typeof r.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(void 0===r.name||null===r.name||"string"!=typeof r.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(r.name.length>it)throw new Error(`ダイスセット${t+1}: 名前が長すぎます`);if(Ka(r.diceConfig,t),"number"!=typeof r.trialCount||r.trialCount<1||r.trialCount>at)throw new Error(`ダイスセット${t+1}: 試行回数が不正です`);if(!Array.isArray(r.results))throw new Error(`ダイスセット${t+1}: 結果が不正です`);if(!Ja(r.createdAt))throw new Error(`ダイスセット${t+1}: 作成日時が不正です`);if(!Ja(r.updatedAt))throw new Error(`ダイスセット${t+1}: 更新日時が不正です`);return{id:r.id,name:r.name,diceConfig:r.diceConfig,trialCount:r.trialCount,results:r.results,resultsConfig:r.resultsConfig,hasMultipleDiceConfigs:r.hasMultipleDiceConfigs||!1,aggregationSettings:r.aggregationSettings,targetValue:"number"==typeof r.targetValue?r.targetValue:1,resultsTargetValue:r.resultsTargetValue,createdAt:r.createdAt,updatedAt:r.updatedAt,sortOrder:r.sortOrder}});t({diceSets:e,chartSettings:[]})}else r(new Error("ファイル形式が正しくありません"))}catch(a){a instanceof Error?r(a):r(new Error("ファイルのパースに失敗しました"))}},a.onerror=()=>{r(new Error("ファイルの読み込みに失敗しました"))},a.readAsText(e)})}(t);let o=0;if(i.length>0){const e=new Set(r.map(e=>e.id)),t=i.map(t=>e.has(t.id)?{...t,id:gt(),name:`${t.name}（インポート）`,createdAt:ht(),updatedAt:ht()}:t);for(const r of t)await Et(r);n(e=>[...e,...t]),o+=t.length}if(s.length>0){const e=new Set(I.map(e=>e.id));let t=0;for(const r of s)if(!e.has(r.id))try{await F(r.name,r),t++}catch(a){}t>0&&(o+=t)}if(0===o)return void c({type:"warning",text:e("messages:warning.noImportableData")});const l=[];i.length>0&&l.push(e("messages:import.diceSetsCount",{count:i.length})),s.length>0&&l.push(e("messages:import.chartSettingsCount",{count:s.length})),c({type:"success",text:e("messages:import.successWithDetails",{details:l.join(e("common:punctuation.comma"))})})}catch(i){i instanceof Error?c({type:"error",text:i.message}):c({type:"error",text:e("messages:error.importFailed")})}},[r,I,F,e]);return s.jsx(sr,{children:s.jsxs("div",{className:"min-h-screen flex flex-col bg-white dark:bg-gray-800",children:[x?s.jsx("div",{className:"w-100 lg:container lg:mx-auto mt-4 lg:mt-0 pt-0 lg:pt-20 flex-grow",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:e("common:label.loading")})})}):s.jsxs("div",{className:"w-full pt-4 lg:pt-0 flex-grow flex flex-col h-[calc(100vh-89px)] lg:h-[calc(100vh-3.5rem)] overflow-hidden",children:[s.jsx(Pa,{message:l,onClose:()=>c(null)}),s.jsxs("div",{className:"flex flex-col lg:flex-row flex-1 overflow-hidden",children:[s.jsx("div",{className:"hidden lg:block lg:w-80 lg:flex-shrink-0",children:s.jsx(ri,{diceSets:r,compareDiceSetIds:i,onToggleCompareDiceSet:Xe,onSetCompareDiceSetIds:_e,onCreateDiceSet:De,onDuplicateDiceSet:Me,onDeleteDiceSet:Ne,onDeleteAllDiceSets:Ae,onBulkDeleteDiceSets:Ee,onBulkDuplicateDiceSets:Re,onReorderDiceSets:Te,onExportDiceSets:Je,onImportDiceSets:Ke,onUpdateDiceSet:Le,activeResultTab:A,darkMode:ce,onToggleDarkMode:ye,onAboutClick:()=>he(!0),onChangelogClick:()=>pe(!0),themeMode:ie,onChangeThemeMode:be,transparentExport:de,onChangeTransparentExport:ve,chartHeightSettings:M,onChangeChartHeightSettings:R,diceSetsCount:r.length,chartSettingsCount:I.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-")).length,onItemDragStateChange:fe})}),s.jsx("div",{className:"flex-1 min-w-0 flex flex-col min-h-0 overflow-hidden",children:r.length>0?s.jsx(s.Fragment,{children:s.jsx("div",{className:("results"!==m?"hidden lg:block":"")+" flex-1 flex flex-col min-h-0",children:s.jsx(Mi,{diceSet:je,diceSets:r,compareDiceSetIds:i,onResetResults:Pe,onReroll:Oe,onAddRoll:Fe,isSimulating:d,simulationProgress:g,onSortConfigChange:qe,onColumnWidthsChange:Ye,selectedDiceSetIds:C,widgetDiceSetIds:C,onWidgetDiceSetIdsChange:j,activeSheetDiceSetId:D,onActiveSheetDiceSetIdChange:N,activeTab:A,onActiveTabChange:T,targetDiceSetType:S,onTargetDiceSetTypeChange:k,isExternalDragging:xe,chartHeightSettings:M,chartSettings:I,currentChartSettingsId:L,onSelectChartSettings:e=>{O(e),U({}),Y({}),_(void 0),K({}),G({}),ee({}),re(void 0)},onManageChartSettings:()=>{b(!0)},onCreateChartSettings:()=>{b(!0)},onCreateNewSettings:async(t,r)=>{if(r&&Object.keys(r).length>0){return void(await F(t,r)&&c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})}))}const a=I.find(e=>e.id===L),n={};a&&(n.resultChart=a.resultChart,n.individualDiceChart=a.individualDiceChart,n.rollProgressChart=a.rollProgressChart,n.resultChartType=a.resultChartType,n.individualDiceChartType=a.individualDiceChartType,n.targetValueChartType=a.targetValueChartType,n.rollProgressMovingAverageWindow=a.rollProgressMovingAverageWindow,n.cumulativeDistributionType=a.cumulativeDistributionType,n.cumulativeShowOnlyActualData=a.cumulativeShowOnlyActualData,n.cumulativeQuantileCount=a.cumulativeQuantileCount),z.resultChart&&(n.resultChart=z.resultChart),z.individualDiceChart&&(n.individualDiceChart=z.individualDiceChart),z.rollProgressChart&&(n.rollProgressChart=z.rollProgressChart),q.resultChartType&&(n.resultChartType=q.resultChartType),q.individualDiceChartType&&(n.individualDiceChartType=q.individualDiceChartType),q.targetValueChartType&&(n.targetValueChartType=q.targetValueChartType),void 0!==X&&(n.rollProgressMovingAverageWindow=X),void 0!==J.distributionType&&(n.cumulativeDistributionType=J.distributionType),void 0!==J.showOnlyActualData&&(n.cumulativeShowOnlyActualData=J.showOnlyActualData),void 0!==J.quantileCount&&(n.cumulativeQuantileCount=J.quantileCount);await F(t,Object.keys(n).length>0?n:void 0)&&(U({}),Y({}),_(void 0),K({}),re(void 0)),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})})},onSaveChartSettings:He,onUpdateChartSettings:async(t,r)=>{await $(t,r),c({type:"success",text:e("messages:success.settingsUpdated")})},hasPendingChanges:Ue,onWidgetsChange:Ve,onShowCompareModal:()=>w(!0)})})}):s.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-12 text-center transition-colors",children:[s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-lg mb-6",children:e("diceSets:selectOrCreatePrompt")}),ae&&s.jsxs("button",{onClick:()=>w(!0),className:"px-6 py-3 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors inline-flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),s.jsx("span",{children:e("diceSets:action.selectDiceSet")})]})]})})]})]}),s.jsx(Fa,{onReroll:async()=>{await Oe()&&p("results")},onAddRoll:async()=>{await Fe()&&p("results")},isSimulating:d,hasResults:(()=>{const e=C.length>0?C:i;return("selected"===S?r.filter(t=>e.includes(t.id)):r.filter(e=>e.id===S)).some(e=>e.results.length>0)})(),isAddRollDisabled:!1,diceSets:r,selectedDiceSetIds:C.length>0?C:i,targetDiceSetType:S,onTargetDiceSetTypeChange:k,onOpenDiceSetList:()=>w(!0),themeMode:ie,onChangeThemeMode:be,transparentExport:de,onChangeTransparentExport:ve,chartHeightSettings:M,onChangeChartHeightSettings:R,onExportData:Je,onImportData:Ke,diceSetsCount:r.length,chartSettingsCount:I.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-")).length,onAboutClick:()=>he(!0),onChangelogClick:()=>pe(!0)}),ge&&s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsx("div",{className:"text-white",children:"読み込み中..."})}),children:s.jsx(Ei,{onClose:()=>he(!1)})}),me&&s.jsx(a.Suspense,{fallback:s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsx("div",{className:"text-white",children:"読み込み中..."})}),children:s.jsx(Ri,{onClose:()=>pe(!1)})}),y&&s.jsx(Tn,{chartSettings:I,currentSettingsId:L,diceSets:r,compareDiceSetIds:i,currentDiceSetIds:C,onCreateSettings:async t=>{const r={};z.resultChart&&(r.resultChart=z.resultChart),z.individualDiceChart&&(r.individualDiceChart=z.individualDiceChart),q.resultChartType&&(r.resultChartType=q.resultChartType),q.individualDiceChartType&&(r.individualDiceChartType=q.individualDiceChartType),q.targetValueChartType&&(r.targetValueChartType=q.targetValueChartType);await F(t,Object.keys(r).length>0?r:void 0)&&(U({}),Y({})),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})})},onCreateSettingsWithConfig:async(t,r)=>{await F(t,r)&&(U({}),Y({}),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})}))},onDuplicateSettings:async(t,r)=>{const a=await P(t,r);a&&c({type:"success",text:e("messages:success.settingsDuplicatedWithName",{name:a.name})})},onDuplicateSettingsWithConfig:async(t,r,a)=>{const n=I.find(e=>e.id===t);if(!n)return;const i={...n,...a,name:r};await F(r,i)&&c({type:"success",text:e("messages:success.settingsDuplicatedWithName",{name:r})})},onImportSettings:async t=>{const r=await B(t);c({type:"success",text:e("messages:success.importedSettings",{count:r,defaultValue:"{{count}} items imported"})})},onRenameSettings:async(t,r)=>{await V(t,r),c({type:"success",text:e("messages:success.settingsRenamed")})},onUpdateSettings:async(t,r)=>{await $(t,r),c({type:"success",text:e("messages:success.settingsUpdated")})},onDeleteSettings:async t=>{await W(t),c({type:"success",text:e("messages:success.settingsDeleted")})},onClose:()=>{b(!1)},hasUnsavedChanges:Object.keys(z).length>0||Object.keys(q).length>0,onSaveToSettings:He,onDiscardChanges:ze,onReorderSettings:H}),v&&s.jsx(qn,{diceSets:r,selectedDiceSetIds:i,onToggleDiceSet:Xe,onApply:e=>{i.forEach(t=>{e.includes(t)||Xe(t)}),e.forEach(e=>{i.includes(e)||Xe(e)})},onClose:()=>w(!1),onDuplicateDiceSet:Me,onDeleteDiceSet:Ne,onBulkDeleteDiceSets:Ee,onBulkDuplicateDiceSets:Re,onUpdateDiceSet:Le,onReorderDiceSets:Te,onExportDiceSets:Je,onImportDiceSets:Ke,onCreateDiceSet:De,onDeleteAllDiceSets:Ae})]})})}C.createRoot(document.getElementById("root")).render(s.jsx(i.StrictMode,{children:s.jsx(Ii,{})}));export{zn as C,Un as D,ct as I,lr as M,bn as N,Xn as S,pr as T,cr as a,dr as b,ur as c,$n as d,Pt as e,Ea as f,qn as g,Gn as h,Jn as i,_t as s,$e as u};
