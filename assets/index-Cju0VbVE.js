const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CEiIUMOo.js","assets/chart-js-B92AkZbw.js","assets/vendor-CcyvE6mB.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,r)=>((t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r)(t,"symbol"!=typeof a?a+"":a,r);import{g as a,a as r,r as i,R as n,j as s,B as o,L as l,C as c,b as d,c as g,d as u,e as h,f as m,P as p,p as x,h as f,i as y,k as b,l as v}from"./chart-js-B92AkZbw.js";import{r as S}from"./vendor-CcyvE6mB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var w,k={};const C=a(function(){if(w)return k;w=1;var e=S();return k.createRoot=e.createRoot,k.hydrateRoot=e.hydrateRoot,k}()),j={},D=function(e,t,a){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=a?.nonce||a?.getAttribute("nonce");r=e(t.map(e=>{if((e=function(e){return"/dice/"+e}(e))in j)return;j[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,i&&r.setAttribute("nonce",i),document.head.appendChild(r),t?new Promise((t,a)=>{r.addEventListener("load",t),r.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},N=e=>"string"==typeof e,A=()=>{let e,t;const a=new Promise((a,r)=>{e=a,t=r});return a.resolve=e,a.reject=t,a},T=e=>null==e?"":""+e,M=/###/g,L=e=>e&&e.indexOf("###")>-1?e.replace(M,"."):e,R=e=>!e||N(e),E=(e,t,a)=>{const r=N(t)?t.split("."):t;let i=0;for(;i<r.length-1;){if(R(e))return{};const t=L(r[i]);!e[t]&&a&&(e[t]=new a),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++i}return R(e)?{}:{obj:e,k:L(r[i])}},I=(e,t,a)=>{const{obj:r,k:i}=E(e,t,Object);if(void 0!==r||1===t.length)return void(r[i]=a);let n=t[t.length-1],s=t.slice(0,t.length-1),o=E(e,s,Object);for(;void 0===o.obj&&s.length;)n=`${s[s.length-1]}.${n}`,s=s.slice(0,s.length-1),o=E(e,s,Object),o?.obj&&void 0!==o.obj[`${o.k}.${n}`]&&(o.obj=void 0);o.obj[`${o.k}.${n}`]=a},O=(e,t)=>{const{obj:a,k:r}=E(e,t);if(a&&Object.prototype.hasOwnProperty.call(a,r))return a[r]},$=(e,t,a)=>{for(const r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?N(e[r])||e[r]instanceof String||N(t[r])||t[r]instanceof String?a&&(e[r]=t[r]):$(e[r],t[r],a):e[r]=t[r]);return e},P=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const W=e=>N(e)?e.replace(/[&<>"'\/]/g,e=>F[e]):e;const V=[" ",",","?","!",";"],B=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const a=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,a),this.regExpQueue.push(e),a}}(20),U=(e,t,a=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const r=t.split(a);let i=e;for(let n=0;n<r.length;){if(!i||"object"!=typeof i)return;let e,t="";for(let s=n;s<r.length;++s)if(s!==n&&(t+=a),t+=r[s],e=i[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&s<r.length-1)continue;n+=s-n+1;break}i=e}return i},H=e=>e?.replace("_","-"),z={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){}};class q{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||z,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,a,r){return r&&!this.debug?null:(N(e[0])&&(e[0]=`${a}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new q(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new q(this.logger,e)}}var Y=new q;class X{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const a=this.observers[e].get(t)||0;this.observers[e].set(t,a+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){if(this.observers[e]){Array.from(this.observers[e].entries()).forEach(([e,a])=>{for(let r=0;r<a;r++)e(...t)})}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach(([a,r])=>{for(let i=0;i<r;i++)a.apply(a,[e,...t])})}}}class _ extends X{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,a,r={}){const i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,n=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let s;e.indexOf(".")>-1?s=e.split("."):(s=[e,t],a&&(Array.isArray(a)?s.push(...a):N(a)&&i?s.push(...a.split(i)):s.push(a)));const o=O(this.data,s);return!o&&!t&&!a&&e.indexOf(".")>-1&&(e=s[0],t=s[1],a=s.slice(2).join(".")),!o&&n&&N(a)?U(this.data?.[e]?.[t],a,i):o}addResource(e,t,a,r,i={silent:!1}){const n=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let s=[e,t];a&&(s=s.concat(n?a.split(n):a)),e.indexOf(".")>-1&&(s=e.split("."),r=t,t=s[1]),this.addNamespaces(t),I(this.data,s,r),i.silent||this.emit("added",e,t,a,r)}addResources(e,t,a,r={silent:!1}){for(const i in a)(N(a[i])||Array.isArray(a[i]))&&this.addResource(e,t,i,a[i],{silent:!0});r.silent||this.emit("added",e,t,a)}addResourceBundle(e,t,a,r,i,n={silent:!1,skipCopy:!1}){let s=[e,t];e.indexOf(".")>-1&&(s=e.split("."),r=a,a=t,t=s[1]),this.addNamespaces(t);let o=O(this.data,s)||{};n.skipCopy||(a=JSON.parse(JSON.stringify(a))),r?$(o,a,i):o={...o,...a},I(this.data,s,o),n.silent||this.emit("added",e,t,a)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var J={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,a,r,i){return e.forEach(e=>{t=this.processors[e]?.process(t,a,r,i)??t}),t}};const K=Symbol("i18next/PATH_KEY");function Q(e,t){const{[K]:a}=e(function(){const e=[],t=Object.create(null);let a;return t.get=(r,i)=>(a?.revoke?.(),i===K?e:(e.push(i),a=Proxy.revocable(r,t),a.proxy)),Proxy.revocable(Object.create(null),t).proxy}());return a.join(t?.keySeparator??".")}const G={},Z=e=>!N(e)&&"boolean"!=typeof e&&"number"!=typeof e;class ee extends X{constructor(e,t={}){var a,r;super(),a=e,r=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{a[e]&&(r[e]=a[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=Y.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const a={...t};if(null==e)return!1;const r=this.resolve(e,a);if(void 0===r?.res)return!1;const i=Z(r.res);return!1!==a.returnObjects||!i}extractFromKey(e,t){let a=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===a&&(a=":");const r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const n=a&&e.indexOf(a)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,a)=>{t=t||"",a=a||"";const r=V.filter(e=>t.indexOf(e)<0&&a.indexOf(e)<0);if(0===r.length)return!0;const i=B.getRegExp(`(${r.map(e=>"?"===e?"\\?":e).join("|")})`);let n=!i.test(e);if(!n){const t=e.indexOf(a);t>0&&!i.test(e.substring(0,t))&&(n=!0)}return n})(e,a,r));if(n&&!s){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:N(i)?[i]:i};const n=e.split(a);(a!==r||a===r&&this.options.ns.indexOf(n[0])>-1)&&(i=n.shift()),e=n.join(r)}return{key:e,namespaces:N(i)?[i]:i}}translate(e,t,a){let r="object"==typeof t?{...t}:t;if("object"!=typeof r&&this.options.overloadTranslationOptionHandler&&(r=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof r&&(r={...r}),r||(r={}),null==e)return"";"function"==typeof e&&(e=Q(e,{...this.options,...r})),Array.isArray(e)||(e=[String(e)]);const i=void 0!==r.returnDetails?r.returnDetails:this.options.returnDetails,n=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,{key:s,namespaces:o}=this.extractFromKey(e[e.length-1],r),l=o[o.length-1];let c=void 0!==r.nsSeparator?r.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");const d=r.lng||this.language,g=r.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===d?.toLowerCase())return g?i?{res:`${l}${c}${s}`,usedKey:s,exactUsedKey:s,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(r)}:`${l}${c}${s}`:i?{res:s,usedKey:s,exactUsedKey:s,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(r)}:s;const u=this.resolve(e,r);let h=u?.res;const m=u?.usedKey||s,p=u?.exactUsedKey||s,x=void 0!==r.joinArrays?r.joinArrays:this.options.joinArrays,f=!this.i18nFormat||this.i18nFormat.handleAsObject,y=void 0!==r.count&&!N(r.count),b=ee.hasDefaultValue(r),v=y?this.pluralResolver.getSuffix(d,r.count,r):"",S=r.ordinal&&y?this.pluralResolver.getSuffix(d,r.count,{ordinal:!1}):"",w=y&&!r.ordinal&&0===r.count,k=w&&r[`defaultValue${this.options.pluralSeparator}zero`]||r[`defaultValue${v}`]||r[`defaultValue${S}`]||r.defaultValue;let C=h;f&&!h&&b&&(C=k);const j=Z(C),D=Object.prototype.toString.apply(C);if(!(f&&C&&j&&["[object Number]","[object Function]","[object RegExp]"].indexOf(D)<0)||N(x)&&Array.isArray(C))if(f&&N(x)&&Array.isArray(h))h=h.join(x),h&&(h=this.extendTranslation(h,e,r,a));else{let t=!1,i=!1;!this.isValidLookup(h)&&b&&(t=!0,h=k),this.isValidLookup(h)||(i=!0,h=s);const o=(r.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&i?void 0:h,g=b&&k!==h&&this.options.updateMissing;if(i||t||g){if(this.logger.log(g?"updateKey":"missingKey",d,l,s,g?k:h),n){const e=this.resolve(s,{...r,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,r.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let r=0;r<t.length;r++)e.push(t[r]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(r.lng||this.language):e.push(r.lng||this.language);const a=(e,t,a)=>{const i=b&&a!==h?a:o;this.options.missingKeyHandler?this.options.missingKeyHandler(e,l,t,i,g,r):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,l,t,i,g,r),this.emit("missingKey",e,l,t,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&y?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,r);w&&r[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{a([e],s+t,r[`defaultValue${t}`]||k)})}):a(e,s,k))}h=this.extendTranslation(h,e,r,u,a),i&&h===s&&this.options.appendNamespaceToMissingKey&&(h=`${l}${c}${s}`),(i||t)&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${s}`:s,t?h:void 0,r))}else{if(!r.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,C,{...r,ns:o}):`key '${s} (${this.language})' returned an object instead of string.`;return i?(u.res=e,u.usedParams=this.getUsedParamsDetails(r),u):e}if(n){const e=Array.isArray(C),t=e?[]:{},a=e?p:m;for(const i in C)if(Object.prototype.hasOwnProperty.call(C,i)){const e=`${a}${n}${i}`;t[i]=b&&!h?this.translate(e,{...r,defaultValue:Z(k)?k[i]:void 0,joinArrays:!1,ns:o}):this.translate(e,{...r,joinArrays:!1,ns:o}),t[i]===e&&(t[i]=C[i])}h=t}}return i?(u.res=h,u.usedParams=this.getUsedParamsDetails(r),u):h}extendTranslation(e,t,a,r,i){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...a},a.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!a.skipInterpolation){a.interpolation&&this.interpolator.init({...a,interpolation:{...this.options.interpolation,...a.interpolation}});const n=N(e)&&(void 0!==a?.interpolation?.skipOnVariables?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let s;if(n){const t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let o=a.replace&&!N(a.replace)?a.replace:a;if(this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),e=this.interpolator.interpolate(e,o,a.lng||this.language||r.usedLng,a),n){const t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(a.nest=!1)}!a.lng&&r&&r.res&&(a.lng=this.language||r.usedLng),!1!==a.nest&&(e=this.interpolator.nest(e,(...e)=>i?.[0]!==e[0]||a.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),a)),a.interpolation&&this.interpolator.reset()}const n=a.postProcess||this.options.postProcess,s=N(n)?[n]:n;return null!=e&&s?.length&&!1!==a.applyPostProcessor&&(e=J.handle(s,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(a)},...a}:a,this)),e}resolve(e,t={}){let a,r,i,n,s;return N(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(a))return;const o=this.extractFromKey(e,t),l=o.key;r=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==t.count&&!N(t.count),g=d&&!t.ordinal&&0===t.count,u=void 0!==t.context&&(N(t.context)||"number"==typeof t.context)&&""!==t.context,h=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(e=>{this.isValidLookup(a)||(s=e,G[`${h[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(s)||(G[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${r}" for languages "${h.join(", ")}" won't get resolved as namespace "${s}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(r=>{if(this.isValidLookup(a))return;n=r;const s=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(s,l,r,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(r,t.count,t));const a=`${this.options.pluralSeparator}zero`,i=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(t.ordinal&&0===e.indexOf(i)&&s.push(l+e.replace(i,this.options.pluralSeparator)),s.push(l+e),g&&s.push(l+a)),u){const r=`${l}${this.options.contextSeparator||"_"}${t.context}`;s.push(r),d&&(t.ordinal&&0===e.indexOf(i)&&s.push(r+e.replace(i,this.options.pluralSeparator)),s.push(r+e),g&&s.push(r+a))}}let o;for(;o=s.pop();)this.isValidLookup(a)||(i=o,a=this.getResource(r,e,o,t))}))})}),{res:a,usedKey:r,exactUsedKey:i,usedLng:n,usedNS:s}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,a,r={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,a,r):this.resourceStore.getResource(e,t,a,r)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],a=e.replace&&!N(e.replace);let r=a?e.replace:e;if(a&&void 0!==e.count&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!a){r={...r};for(const e of t)delete r[e]}return r}static hasDefaultValue(e){const t="defaultValue";for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&t===a.substring(0,12)&&void 0!==e[a])return!0;return!1}}class te{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Y.create("languageUtils")}getScriptPartFromCode(e){if(!(e=H(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=H(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(N(e)&&e.indexOf("-")>-1){let a;try{a=Intl.getCanonicalLocales(e)[0]}catch(t){}return a&&this.options.lowerCaseLng&&(a=a.toLowerCase()),a||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const a=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(a)||(t=a)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const a=this.getScriptPartFromCode(e);if(this.isSupportedCode(a))return t=a;const r=this.getLanguagePartFromCode(e);if(this.isSupportedCode(r))return t=r;t=this.options.supportedLngs.find(e=>e===r?e:e.indexOf("-")<0&&r.indexOf("-")<0?void 0:e.indexOf("-")>0&&r.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===r||0===e.indexOf(r)&&r.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),N(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let a=e[t];return a||(a=e[this.getScriptPartFromCode(t)]),a||(a=e[this.formatLanguageCode(t)]),a||(a=e[this.getLanguagePartFromCode(t)]),a||(a=e.default),a||[]}toResolveHierarchy(e,t){const a=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),r=[],i=e=>{e&&(this.isSupportedCode(e)?r.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return N(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):N(e)&&i(this.formatLanguageCode(e)),a.forEach(e=>{r.indexOf(e)<0&&i(this.formatLanguageCode(e))}),r}}const ae={zero:0,one:1,two:2,few:3,many:4,other:5},re={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class ie{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=Y.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const a=H("dev"===e?"en":e),r=t.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:a,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let n;try{n=new Intl.PluralRules(a,{type:r})}catch(s){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),re;if(!e.match(/-|_/))return re;const a=this.languageUtils.getLanguagePartFromCode(e);n=this.getRule(a,t)}return this.pluralRulesCache[i]=n,n}needsPlural(e,t={}){let a=this.getRule(e,t);return a||(a=this.getRule("dev",t)),a?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,a={}){return this.getSuffixes(e,a).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let a=this.getRule(e,t);return a||(a=this.getRule("dev",t)),a?a.resolvedOptions().pluralCategories.sort((e,t)=>ae[e]-ae[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,a={}){const r=this.getRule(e,a);return r?`${this.options.prepend}${a.ordinal?`ordinal${this.options.prepend}`:""}${r.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,a))}}const ne=(e,t,a,r=".",i=!0)=>{let n=((e,t,a)=>{const r=O(e,a);return void 0!==r?r:O(t,a)})(e,t,a);return!n&&i&&N(a)&&(n=U(e,a,r),void 0===n&&(n=U(t,a,r))),n},se=e=>e.replace(/\$/g,"$$$$");class oe{constructor(e={}){this.logger=Y.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:a,useRawValueToEscape:r,prefix:i,prefixEscaped:n,suffix:s,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:g,nestingPrefixEscaped:u,nestingSuffix:h,nestingSuffixEscaped:m,nestingOptionsSeparator:p,maxReplaces:x,alwaysFormat:f}=e.interpolation;this.escape=void 0!==t?t:W,this.escapeValue=void 0===a||a,this.useRawValueToEscape=void 0!==r&&r,this.prefix=i?P(i):n||"{{",this.suffix=s?P(s):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=g?P(g):u||P("$t("),this.nestingSuffix=h?P(h):m||P(")"),this.nestingOptionsSeparator=p||",",this.maxReplaces=x||1e3,this.alwaysFormat=void 0!==f&&f,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,a,r){let i,n,s;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(e.indexOf(this.formatSeparator)<0){const i=ne(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,a,{...r,...t,interpolationkey:e}):i}const i=e.split(this.formatSeparator),n=i.shift().trim(),s=i.join(this.formatSeparator).trim();return this.format(ne(t,o,n,this.options.keySeparator,this.options.ignoreJSONStructure),s,a,{...r,...t,interpolationkey:n})};this.resetRegExp();const c=r?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=void 0!==r?.interpolation?.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>se(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?se(this.escape(e)):se(e)}].forEach(t=>{for(s=0;i=t.regex.exec(e);){const a=i[1].trim();if(n=l(a),void 0===n)if("function"==typeof c){const t=c(e,i,r);n=N(t)?t:""}else if(r&&Object.prototype.hasOwnProperty.call(r,a))n="";else{if(d){n=i[0];continue}this.logger.warn(`missed to pass in variable ${a} for interpolating ${e}`),n=""}else N(n)||this.useRawValueToEscape||(n=T(n));const o=t.safeValue(n);if(e=e.replace(i[0],o),d?(t.regex.lastIndex+=n.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,s++,s>=this.maxReplaces)break}}),e}nest(e,t,a={}){let r,i,n;const s=(e,t)=>{const a=this.nestingOptionsSeparator;if(e.indexOf(a)<0)return e;const r=e.split(new RegExp(`${a}[ ]*{`));let i=`{${r[1]}`;e=r[0],i=this.interpolate(i,n);const s=i.match(/'/g),o=i.match(/"/g);((s?.length??0)%2==0&&!o||o.length%2!=0)&&(i=i.replace(/'/g,'"'));try{n=JSON.parse(i),t&&(n={...t,...n})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${a}${i}`}return n.defaultValue&&n.defaultValue.indexOf(this.prefix)>-1&&delete n.defaultValue,e};for(;r=this.nestingRegexp.exec(e);){let o=[];n={...a},n=n.replace&&!N(n.replace)?n.replace:n,n.applyPostProcessor=!1,delete n.defaultValue;const l=/{.*}/.test(r[1])?r[1].lastIndexOf("}")+1:r[1].indexOf(this.formatSeparator);if(-1!==l&&(o=r[1].slice(l).split(this.formatSeparator).map(e=>e.trim()).filter(Boolean),r[1]=r[1].slice(0,l)),i=t(s.call(this,r[1].trim(),n),n),i&&r[0]===e&&!N(i))return i;N(i)||(i=T(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),o.length&&(i=o.reduce((e,t)=>this.format(e,t,a.lng,{...a,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const le=e=>{const t={};return(a,r,i)=>{let n=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(n={...n,[i.interpolationkey]:void 0});const s=r+JSON.stringify(n);let o=t[s];return o||(o=e(H(r),i),t[s]=o),o(a)}},ce=e=>(t,a,r)=>e(H(a),r)(t);class de{constructor(e={}){this.logger=Y.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const a=t.cacheInBuiltFormats?le:ce;this.formats={number:a((e,t)=>{const a=new Intl.NumberFormat(e,{...t});return e=>a.format(e)}),currency:a((e,t)=>{const a=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>a.format(e)}),datetime:a((e,t)=>{const a=new Intl.DateTimeFormat(e,{...t});return e=>a.format(e)}),relativetime:a((e,t)=>{const a=new Intl.RelativeTimeFormat(e,{...t});return e=>a.format(e,t.range||"day")}),list:a((e,t)=>{const a=new Intl.ListFormat(e,{...t});return e=>a.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=le(t)}format(e,t,a,r={}){const i=t.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(e=>e.indexOf(")")>-1)){const e=i.findIndex(e=>e.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,e)].join(this.formatSeparator)}return i.reduce((e,t)=>{const{formatName:i,formatOptions:n}=(e=>{let t=e.toLowerCase().trim();const a={};if(e.indexOf("(")>-1){const r=e.split("(");t=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);"currency"===t&&i.indexOf(":")<0?a.currency||(a.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?a.range||(a.range=i.trim()):i.split(";").forEach(e=>{if(e){const[t,...r]=e.split(":"),i=r.join(":").trim().replace(/^'+|'+$/g,""),n=t.trim();a[n]||(a[n]=i),"false"===i&&(a[n]=!1),"true"===i&&(a[n]=!0),isNaN(i)||(a[n]=parseInt(i,10))}})}return{formatName:t,formatOptions:a}})(t);if(this.formats[i]){let t=e;try{const s=r?.formatParams?.[r.interpolationkey]||{},o=s.locale||s.lng||r.locale||r.lng||a;t=this.formats[i](e,o,{...n,...r,...s})}catch(s){this.logger.warn(s)}return t}return this.logger.warn(`there was no format function for ${i}`),e},e)}}class ge extends X{constructor(e,t,a,r={}){super(),this.backend=e,this.store=t,this.services=a,this.languageUtils=a.languageUtils,this.options=r,this.logger=Y.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(a,r.backend,r)}queueLoad(e,t,a,r){const i={},n={},s={},o={};return e.forEach(e=>{let r=!0;t.forEach(t=>{const s=`${e}|${t}`;!a.reload&&this.store.hasResourceBundle(e,t)?this.state[s]=2:this.state[s]<0||(1===this.state[s]?void 0===n[s]&&(n[s]=!0):(this.state[s]=1,r=!1,void 0===n[s]&&(n[s]=!0),void 0===i[s]&&(i[s]=!0),void 0===o[t]&&(o[t]=!0)))}),r||(s[e]=!0)}),(Object.keys(i).length||Object.keys(n).length)&&this.queue.push({pending:n,pendingCount:Object.keys(n).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(n),toLoadLanguages:Object.keys(s),toLoadNamespaces:Object.keys(o)}}loaded(e,t,a){const r=e.split("|"),i=r[0],n=r[1];t&&this.emit("failedLoading",i,n,t),!t&&a&&this.store.addResourceBundle(i,n,a,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&a&&(this.state[e]=0);const s={};this.queue.forEach(a=>{((e,t,a)=>{const{obj:r,k:i}=E(e,t,Object);r[i]=r[i]||[],r[i].push(a)})(a.loaded,[i],n),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(a,e),t&&a.errors.push(t),0!==a.pendingCount||a.done||(Object.keys(a.loaded).forEach(e=>{s[e]||(s[e]={});const t=a.loaded[e];t.length&&t.forEach(t=>{void 0===s[e][t]&&(s[e][t]=!0)})}),a.done=!0,a.errors.length?a.callback(a.errors):a.callback())}),this.emit("loaded",s),this.queue=this.queue.filter(e=>!e.done)}read(e,t,a,r=0,i=this.retryTimeout,n){if(!e.length)return n(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:a,tried:r,wait:i,callback:n});this.readingCalls++;const s=(s,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}s&&o&&r<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,a,r+1,2*i,n)},i):n(s,o)},o=this.backend[a].bind(this.backend);if(2!==o.length)return o(e,t,s);try{const a=o(e,t);a&&"function"==typeof a.then?a.then(e=>s(null,e)).catch(s):s(null,a)}catch(l){s(l)}}prepareLoading(e,t,a={},r){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();N(e)&&(e=this.languageUtils.toResolveHierarchy(e)),N(t)&&(t=[t]);const i=this.queueLoad(e,t,a,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,a){this.prepareLoading(e,t,{},a)}reload(e,t,a){this.prepareLoading(e,t,{reload:!0},a)}loadOne(e,t=""){const a=e.split("|"),r=a[0],i=a[1];this.read(r,i,"read",void 0,void 0,(a,n)=>{a&&this.logger.warn(`${t}loading namespace ${i} for language ${r} failed`,a),!a&&n&&this.logger.log(`${t}loaded namespace ${i} for language ${r}`,n),this.loaded(e,a,n)})}saveMissing(e,t,a,r,i,n={},s=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=a&&""!==a){if(this.backend?.create){const l={...n,isUpdate:i},c=this.backend.create.bind(this.backend);if(c.length<6)try{let i;i=5===c.length?c(e,t,a,r,l):c(e,t,a,r),i&&"function"==typeof i.then?i.then(e=>s(null,e)).catch(s):s(null,i)}catch(o){s(o)}else c(e,t,a,r,s,l)}e&&e[0]&&this.store.addResource(e[0],t,a,r)}}else this.logger.warn(`did not save key "${a}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const ue=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),N(e[1])&&(t.defaultValue=e[1]),N(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const a=e[3]||e[2];Object.keys(a).forEach(e=>{t[e]=a[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),he=e=>(N(e.ns)&&(e.ns=[e.ns]),N(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),N(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),me=()=>{};class pe extends X{constructor(e={},t){var a;if(super(),this.options=he(e),this.services={},this.logger=Y,this.modules={external:[]},a=this,Object.getOwnPropertyNames(Object.getPrototypeOf(a)).forEach(e=>{"function"==typeof a[e]&&(a[e]=a[e].bind(a))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(N(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const a=ue();this.options={...a,...this.options,...he(e)},this.options.interpolation={...a.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator),"function"!=typeof this.options.overloadTranslationOptionHandler&&(this.options.overloadTranslationOptionHandler=a.overloadTranslationOptionHandler);const r=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?Y.init(r(this.modules.logger),this.options):Y.init(null,this.options),e=this.modules.formatter?this.modules.formatter:de;const t=new te(this.options);this.store=new _(this.options.resources,this.options);const i=this.services;i.logger=Y,i.resourceStore=this.store,i.languageUtils=t,i.pluralResolver=new ie(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix});this.options.interpolation.format&&this.options.interpolation.format!==a.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),!e||this.options.interpolation.format&&this.options.interpolation.format!==a.interpolation.format||(i.formatter=r(e),i.formatter.init&&i.formatter.init(i,this.options),this.options.interpolation.format=i.formatter.format.bind(i.formatter)),i.interpolator=new oe(this.options),i.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},i.backendConnector=new ge(r(this.modules.backend),i.resourceStore,i,this.options),i.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(i.languageDetector=r(this.modules.languageDetector),i.languageDetector.init&&i.languageDetector.init(i,this.options.detection,this.options)),this.modules.i18nFormat&&(i.i18nFormat=r(this.modules.i18nFormat),i.i18nFormat.init&&i.i18nFormat.init(this)),this.translator=new ee(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=me),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const i=A(),n=()=>{const e=(e,a)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(a),t(e,a)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?n():setTimeout(n,0),i}loadResources(e,t=me){let a=t;const r=N(e)?e:this.language;if("function"==typeof e&&(a=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===r?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return a();const e=[],t=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};if(r)t(r);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e))}this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),a(e)})}else a(null)}reloadResources(e,t,a){const r=A();return"function"==typeof e&&(a=e,e=void 0),"function"==typeof t&&(a=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),a||(a=me),this.services.backendConnector.reload(e,t,e=>{r.resolve(),a(e)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&J.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const a=A();this.emit("languageChanging",e);const r=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},i=(i,n)=>{n?this.isLanguageChangingTo===e&&(r(n),this.translator.changeLanguage(n),this.isLanguageChangingTo=void 0,this.emit("languageChanged",n),this.logger.log("languageChanged",n)):this.isLanguageChangingTo=void 0,a.resolve((...e)=>this.t(...e)),t&&t(i,(...e)=>this.t(...e))},n=t=>{e||t||!this.services.languageDetector||(t=[]);const a=N(t)?t:t&&t[0],n=this.store.hasLanguageSomeTranslations(a)?a:this.services.languageUtils.getBestMatchFromCodes(N(t)?[t]:t);n&&(this.language||r(n),this.translator.language||this.translator.changeLanguage(n),this.services.languageDetector?.cacheUserLanguage?.(n)),this.loadResources(n,e=>{i(e,n)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(n):this.services.languageDetector.detect(n):n(e):n(this.services.languageDetector.detect()),a}getFixedT(e,t,a){const r=(e,t,...i)=>{let n;n="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(i)):{...t},n.lng=n.lng||r.lng,n.lngs=n.lngs||r.lngs,n.ns=n.ns||r.ns,""!==n.keyPrefix&&(n.keyPrefix=n.keyPrefix||a||r.keyPrefix);const s=this.options.keySeparator||".";let o;return n.keyPrefix&&Array.isArray(e)?o=e.map(e=>("function"==typeof e&&(e=Q(e,{...this.options,...t})),`${n.keyPrefix}${s}${e}`)):("function"==typeof e&&(e=Q(e,{...this.options,...t})),o=n.keyPrefix?`${n.keyPrefix}${s}${e}`:e),this.t(o,n)};return N(e)?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=a,r}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const a=t.lng||this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===a.toLowerCase())return!0;const n=(e,t)=>{const a=this.services.backendConnector.state[`${e}|${t}`];return-1===a||0===a||2===a};if(t.precheck){const e=t.precheck(this,n);if(void 0!==e)return e}return!!this.hasResourceBundle(a,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!n(a,e)||r&&!n(i,e)))}loadNamespaces(e,t){const a=A();return this.options.ns?(N(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{a.resolve(),t&&t(e)}),a):(t&&t(),Promise.resolve())}loadLanguages(e,t){const a=A();N(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(e=>r.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return i.length?(this.options.preload=r.concat(i),this.loadResources(e=>{a.resolve(),t&&t(e)}),a):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const t=new Intl.Locale(e);if(t&&t.getTextInfo){const e=t.getTextInfo();if(e&&e.direction)return e.direction}}catch(a){}const t=this.services?.languageUtils||new te(ue());return e.toLowerCase().indexOf("-latn")>1?"ltr":["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const a=new pe(e,t);return a.createInstance=pe.createInstance,a}cloneInstance(e={},t=me){const a=e.forkResourceStore;a&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new pe(r);void 0===e.debug&&void 0===e.prefix||(i.logger=i.logger.clone(e));if(["store","services","language"].forEach(e=>{i[e]=this[e]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},a){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((a,r)=>(a[r]={...e[t][r]},a),e[t]),e),{});i.store=new _(e,r),i.services.resourceStore=i.store}return e.interpolation&&(i.services.interpolator=new oe(r)),i.translator=new ee(i.services,r),i.translator.on("*",(e,...t)=>{i.emit(e,...t)}),i.init(r,t),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const xe=pe.createInstance();xe.createInstance,xe.dir,xe.init,xe.loadResources,xe.reloadResources,xe.use,xe.changeLanguage,xe.getFixedT,xe.t,xe.exists,xe.setDefaultNamespace,xe.hasLoadedNamespace,xe.loadNamespaces,xe.loadLanguages;const fe={},ye=(e,t,a,r)=>{we(a)&&fe[a]||(we(a)&&(fe[a]=new Date),((e,t,a,r)=>{const i=[a,{code:t,...r||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(i,"warn","react-i18next::",!0);we(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...i):console})(e,t,a,r))},be=(e,t)=>()=>{if(e.isInitialized)t();else{const a=()=>{setTimeout(()=>{e.off("initialized",a)},0),t()};e.on("initialized",a)}},ve=(e,t,a)=>{e.loadNamespaces(t,be(e,a))},Se=(e,t,a,r)=>{if(we(a)&&(a=[a]),e.options.preload&&e.options.preload.indexOf(t)>-1)return ve(e,a,r);a.forEach(t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)}),e.loadLanguages(t,be(e,r))},we=e=>"string"==typeof e,ke=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Ce={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},je=e=>Ce[e];let De={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(ke,je),transDefaultProps:void 0};let Ne;const Ae={type:"3rdParty",init(e){((e={})=>{De={...De,...e}})(e.options.react),(e=>{Ne=e})(e)}},Te=r.createContext();class Me{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var Le,Re,Ee={exports:{}},Ie={};var Oe=(Re||(Re=1,Ee.exports=function(){if(Le)return Ie;Le=1;var e=i(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=e.useState,r=e.useEffect,n=e.useLayoutEffect,s=e.useDebugValue;function o(e){var a=e.getSnapshot;e=e.value;try{var r=a();return!t(e,r)}catch(i){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var i=t(),l=a({inst:{value:i,getSnapshot:t}}),c=l[0].inst,d=l[1];return n(function(){c.value=i,c.getSnapshot=t,o(c)&&d({inst:c})},[e,i,t]),r(function(){return o(c)&&d({inst:c}),e(function(){o(c)&&d({inst:c})})},[e]),s(i),i};return Ie.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Ie}()),Ee.exports);const $e={t:(e,t)=>{return we(t)?t:"object"==typeof(a=t)&&null!==a&&we(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e;var a},ready:!1},Pe=()=>()=>{},Fe=(e,t={})=>{const{i18n:a}=t,{i18n:i,defaultNS:n}=r.useContext(Te)||{},s=a||i||Ne;s&&!s.reportNamespaces&&(s.reportNamespaces=new Me),s||ye(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const o=r.useMemo(()=>({...De,...s?.options?.react,...t}),[s,t]),{useSuspense:l,keyPrefix:c}=o,d=e||n||s?.options?.defaultNS,g=we(d)?[d]:d||["translation"],u=r.useMemo(()=>g,g);s?.reportNamespaces?.addUsedNamespaces?.(u);const h=r.useRef(0),m=r.useCallback(e=>{if(!s)return Pe;const{bindI18n:t,bindI18nStore:a}=o,r=()=>{h.current+=1,e()};return t&&s.on(t,r),a&&s.store.on(a,r),()=>{t&&t.split(" ").forEach(e=>s.off(e,r)),a&&a.split(" ").forEach(e=>s.store.off(e,r))}},[s,o]),p=r.useRef(),x=r.useCallback(()=>{if(!s)return $e;const e=!(!s.isInitialized&&!s.initializedStoreOnce)&&u.every(e=>((e,t,a={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:a.lng,precheck:(t,r)=>{if(a.bindI18n&&a.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!r(t.isLanguageChangingTo,e))return!1}}):(ye(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0))(e,s,o)),a=t.lng||s.language,r=h.current,i=p.current;if(i&&i.ready===e&&i.lng===a&&i.keyPrefix===c&&i.revision===r)return i;const n={t:s.getFixedT(a,"fallback"===o.nsMode?u:u[0],c),ready:e,lng:a,keyPrefix:c,revision:r};return p.current=n,n},[s,u,c,o,t.lng]),[f,y]=r.useState(0),{t:b,ready:v}=Oe.useSyncExternalStore(m,x,x);r.useEffect(()=>{if(s&&!v&&!l){const e=()=>y(e=>e+1);t.lng?Se(s,t.lng,u,e):ve(s,u,e)}},[s,t.lng,u,v,l,f]);const S=s||{},w=r.useRef(null),k=r.useRef(),C=e=>{const t=Object.getOwnPropertyDescriptors(e);t.__original&&delete t.__original;const a=Object.create(Object.getPrototypeOf(e),t);if(!Object.prototype.hasOwnProperty.call(a,"__original"))try{Object.defineProperty(a,"__original",{value:e,writable:!1,enumerable:!1,configurable:!1})}catch(r){}return a},j=r.useMemo(()=>{const e=S,t=e?.language;let a=e;e&&(w.current&&w.current.__original===e?k.current!==t?(a=C(e),w.current=a,k.current=t):a=w.current:(a=C(e),w.current=a,k.current=t));const r=[b,a,v];return r.t=b,r.i18n=a,r.ready=v,r},[b,S,v,S.resolvedLanguage,S.language,S.languages]);if(s&&l&&!v)throw new Promise(e=>{const a=()=>e();t.lng?Se(s,t.lng,u,a):ve(s,u,a)});return j},We=20,Ve=1e4,Be="default",Ue=[Be],He=100,ze=200,qe=300,Ye=400,Xe=500,_e=600,Je=700,Ke=800,Qe=900,Ge=1e3,Ze=10,et=9999,tt=99999,at=1e3,rt=1e5,it=128,nt=5e3,st=10,ot={"bar-chart":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{fill:t,x:"4",y:"10",width:"4",height:"10"}),s.jsx("rect",{fill:t,x:"10",y:"6",width:"4",height:"14"}),s.jsx("rect",{fill:t,x:"16",y:"13",width:"4",height:"7"})]}),"line-chart":e=>s.jsx("polyline",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,points:"4,18 8,12 12,14 16,8 20,10"}),"site-logo":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9.66,7.94l-3.92,2.08c-.68.36-1.09,1.07-1.06,1.84l.22,6.02c.02.66.37,1.27.94,1.62l5.1,3.2c.65.41,1.48.41,2.13,0l5.1-3.2c.56-.35.91-.96.94-1.62l.22-6.02c.03-.77-.38-1.48-1.06-1.84l-3.92-2.08"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M13.92,5.61c1.07.71,2.51,1.39,4.08,1.39,2.21,0,4-1.34,4-3,0-1.66-1.79-3-4-3-3.31,0-6,3-6,3,0,0-2.69,3-6,3-2.21,0-4-1.34-4-3S3.79,1,6,1c.18,0,.37,0,.55.03,1.31.13,2.47.69,3.39,1.53"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M14.25,10.98c0,.69-1.01,1.24-2.25,1.24s-2.25-.56-2.25-1.24"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M11.99,7.01c0,.1,0,.2,0,.3v2.42"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"8.78",cy:"16.77",rx:".62",ry:"1.12",transform:"translate(-7.21 6.64) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"10.49",cy:"19.73",rx:".62",ry:"1.12",transform:"translate(-8.46 7.89) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"7.07",cy:"13.8",rx:".62",ry:"1.12",transform:"translate(-5.95 5.38) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"16.96",cy:"13.75",rx:"1.12",ry:".62",transform:"translate(-3.43 21.56) rotate(-60)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"13.54",cy:"19.68",rx:"1.12",ry:".62",transform:"translate(-10.27 21.56) rotate(-60)"})]}),dice:(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.33,16.08l.32-8.65c.03-.77-.38-1.48-1.06-1.84L12.94,1.55c-.59-.31-1.29-.31-1.87,0L3.42,5.59c-.68.36-1.09,1.07-1.06,1.84l.32,8.65c.02.66.37,1.27.94,1.62l7.33,4.6c.65.41,1.48.41,2.13,0l7.33-4.6c.56-.35.91-.96.94-1.62Z"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"12",cy:"6.68",rx:"2.96",ry:"1.64"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"7.77",cy:"14.29",rx:".82",ry:"1.48",transform:"translate(-6.1 5.8) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"10.02",cy:"18.19",rx:".82",ry:"1.48",transform:"translate(-7.75 7.45) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"5.52",cy:"10.39",rx:".82",ry:"1.48",transform:"translate(-4.46 4.15) rotate(-30)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"18.52",cy:"10.32",rx:"1.48",ry:".82",transform:"translate(.33 21.2) rotate(-60)"}),s.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"14.02",cy:"18.12",rx:"1.48",ry:".82",transform:"translate(-8.68 21.2) rotate(-60)"})]}),"chevron-left":e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M15 19l-7-7 7-7"}),"chevron-right":e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5l7 7-7 7"}),"chevron-up":e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5*e,d:"M6 15l6-6 6 6"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,opacity:"0.5",d:"M6 18l6-6 6 6"})]}),"chevron-down":e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5*e,d:"M6 9l6 6 6-6"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,opacity:"0.5",d:"M6 6l6 6 6-6"})]}),help:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),sun:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"}),moon:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"}),diceSets:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"}),settings:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"chart-bar":e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"}),results:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"}),menu:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 6h16M4 12h16M4 18h16"}),"dots-vertical":()=>s.jsxs(s.Fragment,{children:[s.jsx("circle",{fill:"currentColor",cx:"12",cy:"5",r:"1"}),s.jsx("circle",{fill:"currentColor",cx:"12",cy:"12",r:"1"}),s.jsx("circle",{fill:"currentColor",cx:"12",cy:"19",r:"1"})]}),close:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M6 18L18 6M6 6l12 12"}),download:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"}),upload:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"}),edit:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}),save:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M3 7v11a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-7l-2-2H5a2 2 0 00-2 2z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 16v-3m3 3v-5m3 5v-2"})]}),trash:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}),copy:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"}),clipboard:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]}),export:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),import:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"}),reroll:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.4,15.6l.28-7.55c.04-1.15-.58-2.22-1.59-2.76l-6.68-3.53c-.88-.46-1.93-.46-2.81,0l-6.68,3.53c-1.02.54-1.64,1.61-1.59,2.76l.28,7.55c.04.99.56,1.9,1.4,2.43l6.4,4.01c.98.61,2.21.61,3.19,0l6.4-4.01c.84-.53,1.37-1.44,1.4-2.43Z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M13.97,7.75c1.09.51,1.98,1.43,2.42,2.65.89,2.43-.37,5.12-2.8,6.01s-5.12-.37-6.01-2.8c-.89-2.43.37-5.12,2.8-6.01"}),s.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",points:"8.13 6.99 10.39 7.6 9.78 9.86"})]}),"add-roll":e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.4,15.6l.28-7.55c.04-1.15-.58-2.22-1.59-2.76l-6.68-3.53c-.88-.46-1.93-.46-2.81,0l-6.68,3.53c-1.02.54-1.64,1.61-1.59,2.76l.28,7.55c.04.99.56,1.9,1.4,2.43l6.4,4.01c.98.61,2.21.61,3.19,0l6.4-4.01c.84-.53,1.37-1.44,1.4-2.43Z"}),s.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",x1:"8.25",y1:"12",x2:"15.75",y2:"12"}),s.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",x1:"12",y1:"8.25",x2:"12",y2:"15.75"})]}),refresh:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"}),plus:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 4v16m8-8H4"}),spinner:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21 12a9 9 0 1 1-6.219-8.56"}),table:()=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{strokeWidth:"2",x:"2",y:"3",width:"20",height:"18",rx:"2",ry:"2"}),s.jsx("line",{strokeWidth:"2",x1:"2",y1:"9",x2:"22",y2:"9"}),s.jsx("line",{strokeWidth:"2",x1:"2",y1:"15",x2:"22",y2:"15"}),s.jsx("line",{strokeWidth:"2",x1:"12",y1:"3",x2:"12",y2:"21"})]}),reset:e=>s.jsxs(s.Fragment,{children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M22 21H7"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"m5 11 9 9"})]}),info:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),filter:e=>s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"}),"chart-total-distribution":e=>s.jsx(s.Fragment,{children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4,17h0c2.21,0,3.4-.83,4-3.72.6-2.9,1.75-6.28,3.96-6.28,2.21,0,3.44,3.38,4.04,6.28.6,2.9,1.79,3.72,4,3.72h0"})}),"chart-cumulative-distribution":e=>s.jsx(s.Fragment,{children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4,7h0c4.42,0,6.79,1.11,8,5s3.58,5,8,5h0"})}),"chart-roll-progress":e=>s.jsx(s.Fragment,{children:s.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,points:"4 13.04 6.42 7 11.69 17 13.78 13.76 15.98 15.77 20 9.08"})}),"chart-individual-dice":(e,t)=>s.jsxs(s.Fragment,{children:[s.jsx("rect",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,style:{fill:t},x:"4",y:"10",width:"2",height:"8"}),s.jsx("rect",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,style:{fill:t},x:"18",y:"14",width:"2",height:"4"}),s.jsx("rect",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,style:{fill:t},x:"11",y:"6",width:"2",height:"12"})]})},lt=n.memo(({name:e,className:t="w-6 h-6",strokeWidth:a=2})=>{const r=ot[e];return r?s.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r(a,"currentColor")}):null});function ct(e,t,a,r){return new Promise((i,n)=>{const s=new Worker(new URL("/dice/assets/diceSimulation.worker-DCJS2b41.js",import.meta.url),{type:"module"});s.onmessage=e=>{const t=e.data;"progress"===t.type?a?.(t.progress,t.processed,t.total):"complete"===t.type?(s.terminate(),i(t.results)):"error"===t.type&&(s.terminate(),n(new Error(t.error)))},s.onerror=e=>{s.terminate(),n(e)};const o={type:"simulate",config:e,trialCount:t,chunkSize:r};s.postMessage(o)})}function dt(e){let t=`dice${e.diceCount}d${e.diceFaces}`;return e.modifierSign&&e.modifierValue>0&&(t+=`${e.modifierSign}${e.modifierValue}`),t}function gt(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function ut(){return(new Date).toISOString()}function ht(e,t){return e.diceCount===t.diceCount&&e.diceFaces===t.diceFaces&&e.modifierSign===t.modifierSign&&e.modifierValue===t.modifierValue}function mt(e,t=8){return e.length<=t?e:e.substring(0,t)+"..."}function pt(e){const t=e.name||dt(e.diceConfig);return`${void 0!==e.numericUid?`#${e.numericUid} - `:""}${t}`}function xt(e,t=8){const a=e.name||dt(e.diceConfig),r=a.length<=t?a:a.substring(0,t)+"...";return`${void 0!==e.numericUid?`#${e.numericUid} - `:""}${r}`}function ft(){return`widget-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function yt(){return[{id:ft(),type:"result"},{id:ft(),type:"cumulative"},{id:ft(),type:"rollProgress"},{id:ft(),type:"individual"}]}function bt(e,t,a){const r=a(`charts:widget.graphTypes.${e}`);return a("charts:widget.autoName",{type:r,index:t})}lt.displayName="Icon";const vt=128;function St(e){return Ue.includes(e)}function wt(){const e=(new Date).toISOString();return{id:Be,name:"デフォルト設定",widgets:yt(),createdAt:e,updatedAt:e}}function kt(){return`chart-settings-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function Ct(e){return e&&0!==e.trim().length?e.length>vt?{valid:!1,error:"設定名は128文字以内で入力してください"}:{valid:!0}:{valid:!1,error:"設定名を入力してください"}}const jt="diceSets",Dt="chartSettings",Nt="metadata";const At=new class{constructor(){t(this,"dbPromise",null)}async closeDB(){if(this.dbPromise){try{(await this.dbPromise).close()}catch(e){}this.dbPromise=null}}async getDB(){return this.dbPromise||(this.dbPromise=new Promise((e,t)=>{const a=indexedDB.open("DiceSimulatorDB",6);a.onerror=()=>{t(new Error("IndexedDBを開けませんでした"))},a.onsuccess=()=>{e(a.result)},a.onupgradeneeded=e=>{const t=e.target.result,a=e.oldVersion,r=e.target.transaction;if(t.objectStoreNames.contains("sessions")&&!t.objectStoreNames.contains(jt)){const e=r.objectStore("sessions").getAll();e.onsuccess=()=>{const a=e.result,r=t.createObjectStore(jt,{keyPath:"id"});r.createIndex("by-sortOrder","sortOrder",{unique:!1}),r.createIndex("by-updated","updatedAt",{unique:!1}),a.forEach(e=>{r.add(e)})},t.deleteObjectStore("sessions")}else if(t.objectStoreNames.contains(jt)){if(a<2){const e=r.objectStore(jt);e.indexNames.contains("by-sortOrder")||e.createIndex("by-sortOrder","sortOrder",{unique:!1})}}else{const e=t.createObjectStore(jt,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}if(a<3&&!t.objectStoreNames.contains(Dt)){const e=t.createObjectStore(Dt,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}if(a<4&&a>=3){const t=e.target.transaction.objectStore(Dt);t.indexNames.contains("by-sortOrder")||t.createIndex("by-sortOrder","sortOrder",{unique:!1})}a<6&&(t.objectStoreNames.contains(Nt)||t.createObjectStore(Nt,{keyPath:"key"}))}})),this.dbPromise}async loadDiceSets(){try{const e=await this.getDB(),t=e.transaction(jt,"readonly").objectStore(jt);return new Promise((e,a)=>{const r=t.getAll();r.onsuccess=()=>{const t=r.result;t.sort((e,t)=>void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),e(t)},r.onerror=()=>{a(new Error("ダイスセットの読み込みに失敗しました"))}})}catch(e){return[]}}async saveDiceSet(e){const t=await this.getDB();let a=e;if(void 0===e.sortOrder)try{const t=await this.getDiceSet(e.id);if(t&&void 0!==t.sortOrder)a={...e,sortOrder:t.sortOrder};else{const t=(await this.loadDiceSets()).reduce((e,t)=>void 0!==t.sortOrder&&t.sortOrder>e?t.sortOrder:e,-1);a={...e,sortOrder:t+1}}}catch(i){}const r=t.transaction(jt,"readwrite").objectStore(jt);return new Promise((e,t)=>{const i=r.put(a);i.onsuccess=()=>{e()},i.onerror=()=>{t(new Error("ダイスセットの保存に失敗しました"))}})}async saveDiceSets(e){const t=(await this.getDB()).transaction(jt,"readwrite").objectStore(jt);return await new Promise((e,a)=>{const r=t.clear();r.onsuccess=()=>e(),r.onerror=()=>a(new Error("データのクリアに失敗しました"))}),new Promise((a,r)=>{let i=0;const n=e.length;0!==n?e.forEach((e,s)=>{const o={...e,sortOrder:s},l=t.put(o);l.onsuccess=()=>{i++,i===n&&a()},l.onerror=()=>{r(new Error("ダイスセットの保存に失敗しました"))}}):a()})}async deleteDiceSet(e){const t=(await this.getDB()).transaction(jt,"readwrite").objectStore(jt);return new Promise((a,r)=>{const i=t.delete(e);i.onsuccess=()=>{a()},i.onerror=()=>{r(new Error("ダイスセットの削除に失敗しました"))}})}async getDiceSet(e){const t=(await this.getDB()).transaction(jt,"readonly").objectStore(jt);return new Promise((a,r)=>{const i=t.get(e);i.onsuccess=()=>{a(i.result)},i.onerror=()=>{r(new Error("ダイスセットの取得に失敗しました"))}})}async getDiceSetCount(){const e=(await this.getDB()).transaction(jt,"readonly").objectStore(jt);return new Promise((t,a)=>{const r=e.count();r.onsuccess=()=>{t(r.result)},r.onerror=()=>{a(new Error("ダイスセット数の取得に失敗しました"))}})}async migrateFromLocalStorage(){try{const t="dice-simulator-dice-sets",a=localStorage.getItem(t);if(!a)return!1;let r;try{r=JSON.parse(a)}catch(e){return localStorage.removeItem(t),!1}if(!r||"object"!=typeof r)throw new Error("LocalStorageのデータ形式が不正です");const i=r;let n=[];if(Array.isArray(i.diceSets)?n=i.diceSets:Array.isArray(i.sessions)&&(n=i.sessions),!Array.isArray(n))throw new Error("diceSetsが配列ではありません");return n.length>0&&(n.forEach((e,t)=>{!function(e,t){if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const a=e;if(!a.id||"string"!=typeof a.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(void 0===a.name||null===a.name||"string"!=typeof a.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(a.name.length>it)throw new Error(`ダイスセット${t+1}: 名前が長すぎます（最大128文字）`);if(!a.diceConfig||"object"!=typeof a.diceConfig)throw new Error(`ダイスセット${t+1}: ダイス設定が不正です`);const r=a.diceConfig;if("number"!=typeof r.diceCount||r.diceCount<1||r.diceCount>Ze)throw new Error(`ダイスセット${t+1}: ダイス数が範囲外です`);if("number"!=typeof r.diceFaces||r.diceFaces<1||r.diceFaces>et)throw new Error(`ダイスセット${t+1}: ダイス面数が範囲外です`);if(""!==r.modifierSign&&"+"!==r.modifierSign&&"-"!==r.modifierSign)throw new Error(`ダイスセット${t+1}: 修正値符号が不正です`);if("number"!=typeof r.modifierValue||r.modifierValue<0||r.modifierValue>tt)throw new Error(`ダイスセット${t+1}: 修正値が範囲外です`);if("number"!=typeof a.trialCount||a.trialCount<1||a.trialCount>at)throw new Error(`ダイスセット${t+1}: 試行回数が範囲外です`);if(!Array.isArray(a.results))throw new Error(`ダイスセット${t+1}: 結果が配列ではありません`)}(e,t)}),await this.saveDiceSets(n),localStorage.removeItem(t),!0)}catch(e){return!1}}async loadChartSettings(){try{const e=await this.getDB(),t=e.transaction(Dt,"readonly").objectStore(Dt);return new Promise((e,a)=>{const r=t.getAll();r.onsuccess=()=>{const t=r.result;if(!t.some(e=>e.id===Be)){const e=wt();t.unshift(e)}t.sort((e,t)=>{const a=Ue.includes(e.id),r=Ue.includes(t.id);return a&&r?e.id===Be?-1:t.id===Be?1:Ue.indexOf(e.id)-Ue.indexOf(t.id):a?-1:r?1:void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()}),e(t)},r.onerror=()=>{a(new Error("ウィジェットセット設定の読み込みに失敗しました"))}})}catch(e){return[wt()]}}async saveChartSettings(e){const t=(await this.getDB()).transaction(Dt,"readwrite").objectStore(Dt);return new Promise((a,r)=>{const i=t.put(e);i.onsuccess=()=>{a()},i.onerror=()=>{r(new Error("ウィジェットセット設定の保存に失敗しました"))}})}async deleteChartSettings(e){if(e===Be)throw new Error("デフォルト設定は削除できません");const t=(await this.getDB()).transaction(Dt,"readwrite").objectStore(Dt);return new Promise((a,r)=>{const i=t.delete(e);i.onsuccess=()=>{a()},i.onerror=()=>{r(new Error("ウィジェットセット設定の削除に失敗しました"))}})}async getChartSettings(e){const t=(await this.getDB()).transaction(Dt,"readonly").objectStore(Dt);return new Promise((a,r)=>{const i=t.get(e);i.onsuccess=()=>{i.result?a(i.result):a(e===Be?wt():void 0)},i.onerror=()=>{r(new Error("ウィジェットセット設定の取得に失敗しました"))}})}async ensureDefaultChartSettings(){await this.getChartSettings(Be)||await this.saveChartSettings(wt())}async getNextNumericUid(){const e=(await this.getDB()).transaction(Nt,"readwrite").objectStore(Nt);return new Promise((t,a)=>{const r=e.get("numericUidCounter");r.onsuccess=()=>{const i=(r.result?.value||0)+1,n=e.put({key:"numericUidCounter",value:i});n.onsuccess=()=>{t(i)},n.onerror=()=>{a(new Error("numericUidカウンターの更新に失敗しました"))}},r.onerror=()=>{a(new Error("numericUidカウンターの取得に失敗しました"))}})}};async function Tt(e){return At.saveDiceSet(e)}async function Mt(e){return At.saveDiceSets(e)}async function Lt(e){return At.deleteDiceSet(e)}async function Rt(){return At.loadChartSettings()}async function Et(e){return At.saveChartSettings(e)}async function It(){return At.getNextNumericUid()}async function Ot(){return At.closeDB()}const $t="language";function Pt(e){localStorage.setItem($t,e)}const Ft=[{code:"ja",label:"日本語",subtitle:"Japanese",badge:"JA"},{code:"en",label:"English",subtitle:"English",badge:"EN"}],Wt=r.lazy(()=>D(()=>import("./index-CEiIUMOo.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.HelpModal}))),Vt=r.lazy(()=>D(()=>import("./index-CEiIUMOo.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.SettingsModal}))),Bt=n.memo(({darkMode:e,onToggleDarkMode:t,onAboutClick:a,onChangelogClick:i,themeMode:n,onChangeThemeMode:o,transparentExport:l,onChangeTransparentExport:c,onExportData:d,onImportData:g,diceSetsCount:u,chartSettingsCount:h})=>{const{i18n:m,t:p}=Fe("common"),[x,f]=r.useState(!1),[y,b]=r.useState(!1),[v,S]=r.useState(!0),[w,k]=r.useState(!1),C=r.useRef(0),j=r.useRef(null),D=r.useRef(null),N=p("common:siteName");r.useEffect(()=>{const e=()=>{if(window.innerWidth>=768)return void S(!0);const e=window.scrollY;if(e<=0)return S(!0),void(C.current=e);Math.abs(e-C.current)<10||(e>C.current?S(!1):S(!0),C.current=e)};return e(),window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]),r.useEffect(()=>{const e=e=>{w&&D.current&&!D.current.contains(e.target)&&j.current&&!j.current.contains(e.target)&&k(!1)},t=e=>{"Escape"===e.key&&k(!1)};if(w)return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[w]);const A=Ft.find(e=>e.code===m.language)||Ft[0];return s.jsxs(s.Fragment,{children:[s.jsx("header",{className:"h-18 fixed top-0 left-0 right-0 z-[500] bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm text-gray-800 dark:text-white py-2 px-4 shadow-md transition-all duration-300 "+(v?"translate-y-0":"-translate-y-full"),children:s.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center flex-1 min-w-0 mr-2",children:[s.jsx("div",{className:"mr-2 flex-shrink-0",children:s.jsx(lt,{name:"site-logo",className:"w-10 h-10",strokeWidth:1})}),s.jsx("h1",{className:"text-xl font-bold truncate",children:N})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsxs("button",{ref:j,onClick:()=>k(e=>!e),className:"flex items-center gap-1 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none text-sm font-medium","aria-label":p("label.toggleLanguage"),"aria-haspopup":"listbox","aria-expanded":w,children:[s.jsx("span",{children:A.badge}),s.jsx(lt,{name:"chevron-down",className:"w-4 h-4 transition-transform "+(w?"rotate-180":""),strokeWidth:2})]}),w&&s.jsx("div",{ref:D,className:"absolute right-0 mt-2 w-40 bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-1 z-50",children:s.jsx("ul",{role:"listbox","aria-label":p("label.toggleLanguage"),children:Ft.map(e=>{const t=e.code===m.language;return s.jsx("li",{children:s.jsxs("button",{type:"button",onClick:()=>{return t=e.code,m.language!==t&&(m.changeLanguage(t),Pt(t)),void k(!1);var t},className:"w-full text-left px-4 py-2 text-sm transition-colors flex items-center justify-between "+(t?"bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white font-medium":"hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200"),role:"option","aria-selected":t,children:[s.jsx("span",{children:e.label}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.badge})]})},e.code)})})})]}),s.jsx("button",{onClick:()=>f(!0),className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none","aria-label":p("label.help"),children:s.jsx(lt,{name:"help"})}),s.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none","aria-label":p("label.toggleTheme"),children:s.jsx(lt,{name:e?"moon":"sun"})}),s.jsx("button",{onClick:()=>b(!0),className:"hidden md:flex p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none mr-2 flex-shrink-0","aria-label":p("label.settings"),children:s.jsx(lt,{name:"settings"})})]})]})}),x&&s.jsx(r.Suspense,{fallback:null,children:s.jsx(Wt,{isOpen:x,onClose:()=>f(!1),onOpenAbout:a})}),y&&s.jsx(r.Suspense,{fallback:null,children:s.jsx(Vt,{isOpen:y,onClose:()=>b(!1),darkMode:n,onChangeDarkMode:o,transparentExport:l,onChangeTransparentExport:c,onExportData:d,onImportData:g,diceSetsCount:u,chartSettingsCount:h,onAboutClick:a,onChangelogClick:i})})]})}),Ut=n.memo(()=>{const{t:e}=Fe("common");return s.jsx("footer",{className:"mt-auto py-10 px-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:s.jsx("div",{className:"max-w-7xl mx-auto flex justify-center items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:s.jsxs("span",{children:["© 2025 ",e("siteName")]})})})});var Ht=S();const{slice:zt,forEach:qt}=[];const Yt=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Xt={create(e,t,a,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};a&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+60*a*1e3)),r&&(i.domain=r),document.cookie=function(e,t){const a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let r=`${e}=${encodeURIComponent(t)}`;if(a.maxAge>0){const e=a.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");r+=`; Max-Age=${Math.floor(e)}`}if(a.domain){if(!Yt.test(a.domain))throw new TypeError("option domain is invalid");r+=`; Domain=${a.domain}`}if(a.path){if(!Yt.test(a.path))throw new TypeError("option path is invalid");r+=`; Path=${a.path}`}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");r+=`; Expires=${a.expires.toUTCString()}`}if(a.httpOnly&&(r+="; HttpOnly"),a.secure&&(r+="; Secure"),a.sameSite)switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:r+="; SameSite=Strict";break;case"lax":r+="; SameSite=Lax";break;case"strict":r+="; SameSite=Strict";break;case"none":r+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a.partitioned&&(r+="; Partitioned"),r}(e,t,i)},read(e){const t=`${e}=`,a=document.cookie.split(";");for(let r=0;r<a.length;r++){let e=a[r];for(;" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var _t={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return Xt.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:a,cookieMinutes:r,cookieDomain:i,cookieOptions:n}=t;a&&"undefined"!=typeof document&&Xt.create(a,e,r,i,n)}},Jt={name:"querystring",lookup(e){let t,{lookupQuerystring:a}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const r=e.substring(1).split("&");for(let i=0;i<r.length;i++){const e=r[i].indexOf("=");if(e>0){r[i].substring(0,e)===a&&(t=r[i].substring(e+1))}}}return t}},Kt={name:"hash",lookup(e){let t,{lookupHash:a,lookupFromHashIndex:r}=e;if("undefined"!=typeof window){const{hash:e}=window.location;if(e&&e.length>2){const i=e.substring(1);if(a){const e=i.split("&");for(let r=0;r<e.length;r++){const i=e[r].indexOf("=");if(i>0){e[r].substring(0,i)===a&&(t=e[r].substring(i+1))}}}if(t)return t;if(!t&&r>-1){const t=e.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(t))return;const a="number"==typeof r?r:0;return t[a]?.replace("/","")}}}return t}};let Qt=null;const Gt=()=>{if(null!==Qt)return Qt;try{if(Qt="undefined"!=typeof window&&null!==window.localStorage,!Qt)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){Qt=!1}return Qt};var Zt={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&Gt())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:a}=t;a&&Gt()&&window.localStorage.setItem(a,e)}};let ea=null;const ta=()=>{if(null!==ea)return ea;try{if(ea="undefined"!=typeof window&&null!==window.sessionStorage,!ea)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){ea=!1}return ea};var aa={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&ta())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:a}=t;a&&ta()&&window.sessionStorage.setItem(a,e)}},ra={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:a,language:r}=navigator;if(e)for(let i=0;i<e.length;i++)t.push(e[i]);a&&t.push(a),r&&t.push(r)}return t.length>0?t:void 0}},ia={name:"htmlTag",lookup(e){let t,{htmlTag:a}=e;const r=a||("undefined"!=typeof document?document.documentElement:null);return r&&"function"==typeof r.getAttribute&&(t=r.getAttribute("lang")),t}},na={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if("undefined"==typeof window)return;const a=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(a))return;const r="number"==typeof t?t:0;return a[r]?.replace("/","")}},sa={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const a="number"==typeof t?t+1:1,r="undefined"!=typeof window&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(r)return r[a]}};let oa=!1;try{document.cookie,oa=!0}catch(Ni){}const la=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];oa||la.splice(1,1);class ca{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return qt.call(zt.call(arguments,1),t=>{if(t)for(const a in t)void 0===e[a]&&(e[a]=t[a])}),e}(t,this.options||{},{order:la,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=a,this.addDetector(_t),this.addDetector(Jt),this.addDetector(Zt),this.addDetector(aa),this.addDetector(ra),this.addDetector(ia),this.addDetector(na),this.addDetector(sa),this.addDetector(Kt)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach(e=>{if(this.detectors[e]){let a=this.detectors[e].lookup(this.options);a&&"string"==typeof a&&(a=[a]),a&&(t=t.concat(a))}}),t=t.filter(e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(e=>e.test(t)));var t}).map(e=>this.options.convertDetectedLanguage(e)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)}))}}ca.type="languageDetector";const da={button:{start:"開始",reroll:"振り直し",addRoll:"さらに振る",save:"保存",cancel:"キャンセル",close:"閉じる",delete:"削除",duplicate:"複製",edit:"編集",apply:"適用",confirm:"確認",create:"作成",export:"エクスポート",import:"インポート",copy:"コピー",reset:"リセット",ok:"OK",yes:"はい",no:"いいえ",back:"戻る",next:"次へ"},action:{edit:"編集",save:"保存",cancel:"キャンセル",delete:"削除",duplicate:"複製",create:"作成",close:"閉じる",change:"変更"},unit:{count:"件",piece:"個",times:"回",diceSet:"ダイスセット"},label:{loading:"読み込み中...",processing:"処理中...",noData:"データがありません",help:"ヘルプ",toggleTheme:"テーマ切り替え",toggleLanguage:"言語切り替え",settings:"設定",firstPage:"最初のページ",lastPage:"最後のページ",quantile:"分位点",aggregation:"集約",target:"対象",all:"すべて",preview:"プレビュー",list:"リスト",roll:"ロール",start:"開始",addMore:"さらに振る",noChanges:"変更なし",trial:"試行",dice:"ダイス",modifier:"補正",total:"合計"},punctuation:{comma:"、"},none:"なし",unnamed:"名称未設定",siteName:"てすとDice",menu:{options:"オプション",edit:"編集",duplicate:"複製",delete:"削除"},emptyState:{noItems:"アイテムがありません"},selection:{moving:"移動中...",selected:"件選択中",deselect:"選択解除"},custom:"カスタム"},ga={title:"ガイド",closeButton:"閉じる",aboutSection:{description:{before:"当アプリの詳細情報やプライバシーポリシーについては",after:"をご覧ください。"},linkText:"こちら"},basicSettings:{diceNotation:{title:"ダイス記法について",description:"ダイス記法は以下の形式で指定します：",format:"dice[個数]d[面数](+|-)[修正値]",parameters:{count:{label:"個数",description:"振るダイスの数（1〜10）"},sides:{label:"面数",description:"ダイスの面の数（1〜9,999）"},modifier:{label:"修正値",description:"オプション。結果に加算または減算する値（0〜99,999）"}}},examples:{title:"使用例",items:[{notation:"dice1d6",description:"→ 6面ダイスを1個振る"},{notation:"dice3d6+2",description:"→ 6面ダイスを3個振り、合計に2を加算"},{notation:"dice2d10-5",description:"→ 10面ダイスを2個振り、合計から5を減算"}]},trials:{title:"試行回数",description:"同じダイスロールを複数回実行できます（1〜1,000回）。\n試行回数を増やすことで、より正確な確率分布を確認できます。"}},diceSetManagement:{diceSetFeatures:{title:"ダイスセット機能",features:["各ダイスセットに任意の名前を付けて保存できます（最大128文字）","最大20個のダイスセットを保存可能","結果はブラウザのIndexedDBに自動保存されます","ダイスセットの複製と削除が可能","ドラッグ&ドロップでダイスセットの並び替えが可能","ダイスセット全体をJSON形式でエクスポート/インポート可能","複数のダイスセットを選択して一括で複製・削除が可能","全ダイスセットを一括削除する機能（確認ダイアログ付き）"]},comparison:{title:"ダイスセットの比較",features:["複数のダイスセットを選択してグラフで比較表示が可能","比較モードでは各ダイスセットが異なる色で表示されます","最大20個のダイスセットまで同時比較可能","比較時は各ダイスセットのラベルに試行回数が表示されます"]}},resultDisplay:{title:"結果の表示",table:{label:"表形式",description:"各試行の詳細な結果を一覧表示",features:["試行番号、各ダイスの値、合計値を表示","ページネーション機能（1ページあたり25件表示）","CSV形式でのエクスポートが可能"]},chart:{label:"グラフ形式",description:"結果の分布を視覚化（4種類のグラフ）",types:{distribution:{icon:"📊",title:"合計値の分布",features:["全試行の合計値の分布をヒストグラムで表示","棒グラフと折れ線グラフの切り替え可能","統計情報をアノテーションラインで表示（平均値：緑、中央値：オレンジ、期待値：ピンク、±1σ：紫）","中央値に該当するバー/ポイントをオレンジ色でハイライト","理論分布を灰色の点線で重ねて表示（単一セッション時のみ）","データ集約機能で大量データを見やすく表示"]},cumulative:{icon:"📈",title:"累積分布",features:["確率の累積分布を表示","合計値と個別のダイスの両方に対応","実測値と理論値の比較が可能","分位点（10分位、20分位など）の表示切り替え機能","「この値以下が出る確率」を視覚的に把握可能"]},progress:{icon:"📉",title:"試行の推移",features:["各試行での合計値の推移を表示","時系列で結果の変動を確認可能","移動平均線を表示してトレンドを把握","移動平均のウィンドウサイズを調整可能（5〜100試行）"]},individualDice:{icon:"🎲",title:"個別の出目の分布",features:["各ダイスの出目の分布を表示（ダイスが2個以上の場合）","棒グラフと折れ線グラフの切り替え可能","理論分布を灰色の点線で重ねて表示","データ集約機能で大量データを見やすく表示"]}}}},advancedFeatures:{dataAggregation:{title:"データ集約機能",description:"グラフ表示時、データポイント数が多い場合は集約機能を使用することで、見やすく表示できます。",features:[{label:"データ集約を使用する",description:"指定した間隔を目安にデータを均等にまとめて表示"},{label:"集約間隔の目安",description:"おおよそ何件ずつにまとめるかを設定（2〜5,000、デフォルト: 20）"},{label:"対応グラフ",description:"合計値の分布グラフ、個別の出目の分布グラフ"},{label:"例: 間隔を20に設定すると、全体を約20件ずつの均等なグループに分割します",subFeatures:["端数が出ないよう、各グループはできるだけ均等なサイズに自動調整されます"]},{label:"集約時はグラフタイトルに「集約：XX」と表示されます"}]},chartSettings:{title:"ウィジェットセット設定の保存",description:"グラフの表示設定（チャートタイプ、集約設定など）を保存して再利用できます。",features:["複数の設定プリセットを作成・管理可能","設定の名前変更、複製、削除が可能","未保存の変更がある場合は警告を表示","各グラフの表示設定を個別に保存","デフォルト設定は削除・変更不可"]}},globalSettings:{title:"全体設定",description:"ヘッダー（モバイル版はフッター）の歯車アイコンから全体設定を開くことができます。",appearance:{label:"外観",features:["テーマ切り替え（ライト/ダーク/システム設定に従う）","選択はブラウザに自動保存されます"]},dataManagement:{label:"データ管理",features:[{label:"データのエクスポート",description:"全ダイスセットとカスタムグラフ設定をJSON形式でバックアップ",subFeatures:["デフォルト設定とプリセット設定は除外されます"]},{label:"データのインポート",description:"エクスポートしたJSONファイルから復元",subFeatures:["既存データとマージされます（上書きではありません）"]},{label:"全データの削除",description:"全てのダイスセットとグラフ設定を削除（確認ダイアログ付き）"},{label:"保存されているダイスセット数とグラフ設定数を表示"}]}},operations:{retryAndRoll:{title:"再試行と追加ロール",features:[{label:"結果リセット",description:"現在のダイスセットの結果をクリア（確認ダイアログ付き）"},{label:"再試行",description:"既存の結果をクリアして新しい結果に置き換え"},{label:"追加ロール",description:"既存の結果を保持したまま追加でダイスロールを実行",subFeatures:["ダイス設定が変更されている場合は警告を表示","追加実行時は既存データと統合されます"]}]},dataExport:{title:"データのエクスポート",description:"結果とダイスセットデータを様々な形式でエクスポートできます。",features:[{label:"CSV形式",description:"結果を表形式のCSVファイルでダウンロード"},{label:"PNG形式",description:"グラフを画像でダウンロード"},{label:"JSON形式",description:"ダイスセット全体をJSON形式でエクスポート/インポート"},{label:"クリップボードコピー",description:"ダイス設定のプレビュー文字列をコピー"}]}}},ua={title:"About / Privacy",close:"閉じる",sections:{app:{title:"このアプリについて",description:"{{siteName}}は、複数のダイスロールをシミュレーションし、結果を統計的に分析するためのWebアプリケーションです。TRPG（テーブルトークRPG）やボードゲームなどで使用するダイスの確率分布を確認することができます。"},data:{title:"データの取り扱い",items:["このアプリケーションはすべてのデータをブラウザ内にローカル保存します","ダイスセットデータ: IndexedDBに保存","設定（ダークモード等）: LocalStorageに保存","サーバーへのデータ送信は一切行いません","個人情報の収集は行いません","外部サービスとの連携はありません","データの管理はユーザー自身の責任で行ってください。ブラウザのデータクリアやアップデートにより保存データが消失する可能性があるため、重要なデータは定期的にエクスポート機能でバックアップすることを推奨します"]},disclaimer:{title:"免責事項",items:["このアプリケーションは無保証で提供されます","動作の正確性や継続性についても保証いたしかねます","本アプリの使用により生じた損害について、開発者は一切の責任を負いません"]},libraries:{title:"使用ライブラリ",description:"このアプリケーションは以下のオープンソースライブラリを使用しています：",items:["React (MIT License)","Chart.js (MIT License)","Tailwind CSS (MIT License)","Vite (MIT License)"]},version:{version:"Version: {{version}}",lastUpdated:"Last Updated: {{date}}"}}},ha={title:"全体設定",close:"閉じる",appearance:{title:"外観",theme:{title:"テーマ",description:"アプリの表示テーマを選択できます",light:"ライト",dark:"ダーク",system:"システム"},language:{title:"言語",description:"アプリの表示言語を選択できます"},chartImage:{title:"グラフ画像",description:"グラフを画像としてダウンロードする際の設定",transparentExport:{label:"透明背景でエクスポート",description:"有効にすると、グラフ画像をダウンロードする際に背景を透明にします"}}},dataManagement:{title:"データ管理",currentData:{title:"保存されているデータ",diceSets:"ダイスセット: {{count}}件",chartSettings:"グラフ設定: {{count}}件"},backup:{title:"バックアップと復元",description:"すべてのダイスセットとウィジェットセット設定を含む完全なバックアップをJSON形式でエクスポート・インポートできます。旧形式のダイスセットのみのファイルにも対応しています。",export:"エクスポート",exportDescription:"すべてのデータをJSON形式で保存",import:"インポート",importDescription:"バックアップファイルから復元"},reset:{title:"データの完全消去",description:"すべてのダイスセット、ウィジェットセット設定、アプリケーション設定を削除します。この操作は元に戻せません。",button:"すべてのデータを削除",confirm:"本当にすべてのデータを削除しますか？",confirmButton:"削除する",cancel:"キャンセル",processing:"削除中...",resetError:"データの初期化に失敗しました"}},system:{resetError:"IndexedDBの削除に失敗しました"},chartSettings:{title:"ウィジェットセット管理",renameTitle:"設定名を変更",editTitle:"ウィジェットセットを編集",duplicateTitle:"設定を複製",close:"閉じる",new:"+ 新規",create:"新規作成",rename:"名前変更",edit:"編集",duplicate:"複製",delete:"削除",save:"保存",change:"変更",cancel:"キャンセル",discard:"破棄",preset:"プリセット",custom:"カスタム",inUse:"使用中",selected:"{{count}}件選択",emptyMessage:"設定がありません",maxLength:"最大128文字",copyNameSuffix:"のコピー",unsavedChanges:"未保存の変更があります",unsavedWarning:"未保存の変更があります。保存したい設定の「保存」ボタンをクリックしてください。",savePrompt:"変更を保存しますか？",nameLabel:"設定名",namePlaceholder:"設定名を入力",rememberDiceSet:{label:"選択中のダイスセットを記憶する",description:"このウィジェットセットに切り替えたときに、記憶したダイスセットを自動的に選択します"},chartOptions:"ウィジェットオプション",moreOptions:"その他のオプション",bulkActions:{title:"一括操作",duplicate:"選択を一括複製",delete:"選択を一括削除",selectAll:"すべて選択",deselectAll:"選択解除"},errors:{nameRequired:"設定名を入力してください",duplicateFailed:"設定の複製に失敗しました",renameFailed:"設定の名前変更に失敗しました",deleteFailed:"設定の削除に失敗しました",saveFailed:"保存に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",cannotDeletePreset:"プリセット設定は削除できません",noSelection:"削除可能な設定が選択されていません",noDuplicateSelection:"複製する設定を選択してください"},confirmDelete:"設定「{{name}}」を削除しますか？",confirmBulkDelete:"{{count}}件の設定を削除しますか？"},about:{link:"About / Privacy"}},ma={type:{bar:"棒グラフ",line:"線グラフ"},title:{totalDistribution:"合計値の分布",totalDistributionShort:"合計値",cumulative:"累積分布 - {{diceCode}} / {{trials}}回試行{{quantile}}",cumulativeTotalBase:"累積分布（合計値）",cumulativeTotalBaseShort:"累積",cumulativeIndividualBase:"累積分布（全ダイスの出目）",cumulativeIndividual:"累積分布 (全ダイスの出目) - {{diceCode}} / {{trials}}回試行{{quantile}}",cumulativeComparison:"累積分布の比較 - {{count}}件のダイスセット比較{{quantile}}",cumulativeComparisonIndividual:"累積分布の比較 (全ダイスの出目) - {{count}}件のダイスセット比較{{quantile}}",cumulativeAggregated:"累積分布 - {{diceCode}} (集約)",individualDice:"個別の出目の分布",individualDiceShort:"個別出目",rollProgress:"試行推移 - {{diceCode}} / {{trials}}回試行{{aggregation}}",rollProgressBase:"試行推移",rollProgressBaseShort:"推移",rollProgressComparison:"試行推移の比較 - {{count}}件のダイスセット比較{{aggregation}}",targetValue:"特定の目の出現",comparison:"{{count}}件のダイスセット比較"},subtitle:{trialCount:"{{count}}回試行",aggregation:"集約：{{interval}}",binning:"ビニング: {{algorithm}} ({{binCount}}ビン)",quantilePoints:"分位点：{{count}}",custom:"カスタム"},legend:{title:"凡例",actual:"実測値",actualSampled:"実測値 (サンプリング)",actualCumulative:"累積分布 (実測)",theoretical:"理論値",theoreticalCumulative:"理論値",movingAverage:"移動平均",movingAverageWindow:"移動平均 ({{window}}試行)",expectedValue:"期待値 ({{value}})",showMore:"他 {{count}} 件を表示",collapse:"折りたたむ"},axis:{total:"合計値",diceValue:"ダイスの出目",trialNumber:"試行回数",frequency:"出現回数",cumulativeProbability:"累積確率 (%)",dicePosition:"ダイス位置"},stats:{mean:"平均",median:"中央値",mode:"最頻値",stdDev:"標準偏差",expectedValue:"期待値",totalCount:"合計",averagePerDice:"平均（各ダイス）",maxCount:"最大",minCount:"最小",individualStats:"個別の出目の統計",dataPoints:"表示データポイント数: {{count}}点"},options:{title:"ウィジェットオプション",widgetType:"ウィジェットの種類",chartType:"グラフの外観",displaySettings:"表示設定",manageSettings:"設定を管理",createNew:"新規ウィジェットセット",editSettings:"設定を編集",editingSettings:"編集中の設定",settingsName:"設定名",settingsNamePlaceholder:"設定名を入力",maxLength:"最大128文字",download:"画像ダウンロード",useAggregation:"集約",aggregationInterval:"集約間隔",movingAverageWindow:"移動平均ウィンドウ",cumulativeType:"分布タイプ",cumulativeTotal:"合計値",cumulativeIndividual:"全ダイスの出目",cumulativeShowOnlyActual:"実データ範囲のみ表示",cumulativeQuantile:"分位点による集約",cumulativeQuantileCount:"分位点数",aggregation:{title:"データ集約",useAggregation:"集約を使用",intervalLabel:"集約間隔の目安（件数）",apply:"適用",reset:"リセット",status:"データポイント数: {{count}}",statusAggregated:"✓ 集約中（約{{interval}}件ずつ）"},binning:{title:"ビニング設定",useBinning:"ビニングを使用",algorithm:"アルゴリズム",equalWidth:"等幅",scott:"Scott's rule",fd:"Freedman-Diaconis",binWidthMultiple:"ビン幅の倍数",status:"データポイント数: {{count}}",statusBinned:"{{binCount}}ビン（幅: {{binWidth}}）に集約"},targetValue:{title:"特定の目を集計",label:"集計する目の値",range:"{{min}}-{{max}}の範囲で指定"},movingAverage:{title:"移動平均の設定",windowLabel:"移動平均ウィンドウ（試行数）",apply:"適用",reset:"リセット",description:"移動平均を表示: {{window}}試行"},cumulative:{title:"累積分布の設定",distributionType:"分布タイプ",total:"合計値",individual:"出目（全ダイス統合）",dataRange:"データ表示範囲",fullRange:"全範囲",actualOnly:"実データのみ",quantileAggregation:"分位点による集約",points:"{{count}}点",aggregationLabel:"集約: {{count}}点",yAxisRange:"Y軸範囲指定",yAxisMin:"最小値 (%)",yAxisMax:"最大値 (%)",resetRange:"範囲をリセット",apply:"適用",reset:"リセット"},xAxisScale:{title:"X軸範囲設定",mode:"範囲指定モード",auto:"自動",semiAuto:"初期範囲で固定",manual:"手動",rangeLabel:"表示範囲",min:"最小値",max:"最大値",apply:"適用",reset:"リセット",description:{auto:"データに応じて自動調整","semi-auto":"初期レンダリング時の範囲を維持",manual:"指定した範囲で固定"},manualHelp:"空欄の場合は自動で範囲が調整されます",placeholder:"空欄で自動"},yAxisScale:{title:"Y軸範囲設定",mode:"範囲指定モード",auto:"自動",semiAuto:"初期範囲で固定",manual:"手動",rangeLabel:"表示範囲",min:"最小値",max:"最大値",apply:"適用",reset:"リセット",description:{auto:"データに応じて自動調整","semi-auto":"初期レンダリング時の範囲を維持",manual:"指定した範囲で固定"},manualHelp:"空欄の場合は自動で範囲が調整されます",placeholder:"空欄で自動"}},noData:"結果がありません",message:{startRoll:"ダイスロールを実行すると、ここに結果が表示されます"},description:{totalDistribution:"全試行における合計値の出現頻度をヒストグラムで表示します。",theoreticalDistributionComparison:"期待頻度（理論値）と比較して、実際の分布の偏りを確認できます。",cumulativeTotal:"特定の合計値以上が出る確率の累積分布を表示しています。",cumulativeIndividual:"特定の出目以上が出る確率の累積分布を表示しています。",theoreticalComparison:"理論値（点線）と実測値を比較できます。",rollProgress:"各試行での合計値の推移を表示しています。移動平均により傾向を把握できます。",expectedValueComparison:"期待値ライン（点線）との比較で、偏りの有無を確認できます。",progressDescription:"各試行での合計値の推移を表示しています。移動平均により傾向を把握できます。",expectedLineDescription:"期待値ライン（点線）との比較で、偏りの有無を確認できます。",individualDiceDescription:"このグラフは、複数のダイスを振った際に、それぞれのダイスで出た目を個別に集計したものです。\n各出目が全体で何回出現したかを表示しています。"},view:{chart:"グラフ",table:"表形式",manage:"ウィジェットセット管理",saveCurrentView:"現在のセットを保存",overwrite:"上書き",selectView:"ウィジェットセット",presetGroup:"プリセット設定",customGroup:"カスタム設定",layout:"レイアウト",layoutType:{"4row1col":"4行1列","2row2col":"2行2列","2row1col3col":"2行（1列+3列）"}},widget:{add:"ウィジェットを追加",duplicate:"複製",remove:"削除",resetToDefault:"デフォルト構成に戻す",limitReached:"グラフ数が上限（{{max}}個）に達しています",minLimitReached:"最低1つのグラフが必要です",confirmReset:"デフォルト構成（4グラフ）にリセットしますか？",autoName:"{{type}} #{{index}}",graphTypes:{result:"合計値",cumulative:"累積分布",rollProgress:"試行推移",individual:"個別出目",recentRolls:"ロール結果"}},preset:{default:"デフォルト設定"},menu:{options:"その他のオプション",csvDownload:"CSVダウンロード",rollReset:"ロールリセット",confirmReset:"結果をリセットしてもよろしいですか？",csvDownloadFailed:"CSVのダウンロードに失敗しました",fullScreen:"全画面表示",exitFullScreen:"全画面表示を終了",toggleLegend:"凡例表示切り替え (F)"},targetStats:{title:{base:"特定の目の集計",single:"特定の目（{{value}}）の集計 - {{dice}} / {{trials}}回試行",comparison:"特定の目（{{value}}）の比較 - {{count}}件のダイスセット比較"},occurrences:"{{value}}の出現回数",occurrenceRate:"（出現率: {{rate}}%）",yAxis:"出現回数",summary:{title:"【{{value}}】の統計サマリー",total:"合計出現回数: {{count}}回",average:"ダイスあたり平均: {{average}}回",rate:"全試行中の出現率: {{rate}}%",range:"最大: {{max}}回 / 最小: {{min}}回"},totalAppearances:"合計出現回数",averagePerDice:"ダイスあたり平均",appearanceRate:"出現率",maxMin:"最大: {{max}}回 / 最小: {{min}}回"},result:{title:"結果表示"},recentRolls:{noResultsYet:"まだ結果がありません",trialNumber:"{{number}} 回目",total:"合計",countLabel:"表示件数",countOption:"{{count}}件",highlightLabel:"ハイライトする出目",highlightPlaceholder:"例: 1, 6 または 1-6, 2n, 3n+1",highlightHelp:"カンマ、スペースで区切って複数値指定（例：2,5,8）、数値間をハイフンで区切って範囲指定（例：50-100）できます。倍数指定（例：2n, 5n+3）も可能です"}},pa={config:{title:"ダイス設定",titleEdit:"ダイス設定の編集",titleCreate:"ダイス設定の新規追加",editingMultiple:"{{count}}件編集",name:{label:"ダイスセット名（128文字まで）",placeholder:"ダイスセット名を記入（任意）"},count:{label:"ダイスの数 ({{min}}-{{max}})",description:"振るダイスの数"},sides:{label:"面の数 ({{min}}-{{max}})",description:"ダイスの面の数"},modifier:{label:"修正値 ({{min}}-{{max}})",sign:"符号",value:"値",add:"加算",subtract:"減算"},trial:{label:"試行回数 ({{min}}-{{max}})",description:"実行する試行の回数"},notation:{label:"ダイス記法",copy:"クリップボードにコピー",copied:"コピー完了",preview:"プレビュー"},editing:{multipleMessage:"{{count}}件のダイスセットを編集中です"},unspecified:"未指定"},action:{simulate:"ダイスロール開始",reroll:"振り直し",addRoll:"追加ロール",reset:"結果をリセット",export:"CSVでエクスポート"}},xa={title:"ダイスセット",empty:"ダイスセットがありません",selectPrompt:"ダイスセットを選択してください",selectOrCreatePrompt:"ダイスセットを選択または作成してください",list:{multiSelectMode:"複数選択モード",selected:"{{count}}件選択中",comparing:"{{count}}件のダイスセットを比較中"},action:{create:"新規作成",createShort:"新規",compare:"比較",export:"エクスポート",import:"インポート",bulkDelete:"一括削除",bulkDuplicate:"一括複製",bulkDuplicateShort:"選択を一括複製",bulkDeleteShort:"選択を一括削除",deleteAll:"全て削除",deleteAllShort:"全削除",reorder:"並び替え",clearSelection:"選択解除",change:"変更",selectDiceSet:"ダイスセットを選択"},confirm:{delete:"このダイスセットを削除してもよろしいですか？",deleteAll:"全てのダイスセットを削除してもよろしいですか？",bulkDelete:"選択した{{count}}件のダイスセットを削除してもよろしいですか？",bulkDeleteWarning:"選択中の{{count}}件のダイスセットを削除してもよろしいですか？\nこの操作は取り消せません。"},copy:{suffix:"のコピー"},limit:{reached:"ダイスセット数が上限（{{max}}個）に達しています",maxRecords:"記録可能な最大試行数（{{max}}回）を超えています"},target:{label:"対象",all:"すべて ({{count}})",selected:"選択中"},multiSelect:{label:"複数選択"},viewing:{single:"{{count}}件のダイスセットを閲覧中",multiple:"{{count}}件のダイスセットを比較中"},tooltip:{create:"新しいダイスセットを作成",maxReached:"ダイスセット数が上限に達しています",addRollDisabled:"特定の目が変更されたため追加ロールできません"}},fa={dice:{count:{required:"ダイスの数を入力してください",range:"ダイスの数は{{min}}〜{{max}}の範囲で指定してください",invalid:"ダイスの数が不正です"},sides:{required:"面の数を入力してください",range:"面の数は{{min}}〜{{max}}の範囲で指定してください",invalid:"面の数が不正です"},modifier:{range:"修正値は{{min}}〜{{max}}の範囲で指定してください",invalid:"修正値が不正です"}},trial:{required:"試行回数を入力してください",range:"試行回数は{{min}}〜{{max}}の範囲で指定してください",invalid:"試行回数が不正です"},diceSet:{nameRequired:"ダイスセット名を入力してください",nameTooLong:"ダイスセット名は{{max}}文字以内で入力してください",limitReached:"ダイスセット数の上限に達しています"},file:{invalidFormat:"ファイル形式が不正です",parseError:"ファイルのパースに失敗しました",readError:"ファイルの読み込みに失敗しました"},chart:{aggregationRange:"集約間隔は{{min}}〜{{max}}の範囲で指定してください",targetValueRange:"目の値は{{min}}〜{{max}}の範囲で指定してください"}},ya={success:{diceSetCreated:"新しいダイスセットを作成しました",diceSetDeleted:"ダイスセットを削除しました",diceSetDuplicated:"ダイスセットを複製しました",diceSetUpdated:"ダイス設定を更新しました",bulkDeleted:"{{count}}件のダイスセットを削除しました",bulkDuplicated:"{{count}}件のダイスセットを複製しました",rollCompleted:"{{count}}回のダイスロールが完了しました",dataExported:"データをエクスポートしました",dataImported:"データをインポートしました",migrated:"LocalStorageからIndexedDBへ移行しました",copied:"クリップボードにコピーしました",settingsCreated:"設定を作成しました",settingsCreatedWithName:"設定「{{name}}」を作成しました",settingsDuplicatedWithName:"設定「{{name}}」を複製しました",settingsSaved:"設定を保存しました",settingsUpdated:"設定を更新しました",settingsRenamed:"設定名を変更しました",settingsDeleted:"設定を削除しました"},error:{diceSetCreateFailed:"ダイスセットの作成に失敗しました",diceSetDeleteFailed:"ダイスセットの削除に失敗しました",diceSetDuplicateFailed:"ダイスセットの複製に失敗しました",diceSetUpdateFailed:"ダイスセットの更新に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",rollFailed:"ダイスロールに失敗しました",loadFailed:"データの読み込みに失敗しました",exportFailed:"エクスポートに失敗しました",importFailed:"インポートに失敗しました",copyFailed:"クリップボードへのコピーに失敗しました",csvDownloadFailed:"CSVのダウンロードに失敗しました",imageGenerationFailed:"画像の生成に失敗しました",generic:"エラーが発生しました",partialSuccess:"{{completed}}件完了、{{failed}}件エラー:\n{{errors}}",cannotModifyDefault:"デフォルト設定は変更できません",diceSetLimitReached:"ダイスセット数が上限（{{max}}個）に達しています",bulkDuplicateLimitReached:"ダイスセット数の上限により、{{count}}件までしか複製できません",trialCountExceeded:"試行回数が上限の{{max}}件を超えています",maxRecordsExceeded:"記録可能な上限（{{max}}件）を超えるため、追加ロールできません",settingImportSkipped:'ウィジェットセット設定 "{{name}}" のインポートをスキップ:'},import:{successWithDetails:"{{details}}をインポートしました",diceSetsCount:"ダイスセット{{count}}件",chartSettingsCount:"ウィジェットセット設定{{count}}件"},info:{processing:"処理中...",simulating:"シミュレーション中... ({{progress}}%)",noResults:"結果がありません",noDiceSets:"ダイスセットがありません",resetResults:"結果をリセットしました",selectDiceSet:"ダイスセットを選択してください"},warning:{unsavedChanges:"未保存の変更があります",configChanged:"ダイス設定が変更されています",noImportableData:"インポートできるデータがありません（すべて既に存在します）",addRollDisabled:"特定の目が変更されたため追加ロールできません"}},ba={title:"更新履歴",entries:[{version:"0.1.10",date:"2026-01-03",changes:{added:["直近のロール結果を表示するウィジェット「ロール結果」を追加（表示件数: 1〜3件）","ロール結果ウィジェットに出目ハイライト機能を追加（単一値、範囲、倍数指定に対応）","合計値分布グラフのビニング機能に「等幅」アルゴリズムを追加","ウィジェットセットに「選択中のダイスセットを記憶する」オプションを追加（ウィジェットセットごとに異なるダイスセットを自動選択可能に）"],changed:["名称変更：「グラフビュー」→「ウィジェットセット」、「グラフボックス」→「ウィジェット」","ビニング機能のデフォルトアルゴリズムを「等幅」に変更（データ範囲を均等分割し、両端も含めて均一な頻度表示が可能に）"],fixed:["その他コードの最適化を実施"]}},{version:"0.1.9",date:"2026-01-02",changes:{fixed:["累積分布グラフのオプションメニューでグラフ外観を変更するとカスタムメニュー項目が消える問題を修正","その他軽微な修正"]}},{version:"0.1.8",date:"2026-01-01",changes:{added:["ウィジェットの全画面表示機能を追加（全画面モードではCharts.js標準の凡例を常に表示させます）"],changed:["PC版のグラフビュー設定エディタのタブ表示を横スクロールからサイドバー方式に変更","モバイル版のグラフビュー設定エディタでグラフ選択をドロップダウンに変更"],fixed:["ウィジェット内のグラフオプションでビニング設定を変更して上書き保存しても設定が保存されない問題を修正","モバイルデバイスでモーダル内コンテンツがはみ出す問題を修正","各ウィジェットのグラフオプションでグラフタイプ切り替えボタンが表示されない問題を修正"]}},{version:"0.1.7",date:"2026-01-01",changes:{added:["合計値分布グラフにビニング機能を追加（Scott's rule、Freedman-Diaconis法によるビン幅自動計算）","グラフ画像ダウンロード時の背景色をテーマに応じて自動設定（ライトモード: 白、ダークモード: グレー）","全体設定にグラフ背景を透明にするオプションを追加","各ウィジェットごとに凡例の表示・非表示状態を保存する機能を追加"],changed:["合計値分布グラフの集約設定をビニング設定に移行","グラフ画像のファイル名を統一形式に変更（チャートタイプ_タイムスタンプ.png）"],fixed:[]}},{version:"0.1.6",date:"2025-12-31",changes:{added:["全グラフにY軸範囲指定機能を追加（自動/半自動/手動モード対応）"],changed:["グラフビュー設定の構造をウィジェットベースに変更し、各ウィジェットごとに独立した設定を保持するように改善","グラフビュー設定エディタのタブを動的生成に変更し、ウィジェットの追加・削除・複製に対応","グラフビュー設定にウィジェットの配置情報を保存するように変更","プリセット設定をデフォルトのみに簡略化","累積分布グラフのY軸範囲指定をX軸範囲指定と同じ統一された方式に変更"],fixed:["ウィジェットを複製した際に設定が共有されてしまう問題を修正","グラフビュー設定を切り替えてもウィジェットの配置が反映されない問題を修正"]}},{version:"0.1.5",date:"2025-12-30",changes:{added:["ダイスセット一覧に編集ボタンを追加（メニューを開かずに直接編集可能に）","ダイスセット一覧にダイス記法のコピーボタンを追加（ダイス記法の横に配置）"],changed:[],fixed:[]}},{version:"0.1.4",date:"2025-12-29",changes:{added:[],changed:[],fixed:["スマートフォンでグラフの並び替えができない問題を修正（タッチ操作に対応）"]}},{version:"0.1.3",date:"2025-12-29",changes:{added:["グラフエリアのレイアウト選択機能を追加（4行1列/2行2列/2行（1列+3列）の3種類）","各グラフの表示順序を変更できる機能を追加","ウィジェットセット設定選択欄に編集ボタンを追加（グラフビュー設定モーダルへの導線を減らしました）"],changed:["凡例ラベルを各グラフから分離し、グラフエリア上部に一元化して表示するように変更","ダイスセット名を空欄にできるように変更。空欄の場合はダイス記法（例：dice2d6+3）が自動的に表示されます","試行推移グラフは線グラフのみをサポートするように変更（棒グラフが指定されている場合は自動的に線グラフを表示）","試行推移グラフの移動平均線を点線で表示するように変更","グラフビュー設定モーダルのUIをアコーディオン式からタブ式に変更","ダイスセットリスト、グラフ凡例、比較画面でのダイスセット名表示に連番の接頭辞を付与"],fixed:["グラフビュー設定の新規作成時にグラフオプションを変更しても反映されない問題を修正"]}},{version:"0.1.2",date:"2025-12-26",changes:{added:[],changed:[],fixed:["試行推移グラフと累積分布グラフのチャートタイプを変更して上書き保存しても設定が保持されない問題を修正"]}},{version:"0.1.1",date:"2025-12-26",changes:{added:["グラフX軸範囲設定機能（自動/半自動/手動の3モード）を追加","グラフビュー管理モーダルで各グラフのオプション（チャートタイプ、集約設定、移動平均など）を編集できる機能を追加","グラフビュー設定を新規作成する際、名前だけでなく各グラフの初期設定を編集できるように"],changed:["グラフオプションメニューの幅を拡大して操作性を改善","グラフ設定編集メニューのラベルを「名前変更」から「編集」に変更","グラフ設定編集モーダルのタイトルを「設定名を変更」から「設定を編集」に変更"],fixed:["スマホ版ダイスセット一覧モーダルで全削除機能が動作しない問題を修正"]}},{version:"0.1.0",date:"2025-12-24",changes:{added:["ダイスロールシミュレーション機能","結果の表形式表示","結果のグラフ表示（正規分布、累積分布、個別ダイス、ターゲット値別など）","ダイスセットの保存・管理機能","CSVエクスポート機能","画像エクスポート機能","日本語/英語の多言語対応","ダークモード対応","レスポンシブデザイン"],changed:[],fixed:[]}}],categories:{added:"追加",changed:"変更",fixed:"修正",removed:"削除",security:"セキュリティ"}},va={button:{start:"Start",reroll:"Reroll",addRoll:"Add Roll",save:"Save",cancel:"Cancel",close:"Close",delete:"Delete",duplicate:"Duplicate",edit:"Edit",apply:"Apply",confirm:"Confirm",create:"Create",export:"Export",import:"Import",copy:"Copy",reset:"Reset",ok:"OK",yes:"Yes",no:"No",back:"Back",next:"Next"},action:{edit:"Edit",save:"Save",cancel:"Cancel",delete:"Delete",duplicate:"Duplicate",create:"Create",close:"Close",change:"Change"},unit:{count:"items",piece:"pcs",times:"times",diceSet:"dice set"},label:{loading:"Loading...",processing:"Processing...",noData:"No data available",help:"Help",toggleTheme:"Toggle Theme",toggleLanguage:"Toggle Language",settings:"Settings",firstPage:"First Page",lastPage:"Last Page",quantile:"Quantile",aggregation:"Aggregation",target:"Target",all:"All",preview:"Preview",list:"List",roll:"Roll",start:"Start",addMore:"Roll more",noChanges:"No changes",trial:"Trial",dice:"Dice",modifier:"Modifier",total:"Total"},punctuation:{comma:", "},none:"None",unnamed:"Unnamed",siteName:"Dice Simulator",menu:{options:"Options",edit:"Edit",duplicate:"Duplicate",delete:"Delete"},emptyState:{noItems:"No items available"},selection:{moving:"Moving...",selected:"selected",deselect:"Deselect"},custom:"Custom"},Sa={title:"Guide",closeButton:"Close",aboutSection:{description:{before:"For more information about this app and privacy policy, please see",after:"."},linkText:"here"},basicSettings:{diceNotation:{title:"About Dice Notation",description:"Dice notation is specified in the following format:",format:"dice[count]d[sides](+|-)[modifier]",parameters:{count:{label:"Count",description:"Number of dice to roll (1-10)"},sides:{label:"Sides",description:"Number of sides on each die (1-9,999)"},modifier:{label:"Modifier",description:"Optional. Value to add or subtract from result (0-99,999)"}}},examples:{title:"Usage Examples",items:[{notation:"dice1d6",description:"→ Roll one 6-sided die"},{notation:"dice3d6+2",description:"→ Roll three 6-sided dice and add 2 to the total"},{notation:"dice2d10-5",description:"→ Roll two 10-sided dice and subtract 5 from the total"}]},trials:{title:"Number of Trials",description:"You can execute the same dice roll multiple times (1-1,000 times).\nIncreasing the number of trials allows you to verify more accurate probability distributions."}},diceSetManagement:{diceSetFeatures:{title:"Dice Set Features",features:["Save each dice set with any name (up to 128 characters)","Store up to 20 dice sets","Results are automatically saved to browser IndexedDB","Duplicate and delete dice sets","Reorder dice sets via drag and drop","Export/import entire dice sets in JSON format","Select multiple dice sets for bulk duplicate/delete","Bulk delete all dice sets (with confirmation dialog)"]},comparison:{title:"Dice Set Comparison",features:["Select multiple dice sets to compare in charts","In comparison mode, each dice set is displayed in a different color","Compare up to 20 dice sets simultaneously","Trial count is displayed in each dice set's label during comparison"]}},resultDisplay:{title:"Result Display",table:{label:"Table Format",description:"Display detailed results of each trial in list format",features:["Shows trial number, each die value, and total value","Pagination feature (25 items per page)","Export to CSV format available"]},chart:{label:"Chart Format",description:"Visualize result distribution (4 chart types)",types:{distribution:{icon:"📊",title:"Total Value Distribution",features:["Display histogram of total value distribution across all trials","Toggle between bar chart and line chart","Display statistical information as annotation lines (mean: green, median: orange, expected value: pink, ±1σ: purple)","Highlight bars/points corresponding to median in orange","Overlay theoretical distribution as gray dotted line (single diceSet only)","Data aggregation feature for viewing large datasets clearly"]},cumulative:{icon:"📈",title:"Cumulative Distribution",features:["Display cumulative probability distribution","Support both total values and individual dice","Compare actual and theoretical values","Toggle display of quantiles (deciles, vigintiles, etc.)",'Visually grasp "probability of rolling this value or less"']},progress:{icon:"📉",title:"Trial Progress",features:["Display progression of total values across trials","Verify result variation in time series","Display moving average line to understand trends","Adjust moving average window size (5-100 trials)"]},individualDice:{icon:"🎲",title:"Individual Die Value Distribution",features:["Display distribution of each die's values (when 2+ dice)","Toggle between bar chart and line chart","Overlay theoretical distribution as gray dotted line","Data aggregation feature for viewing large datasets clearly"]}}}},advancedFeatures:{dataAggregation:{title:"Data Aggregation Feature",description:"When displaying charts, if there are many data points, you can use the aggregation feature to display them more clearly.",features:[{label:"Use Data Aggregation",description:"Group and display data evenly based on specified interval"},{label:"Aggregation Interval",description:"Set approximately how many items to group together (2-5,000, default: 20)"},{label:"Supported Charts",description:"Total value distribution chart, individual die value distribution chart"},{label:"Example: Setting interval to 20 divides the whole into approximately 20 evenly sized groups",subFeatures:["Each group is automatically adjusted to be as even as possible to avoid remainders"]},{label:'When aggregated, "Aggregation: XX" is displayed in the chart title'}]},chartSettings:{title:"Saving Chart Settings",description:"Save and reuse chart display settings (chart type, aggregation settings, etc.).",features:["Create and manage multiple setting presets","Rename, duplicate, and delete settings","Display warning when there are unsaved changes","Save display settings for each chart individually","Default settings cannot be deleted or modified"]}},globalSettings:{title:"Global Settings",description:"You can open global settings from the gear icon in the header (footer on mobile).",appearance:{label:"Appearance",features:["Theme switching (light/dark/follow system settings)","Selection is automatically saved to browser"]},dataManagement:{label:"Data Management",features:[{label:"Export Data",description:"Backup all dice sets and custom chart settings in JSON format",subFeatures:["Default and preset settings are excluded"]},{label:"Import Data",description:"Restore from exported JSON file",subFeatures:["Merged with existing data (not overwritten)"]},{label:"Delete All Data",description:"Delete all dice sets and chart settings (with confirmation dialog)"},{label:"Display saved dice set count and chart settings count"}]}},operations:{retryAndRoll:{title:"Retry and Add Roll",features:[{label:"Reset Results",description:"Clear current dice set results (with confirmation dialog)"},{label:"Retry",description:"Clear existing results and replace with new results"},{label:"Add Roll",description:"Execute additional dice rolls while preserving existing results",subFeatures:["Display warning if dice configuration has changed","Integrated with existing data during additional execution"]}]},dataExport:{title:"Data Export",description:"Export results and dice set data in various formats.",features:[{label:"CSV Format",description:"Download results as tabular CSV file"},{label:"PNG Format",description:"Download chart as image"},{label:"JSON Format",description:"Export/import entire dice sets in JSON format"},{label:"Clipboard Copy",description:"Copy dice configuration preview string"}]}}},wa={title:"About / Privacy",sections:{app:{title:"About This App",description:"{{siteName}} is a web application for simulating multiple dice rolls and analyzing results statistically. You can verify probability distributions of dice used in TRPGs (Tabletop Role-Playing Games), board games, and more."},data:{title:"Data Handling",items:["This application stores all data locally in your browser","Dice set data: Stored in IndexedDB","Settings (dark mode, etc.): Stored in LocalStorage","No data is sent to any server","No personal information is collected","No integration with external services","Data management is the user's responsibility. Saved data may be lost due to browser data clearing or updates, so we recommend regularly backing up important data using the export feature"]},disclaimer:{title:"Disclaimer",items:["This application is provided without warranty","We cannot guarantee the accuracy or continuity of operation","The developer assumes no responsibility for damages arising from use of this app"]},libraries:{title:"Libraries Used",description:"This application uses the following open-source libraries:",items:["React (MIT License)","Chart.js (MIT License)","Tailwind CSS (MIT License)","Vite (MIT License)"]},version:{version:"Version: {{version}}",lastUpdated:"Last Updated: {{date}}"}}},ka={title:"Global Settings",close:"Close",appearance:{title:"Appearance",theme:{title:"Theme",description:"Select the application display theme",light:"Light",dark:"Dark",system:"System"},language:{title:"Language",description:"Select the application display language"},chartImage:{title:"Chart Images",description:"Settings for downloading charts as images",transparentExport:{label:"Export with transparent background",description:"When enabled, chart images will be downloaded with a transparent background"}}},dataManagement:{title:"Data Management",currentData:{title:"Saved Data",diceSets:"Dice Sets: {{count}}",chartSettings:"Chart Settings: {{count}}"},backup:{title:"Backup and Restore",description:"Export or import a complete backup including all dice sets and chart settings in JSON format. Compatible with legacy dice-set-only files.",export:"Export",exportDescription:"Save all data as JSON",import:"Import",importDescription:"Restore from backup file"},reset:{title:"Complete Data Deletion",description:"Delete all dice sets, chart settings, and application settings. This action cannot be undone.",button:"Delete All Data",confirm:"Are you sure you want to delete all data?",confirmButton:"Delete",cancel:"Cancel",processing:"Deleting...",resetError:"Failed to reset data"}},system:{resetError:"Failed to delete IndexedDB"},chartSettings:{title:"Manage Widget Sets",renameTitle:"Rename Settings",editTitle:"Edit Settings",duplicateTitle:"Duplicate Settings",close:"Close",new:"+ New",create:"Create New",rename:"Rename",edit:"Edit",duplicate:"Duplicate",delete:"Delete",save:"Save",change:"Change",cancel:"Cancel",discard:"Discard",preset:"Preset",custom:"Custom",inUse:"In Use",selected:"{{count}} selected",emptyMessage:"No settings available",maxLength:"Max 128 characters",copyNameSuffix:" Copy",unsavedChanges:"You have unsaved changes",unsavedWarning:"You have unsaved changes. Click the Save button for the settings you want to save.",savePrompt:"Do you want to save your changes?",nameLabel:"Settings Name",namePlaceholder:"Enter settings name",rememberDiceSet:{label:"Remember Selected Dice Sets",description:"Automatically select the remembered dice sets when switching to this widget set"},chartOptions:"Chart Options",moreOptions:"More options",bulkActions:{title:"Bulk Actions",duplicate:"Bulk Duplicate Selected",delete:"Bulk Delete Selected",selectAll:"Select All",deselectAll:"Deselect All"},errors:{nameRequired:"Please enter a settings name",duplicateFailed:"Failed to duplicate settings",renameFailed:"Failed to rename settings",deleteFailed:"Failed to delete settings",saveFailed:"Failed to save",bulkDeleteFailed:"Failed to bulk delete",bulkDuplicateFailed:"Failed to bulk duplicate",cannotDeletePreset:"Cannot delete preset settings",noSelection:"No deletable settings selected",noDuplicateSelection:"Please select settings to duplicate"},confirmDelete:'Delete settings "{{name}}"?',confirmBulkDelete:"Delete {{count}} settings?"},about:{link:"About / Privacy"}},Ca={type:{bar:"Bar Chart",line:"Line Chart"},title:{totalDistribution:"Total Value Distribution",totalDistributionShort:"Total",cumulative:"Cumulative Distribution - {{diceCode}} / {{trials}} trials{{quantile}}",cumulativeTotalBase:"Cumulative Distribution (Total)",cumulativeTotalBaseShort:"Cumulative",cumulativeIndividualBase:"Cumulative Distribution (All Dice)",cumulativeIndividual:"Cumulative Distribution (All Dice Values) - {{diceCode}} / {{trials}} trials{{quantile}}",cumulativeComparison:"Cumulative Distribution Comparison - {{count}} dice sets{{quantile}}",cumulativeComparisonIndividual:"Cumulative Distribution Comparison (All Dice Values) - {{count}} dice sets{{quantile}}",cumulativeAggregated:"Cumulative Distribution - {{diceCode}} (Aggregated)",individualDice:"Individual Die Value Distribution",individualDiceShort:"Individual",rollProgress:"Trial Progress - {{diceCode}} / {{trials}} trials{{aggregation}}",rollProgressBase:"Trial Progress",rollProgressBaseShort:"Progress",rollProgressComparison:"Trial Progress Comparison - {{count}} dice sets{{aggregation}}",targetValue:"Specific Value Occurrences",comparison:"Comparing {{count}} dice sets"},subtitle:{trialCount:"{{count}} trials",aggregation:"Aggregation: {{interval}}",binning:"Binning: {{algorithm}} ({{binCount}} bins)",quantilePoints:"{{count}} points",custom:"Custom"},legend:{title:"Legend",actual:"Actual",actualSampled:"Actual (Sampled)",actualCumulative:"Cumulative Distribution (Actual)",theoretical:"Theoretical",theoreticalCumulative:"Theoretical",movingAverage:"Moving Average",movingAverageWindow:"Moving Average ({{window}} trials)",expectedValue:"Expected Value ({{value}})",showMore:"Show {{count}} more",collapse:"Collapse"},axis:{total:"Total Value",diceValue:"Die Value",trialNumber:"Trial Number",frequency:"Frequency",cumulativeProbability:"Cumulative Probability (%)",dicePosition:"Die Position"},stats:{mode:"Mode",stdDev:"Standard Deviation",expectedValue:"Expected Value",totalCount:"Total",averagePerDice:"Average (per die)",maxCount:"Maximum",minCount:"Minimum",individualStats:"Individual Die Statistics",dataPoints:"Data points displayed: {{count}}"},options:{title:"Chart Options",widgetType:"Widget Type",chartType:"Chart Type",displaySettings:"Display Settings",manageSettings:"Manage Settings",createNew:"Create New Settings",editSettings:"Edit Settings",editingSettings:"Editing Settings",settingsName:"Settings Name",settingsNamePlaceholder:"Enter settings name",maxLength:"Maximum 128 characters",download:"Download Image",useAggregation:"Aggregation",aggregationInterval:"Aggregation Interval",movingAverageWindow:"Moving Average Window",cumulativeType:"Distribution Type",cumulativeTotal:"Total Value",cumulativeIndividual:"All Dice Values",cumulativeShowOnlyActual:"Show Actual Data Range Only",cumulativeQuantile:"Quantile Aggregation",cumulativeQuantileCount:"Quantile Count",aggregation:{title:"Data Aggregation",useAggregation:"Use Aggregation",intervalLabel:"Aggregation Interval (approximate count)",apply:"Apply",reset:"Reset",status:"Data points: {{count}}",statusAggregated:"✓ Aggregated (approx. every {{interval}} items)"},binning:{title:"Binning Settings",useBinning:"Use Binning",algorithm:"Algorithm",equalWidth:"Equal Width",scott:"Scott's rule",fd:"Freedman-Diaconis",binWidthMultiple:"Bin Width Multiple",status:"Data points: {{count}}",statusBinned:"{{binCount}} bins (width: {{binWidth}})"},targetValue:{title:"Specific Value Count",label:"Value to count",range:"Specify in range {{min}}-{{max}}"},movingAverage:{title:"Moving Average Settings",windowLabel:"Moving Average Window (trials)",apply:"Apply",reset:"Reset",description:"Show moving average: {{window}} trials"},cumulative:{title:"Cumulative Distribution Settings",distributionType:"Distribution Type",total:"Total Value",individual:"Individual Die (All Dice Combined)",dataRange:"Data Display Range",fullRange:"Full Range",actualOnly:"Actual Data Only",quantileAggregation:"Quantile Aggregation",points:"{{count}} points",aggregationLabel:"Aggregation: {{count}} points",yAxisRange:"Y-Axis Range",yAxisMin:"Min (%)",yAxisMax:"Max (%)",resetRange:"Reset Range",apply:"Apply",reset:"Reset"},xAxisScale:{title:"X-Axis Scale Settings",mode:"Scale Mode",auto:"Auto",semiAuto:"Lock Initial Range",manual:"Manual",rangeLabel:"Display Range",min:"Min",max:"Max",apply:"Apply",reset:"Reset",description:{auto:"Automatically adjust to data","semi-auto":"Lock initial rendering range",manual:"Fix to specified range"},manualHelp:"Empty fields will be auto-scaled",placeholder:"Auto if empty"},yAxisScale:{title:"Y-Axis Scale Settings",mode:"Scale Mode",auto:"Auto",semiAuto:"Lock Initial Range",manual:"Manual",rangeLabel:"Display Range",min:"Min",max:"Max",apply:"Apply",reset:"Reset",description:{auto:"Automatically adjust to data","semi-auto":"Lock initial rendering range",manual:"Fix to specified range"},manualHelp:"Empty fields will be auto-scaled",placeholder:"Auto if empty"}},noData:"No results",message:{startRoll:"Results will appear here when you roll the dice"},description:{totalDistribution:"Displays a histogram of total value frequencies across all trials.",theoreticalDistributionComparison:"Compare with expected frequency (theoretical) to check for distribution bias.",cumulativeTotal:"Displays the cumulative probability distribution of getting a total value or higher.",cumulativeIndividual:"Displays the cumulative probability distribution of getting a die value or higher.",theoreticalComparison:"You can compare the theoretical values (dashed line) with actual measurements.",rollProgress:"Shows the progression of total values for each trial. Use moving average to identify trends.",expectedValueComparison:"Compare with the expected value line (dashed) to check for bias.",progressDescription:"Shows the progression of total values for each trial. Use moving average to identify trends.",expectedLineDescription:"Compare with the expected value line (dashed) to check for bias.",individualDiceDescription:"This chart aggregates individual dice outcomes when rolling multiple dice. \nIt shows how many times each outcome appeared in total."},view:{chart:"Chart",table:"Table",manage:"Manage Widget Sets",saveCurrentView:"Save current set",overwrite:"Overwrite",selectView:"Widget Set",presetGroup:"Preset Settings",customGroup:"Custom Settings",layout:"Layout",layoutType:{"4row1col":"4 Rows × 1 Column","2row2col":"2 Rows × 2 Columns","2row1col3col":"2 Rows (1 Column + 3 Columns)"}},widget:{add:"Add Widget",duplicate:"Duplicate",remove:"Remove",resetToDefault:"Reset to Default",limitReached:"Graph limit ({{max}}) reached",minLimitReached:"At least one graph is required",confirmReset:"Reset to default configuration (4 graphs)?",autoName:"{{type}} #{{index}}",graphTypes:{result:"Total",cumulative:"Cumulative",rollProgress:"Progress",individual:"Individual",recentRolls:"Roll Results"}},preset:{default:"Default Settings"},menu:{options:"More options",csvDownload:"Download CSV",rollReset:"Reset Rolls",confirmReset:"Are you sure you want to reset the results?",csvDownloadFailed:"Failed to download CSV",fullScreen:"Full Screen",exitFullScreen:"Exit Full Screen",toggleLegend:"Toggle Legend (F)"},targetStats:{title:{base:"Target Value Statistics",single:"Target Value ({{value}}) Statistics - {{dice}} / {{trials}} trials",comparison:"Target Value ({{value}}) Comparison - {{count}} dice sets"},occurrences:"Occurrences of {{value}}",occurrenceRate:"(Rate: {{rate}}%)",yAxis:"Occurrences",summary:{title:"Summary for [{{value}}]",total:"Total occurrences: {{count}}",average:"Average per die: {{average}}",rate:"Occurrence rate: {{rate}}%",range:"Max: {{max}} / Min: {{min}}"},totalAppearances:"Total appearances",averagePerDice:"Average per die",appearanceRate:"Appearance rate",maxMin:"Max: {{max}} / Min: {{min}}"},result:{title:"Results"},recentRolls:{noResultsYet:"No results yet",trialNumber:"Trial {{number}}",total:"Total",countLabel:"Display Count",countOption:"{{count}} result_one",countOption_other:"{{count}} results",highlightLabel:"Highlight Values",highlightPlaceholder:"e.g., 1, 6 or 1-6, 2n, 3n+1",highlightHelp:"Specify multiple values separated by commas or spaces (e.g., 2,5,8). Use hyphens for ranges (e.g., 50-100). Modulo notation is also supported (e.g., 2n, 5n+3)"}},ja={config:{title:"Dice Configuration",titleEdit:"Edit Dice Configuration",titleCreate:"Create New Dice Configuration",editingMultiple:"Editing {{count}} items",name:{label:"Dice Set Name (up to 128 characters)",placeholder:"Enter dice set name (optional)"},count:{label:"Number of Dice ({{min}}-{{max}})",description:"Number of dice to roll"},sides:{label:"Number of Sides ({{min}}-{{max}})",description:"Number of sides on each die"},modifier:{label:"Modifier ({{min}}-{{max}})",sign:"Sign",value:"Value",add:"Add",subtract:"Subtract"},trial:{label:"Number of Trials ({{min}}-{{max}})",description:"Number of trials to execute"},notation:{label:"Dice Notation",copy:"Copy to clipboard",copied:"Copied",preview:"Preview"},editing:{multipleMessage:"Editing {{count}} dice sets"},unspecified:"Unspecified"},action:{simulate:"Start Rolling",reroll:"Reroll",addRoll:"Add Roll",reset:"Reset Results",export:"Export as CSV"}},Da={title:"Dice Sets",empty:"No dice sets available",selectPrompt:"Please select a dice set",selectOrCreatePrompt:"Please select or create a dice set",list:{multiSelectMode:"Multi-select mode",selected:"{{count}} selected",comparing:"Comparing {{count}} dice sets"},action:{create:"Create New",createShort:"New",compare:"Compare",export:"Export",import:"Import",bulkDelete:"Bulk Delete",bulkDuplicate:"Bulk Duplicate",bulkDuplicateShort:"Bulk duplicate selected",bulkDeleteShort:"Bulk delete selected",deleteAll:"Delete All",deleteAllShort:"Delete all",reorder:"Reorder",clearSelection:"Clear selection",change:"Change",selectDiceSet:"Select dice set"},confirm:{delete:"Are you sure you want to delete this dice set?",deleteAll:"Are you sure you want to delete all dice sets?",bulkDelete:"Are you sure you want to delete {{count}} selected dice sets?",bulkDeleteWarning:"Are you sure you want to delete {{count}} selected dice sets?\nThis operation cannot be undone."},copy:{suffix:" (Copy)"},limit:{reached:"Maximum number of dice sets ({{max}}) reached",maxRecords:"Exceeds maximum number of trials ({{max}})"},target:{label:"Target",all:"All ({{count}})",selected:"Selected"},multiSelect:{label:"Multi-select"},viewing:{single:"Viewing {{count}} dice set",multiple:"Comparing {{count}} dice sets"},tooltip:{create:"Create a new dice set",maxReached:"Maximum number of dice sets reached",addRollDisabled:"Cannot add rolls because specific values were modified"}},Na={dice:{count:{required:"Please enter the number of dice",range:"Number of dice must be between {{min}} and {{max}}",invalid:"Invalid number of dice"},sides:{required:"Please enter the number of sides",range:"Number of sides must be between {{min}} and {{max}}",invalid:"Invalid number of sides"},modifier:{range:"Modifier must be between {{min}} and {{max}}",invalid:"Invalid modifier"}},trial:{required:"Please enter the number of trials",range:"Number of trials must be between {{min}} and {{max}}",invalid:"Invalid number of trials"},diceSet:{nameRequired:"Please enter a dice set name",nameTooLong:"Dice set name must be {{max}} characters or less",limitReached:"Maximum number of dice sets reached"},file:{invalidFormat:"Invalid file format",parseError:"Failed to parse file",readError:"Failed to read file"},chart:{aggregationRange:"Aggregation interval must be between {{min}} and {{max}}",targetValueRange:"Die value must be between {{min}} and {{max}}"}},Aa={success:{diceSetCreated:"New dice set created",diceSetDeleted:"Dice set deleted",diceSetDuplicated:"Dice set duplicated",diceSetUpdated:"Dice configuration updated",bulkDeleted:"{{count}} dice sets deleted",bulkDuplicated:"{{count}} dice sets duplicated",rollCompleted:"{{count}} dice rolls completed",dataExported:"Data exported",dataImported:"Data imported",migrated:"Migrated from LocalStorage to IndexedDB",copied:"Copied to clipboard",settingsCreated:"Settings created",settingsCreatedWithName:'Settings "{{name}}" created',settingsDuplicatedWithName:'Settings "{{name}}" duplicated',settingsSaved:"Settings saved",settingsUpdated:"Settings updated",settingsRenamed:"Settings renamed",settingsDeleted:"Settings deleted"},error:{diceSetCreateFailed:"Failed to create dice set",diceSetDeleteFailed:"Failed to delete dice set",diceSetDuplicateFailed:"Failed to duplicate dice set",diceSetUpdateFailed:"Failed to update dice set",bulkDeleteFailed:"Bulk delete failed",bulkDuplicateFailed:"Bulk duplicate failed",rollFailed:"Dice roll failed",loadFailed:"Failed to load data",exportFailed:"Export failed",importFailed:"Import failed",copyFailed:"Failed to copy to clipboard",csvDownloadFailed:"Failed to download CSV",imageGenerationFailed:"Failed to generate image",generic:"An error occurred",partialSuccess:"{{completed}} completed, {{failed}} errors:\n{{errors}}",cannotModifyDefault:"Cannot modify default settings",diceSetLimitReached:"Dice set limit ({{max}}) reached",bulkDuplicateLimitReached:"Can only duplicate {{count}} due to dice set limit",trialCountExceeded:"Trial count exceeds the limit of {{max}}",maxRecordsExceeded:"Cannot add roll because it exceeds the maximum limit ({{max}} records)",settingImportSkipped:'Skipping import of chart settings "{{name}}":'},import:{successWithDetails:"Imported {{details}}",diceSetsCount:"{{count}} dice sets",chartSettingsCount:"{{count}} chart settings"},info:{processing:"Processing...",simulating:"Simulating... ({{progress}}%)",noResults:"No results",noDiceSets:"No dice sets",resetResults:"Results have been reset",selectDiceSet:"Please select a dice set"},warning:{unsavedChanges:"You have unsaved changes",configChanged:"Dice configuration has been changed",noImportableData:"No importable data (all already exist)",addRollDisabled:"Cannot add roll because specific die values were changed"}},Ta={title:"Changelog",entries:[{version:"0.1.10",date:"2026-01-03",changes:{added:["Added 'Roll Results' widget to display recent roll results (display count: 1-3)","Added dice value highlighting feature to Roll Results widget (supports single values, ranges, and modulo notation)","Added 'Equal Width' binning algorithm to total distribution chart","Added 'Remember Selected Dice Sets' option to widget sets (automatically select different dice sets for each widget set)"],changed:["Renamed: 'Chart View' → 'Widget Set', 'Chart Box' → 'Widget'","Changed default binning algorithm to 'Equal Width' (divides data range evenly and displays uniform frequency including edges)"],fixed:["Performed other code optimizations"]}},{version:"0.1.9",date:"2026-01-02",changes:{fixed:["Fixed issue where custom menu items disappeared when changing chart appearance in cumulative distribution chart options","Other minor fixes"]}},{version:"0.1.8",date:"2026-01-01",changes:{added:["Added fullscreen display feature for widgets (always displays Chart.js native legend in fullscreen mode)"],changed:["Changed chart view settings editor tab display on PC from horizontal scroll to sidebar layout","Changed graph selection in chart view settings editor on mobile to dropdown"],fixed:["Fixed issue where binning settings changed in graph options within widgets were not saved when overwriting","Fixed issue where modal content overflows on mobile devices","Fixed issue where chart type toggle buttons were not displayed in graph options for each widget"]}},{version:"0.1.7",date:"2026-01-01",changes:{added:["Added binning feature to total distribution chart (automatic bin width calculation using Scott's rule and Freedman-Diaconis method)","Added automatic background color for chart image downloads based on theme (light mode: white, dark mode: gray)","Added transparent background export option to settings","Added ability to save legend visibility state for each widget"],changed:["Migrated aggregation settings to binning settings for total distribution chart","Standardized chart image filenames to unified format (charttype_timestamp.png)"],fixed:["Fixed issue where rounding did not work properly when bin width multiple exceeded a certain value"]}},{version:"0.1.6",date:"2025-12-31",changes:{added:["Added Y-axis range settings to all charts (auto/semi-auto/manual modes supported)"],changed:["Restructured chart settings to be widget-based, allowing each widget to maintain independent settings","Chart settings editor tabs are now dynamically generated to support adding, removing, and duplicating widgets","Chart view settings now save widget layout information","Simplified preset settings to default only","Changed cumulative distribution chart Y-axis range settings to use the same unified approach as X-axis range settings"],fixed:["Fixed issue where duplicated widgets shared settings instead of having independent configurations","Fixed issue where switching chart view settings did not reflect widget layout"]}},{version:"0.1.5",date:"2025-12-30",changes:{added:["Added edit button to dice set list (can now edit directly without opening the menu)","Added copy button for dice notation to dice set list (placed next to dice notation)"],changed:[],fixed:[]}},{version:"0.1.4",date:"2025-12-29",changes:{added:[],changed:[],fixed:["Fixed issue where charts could not be reordered on mobile devices (added touch support for drag and drop)"]}},{version:"0.1.3",date:"2025-12-29",changes:{added:["Added graph area layout selection feature (3 types: 4 rows x 1 column, 2 rows x 2 columns, 2 rows (1 column + 3 columns))","Added drag handles to chart areas, allowing users to reorder charts via drag and drop","Added edit button for custom chart settings in the chart settings selector (allows direct editing of selected custom settings)"],changed:["Separated legend labels from individual charts and moved them to a unified display at the top of the chart area","Dice set names can now be left blank. When blank, dice notation (e.g., dice2d6+3) is automatically displayed","Roll Progress Chart now only supports line charts (automatically falls back to line chart if bar chart is specified)","Moving average line in Roll Progress Chart now displays as a dashed line","Changed chart options UI in chart view settings creation/editing from accordion-style to tab-style","Updated dice set list, chart legends, and comparison screen to display UIDs in the format '#1 - dice3d6+2'"],fixed:["Fixed issue where chart options changes were not reflected when creating new chart view settings"]}},{version:"0.1.2",date:"2025-12-26",changes:{added:[],changed:[],fixed:["Fixed issue where chart type settings for Roll Progress Chart and Cumulative Distribution Chart were not saved when overwriting chart view settings"]}},{version:"0.1.1",date:"2025-12-26",changes:{added:["Chart X-axis scale settings (auto/semi-auto/manual modes)","Ability to edit chart options (chart type, aggregation, moving average, etc.) in the chart view management modal","Ability to edit initial settings for each chart (not just the name) when creating new chart view settings"],changed:["Expanded chart options menu width for improved usability","Changed chart settings edit menu label from 'Rename' to 'Edit'","Changed chart settings edit modal title from 'Rename Settings' to 'Edit Settings'"],fixed:["Fixed issue where delete all function didn't work in mobile dice set list modal"]}},{version:"0.1.0",date:"2025-12-24",changes:{added:["Dice roll simulation feature","Table view of results","Chart view of results (normal distribution, cumulative distribution, individual dice, by target value, etc.)","Dice set save and management feature","CSV export feature","Image export feature","Multi-language support (Japanese/English)","Dark mode support","Responsive design"],changed:[],fixed:[]}}],categories:{added:"Added",changed:"Changed",fixed:"Fixed",removed:"Removed",security:"Security"}};function Ma(){return"ja"===xe.language?"ja-JP":"en-US"}function La(e){return e.toLocaleString(Ma())}function Ra(e,t=2){return e.toLocaleString(Ma(),{minimumFractionDigits:t,maximumFractionDigits:t})}xe.use(ca).use(Ae).init({resources:{ja:{common:da,help:ga,about:ua,settings:ha,charts:ma,dice:pa,diceSets:xa,validation:fa,messages:ya,changelog:ba},en:{common:va,help:Sa,about:wa,settings:ka,charts:Ca,dice:ja,diceSets:Da,validation:Na,messages:Aa,changelog:Ta}},fallbackLng:"ja",defaultNS:"common",ns:["common","help","about","settings","charts","dice","diceSets","validation","messages","changelog"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"],lookupLocalStorage:"language"}});const Ea=({targetDiceSetType:e,onChange:t,disabled:a,selectedDiceSetsCount:r,selectedDiceSets:i,className:n="",t:o})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap",children:o("diceSets:target.label")}),s.jsxs("select",{value:e,onChange:e=>t(e.target.value),disabled:a,className:`flex-1 px-4 py-3 bg-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer focus:outline-none disabled:opacity-50 max-w-full truncate ${n}`,children:[s.jsx("option",{value:"selected",children:o("diceSets:target.all",{count:r})}),i.map(e=>s.jsx("option",{value:e.id,children:xt(e)},e.id))]})]}),Ia=({onReroll:e,onAddRoll:t,isSimulating:a,hasResults:r,isAddRollDisabled:i=!1,diceSets:n=[],selectedDiceSetIds:o=[],targetDiceSetType:l="selected",onTargetDiceSetTypeChange:c,className:d=""})=>{const{t:g}=Fe(["dice","diceSets","messages","common"]),u=o.length,h=n.filter(e=>o.includes(e.id)),m=c&&u>1,p=g(r?"dice:action.reroll":"dice:action.simulate"),x=g(r?"dice:action.reroll":"common:button.start"),f=g("common:button.addRoll");return s.jsxs("div",{className:`w-64 bg-white/80 dark:bg-gray-700/80 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-2 ${d}`,children:[m&&s.jsx("div",{className:"mb-4 pb-4 px-4 border-b border-gray-200 dark:border-gray-600",children:s.jsx(Ea,{targetDiceSetType:l,onChange:c,disabled:a,selectedDiceSetsCount:u,selectedDiceSets:h,className:"px-3 py-2 text-sm",t:g})}),s.jsxs("div",{className:"flex flex-row mt-2 px-4 text-xs text-gray-500 dark:text-gray-400",children:[r&&s.jsxs("button",{onClick:t,disabled:a||i,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(a||i?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":g("dice:action.addRoll"),title:i?g("messages:warning.addRollDisabled"):"","data-testid":"add-roll-button",children:[s.jsx("div",{className:"mb-1",children:s.jsx(lt,{name:a?"spinner":"add-roll",className:a?"w-6 h-6 animate-spin":"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:f})]}),s.jsxs("button",{onClick:e,disabled:a,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(a?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":p,"data-testid":"simulate-button",children:[s.jsx("div",{className:"mb-1",children:s.jsx(lt,{name:a?"spinner":"reroll",className:a?"w-6 h-6 animate-spin":"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:x})]})]})]})},Oa=r.lazy(()=>D(()=>import("./index-CEiIUMOo.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.SettingsModal}))),$a=({onReroll:e,onAddRoll:t,isSimulating:a=!1,hasResults:i=!1,isAddRollDisabled:n=!1,diceSets:o=[],selectedDiceSetIds:l=[],targetDiceSetType:c="selected",onTargetDiceSetTypeChange:d,onOpenDiceSetList:g,themeMode:u,onChangeThemeMode:h,transparentExport:m,onChangeTransparentExport:p,onExportData:x,onImportData:f,diceSetsCount:y,chartSettingsCount:b,onAboutClick:v,onChangelogClick:S})=>{const{t:w}=Fe(["common","diceSets"]),[k,C]=r.useState(!1),[j,D]=r.useState(!1),N=r.useRef(null),A=r.useRef(null),T=l.length,M=d&&T>0;return r.useEffect(()=>{const e=e=>{A.current&&!A.current.contains(e.target)&&N.current&&!N.current.contains(e.target)&&C(!1)};if(k)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[k]),s.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 pt-2 pb-4 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 lg:hidden z-50 transition-colors",children:[k&&M&&Ht.createPortal(s.jsx("div",{ref:A,className:"fixed bottom-24 left-1/2 -translate-x-1/2 z-50",children:s.jsx(Ia,{onReroll:e,onAddRoll:t,isSimulating:a,hasResults:i,isAddRollDisabled:n,diceSets:o,selectedDiceSetIds:l,targetDiceSetType:c,onTargetDiceSetTypeChange:d})}),document.body),s.jsxs("div",{className:"flex justify-around items-center h-16",children:[s.jsxs("button",{onClick:g,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300","aria-label":w("common:label.list"),children:[s.jsxs("div",{className:"mb-1 relative",children:[s.jsx(lt,{name:"diceSets",className:"w-6 h-6"}),l.length>0&&s.jsx("span",{className:"absolute -top-3 -right-3 bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center",children:La(l.length)})]}),s.jsx("span",{className:"text-xs font-medium",children:w("common:label.list")})]}),M&&s.jsxs("button",{ref:N,onClick:()=>C(!k),className:"flex flex-col items-center justify-center flex-1 h-full transition-colors relative "+(k?"text-accent-light-600 dark:text-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),"aria-label":w("common:label.roll"),disabled:a,children:[s.jsx("div",{className:"mb-1",children:s.jsx(lt,{name:"dice",className:"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:w("common:label.roll")})]}),s.jsxs("button",{onClick:()=>D(!0),className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300","aria-label":w("common:label.settings"),children:[s.jsx("div",{className:"mb-1",children:s.jsx(lt,{name:"settings",className:"w-6 h-6"})}),s.jsx("span",{className:"text-xs font-medium",children:w("common:label.settings")})]})]}),j&&s.jsx(r.Suspense,{fallback:null,children:s.jsx(Oa,{isOpen:j,onClose:()=>D(!1),darkMode:u,onChangeDarkMode:h,transparentExport:m,onChangeTransparentExport:p,onExportData:x,onImportData:f,diceSetsCount:y,chartSettingsCount:b,onAboutClick:v,onChangelogClick:S})})]})},Pa=n.memo(({message:e,onClose:t})=>{const[a,i]=r.useState(!1),[n,o]=r.useState(!1);r.useEffect(()=>{if(e){i(!0),setTimeout(()=>{o(!0)},10);const e=setTimeout(()=>{o(!1),setTimeout(()=>{t(),i(!1)},500)},3e3);return()=>clearTimeout(e)}i(!1),o(!1)},[e,t]);if(!e||!a)return null;const l={success:"border-green-500 dark:border-green-400",error:"border-red-500 dark:border-red-400",warning:"border-yellow-500 dark:border-yellow-400",info:"border-accent-light-500 dark:border-accent-dark-400"}[e.type],c={success:"text-green-500 dark:text-green-400",error:"text-red-500 dark:text-red-400",warning:"text-yellow-500 dark:text-yellow-400",info:"text-accent-light-500 dark:text-accent-dark-400"}[e.type];return s.jsx("div",{className:"fixed top-18 left-1/2 -translate-x-1/2 z-[10000] w-full max-w-2xl px-4 transition-all duration-500 "+(n?"opacity-100 blur-0":"opacity-0 blur-sm"),children:s.jsxs("div",{className:`bg-white dark:bg-gray-800 text-sm text-gray-900 dark:text-gray-100 px-3 py-2 rounded-md shadow-lg border-l-4 ${l} flex items-center justify-between`,children:[s.jsxs("div",{className:"flex items-center",children:[s.jsxs("span",{className:`mr-3 text-xl font-bold ${c}`,children:["success"===e.type&&"✓","error"===e.type&&"✕","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),s.jsx("span",{className:"whitespace-pre-line",children:e.text})]}),s.jsx("button",{onClick:()=>{o(!1),setTimeout(()=>{t(),i(!1)},500)},className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-bold",children:"×"})]})})}),Fa="bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-white rounded-lg transition-colors inline-flex items-center justify-center gap-2",Wa=(e,t)=>({name:e?"spinner":t,className:e?"w-6 h-6 animate-spin":"w-6 h-6"}),Va=({targetDiceSetType:e,onChange:t,disabled:a,selectedDiceSetsCount:r,selectedDiceSets:i,className:n="",t:o})=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap",children:o("diceSets:target.label")}),s.jsxs("select",{value:e,onChange:e=>t(e.target.value),disabled:a,className:`flex-1 px-4 py-3 bg-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer focus:outline-none disabled:opacity-50 max-w-full truncate ${n}`,children:[s.jsx("option",{value:"selected",children:o("diceSets:target.all",{count:r})}),i.map(e=>s.jsx("option",{value:e.id,children:xt(e)},e.id))]})]}),Ba=({onReroll:e,onAddRoll:t,isSimulating:a,simulationProgress:r=0,hasResults:i,variant:n="large",className:o="",isAddRollDisabled:l=!1,diceSets:c=[],selectedDiceSetIds:d=[],targetDiceSetType:g="selected",onTargetDiceSetTypeChange:u})=>{const{t:h}=Fe(["dice","diceSets","messages","common"]),m=d.length,p=c.filter(e=>d.includes(e.id)),x=u&&m>1,f=h(i?"dice:action.reroll":"dice:action.simulate"),y=h(i?"dice:action.reroll":"common:button.start"),b=h("dice:action.addRoll"),v=h("common:button.addRoll");return"large"===n?s.jsxs("div",{className:`flex flex-col gap-2 ${o}`,children:[a&&r>0&&s.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:s.jsx("div",{className:"bg-accent-light-500 dark:bg-accent-dark-500 h-2.5 rounded-full transition-all duration-300",style:{width:`${r}%`}})}),s.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 items-stretch lg:items-center",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[i&&s.jsxs("button",{onClick:t,disabled:a||l,className:`${Fa} font-bold py-3 px-3 text-lg flex-1`,title:l?h("messages:warning.addRollDisabled"):"","data-testid":"add-roll-button",children:[s.jsx(lt,{...Wa(a,"add-roll"),strokeWidth:1}),s.jsx("span",{className:"hidden lg:inline",children:b}),s.jsx("span",{className:"lg:hidden",children:v})]}),s.jsxs("button",{onClick:e,disabled:a,className:`${Fa} font-bold py-3 px-3 text-lg flex-1`,"data-testid":"simulate-button",children:[s.jsx(lt,{...Wa(a,"reroll"),strokeWidth:1}),s.jsx("span",{className:"hidden lg:inline",children:f}),s.jsx("span",{className:"lg:hidden",children:y}),a&&r>0&&s.jsxs("span",{className:"ml-2 text-sm",children:["(",Math.round(r),"%)"]})]})]}),x&&s.jsx(Va,{targetDiceSetType:g,onChange:u,disabled:a,selectedDiceSetsCount:m,selectedDiceSets:p,className:"px-4 py-3 lg:w-auto",t:h})]})]}):s.jsx("div",{className:"fixed bottom-20 mb-4 right-6 left-6 lg:left-auto lg:bottom-6 lg:mb-0 z-40 lg:w-auto",children:s.jsx(Ia,{onReroll:e,onAddRoll:t,isSimulating:a,hasResults:i,isAddRollDisabled:l,diceSets:c,selectedDiceSetIds:d,targetDiceSetType:g,onTargetDiceSetTypeChange:u})})},Ua=r.createContext(null);function Ha({children:e,multipleExpanded:t=!0,defaultExpanded:a=[],className:i=""}){const[n,o]=r.useState(new Set(a)),l=r.useCallback(e=>{o(a=>{const r=new Set(a);return r.has(e)?r.delete(e):(t||r.clear(),r.add(e)),r})},[t]),c=r.useMemo(()=>({expandedItems:n,toggleItem:l,multipleExpanded:t}),[n,l,t]);return s.jsx(Ua.Provider,{value:c,children:s.jsx("div",{className:i,role:"presentation",children:e})})}function za({id:e,title:t,children:a,headerClassName:i="w-full px-4 py-3 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-600",contentClassName:n="px-4 pt-1 pb-3",disabled:o=!1}){const{expandedItems:l,toggleItem:c}=function(){const e=r.useContext(Ua);if(!e)throw new Error("Accordion components must be used within an Accordion");return e}(),d=l.has(e),g=`accordion-header-${e}`,u=`accordion-content-${e}`;return s.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-600",children:[s.jsxs("button",{id:g,type:"button",onClick:()=>{o||c(e)},onKeyDown:t=>{o||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),c(e))},className:i,"aria-expanded":d,"aria-controls":u,disabled:o,children:[s.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400",children:t}),s.jsx("svg",{className:"w-4 h-4 text-gray-400 transition-transform "+(d?"rotate-180":""),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:s.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),d&&s.jsx("div",{id:u,role:"region","aria-labelledby":g,className:n,children:a})]})}function qa({items:e,selectedIds:t,onDeselectAll:a,renderItem:r,emptyMessage:i,className:o="",itemClassName:l="",footer:c,showSelectionCount:d=!0,enableDragAndDrop:g=!1,onReorder:u}){const{t:h}=Fe(),[m,p]=n.useState(null),[x,f]=n.useState(null),[y,b]=n.useState(null),[v,S]=n.useState(null),[w,k]=n.useState(null),[C,j]=n.useState(null),D=n.useRef(new Map),N=n.useRef(null),A=i||h("common:emptyState.noItems");n.useEffect(()=>{D.current.clear()},[e.length]);const T=e=>(D.current.has(e)||D.current.set(e,n.createRef()),D.current.get(e)),M=e=>{g&&(e.target.style.opacity="1",p(null),f(null))};return s.jsxs("div",{className:`flex flex-col pb-10 h-full ${o}`,children:[s.jsxs("div",{ref:N,className:"fixed -left-[9999px] -top-[9999px] bg-accent-light-500 dark:bg-accent-dark-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",style:{zIndex:9999,opacity:1},children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),s.jsx("span",{className:"font-medium text-sm",children:h("common:selection.moving")})]}),s.jsx("div",{className:"flex-1 space-y-2 pb-10",children:0===e.length?s.jsx("p",{className:"text-center text-gray-400 dark:text-gray-500 py-8",children:A}):e.map((a,i)=>{const n=t.includes(a.id),o=m===i,c=w===i,d=x===i&&(null!==m||null!==w)&&m!==i&&w!==i,h={};if(c&&null!==y&&null!==v&&C){const e=v-y;h.position="fixed",h.top=C.top+e,h.left=C.left,h.width=C.width,h.zIndex=1e3,h.pointerEvents="none",h.transition="none",h.opacity=.7}else h.transition="all 0.2s",h.opacity=o?.5:1;return s.jsxs("div",{onDragOver:e=>((e,t)=>{g&&(e.preventDefault(),e.dataTransfer.dropEffect="move",null!==m&&m!==t&&x!==t&&f(t))})(e,i),onDrop:t=>((t,a)=>{if(!g||!u)return;if(t.preventDefault(),null===m||m===a)return;const r=[...e],[i]=r.splice(m,1);r.splice(a,0,i),u(r),p(null),f(null)})(t,i),onTouchStart:e=>((e,t)=>{if(!g)return;const a=e.target,r=T(t).current;if(!r||!r.contains(a))return;e.stopPropagation(),e.preventDefault();const i=e.currentTarget;j(i.getBoundingClientRect()),b(e.touches[0].clientY),S(e.touches[0].clientY),k(t)})(e,i),onTouchMove:t=>((t,a)=>{if(!g||w!==a||null===y)return;t.preventDefault(),t.stopPropagation();const r=t.touches[0].clientY;S(r);const i=t.currentTarget.getBoundingClientRect().height,n=r-y,s=.5*i;if(Math.abs(n)>s){const t=Math.round(n/i),r=Math.max(0,Math.min(e.length-1,a+t));f(r!==a?r:null)}else f(null)})(t,i),onTouchEnd:()=>(t=>{if(g&&w===t){if(null!==x&&x!==t&&u){const a=[...e],[r]=a.splice(t,1);a.splice(x,0,r),u(a)}j(null),b(null),S(null),k(null),f(null)}})(i),onTouchCancel:()=>(e=>{g&&w===e&&(j(null),b(null),S(null),k(null),f(null))})(i),style:h,className:`${c?"":"relative"} ${l} ${d?(m??w)<i?"mb-4":"mt-4":""} ${o?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500 ring-offset-2 dark:ring-offset-gray-800 rounded-lg":""}`,children:[d&&s.jsx("div",{className:`absolute left-0 right-0 h-1 bg-accent-light-500 dark:bg-accent-dark-500 rounded-full ${(m??w)<i?"-bottom-1":"-top-1"} z-10`}),r(a,n,i,g?{ref:T(i),onDragStart:e=>((e,t)=>{g&&(p(t),e.dataTransfer.effectAllowed="move",N.current&&e.dataTransfer.setDragImage(N.current,-10,20))})(e,i),onDragEnd:M,isDraggingOther:null!==m&&m!==i||null!==w&&w!==i}:void 0)]},a.id)})}),c&&s.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:[d&&s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.length,h("common:selection.selected")]}),a&&s.jsx("button",{onClick:a,disabled:0===t.length,className:"px-4 py-1.5 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 text-gray-800 dark:text-gray-200 font-medium rounded transition-colors",children:h("common:selection.deselect")})]}),c]})]})}const Ya=({dragHandleProps:e,onTouchStart:t,onTouchMove:a,onTouchEnd:r,isDragging:i=!1,className:n=""})=>s.jsx("div",{ref:e?.ref,draggable:!!e,onDragStart:e?.onDragStart,onDragEnd:e?.onDragEnd,onTouchStart:t,onTouchMove:a,onTouchEnd:r,className:`select-none cursor-grab active:cursor-grabbing ${i?"text-accent-light-500 dark:text-accent-dark-400":"text-gray-400"} ${n}`,style:{touchAction:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:s.jsxs("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 16 16",children:[s.jsx("circle",{cx:"6",cy:"2",r:"1"}),s.jsx("circle",{cx:"10",cy:"2",r:"1"}),s.jsx("circle",{cx:"6",cy:"6",r:"1"}),s.jsx("circle",{cx:"10",cy:"6",r:"1"}),s.jsx("circle",{cx:"6",cy:"10",r:"1"}),s.jsx("circle",{cx:"10",cy:"10",r:"1"}),s.jsx("circle",{cx:"6",cy:"14",r:"1"}),s.jsx("circle",{cx:"10",cy:"14",r:"1"})]})}),Xa=({isSelected:e,onToggle:t,children:a,actions:r,showDragHandle:i=!1,dragHandleProps:n,clickable:o=!0,className:l="",showCheckbox:c=!0})=>s.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg transition-colors ${e?"bg-accent-light-100 dark:bg-accent-dark-900/30 border-2 border-accent-light-500 dark:border-accent-dark-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 border-2 border-transparent"} ${l}`,children:[i&&s.jsx(Ya,{dragHandleProps:n,className:"p-2 -m-2"}),c&&s.jsx("input",{type:"checkbox",checked:e,onChange:t,className:"mt-1 w-5 h-5 rounded border-gray-300 text-accent-light-500 focus:ring-accent-light-500 dark:border-gray-600 dark:bg-gray-700 dark:text-accent-dark-500 dark:focus:ring-accent-dark-500 cursor-pointer",onClick:e=>e.stopPropagation()}),s.jsx("div",{className:"flex-1 min-w-0 "+(o?"cursor-pointer":""),onClick:o?t:void 0,children:a}),r&&s.jsx("div",{className:"flex-shrink-0 relative",children:r})]}),_a=r.createContext(void 0),Ja=({children:e})=>{const[t,a]=r.useState([]),i={registerModal:r.useCallback(e=>{let t=9999;return a(a=>{if(a.find(t=>t.id===e))return a;const r=a.length>0?Math.max(...a.map(e=>e.zIndex)):9998;return t=r+1,[...a,{id:e,zIndex:t}]}),t},[]),unregisterModal:r.useCallback(e=>{a(t=>t.filter(t=>t.id!==e))},[]),bringToFront:r.useCallback(e=>{a(t=>{const a=t.find(t=>t.id===e);if(!a)return t;const r=Math.max(...t.map(e=>e.zIndex));if(a.zIndex===r)return t;const i=r+1;return t.map(t=>t.id===e?{...t,zIndex:i}:t)})},[]),getZIndex:r.useCallback(e=>{const a=t.find(t=>t.id===e);return a?.zIndex},[t])};return s.jsx(_a.Provider,{value:i,children:e})},Ka=({isOpen:e,onClose:t,children:a,size:i="lg",maxHeight:n="90vh",closeOnBackdropClick:o=!0,closeOnEsc:l=!0,className:c="",animationClassName:d="",modalId:g})=>{const u=r.useId(),h=g||u,{registerModal:m,unregisterModal:p,bringToFront:x,getZIndex:f}=(()=>{const e=r.useContext(_a);if(void 0===e)throw new Error("useModal must be used within a ModalProvider");return e})();r.useEffect(()=>{if(e)return m(h),()=>{p(h)}},[e,h,m,p]);const y=r.useCallback(()=>{x(h),o&&t()},[h,o,t,x]),b=r.useCallback(e=>{e.stopPropagation(),x(h)},[h,x]);if(r.useEffect(()=>{if(!e||!l)return;const a=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e,l,t]),!e)return null;const v=f(h)||9999,S="fullscreen"===i?"max-h-[98vh]":{"60vh":"max-h-[60vh]","80vh":"max-h-[80vh]","90vh":"max-h-[90vh]"}[n],w=s.jsx("div",{className:`fixed inset-0 flex items-center justify-center p-4 bg-black/50 ${d}`,style:{zIndex:v},onClick:y,children:s.jsx("div",{className:`flex flex-col bg-white dark:bg-gray-800 rounded-lg shadow-xl ${{sm:"max-w-sm",md:"max-w-md",lg:"max-w-lg",xl:"max-w-xl","2xl":"max-w-2xl",fullscreen:"max-w-[98vw]"}[i]} w-full ${S} ${c}`,onClick:b,children:a})});return Ht.createPortal(w,document.body)},Qa=({title:e,onClose:t,closeButtonLabel:a,actions:r,showCloseButton:i=!0,sticky:n=!0,className:o=""})=>{const l=n?"sticky top-0 bg-white dark:bg-gray-800 rounded-tl-lg rounded-tr-lg border-b border-gray-200 dark:border-gray-700":"border-b border-gray-200 dark:border-gray-700";return s.jsxs("div",{className:`${l} px-6 py-4 flex justify-between items-center ${o}`,children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white",children:e}),s.jsxs("div",{className:"flex items-center gap-2",children:[r,i&&t&&s.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors text-gray-800 dark:text-gray-200","aria-label":a||"Close",children:s.jsx(lt,{name:"close"})})]})]})},Ga=({children:e,padding:t=!0,scrollable:a=!1,className:r=""})=>{const i=["text-gray-700 dark:text-gray-300",t?"px-6 py-4":"",...a?["overflow-y-auto","flex-1","min-h-0"]:[],r].filter(Boolean).join(" ");return s.jsx("div",{className:i,children:e})},Za=({children:e,sticky:t=!1,align:a="right",className:r=""})=>{const i=t?"sticky bottom-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700":"border-t border-gray-200 dark:border-gray-700";return s.jsx("div",{className:`${i} px-6 py-4 flex ${{left:"justify-start",center:"justify-center",right:"justify-end","space-between":"justify-between"}[a]} gap-3 ${r}`,children:e})},er=({isOpen:e,buttonRef:t,items:a,onClose:i,iconClassName:o="w-4 h-4"})=>{const l=r.useRef(null);r.useEffect(()=>{const a=e=>{l.current&&!l.current.contains(e.target)&&t.current&&!t.current.contains(e.target)&&i()};if(e)return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[e,i,t]);return s.jsx("div",{ref:l,className:"absolute right-0 top-full mt-1 w-44 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[100] overflow-hidden border border-gray-200 dark:border-gray-600 transition-opacity "+(e?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:a.map((e,t)=>s.jsxs(n.Fragment,{children:[e.separator&&t>0&&s.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600"}),s.jsxs("button",{onClick:t=>{t.stopPropagation(),(0,e.onClick)(),i()},disabled:e.disabled,title:e.title,className:"w-full px-4 py-2.5 text-left transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed "+(e.danger?"hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400":"hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white"),children:[e.customIcon?e.customIcon:e.icon?s.jsx(lt,{name:e.icon,className:o}):s.jsx("div",{className:o}),s.jsx("span",{className:"text-sm",children:e.label})]})]},e.id))})},tr=({buttonRef:e,onClick:t,title:a,iconClassName:r="w-4 h-4",isSelected:i=!1})=>s.jsx("button",{ref:e,onClick:t,className:"w-8 h-8 rounded transition-colors inline-flex items-center justify-center "+(i?"text-accent-light-800/75 dark:text-accent-dark-400 hover:bg-accent-light-500/20 dark:hover:bg-accent-dark-700/50":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),title:a,children:s.jsx(lt,{name:"dots-vertical",className:r})}),ar=({checked:e,onChange:t,label:a,disabled:r=!1,size:i="medium",className:n=""})=>{const o={small:{switch:"h-5 w-9",slider:"h-3 w-3",translate:e?"translate-x-5":"translate-x-1"},medium:{switch:"h-6 w-11",slider:"h-4 w-4",translate:e?"translate-x-6":"translate-x-1"},large:{switch:"h-7 w-14",slider:"h-5 w-5",translate:e?"translate-x-8":"translate-x-1"}}[i];return s.jsx("button",{type:"button",role:"switch","aria-checked":e,"aria-label":a,onClick:()=>!r&&t(!e),disabled:r,className:`\n        relative inline-flex items-center rounded-full transition-colors\n        focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800\n        ${e?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}\n        ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n        ${o.switch}\n        ${n}\n      `,children:s.jsx("span",{className:`\n          inline-block transform rounded-full bg-white transition-transform\n          ${o.slider}\n          ${o.translate}\n        `})})};function rr(e,t=1){if(0===e.length)return{data:[],isAggregated:!1};if(t<=1)return{data:e,isAggregated:!1};const a=e[0][0],r=e[e.length-1][0]-a+1,i=Math.ceil(r/t),n=Math.floor(r/i),s=r%i,o=[];let l=a;for(let c=0;c<i;c++){const t=n+(c<s?1:0),a=l+t-1,r=e.filter(([e])=>e>=l&&e<=a);if(r.length>0){const e=l+t/2,a=r.reduce((e,[,t])=>e+t,0);o.push([Math.round(e),a])}l+=t}return{data:o,isAggregated:!0}}function ir(e,t=1e3){const a=e.length;if(a<=t)return e;const r=[];r.push(e[0]);const i=(a-2)/(t-2);let n=0;for(let s=0;s<t-2;s++){const t=Math.floor((s+1)*i)+1,o=Math.floor((s+2)*i)+1,l=Math.min(o,a)-t;let c=0,d=0;for(let r=t;r<Math.min(o,a);r++)c+=e[r].x,d+=e[r].y;c/=l,d/=l;const g=Math.floor(s*i)+1,u=Math.floor((s+1)*i)+1,h=e[n].x,m=e[n].y;let p=-1,x=g;for(let r=g;r<Math.min(u,a);r++){const t=.5*Math.abs((h-c)*(e[r].y-m)-(h-e[r].x)*(d-m));t>p&&(p=t,x=r)}r.push(e[x]),n=x}return r.push(e[a-1]),r}function nr(e){return e.length>2e3?{data:ir(e,1e3),wasDownsampled:!0}:{data:e,wasDownsampled:!1}}function sr(e,t="scott",a=1){if(0===e.length)return 1;if(1===e.length)return 1;const r=e.length;let i;if("scott"===t){const t=e.reduce((e,t)=>e+t,0)/r,a=e.reduce((e,a)=>e+Math.pow(a-t,2),0)/r;i=3.5*Math.sqrt(a)*Math.pow(r,-1/3)}else{const t=[...e].sort((e,t)=>e-t),a=Math.floor(.25*r),n=Math.floor(.75*r),s=t[a];i=2*(t[n]-s)*Math.pow(r,-1/3)}return(i<=0||!isFinite(i))&&(i=1),i=a>1?Math.max(a,Math.ceil(i/a)*a):Math.max(1,Math.round(i)),i}function or(e,t=1,a="equal-width"){if(0===e.length)return{data:[],isBinned:!1,binCount:0,binWidth:1};if(t<=1)return{data:e,isBinned:!1,binCount:e.length,binWidth:1};const r=e[0][0],i=e[e.length-1][0]-r+1;if("equal-width"===a){const a=Math.ceil(i/t),n=i/a,s=new Map;for(const[t,i]of e){const e=Math.floor((t-r)/n),o=Math.min(e,a-1),l=s.get(o)||{frequency:0,weightedSum:0};s.set(o,{frequency:l.frequency+i,weightedSum:l.weightedSum+t*i})}const o=Array.from(s.entries()).sort((e,t)=>e[0]-t[0]).map(([,{frequency:e,weightedSum:t}])=>{const a=t/e;return[Math.round(a),e]});return{data:o,isBinned:!0,binCount:o.length,binWidth:n}}{const a=Math.floor(r/t)*t,i=new Map;for(const[r,s]of e){const e=a+Math.floor((r-a)/t)*t,n=i.get(e)||{frequency:0,weightedSum:0};i.set(e,{frequency:n.frequency+s,weightedSum:n.weightedSum+r*s})}const n=Array.from(i.entries()).sort((e,t)=>e[0]-t[0]).map(([,{frequency:e,weightedSum:t}])=>{const a=t/e;return[Math.round(a),e]});return{data:n,isBinned:!0,binCount:n.length,binWidth:t}}}function lr(e,t,a=0){if(0===e||0===t)return[];const r=e,i=e*t,n=Array(i+1).fill(0);n[0]=1;for(let l=0;l<e;l++){const e=Array(i+1).fill(0);for(let a=0;a<=i;a++)if(0!==n[a])for(let r=1;r<=t;r++){const t=a+r;t<=i&&(e[t]+=n[a])}n.splice(0,n.length,...e)}const s=Math.pow(t,e),o=[];for(let l=r;l<=i;l++){const e=n[l];if(e>0){const t=e/s;o.push([l+a,t])}}return o}function cr(e){if("string"!=typeof e)return!1;const t=new Date(e);return!isNaN(t.getTime())&&e===t.toISOString()}function dr(e,t,a="ダイス設定"){if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: ${a}が不正です`);const r=e;if("number"!=typeof r.diceCount||r.diceCount<1||r.diceCount>Ze)throw new Error(`ダイスセット${t+1}: ${a}のダイス数が不正です（1-10の範囲）`);if("number"!=typeof r.diceFaces||r.diceFaces<1||r.diceFaces>et)throw new Error(`ダイスセット${t+1}: ${a}のダイス面数が不正です（1-9999の範囲）`);if(""!==r.modifierSign&&"+"!==r.modifierSign&&"-"!==r.modifierSign)throw new Error(`ダイスセット${t+1}: ${a}の修正値符号が不正です`);if("number"!=typeof r.modifierValue||r.modifierValue<0||r.modifierValue>tt)throw new Error(`ダイスセット${t+1}: ${a}の修正値が不正です（0-99999の範囲）`)}function gr(e,t,a=!1,r=!1){if(a)return void e.toBlob(e=>{if(!e)throw new Error("画像の生成に失敗しました");const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},"image/png");const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const n=i.getContext("2d");n&&(n.fillStyle=r?"#1f2937":"#ffffff",n.fillRect(0,0,i.width,i.height),n.drawImage(e,0,0)),i.toBlob(e=>{if(!e)throw new Error("画像の生成に失敗しました");const a=URL.createObjectURL(e),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},"image/png")}async function ur(e){try{await navigator.clipboard.writeText(e)}catch{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch{throw new Error("クリップボードへのコピーに失敗しました")}finally{document.body.removeChild(t)}}}function hr(e,t,a=!1,r=!1){if(!e.current)return;gr(e.current.canvas,`${{total:"total-distribution",individual:"individual-dice",target:"target-value"}[t]}_${Date.now()}.png`,a,r)}const mr="chart-settings-migration-v1",pr="chart-settings-binning-migration-v1";async function xr(e){if("completed"===localStorage.getItem(mr))return await fr(e);const t=e.map(e=>function(e){if(e.widgets&&e.widgets.length>0)return e;const t=e;if(t.chartBoxes&&Array.isArray(t.chartBoxes)&&t.chartBoxes.length>0)return{id:e.id,name:e.name,widgets:t.chartBoxes,createdAt:e.createdAt,updatedAt:(new Date).toISOString(),sortOrder:e.sortOrder};const a=function(e){return yt().map(t=>({...t,...yr(e,t.type)}))}(t),r={id:e.id,name:e.name,widgets:a,createdAt:e.createdAt,updatedAt:(new Date).toISOString(),sortOrder:e.sortOrder};return r}(e));return localStorage.setItem(mr,"completed"),await fr(t)}async function fr(e){if("completed"===localStorage.getItem(pr))return e;const t=e.map(e=>{let t=!1;const a=e.resultChart;let r=a;a&&"useAggregation"in a&&(r={useBinning:a.useAggregation,binningAlgorithm:"scott",binWidthMultiple:1},t=!0);let i=e.widgets;return e.widgets&&e.widgets.length>0&&(i=e.widgets.map(e=>{if("result"===e.type&&e.aggregationSettings&&"useAggregation"in e.aggregationSettings){const a=e.aggregationSettings;return t=!0,{...e,aggregationSettings:{useBinning:a.useAggregation,binningAlgorithm:"scott",binWidthMultiple:1}}}return e})),t?{...e,resultChart:r,widgets:i,updatedAt:(new Date).toISOString()}:e});return localStorage.setItem(pr,"completed"),t}function yr(e,t,a){const r={};switch(t){case"result":e.resultChart&&(r.aggregationSettings=e.resultChart),e.resultChartType&&(r.chartType=e.resultChartType),e.resultChartXScale&&(r.xAxisScale=e.resultChartXScale);break;case"cumulative":e.cumulativeChartType&&(r.chartType=e.cumulativeChartType),e.cumulativeDistributionType&&(r.distributionType=e.cumulativeDistributionType),void 0!==e.cumulativeShowOnlyActualData&&void 0===a?.showOnlyActualData&&(r.showOnlyActualData=e.cumulativeShowOnlyActualData),void 0!==e.cumulativeQuantileCount&&void 0===a?.quantileCount&&(r.quantileCount=e.cumulativeQuantileCount),e.cumulativeChartXScale&&(r.xAxisScale=e.cumulativeChartXScale);break;case"rollProgress":e.rollProgressChart&&(r.aggregationSettings=e.rollProgressChart),e.rollProgressChartType&&(r.chartType=e.rollProgressChartType),e.rollProgressMovingAverageWindow&&(r.movingAverageWindow=e.rollProgressMovingAverageWindow),e.rollProgressChartXScale&&(r.xAxisScale=e.rollProgressChartXScale);break;case"individual":e.individualDiceChart&&(r.aggregationSettings=e.individualDiceChart),e.individualDiceChartType&&(r.chartType=e.individualDiceChartType),e.individualDiceChartXScale&&(r.xAxisScale=e.individualDiceChartXScale)}return r}function br(){const[e,t]=r.useState(document.documentElement.classList.contains("dark"));return r.useEffect(()=>{const e=new MutationObserver(()=>{t(document.documentElement.classList.contains("dark"))});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),e}function vr(){const[e,t]=r.useState([]),[a,i]=r.useState(()=>localStorage.getItem("current-chart-settings-id")||Be),[n,s]=r.useState(!0),[o,l]=r.useState(null);r.useEffect(()=>{(async()=>{try{await async function(){return At.ensureDefaultChartSettings()}();const e=await Rt(),a=await xr(e);a!==e&&await Promise.all(a.map(e=>Et(e))),t(a);const r=localStorage.getItem("current-chart-settings-id");r&&!a.some(e=>e.id===r)&&(i(Be),localStorage.setItem("current-chart-settings-id",Be))}catch(e){l("ウィジェットセット設定の読み込みに失敗しました。デフォルト設定にリセットします。"),i(Be),localStorage.setItem("current-chart-settings-id",Be)}finally{s(!1)}})()},[]),r.useEffect(()=>{a&&localStorage.setItem("current-chart-settings-id",a)},[a]);const c=r.useCallback(()=>e.find(e=>e.id===a),[e,a]),d=r.useCallback(async()=>{const e=await Rt();return t(e),e},[]),g=r.useCallback(async(e,t)=>{const a=Ct(e);if(!a.valid)throw new Error(a.error);const r=function(e){const t=(new Date).toISOString();return{id:kt(),name:e.slice(0,vt),widgets:yt(),createdAt:t,updatedAt:t}}(e),n=t?{...r,...t,id:r.id,name:r.name}:r;return await Et(n),await d(),i(n.id),n},[d]),u=r.useCallback(async(t,a)=>{const r=e.find(e=>e.id===t);if(!r)throw new Error("複製元の設定が見つかりません");const n=function(e,t){const a=(new Date).toISOString();return{...e,id:kt(),name:(t||`${e.name}のコピー`).slice(0,vt),createdAt:a,updatedAt:a}}(r,a),s=Ct(n.name);if(!s.valid)throw new Error(s.error);return await Et(n),await d(),i(n.id),n},[e,d]),h=r.useCallback(async(t,a)=>{const r=e.find(e=>e.id===t);if(!r)throw new Error("設定が見つかりません");if(St(t))throw new Error("プリセット設定は変更できません");const i={...r,...a,id:r.id,updatedAt:(new Date).toISOString()};if(a.name){const e=Ct(a.name);if(!e.valid)throw new Error(e.error)}await Et(i),await d()},[e,d]),m=r.useCallback(async e=>{if(St(e))throw new Error("プリセット設定は削除できません");await async function(e){return At.deleteChartSettings(e)}(e),a===e&&i(Be),await d()},[a,d]),p=r.useCallback(async(e,t)=>{await h(e,{name:t})},[h]),x=r.useCallback(async e=>{t(e);try{for(let t=0;t<e.length;t++){const a={...e[t],sortOrder:t};await Et(a)}}catch(a){throw new Error("設定の並び替えに失敗しました")}},[]),f=r.useCallback(async(e,t,a)=>{await h(e,{[t]:a})},[h]),y=r.useCallback(async(e,t)=>{await h(e,{resultChart:t})},[h]);return{chartSettings:e,currentSettingsId:a,setCurrentSettingsId:i,getCurrentSettings:c,isLoading:n,migrationError:o,createSettings:g,duplicateSettings:u,updateSettings:h,deleteSettings:m,renameSettings:p,reorderSettings:x,updateAggregationSettings:f,updateBinningSettings:y,reloadSettings:d}}function Sr(e,t){const a=e?.[t],i=void 0!==a&&"useAggregation"in a?a:void 0,n=e?.id,[s,o]=r.useState(i?.useAggregation??!1),[l,c]=r.useState(i?.aggregationInterval??20);return r.useEffect(()=>{o(i?.useAggregation??!1),c(i?.aggregationInterval??20)},[n,i?.useAggregation,i?.aggregationInterval]),{useAggregation:s,setUseAggregation:o,aggregationInterval:l,setAggregationInterval:c}}function wr(e,t){const a=e?.[t],i=e?.id,[n,s]=r.useState(a??"bar");return r.useEffect(()=>{s(a??"bar")},[i,a]),{chartType:n,setChartType:s}}function kr(e,t){const a=e?.[t],i=e?.id,n=JSON.stringify(a),[s,o]=r.useState(a??{mode:"auto"});return r.useEffect(()=>{const e=n?JSON.parse(n):void 0;o(e??{mode:"auto"})},[i,n]),{xAxisScale:s,setXAxisScale:o}}function Cr(e,t){const a=e?.[t],i=e?.id,n=JSON.stringify(a),[s,o]=r.useState(a??{mode:"auto"});return r.useEffect(()=>{const e=n?JSON.parse(n):void 0;o(e??{mode:"auto"})},[i,n]),{yAxisScale:s,setYAxisScale:o}}function jr(){const[e,t]=r.useState(()=>"true"===localStorage.getItem("transparentExport"));return r.useEffect(()=>{const e=()=>{t("true"===localStorage.getItem("transparentExport"))};window.addEventListener("transparentExportChanged",e);const a=e=>{"transparentExport"===e.key&&t("true"===e.newValue)};return window.addEventListener("storage",a),()=>{window.removeEventListener("transparentExportChanged",e),window.removeEventListener("storage",a)}},[]),e}function Dr(e,t,a,i){const n=r.useRef([]);return r.useCallback(()=>{if(!t.current)return[];const r=t.current.data.datasets||[],s=a?.hiddenLegends||[],o=r.map(a=>{const r=a.label||"";let n;r.includes("理論値")||r.includes("Theoretical")?n="theoretical":r.includes("実測値")||r.includes("Actual")?n="actual":r.includes("中央値")||r.includes("Median")?n="median":r.includes("移動平均")||r.includes("Moving Average")?n="movingAverage":(r.includes("期待値")||r.includes("Expected"))&&(n="expectedValue");const o=Array.isArray(a.backgroundColor)?a.backgroundColor[0]:a.backgroundColor,l=Array.isArray(a.borderColor)?a.borderColor[0]:a.borderColor,c=Array.isArray(a.borderDash)?a.borderDash:void 0,d=s.includes(r);return{label:r,color:o||"#999",borderColor:l||void 0,borderWidth:a.borderWidth||1,borderDash:c,chartType:e,datasetType:n,hidden:d,onClick:()=>{const e=t.current;if(!e)return;const a=e.data.datasets||[],n=[...s];a.forEach((t,a)=>{if(t.label===r){const t=e.getDatasetMeta(a);t.hidden=!t.hidden;const i=n.indexOf(r);t.hidden&&-1===i?n.push(r):t.hidden||-1===i||n.splice(i,1)}}),e.update(),i&&i(n)}}});return n.current=o,o},[e,t,a,i])()}function Nr(e,t,a,r){if(!t.current)return[];const i=t.current.data.datasets||[],n=[];return i.map(a=>{const r=a.label||"";let i;r.includes("理論値")||r.includes("Theoretical")?i="theoretical":r.includes("実測値")||r.includes("Actual")?i="actual":r.includes("中央値")||r.includes("Median")?i="median":r.includes("移動平均")||r.includes("Moving Average")?i="movingAverage":(r.includes("期待値")||r.includes("Expected"))&&(i="expectedValue");const s=Array.isArray(a.backgroundColor)?a.backgroundColor[0]:a.backgroundColor,o=Array.isArray(a.borderColor)?a.borderColor[0]:a.borderColor,l=Array.isArray(a.borderDash)?a.borderDash:void 0,c=n.includes(r);return{label:r,color:s||"#999",borderColor:o||void 0,borderWidth:a.borderWidth||1,borderDash:l,chartType:e,datasetType:i,hidden:c,onClick:()=>{const e=t.current;if(!e)return;const a=e.data.datasets||[],i=[...n];a.forEach((t,a)=>{if(t.label===r){const t=e.getDatasetMeta(a);t.hidden=!t.hidden;const n=i.indexOf(r);t.hidden&&-1===n?i.push(r):t.hidden||-1===n||i.splice(n,1)}}),e.update()}}})}class Ar{constructor(){t(this,"items",[]),t(this,"cachedItems",null)}addItem(e){this.items.find(t=>t.id===e.id),this.items.push(e),this.cachedItems=null}removeItem(e){const t=this.items.length;return this.items=this.items.filter(t=>t.id!==e),this.cachedItems=null,t-this.items.length}disableItem(e){let t=0;return this.items.forEach(a=>{a.id!==e||a.disabled||(a.disabled=!0,t++)}),t>0&&(this.cachedItems=null),t}enableItem(e){let t=0;return this.items.forEach(a=>{a.id===e&&a.disabled&&(a.disabled=!1,t++)}),t>0&&(this.cachedItems=null),t}getItems(){if(null!==this.cachedItems)return this.cachedItems;const e=this.items.filter(e=>!e.disabled&&!(e.condition&&!e.condition())).sort((e,t)=>e.priority!==t.priority?e.priority-t.priority:this.items.indexOf(e)-this.items.indexOf(t));return this.cachedItems=e,e}debugItems(){}}const Tr=({value:e,min:t,max:a,onChange:i,disabled:n=!1,className:o=""})=>{const l=r.useRef(e),[c,d]=r.useState(String(e)),g=r.useRef(null),u=r.useRef(!1);r.useEffect(()=>{u.current||e===l.current||(d(String(e)),l.current=e)},[e]);const h=r.useCallback(e=>e.replace(/[^0-9]/g,""),[]),m=r.useCallback(e=>Math.min(Math.max(e,t),a),[t,a]),p=r.useCallback(e=>{u.current=!0;const t=h(e.target.value);d(t)},[h]),x=r.useCallback(()=>{u.current=!1;const e=h(c);let a;a=""===e?t:m(parseInt(e,10)),d(String(a)),l.current=a,i(a)},[c,h,m,i,t]),f=r.useCallback(()=>{u.current=!0},[]),y=r.useCallback(()=>{x()},[x]),b=r.useCallback(e=>{"Enter"===e.key&&(x(),g.current?.blur())},[x]);return s.jsx("input",{ref:g,type:"text",inputMode:"numeric",pattern:"[0-9]*",value:c,onChange:p,onFocus:f,onBlur:y,onKeyDown:b,disabled:n,className:o})};function Mr(e){const t=[];return(isNaN(e.diceCount)||e.diceCount<1||e.diceCount>Ze)&&t.push({field:"diceCount",message:"ダイスの数は1〜10の範囲で指定してください"}),(isNaN(e.diceFaces)||e.diceFaces<1||e.diceFaces>et)&&t.push({field:"diceFaces",message:"面の数は1〜9999の範囲で指定してください"}),e.modifierSign&&(isNaN(e.modifierValue)||e.modifierValue<0||e.modifierValue>tt)&&t.push({field:"modifierValue",message:"修正値は0〜99999の範囲で指定してください"}),t}function Lr(e){const t=[];return(isNaN(e)||e<1||e>at)&&t.push({field:"trialCount",message:"試行回数は1〜1000の範囲で指定してください"}),t}function Rr(e,t){return[...Mr(e),...Lr(t)]}function Er(e){if(!e.trim())return{conditions:[],normalizedInput:""};const t=e.replace(/[^\d,\s\-+n\u3001\u3000]/g,"");if(!t.trim())return{conditions:[],normalizedInput:""};const a=t.split(/[,、\s\u3000]+/).map(e=>e.trim()).filter(e=>e.length>0);if(0===a.length)return{conditions:[],normalizedInput:""};const r=[],i=new Set;for(const s of a){const e=s.match(/^(\d+)n([+-]\d+)?$/);if(e){const t=parseInt(e[1],10),a=e[2];let n=a?parseInt(a,10):0;if(isNaN(t)||0===t)return{conditions:[],error:`無効な倍数指定: "${s}"`};n=(n%t+t)%t;const o=`modulo:${t}:${n}`;i.has(o)||(i.add(o),r.push({type:"modulo",divisor:t,offset:n}));continue}if(s.includes("-")){const e=s.split("-").filter(e=>e.length>0);if(2!==e.length)return{conditions:[],error:`不正な範囲指定: "${s}"`};const t=parseInt(e[0],10),a=parseInt(e[1],10);if(isNaN(t)||isNaN(a))return{conditions:[],error:`範囲指定に無効な値: "${s}"`};const n=Math.max(1,Math.min(et,t)),o=Math.max(1,Math.min(et,a)),l=Math.min(n,o),c=Math.max(n,o),d=`range:${l}-${c}`;i.has(d)||(i.add(d),r.push({type:"range",min:l,max:c}))}else{const e=parseInt(s,10);if(isNaN(e))return{conditions:[],error:`無効な数値: "${s}"`};const t=Math.max(1,Math.min(et,e)),a=`single:${t}`;i.has(a)||(i.add(a),r.push({type:"single",value:t}))}}const n=r.map(e=>"single"===e.type?`${e.value}`:"range"===e.type?`${e.min}-${e.max}`:"modulo"===e.type?0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"").join(", ");return{conditions:r,normalizedInput:n}}const Ir=({conditions:e,onChange:t,t:a})=>{const i=e&&e.length>0?e.map(e=>"single"===e.type?`${e.value}`:"range"===e.type?`${e.min}-${e.max}`:"modulo"===e.type?0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"").join(", "):"",[n,o]=r.useState(i),[l,c]=r.useState(),[d,g]=r.useState(!1);r.useEffect(()=>{if(d)return;const t=e&&e.length>0?e.map(e=>"single"===e.type?`${e.value}`:"range"===e.type?`${e.min}-${e.max}`:"modulo"===e.type?0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"").join(", "):"";o(t)},[e,d]);return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:a("charts:recentRolls.highlightLabel")}),s.jsx("input",{type:"text",value:n,onChange:e=>{const t=e.target.value;o(t),c(void 0)},onFocus:()=>{g(!0)},onBlur:()=>{g(!1);const e=Er(n);e.error?c(e.error):(c(void 0),t?.(e.conditions),void 0!==e.normalizedInput&&e.normalizedInput!==n&&o(e.normalizedInput))},placeholder:a("charts:recentRolls.highlightPlaceholder"),className:"w-full px-2 py-1.5 text-sm border rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 "+(l?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")}),l&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:l}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a("charts:recentRolls.highlightHelp")})]})};function Or(e){const{t:t}=Fe(),a=n.useRef(e);a.current=e;const i=r.useRef(null);i.current||(i.current=new Ar);const o=i.current,l=r.useMemo(()=>["widget-type","chart-settings","appearance","aggregation","binning","target-value","moving-average","recent-rolls-count","highlight-conditions","x-axis-scale","y-axis-scale","fullscreen","download","custom-children"],[]);r.useEffect(()=>{l.forEach(e=>{o.removeItem(e)}),e.showWidgetTypeSelector&&o.addItem({id:"widget-type",priority:He,render:()=>{const e=a.current;return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:t("charts:options.widgetType")}),s.jsxs("select",{value:e.widgetType,onChange:t=>e.onWidgetTypeChange?.(t.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"result",children:t("charts:widget.graphTypes.result")}),s.jsx("option",{value:"cumulative",children:t("charts:widget.graphTypes.cumulative")}),s.jsx("option",{value:"rollProgress",children:t("charts:widget.graphTypes.rollProgress")}),s.jsx("option",{value:"individual",children:t("charts:widget.graphTypes.individual")}),s.jsx("option",{value:"recentRolls",children:t("charts:widget.graphTypes.recentRolls")})]})]},"widget-type")}}),e.showChartSettingsSelector&&o.addItem({id:"chart-settings",priority:ze,render:()=>{const e=a.current;return s.jsxs(za,{id:"chart-settings",title:t("charts:options.displaySettings"),children:[s.jsx("select",{value:e.currentChartSettingsId,onChange:t=>e.onSelectChartSettings?.(t.target.value),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:e.chartSettings?.map(e=>s.jsx("option",{value:e.id,children:e.name.length>30?e.name.substring(0,30)+"...":e.name},e.id))}),e.onManageChartSettings&&s.jsx("button",{onClick:()=>{e.onManageChartSettings?.(),e.closeMenu?.()},className:"w-full mt-2 px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-xs transition-colors",children:t("charts:options.manageSettings")})]},"chart-settings")}}),e.showChartTypeToggle&&o.addItem({id:"appearance",priority:qe,render:()=>{const e=a.current;return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:t("charts:options.chartType")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>{e.onChartTypeChange?.("bar"),e.closeMenu?.()},className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-2 "+("bar"===e.chartType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),title:t("charts:type.bar"),children:[s.jsx(lt,{name:"bar-chart",className:"w-4 h-4"}),s.jsx("span",{className:"hidden md:inline",children:t("charts:type.bar")})]}),s.jsxs("button",{onClick:()=>{e.onChartTypeChange?.("line"),e.closeMenu?.()},className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-2 "+("line"===e.chartType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),title:t("charts:type.line"),children:[s.jsx(lt,{name:"line-chart",className:"w-4 h-4"}),s.jsx("span",{className:"hidden md:inline",children:t("charts:type.line")})]})]})]},"appearance")}}),e.showBinningSettings&&o.addItem({id:"binning",priority:Ye,render:()=>{const e=a.current;return s.jsxs(za,{id:"binning",title:t("charts:options.binning.title"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:t("charts:options.binning.useBinning")}),s.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:e.useBinning,onChange:t=>{e.onBinningChange?.({useBinning:t.target.checked,binningAlgorithm:e.binningAlgorithm||"scott",binWidthMultiple:e.binWidthMultiple||1})},className:"sr-only peer"}),s.jsx("div",{className:"relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent-light-300 dark:peer-focus:ring-accent-dark-300 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-accent-light-500 dark:peer-checked:bg-accent-dark-500"})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.binning.algorithm")}),s.jsxs("select",{value:e.binningAlgorithm||"equal-width",onChange:t=>{e.onBinningChange?.({useBinning:e.useBinning??!1,binningAlgorithm:t.target.value,binWidthMultiple:e.binWidthMultiple||1})},disabled:!e.useBinning,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("option",{value:"equal-width",children:t("charts:options.binning.equalWidth")}),s.jsx("option",{value:"scott",children:t("charts:options.binning.scott")}),s.jsx("option",{value:"fd",children:t("charts:options.binning.fd")})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.binning.binWidthMultiple")}),s.jsx(Tr,{value:e.binWidthMultiple||1,min:1,max:Ve,onChange:t=>{e.onBinningChange?.({useBinning:e.useBinning??!1,binningAlgorithm:e.binningAlgorithm||"equal-width",binWidthMultiple:t})},disabled:!e.useBinning,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"})]}),s.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[s.jsx("p",{children:t("charts:options.binning.status",{count:e.currentDataPoints})}),e.isBinned&&s.jsx("p",{className:"text-accent-light-600 dark:text-accent-dark-400",children:t("charts:options.binning.statusBinned",{binCount:e.binCount,binWidth:e.binWidth})})]})]},"binning")}}),e.showAggregationSettings&&o.addItem({id:"aggregation",priority:Ye,render:()=>{const e=a.current;return s.jsxs(za,{id:"aggregation",title:t("charts:options.aggregation.title"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:t("charts:options.aggregation.useAggregation")}),s.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:e.useAggregation,onChange:t=>{e.onAggregationChange?.({useAggregation:t.target.checked,aggregationInterval:e.aggregationInterval||2})},className:"sr-only peer"}),s.jsx("div",{className:"relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-accent-light-300 dark:peer-focus:ring-accent-dark-300 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-accent-light-500 dark:peer-checked:bg-accent-dark-500"})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.aggregation.intervalLabel")}),s.jsx(Tr,{value:e.aggregationInterval||2,min:2,max:nt,onChange:t=>{e.onAggregationChange?.({useAggregation:e.useAggregation??!1,aggregationInterval:t})},disabled:!e.useAggregation,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"})]}),s.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[s.jsx("p",{children:t("charts:options.aggregation.status",{count:e.currentDataPoints})}),e.isAggregated&&s.jsx("p",{className:"text-accent-light-600 dark:text-accent-dark-400",children:t("charts:options.aggregation.statusAggregated",{interval:e.aggregationInterval})})]})]},"aggregation")}}),e.showTargetValueSettings&&o.addItem({id:"target-value",priority:Xe,render:()=>{const e=a.current;return s.jsxs(za,{id:"target-value",title:t("charts:options.targetValue.title"),children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.targetValue.label")}),s.jsx(Tr,{value:e.targetValue||e.minTargetValue||1,min:e.minTargetValue||1,max:e.maxTargetValue||6,onChange:t=>{e.onTargetValueChange?.(t)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t("charts:options.targetValue.range",{min:e.minTargetValue,max:e.maxTargetValue})})]},"target-value")}}),e.showMovingAverageSettings&&o.addItem({id:"moving-average",priority:_e,render:()=>{const e=a.current;return s.jsxs(za,{id:"moving-average",title:t("charts:options.movingAverage.title"),children:[s.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.movingAverage.windowLabel")}),s.jsx(Tr,{value:e.movingAverageWindow||20,min:2,max:100,onChange:t=>{e.onMovingAverageWindowChange?.(t)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"2-100の範囲で指定"})]},"moving-average")}}),e.showRecentRollsCountSettings&&o.addItem({id:"recent-rolls-count",priority:650,render:()=>{const e=a.current,r=e.recentRollsCount||1;return s.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:t("charts:recentRolls.countLabel")}),s.jsx("select",{value:r,onChange:t=>{e.onRecentRollsCountChange?.(Number(t.target.value)),e.closeMenu?.()},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[1,2,3].map(e=>s.jsx("option",{value:e,children:t("charts:recentRolls.countOption",{count:e})},e))})]},"recent-rolls-count")}}),e.showHighlightConditionsSettings&&o.addItem({id:"highlight-conditions",priority:655,render:()=>{const e=a.current;return s.jsx(Ir,{conditions:e.highlightConditions,onChange:e.onHighlightConditionsChange,t:t})}}),e.showXAxisScaleSettings&&o.addItem({id:"x-axis-scale",priority:Je,render:()=>{const e=a.current;return s.jsxs(za,{id:"x-axis-scale",title:t("charts:options.xAxisScale.title"),children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"x-axis-scale-mode",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.xAxisScale.mode")}),s.jsxs("select",{id:"x-axis-scale-mode",value:e.xAxisScale?.mode||"auto",onChange:t=>{const a=t.target.value,r={mode:a};"semi-auto"===a&&(r.initialMin=e.xAxisScale?.initialMin,r.initialMax=e.xAxisScale?.initialMax),e.onXAxisScaleChange?.(r)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"auto",children:t("charts:options.xAxisScale.auto")}),s.jsx("option",{value:"semi-auto",children:t("charts:options.xAxisScale.semiAuto")}),s.jsx("option",{value:"manual",children:t("charts:options.xAxisScale.manual")})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t(`charts:options.xAxisScale.description.${e.xAxisScale?.mode||"auto"}`)})]}),"manual"===(e.xAxisScale?.mode||"auto")&&s.jsxs("div",{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"x-axis-scale-min",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.xAxisScale.min")}),s.jsx("input",{id:"x-axis-scale-min",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.xAxisScale?.min?.toString()||"",onChange:t=>{const a=""!==t.target.value?parseFloat(t.target.value):void 0;e.onXAxisScaleChange?.({mode:"manual",min:a,max:e.xAxisScale?.max})},placeholder:t("charts:options.xAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"x-axis-scale-max",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.xAxisScale.max")}),s.jsx("input",{id:"x-axis-scale-max",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.xAxisScale?.max?.toString()||"",onChange:t=>{const a=""!==t.target.value?parseFloat(t.target.value):void 0;e.onXAxisScaleChange?.({mode:"manual",min:e.xAxisScale?.min,max:a})},placeholder:t("charts:options.xAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("charts:options.xAxisScale.manualHelp")})]})]},"x-axis-scale")}}),e.showYAxisScaleSettings&&o.addItem({id:"y-axis-scale",priority:Qe,render:()=>{const e=a.current;return s.jsxs(za,{id:"y-axis-scale",title:t("charts:options.yAxisScale.title"),children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"y-axis-scale-mode",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.yAxisScale.mode")}),s.jsxs("select",{id:"y-axis-scale-mode",value:e.yAxisScale?.mode||"auto",onChange:t=>{const a=t.target.value,r={mode:a};"semi-auto"===a&&(r.initialMin=e.yAxisScale?.initialMin,r.initialMax=e.yAxisScale?.initialMax),e.onYAxisScaleChange?.(r)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"auto",children:t("charts:options.yAxisScale.auto")}),s.jsx("option",{value:"semi-auto",children:t("charts:options.yAxisScale.semiAuto")}),s.jsx("option",{value:"manual",children:t("charts:options.yAxisScale.manual")})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t(`charts:options.yAxisScale.description.${e.yAxisScale?.mode||"auto"}`)})]}),"manual"===(e.yAxisScale?.mode||"auto")&&s.jsxs("div",{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"y-axis-scale-min",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.yAxisScale.min")}),s.jsx("input",{id:"y-axis-scale-min",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.yAxisScale?.min?.toString()||"",onChange:t=>{const a=""!==t.target.value?parseFloat(t.target.value):void 0;e.onYAxisScaleChange?.({mode:"manual",min:a,max:e.yAxisScale?.max})},placeholder:t("charts:options.yAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"y-axis-scale-max",className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:t("charts:options.yAxisScale.max")}),s.jsx("input",{id:"y-axis-scale-max",type:"text",inputMode:"numeric",pattern:"[0-9\\-]*",value:e.yAxisScale?.max?.toString()||"",onChange:t=>{const a=""!==t.target.value?parseFloat(t.target.value):void 0;e.onYAxisScaleChange?.({mode:"manual",min:e.yAxisScale?.min,max:a})},placeholder:t("charts:options.yAxisScale.placeholder"),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"})]})]}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("charts:options.yAxisScale.manualHelp")})]})]},"y-axis-scale")}}),e.children&&o.addItem({id:"custom-children",priority:e.childrenPriority||Ke,render:()=>s.jsx(n.Fragment,{children:a.current.children},"custom-children")}),e.onOpenFullscreen&&o.addItem({id:"fullscreen",priority:950,render:()=>{const e=a.current;return s.jsxs("button",{onClick:()=>{e.onOpenFullscreen?.(),e.closeMenu?.()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"})}),s.jsx("span",{className:"text-sm",children:t("charts:menu.fullScreen")})]},"fullscreen")}}),e.onDownloadImage&&o.addItem({id:"download",priority:Ge,render:()=>{const e=a.current;return s.jsxs("button",{onClick:()=>{e.onDownloadImage?.(),e.closeMenu?.()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),s.jsx("polyline",{points:"21 15 16 10 5 21"})]}),s.jsx("span",{className:"text-sm",children:t("charts:options.download")})]},"download")}})},[o,l,e.showWidgetTypeSelector,e.showChartSettingsSelector,e.showChartTypeToggle,e.showAggregationSettings,e.showBinningSettings,e.showTargetValueSettings,e.showMovingAverageSettings,e.showRecentRollsCountSettings,e.showHighlightConditionsSettings,e.showXAxisScaleSettings,e.showYAxisScaleSettings,e.children,e.childrenPriority,e.onOpenFullscreen,e.onDownloadImage,t]);const c=r.useCallback(e=>{o.addItem(e)},[]),d=r.useCallback(e=>{o.removeItem(e)},[]),g=r.useCallback(e=>{o.disableItem(e)},[]),u=r.useCallback(e=>{o.enableItem(e)},[]);return{manager:o,addCustomItem:c,removeItem:d,disableItem:g,enableItem:u}}const $r=({chartType:e,onChartTypeChange:t,onDownloadImage:a,showChartTypeToggle:i=!0,showAggregationSettings:o=!1,useAggregation:l=!1,aggregationInterval:c=10,onAggregationChange:d,currentDataPoints:g=0,isAggregated:u=!1,showTargetValueSettings:h=!1,targetValue:m=1,minTargetValue:p=1,maxTargetValue:x=6,onTargetValueChange:f,showMovingAverageSettings:y=!1,movingAverageWindow:b=20,onMovingAverageWindowChange:v,showRecentRollsCountSettings:S=!1,recentRollsCount:w=1,onRecentRollsCountChange:k,showHighlightConditionsSettings:C=!1,highlightConditions:j=[],onHighlightConditionsChange:D,showXAxisScaleSettings:N=!1,xAxisScale:A={mode:"auto"},onXAxisScaleChange:T,showYAxisScaleSettings:M=!1,yAxisScale:L={mode:"auto"},onYAxisScaleChange:R,showChartSettingsSelector:E=!1,chartSettings:I=[],currentChartSettingsId:O="",onSelectChartSettings:$,onManageChartSettings:P,showWidgetTypeSelector:F=!1,widgetType:W="result",onWidgetTypeChange:V,children:B,childrenPriority:U=850,menuManager:H})=>{const{t:z}=Fe(["charts"]),[q,Y]=n.useState(!1),X=r.useRef(null),_=r.useRef(null),J=Or({showWidgetTypeSelector:F,widgetType:W,onWidgetTypeChange:V,showChartSettingsSelector:E,chartSettings:I,currentChartSettingsId:O,onSelectChartSettings:$,onManageChartSettings:P,showChartTypeToggle:i,chartType:e,onChartTypeChange:t,showAggregationSettings:o,useAggregation:l,aggregationInterval:c,onAggregationChange:d,currentDataPoints:g,isAggregated:u,showTargetValueSettings:h,targetValue:m,minTargetValue:p,maxTargetValue:x,onTargetValueChange:f,showMovingAverageSettings:y,movingAverageWindow:b,onMovingAverageWindowChange:v,showRecentRollsCountSettings:S,recentRollsCount:w,onRecentRollsCountChange:k,showHighlightConditionsSettings:C,highlightConditions:j,onHighlightConditionsChange:D,showXAxisScaleSettings:N,xAxisScale:A,onXAxisScaleChange:T,showYAxisScaleSettings:M,yAxisScale:L,onYAxisScaleChange:R,children:B,childrenPriority:U,onDownloadImage:a,closeMenu:()=>Y(!1)}),K=H||J.manager;r.useEffect(()=>{const e=e=>{X.current&&!X.current.contains(e.target)&&_.current&&!_.current.contains(e.target)&&Y(!1)};if(q)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[q]);return s.jsxs("div",{className:"relative",children:[s.jsx("button",{ref:_,onClick:()=>{Y(!q)},className:"w-8 h-8 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center z-10",title:z("charts:options.title"),children:s.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"5",r:"1"}),s.jsx("circle",{cx:"12",cy:"12",r:"1"}),s.jsx("circle",{cx:"12",cy:"19",r:"1"})]})}),s.jsx("div",{ref:X,className:"absolute right-0 top-full mt-2 w-72 bg-white dark:bg-gray-700 rounded-lg shadow-lg overflow-hidden border border-gray-200 dark:border-gray-600 z-50 overflow-y-auto transition-opacity "+(q?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:s.jsx(Ha,{multipleExpanded:!0,children:K.getItems().map(e=>s.jsx(n.Fragment,{children:e.render()},e.id))})})]})};function Pr(e){return void 0!==e&&"useAggregation"in e}function Fr(e){return void 0!==e&&"useBinning"in e}const Wr=({settings:e,onChange:t,showAllCharts:a=!0,activeTab:i,onActiveTabChange:n})=>{const{t:o}=Fe(["charts","common"]),[l,c]=r.useState("0"),d=void 0!==i?i:l,g=n||c,[u,h]=r.useState(!1),m=r.useRef(null),p=r.useRef(null),x=e?.widgets||[];r.useEffect(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&m.current&&!m.current.contains(e.target)&&h(!1)};if(u)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[u]);const f=e=>{switch(e){case"result":return"chart-total-distribution";case"cumulative":return"chart-cumulative-distribution";case"rollProgress":return"chart-roll-progress";case"individual":return"chart-individual-dice";case"recentRolls":return"dice";default:return"chart-bar"}},y=(e,a)=>{const r=[...x];r[e]={...r[e],chartType:a},t({widgets:r})},b=(e,a)=>{const r=[...x];r[e]={...r[e],aggregationSettings:a},t({widgets:r})},v=(e,a)=>{const r=[...x];r[e]={...r[e],aggregationSettings:a},t({widgets:r})},S=(e,a)=>{const r=[...x];r[e]={...r[e],distributionType:a},t({widgets:r})},w=(e,a)=>{const r=[...x];r[e]={...r[e],quantileCount:a},t({widgets:r})};return s.jsx("div",{className:"space-y-4",children:a&&x.length>0&&s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"w-full md:w-24 lg:w-32 flex-shrink-0",children:[s.jsxs("div",{className:"md:hidden relative",children:[s.jsx("button",{ref:m,onClick:()=>h(!u),className:"w-full px-3 py-2.5 text-sm font-medium border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 flex items-center justify-between gap-2",children:(()=>{const e=parseInt(d),t=x[e];if(!t)return null;const a=f(t.type),r=x.filter((a,r)=>r<=e&&a.type===t.type).length,i=t.customName||bt(t.type,r,o);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx(lt,{name:a,className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"truncate",children:i})]}),s.jsx(lt,{name:"chevron-down",className:"w-4 h-4 flex-shrink-0 transition-transform "+(u?"rotate-180":"")})]})})()}),s.jsx("div",{ref:p,className:"absolute left-0 right-0 top-full mt-1 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[100] border border-gray-200 dark:border-gray-600 transition-all origin-top "+(u?"opacity-100 scale-y-100 pointer-events-auto":"opacity-0 scale-y-95 pointer-events-none"),style:{maxHeight:"60vh",overflowY:"auto"},children:x.map((e,t)=>{const a=f(e.type),r=x.filter((a,r)=>r<=t&&a.type===e.type).length,i=e.customName||bt(e.type,r,o),n=d===t.toString();return s.jsxs("button",{onClick:()=>{g(t.toString()),h(!1)},className:"w-full px-3 py-2.5 text-sm font-medium transition-colors flex items-center gap-2 text-left "+(n?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-600"),children:[s.jsx(lt,{name:a,className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"truncate",children:i})]},e.id)})})]}),s.jsx("div",{className:"hidden md:block space-y-1",children:x.map((e,t)=>{const a=f(e.type),r=x.filter((a,r)=>r<=t&&a.type===e.type).length,i=e.customName||bt(e.type,r,o);return s.jsxs("button",{"data-tab-index":t.toString(),onClick:()=>g(t.toString()),className:"w-full px-3 py-2.5 text-sm font-medium transition-colors rounded-lg flex items-center gap-2 text-left "+(d===t.toString()?"bg-accent-light-500 dark:bg-accent-dark-500 text-white shadow-sm":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[s.jsx(lt,{name:a,className:"w-4 h-4 flex-shrink-0"}),s.jsx("span",{className:"truncate",children:i})]},e.id)})})]}),s.jsx("div",{className:"flex-1 min-w-0",children:(()=>{const a=parseInt(d),r=x[a];if(!r)return null;return s.jsxs(s.Fragment,{children:[((a,r)=>{const i="rollProgress"!==r.type&&"recentRolls"!==r.type,n="result"===r.type,l="rollProgress"===r.type||"individual"===r.type,c="recentRolls"!==r.type;return s.jsxs("div",{className:"space-y-3",children:[i&&s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("charts:options.chartType")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>y(a,"bar"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-1.5 "+("bar"===(r.chartType||"bar")?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:[s.jsx(lt,{name:"bar-chart",className:"w-4 h-4"}),o("charts:type.bar")]}),s.jsxs("button",{onClick:()=>y(a,"line"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center gap-1.5 "+("line"===r.chartType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:[s.jsx(lt,{name:"line-chart",className:"w-4 h-4",strokeWidth:1.5}),o("charts:type.line")]})]})]}),n&&(()=>{const t=r.aggregationSettings??e?.resultChart,i=!!Fr(t)&&t.useBinning,n=Fr(t)?t.binningAlgorithm:"equal-width",l=Fr(t)?t.binWidthMultiple:1;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.binning.useBinning")}),s.jsx(ar,{checked:i,onChange:e=>v(a,{useBinning:e,binningAlgorithm:n,binWidthMultiple:l}),label:o("charts:options.binning.useBinning"),size:"small"})]}),i&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 block mb-1",children:o("charts:options.binning.algorithm")}),s.jsxs("select",{value:n,onChange:e=>{v(a,{useBinning:!0,binningAlgorithm:e.target.value,binWidthMultiple:l})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[s.jsx("option",{value:"equal-width",children:o("charts:options.binning.equalWidth")}),s.jsx("option",{value:"scott",children:o("charts:options.binning.scott")}),s.jsx("option",{value:"fd",children:o("charts:options.binning.fd")})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 block mb-1",children:o("charts:options.binning.binWidthMultiple")}),s.jsx("input",{type:"number",min:1,max:Ve,value:l,onChange:e=>{const t=""===e.target.value?1:parseInt(e.target.value);v(a,{useBinning:!0,binningAlgorithm:n,binWidthMultiple:t})},onBlur:e=>{const t=parseInt(e.target.value)||1,r=Math.max(1,Math.min(Ve,t));v(a,{useBinning:!0,binningAlgorithm:n,binWidthMultiple:r})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]})})(),l&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.useAggregation")}),s.jsx(ar,{checked:!!Pr(r.aggregationSettings)&&r.aggregationSettings.useAggregation,onChange:e=>b(a,{useAggregation:e,aggregationInterval:Pr(r.aggregationSettings)?r.aggregationSettings.aggregationInterval:20}),label:o("charts:options.useAggregation"),size:"small"})]}),Pr(r.aggregationSettings)&&r.aggregationSettings.useAggregation&&s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:o("charts:options.aggregationInterval")}),s.jsx("input",{type:"number",min:2,max:nt,value:r.aggregationSettings.aggregationInterval,onChange:e=>{const t=""===e.target.value?2:parseInt(e.target.value);b(a,{useAggregation:!0,aggregationInterval:t})},onBlur:e=>{const t=parseInt(e.target.value)||2,r=Math.max(2,Math.min(nt,t));b(a,{useAggregation:!0,aggregationInterval:r})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]}),c&&s.jsx(Vr,{chartKey:a.toString(),settings:r.xAxisScale,onChange:(e,r)=>((e,a)=>{const r=[...x],i={mode:"auto",...r[e].xAxisScale,...a};"manual"!==i.mode&&(delete i.min,delete i.max),r[e]={...r[e],xAxisScale:i},t({widgets:r})})(a,r),t:o}),"recentRolls"!==r.type&&s.jsx(Br,{chartKey:a.toString(),settings:r.yAxisScale,onChange:(e,r)=>((e,a)=>{const r=[...x],i={mode:"auto",...r[e].yAxisScale,...a};"manual"!==i.mode&&(delete i.min,delete i.max),r[e]={...r[e],yAxisScale:i},t({widgets:r})})(a,r),t:o})]})})(a,r),((e,a)=>{switch(a.type){case"rollProgress":return s.jsxs("div",{className:"mt-3",children:[s.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 block mb-2",children:o("charts:options.movingAverageWindow")}),s.jsx("input",{type:"number",min:2,max:1e3,value:a.movingAverageWindow||20,onChange:a=>{const r=parseInt(a.target.value)||2;((e,a)=>{const r=[...x];r[e]={...r[e],movingAverageWindow:a},t({widgets:r})})(e,Math.max(2,Math.min(1e3,r)))},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]});case"cumulative":return s.jsxs("div",{className:"mt-3 space-y-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:o("charts:options.cumulativeType")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>S(e,"total"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors "+("total"===(a.distributionType||"total")?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:o("charts:options.cumulativeTotal")}),s.jsx("button",{onClick:()=>S(e,"individual"),className:"flex-1 px-3 py-2 rounded text-sm transition-colors "+("individual"===a.distributionType?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:o("charts:options.cumulativeIndividual")})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.cumulativeShowOnlyActual")}),s.jsx(ar,{checked:a.showOnlyActualData||!1,onChange:a=>((e,a)=>{const r=[...x];r[e]={...r[e],showOnlyActualData:a},t({widgets:r})})(e,a),label:o("charts:options.cumulativeShowOnlyActual"),size:"small"})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:o("charts:options.cumulativeQuantile")}),s.jsx(ar,{checked:null!==a.quantileCount&&void 0!==a.quantileCount,onChange:t=>w(e,t?10:null),label:o("charts:options.cumulativeQuantile"),size:"small"})]}),null!==a.quantileCount&&void 0!==a.quantileCount&&s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:o("charts:options.cumulativeQuantileCount")}),s.jsxs("select",{value:a.quantileCount||10,onChange:t=>{const a=Number(t.target.value);w(e,a)},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[s.jsx("option",{value:"10",children:o("charts:options.cumulative.points",{count:10})}),s.jsx("option",{value:"20",children:o("charts:options.cumulative.points",{count:20})}),s.jsx("option",{value:"50",children:o("charts:options.cumulative.points",{count:50})}),s.jsx("option",{value:"100",children:o("charts:options.cumulative.points",{count:100})})]})]})]})]});case"recentRolls":return s.jsxs("div",{className:"mt-3 space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 block mb-2",children:o("charts:recentRolls.countLabel")}),s.jsxs("select",{value:a.recentRollsCount||1,onChange:a=>{const r=Number(a.target.value);((e,a)=>{const r=[...x];r[e]={...r[e],recentRollsCount:a},t({widgets:r})})(e,r)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[s.jsx("option",{value:"1",children:o("charts:recentRolls.countOption",{count:1})}),s.jsx("option",{value:"2",children:o("charts:recentRolls.countOption",{count:2})}),s.jsx("option",{value:"3",children:o("charts:recentRolls.countOption",{count:3})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 block mb-2",children:o("charts:recentRolls.highlightLabel")}),s.jsx(Ur,{value:a.highlightConditions,onChange:a=>((e,a)=>{const r=[...x];r[e]={...r[e],highlightConditions:a},t({widgets:r})})(e,a),t:o})]})]});default:return null}})(a,r)]})})()})]})})},Vr=({chartKey:e,settings:t,onChange:a,t:r})=>{const i=t?.mode||"auto";return s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("charts:options.xAxisScale.title")}),s.jsxs("div",{className:"flex gap-1 mb-2",children:[s.jsx("button",{onClick:()=>a(e,{mode:"auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("auto"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:r("charts:options.xAxisScale.auto")}),s.jsx("button",{onClick:()=>a(e,{mode:"semi-auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("semi-auto"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:r("charts:options.xAxisScale.semiAuto")}),s.jsx("button",{onClick:()=>a(e,{mode:"manual"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("manual"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:r("charts:options.xAxisScale.manual")})]}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:r(`charts:options.xAxisScale.description.${i}`)}),"manual"===i&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:r("charts:options.xAxisScale.manualHelp")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:r("charts:options.xAxisScale.min")}),s.jsx("input",{type:"number",value:t?.min??"",placeholder:r("charts:options.xAxisScale.placeholder"),onChange:t=>{const r=""===t.target.value?void 0:Number(t.target.value);a(e,{mode:"manual",min:r})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:r("charts:options.xAxisScale.max")}),s.jsx("input",{type:"number",value:t?.max??"",placeholder:r("charts:options.xAxisScale.placeholder"),onChange:t=>{const r=""===t.target.value?void 0:Number(t.target.value);a(e,{mode:"manual",max:r})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]})]})},Br=({chartKey:e,settings:t,onChange:a,t:r})=>{const i=t?.mode||"auto";return s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("charts:options.yAxisScale.title")}),s.jsxs("div",{className:"flex gap-1 mb-2",children:[s.jsx("button",{onClick:()=>a(e,{mode:"auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("auto"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:r("charts:options.yAxisScale.auto")}),s.jsx("button",{onClick:()=>a(e,{mode:"semi-auto"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("semi-auto"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:r("charts:options.yAxisScale.semiAuto")}),s.jsx("button",{onClick:()=>a(e,{mode:"manual"}),className:"flex-1 px-2 py-1.5 rounded text-xs transition-colors "+("manual"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),children:r("charts:options.yAxisScale.manual")})]}),s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:r(`charts:options.yAxisScale.description.${i}`)}),"manual"===i&&s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:r("charts:options.yAxisScale.manualHelp")}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:r("charts:options.yAxisScale.min")}),s.jsx("input",{type:"number",value:t?.min??"",placeholder:r("charts:options.yAxisScale.placeholder"),onChange:t=>{const r=""===t.target.value?void 0:Number(t.target.value);a(e,{mode:"manual",min:r})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400",children:r("charts:options.yAxisScale.max")}),s.jsx("input",{type:"number",value:t?.max??"",placeholder:r("charts:options.yAxisScale.placeholder"),onChange:t=>{const r=""===t.target.value?void 0:Number(t.target.value);a(e,{mode:"manual",max:r})},className:"w-full mt-1 px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]})]})]})]})},Ur=({value:e,onChange:t,t:a})=>{const i=e&&e.length>0?e.map(e=>"single"===e.type?`${e.value}`:"range"===e.type?`${e.min}-${e.max}`:"modulo"===e.type?0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"").join(", "):"",[n,o]=r.useState(i),[l,c]=r.useState(),[d,g]=r.useState(!1);r.useEffect(()=>{if(d)return;const t=e&&e.length>0?e.map(e=>"single"===e.type?`${e.value}`:"range"===e.type?`${e.min}-${e.max}`:"modulo"===e.type?0===e.offset?`${e.divisor}n`:e.offset>0?`${e.divisor}n+${e.offset}`:`${e.divisor}n${e.offset}`:"").join(", "):"";o(t)},[e,d]);return s.jsxs("div",{className:"space-y-1",children:[s.jsx("input",{type:"text",value:n,onChange:e=>{const t=e.target.value;o(t),c(void 0)},onFocus:()=>{g(!0)},onBlur:()=>{g(!1);const e=Er(n);e.error?c(e.error):(c(void 0),t(e.conditions),void 0!==e.normalizedInput&&e.normalizedInput!==n&&o(e.normalizedInput))},placeholder:a("charts:recentRolls.highlightPlaceholder"),className:"w-full px-2 py-1.5 text-sm border rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white "+(l?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")}),l&&s.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:l}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("charts:recentRolls.highlightHelp")})]})},Hr=({chartSettings:e,currentSettingsId:t,diceSets:a,compareDiceSetIds:i,onCreateSettings:o,onDuplicateSettings:l,onRenameSettings:c,onUpdateSettings:d,onDeleteSettings:g,onClose:u,hasUnsavedChanges:h,onSaveToSettings:m,onDiscardChanges:p,onReorderSettings:x,onCreateSettingsWithConfig:f,onDuplicateSettingsWithConfig:y})=>{const{t:b}=Fe(["settings","common"]),[v,S]=r.useState(""),[w,k]=r.useState(!1),[C,j]=r.useState([]),[D,N]=r.useState(null),[A,T]=r.useState(!1),M=r.useRef({}),L=r.useRef(null),[R,E]=r.useState({isOpen:!1,mode:"create"});e.forEach(e=>{M.current[e.id]||(M.current[e.id]=n.createRef())}),n.useEffect(()=>{const e=e=>{L.current&&!L.current.contains(e.target)&&T(!1)};if(A)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[A]);const I=e=>{C.includes(e)?j(C.filter(t=>t!==e)):j([...C,e])},O=t=>{const a=St(t.id),r=[];return h&&m&&!a&&r.push({id:"save",label:b("settings:chartSettings.save"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),onClick:async()=>{k(!0);try{await m(t.id),S("")}catch(e){S(e instanceof Error?e.message:b("settings:chartSettings.errors.saveFailed"))}finally{k(!1)}},disabled:w}),r.push({id:"duplicate",label:b("settings:chartSettings.duplicate"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),onClick:()=>{E({isOpen:!0,mode:"duplicate",settingsId:t.id,initialSettings:{...t},initialName:`${t.name}${b("settings:chartSettings.copyNameSuffix")}`})},disabled:w},{id:"rename",label:b("settings:chartSettings.edit"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),onClick:()=>{E({isOpen:!0,mode:"edit",settingsId:t.id,initialSettings:{...t},initialName:t.name})},disabled:w||a},{id:"delete",label:b("settings:chartSettings.delete"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:()=>(async t=>{if(St(t))return void S(b("settings:chartSettings.errors.cannotDeletePreset"));const a=e.find(e=>e.id===t);if(a&&confirm(b("settings:chartSettings.confirmDelete",{name:a.name}))){k(!0),S("");try{await g(t)}catch(r){S(r instanceof Error?r.message:b("settings:chartSettings.errors.deleteFailed"))}finally{k(!1)}}})(t.id),disabled:w||a,danger:!0,separator:!0}),r};return s.jsxs(s.Fragment,{children:[s.jsxs(Ka,{isOpen:!0,onClose:u,size:"2xl",maxHeight:"80vh",modalId:"chart-settings-manager-modal",children:[s.jsx(Qa,{title:b("settings:chartSettings.title"),onClose:u,actions:C.length>0?s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:b("settings:chartSettings.selected",{count:C.length})}):null,sticky:!1}),s.jsx("div",{className:"px-6 py-2 border-b border-gray-200 dark:border-gray-700",children:s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsx("button",{onClick:()=>E({isOpen:!0,mode:"create"}),disabled:w,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",children:b("settings:chartSettings.new")}),s.jsxs("div",{className:"relative",ref:L,children:[s.jsx("button",{onClick:()=>T(!A),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:b("settings:chartSettings.moreOptions"),children:s.jsx(lt,{name:"dots-vertical",className:"w-5 h-5"})}),A&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[s.jsx("button",{onClick:()=>{j([]),T(!1)},disabled:0===C.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",title:b("settings:chartSettings.bulkActions.deselectAll"),children:s.jsx("span",{className:"text-sm",children:b("settings:chartSettings.bulkActions.deselectAll")})}),s.jsxs("button",{onClick:async()=>{if(0!==C.length){k(!0),S("");try{for(const e of C)await l(e);j([])}catch(e){S(e instanceof Error?e.message:b("settings:chartSettings.errors.bulkDuplicateFailed"))}finally{k(!1)}T(!1)}else S(b("settings:chartSettings.errors.noDuplicateSelection"))},disabled:0===C.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),s.jsx("span",{className:"text-sm",children:b("settings:chartSettings.bulkActions.duplicate")})]}),s.jsxs("button",{onClick:async()=>{const e=C.filter(e=>!St(e));if(0!==e.length){if(confirm(b("settings:chartSettings.confirmBulkDelete",{count:e.length}))){k(!0),S("");try{for(const t of e)await g(t);j([])}catch(t){S(t instanceof Error?t.message:b("settings:chartSettings.errors.bulkDeleteFailed"))}finally{k(!1)}T(!1)}}else S(b("settings:chartSettings.errors.noSelection"))},disabled:0===C.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-sm",children:b("settings:chartSettings.bulkActions.delete")})]})]})]})]})}),s.jsxs(Ga,{scrollable:!0,padding:!1,className:"p-4",children:[v&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:v})}),h&&p&&s.jsx("div",{className:"mb-4 p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-300 dark:border-orange-700 rounded-lg",children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[s.jsx("svg",{className:"w-5 h-5 text-orange-600 dark:text-orange-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),s.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:b("settings:chartSettings.unsavedWarning")})]}),s.jsx("button",{onClick:()=>{p(),S("")},disabled:w,className:"px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-sm transition-colors whitespace-nowrap disabled:opacity-50",title:b("settings:chartSettings.discard"),children:b("settings:chartSettings.discard")})]})}),s.jsx(qa,{items:e,selectedIds:C,onToggleItem:I,emptyMessage:b("settings:chartSettings.emptyMessage"),enableDragAndDrop:!!x,onReorder:e=>{if(!x)return;const t=[...e.filter(e=>St(e.id)),...e.filter(e=>!St(e.id))];x(t)},renderItem:(e,a,r,i)=>{const n=St(e.id),o=e.id===t;return s.jsx(Xa,{isSelected:C.includes(e.id),onToggle:()=>I(e.id),showCheckbox:!1,showDragHandle:!!x&&!n,dragHandleProps:i,actions:s.jsxs(s.Fragment,{children:[s.jsx(tr,{buttonRef:M.current[e.id],onClick:t=>{t.stopPropagation(),N(D===e.id?null:e.id)},isSelected:C.includes(e.id)}),s.jsx(er,{isOpen:D===e.id,buttonRef:M.current[e.id],items:O(e),onClose:()=>N(null)})]}),children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:[e.name,n&&s.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",b("settings:chartSettings.preset"),")"]})]}),o&&s.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded flex-shrink-0",children:b("settings:chartSettings.inUse")})]})})}})]})]}),R.isOpen&&s.jsx(ui,{mode:R.mode,initialSettings:R.initialSettings,initialName:R.initialName,diceSets:a,compareDiceSetIds:i,onSubmit:async(t,a)=>{if("create"===R.mode){if(f)await f(t,a);else if(await o(t),Object.keys(a).length>0&&d){const r=e.find(e=>e.name===t);r&&await d(r.id,a)}}else if("duplicate"===R.mode&&R.settingsId){if(y)await y(R.settingsId,t,a);else if(await l(R.settingsId,t),Object.keys(a).length>0&&d){await new Promise(e=>setTimeout(e,100));const r=e.find(e=>e.name===t);r&&await d(r.id,a)}}else if("edit"===R.mode&&R.settingsId){const e={...a,name:t};d?await d(R.settingsId,e):await c(R.settingsId,t)}E({isOpen:!1,mode:"create"})},onClose:()=>E({isOpen:!1,mode:"create"})})]})};const zr=({items:e,isDarkMode:t=!1,onLegendClick:a})=>{const{t:i}=Fe("charts"),[n,o]=r.useState(!1),[l,c]=r.useState("undefined"!=typeof window&&window.innerWidth<640);r.useEffect(()=>{const e=()=>{c(window.innerWidth<640)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const d=l?2:4,g=r.useMemo(()=>{const t=function(e){const t=new Map;return e.forEach(e=>{const a=`${e.label}|${e.datasetType||""}`;if(t.has(a)){const r=t.get(a),i=r.onClick,n=e.onClick;i&&n&&(r.onClick=()=>{i(),n()})}else t.set(a,{...e})}),Array.from(t.values())}(e);return function(e){const t={actual:1,theoretical:2,median:3,movingAverage:4,expectedValue:5};return e.sort((e,a)=>{const r=t[e.datasetType||""]||999,i=t[a.datasetType||""]||999;return r!==i?r-i:e.label.localeCompare(a.label)})}(t)},[e]),u=g.length>d,h=n||!u?g:g.slice(0,d),m=g.length-d;return 0===g.length?null:s.jsxs("div",{className:"mb-6 bg-gray-50/90 dark:bg-gray-800/75 rounded-lg border border-gray-200 dark:border-gray-700",children:[s.jsx("div",{className:(u?"px-4 pt-4":"p-4")+" flex flex-wrap gap-x-6 gap-y-2 justify-center max-h-[70vh] overflow-y-auto",children:h.map((e,r)=>s.jsxs("button",{onClick:()=>(e=>{e.onClick?.(),setTimeout(()=>{a?.()},50)})(e),className:"flex items-center gap-2 px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors "+(e.hidden?"opacity-50 line-through":""),title:e.label,children:[e.borderDash&&e.borderDash.length>0?s.jsx("span",{className:"inline-block h-0.5 w-4 flex-shrink-0",style:{background:`repeating-linear-gradient(\n                    to right,\n                    ${e.borderColor||e.color} 0,\n                    ${e.borderColor||e.color} ${e.borderDash[0]}px,\n                    transparent ${e.borderDash[0]}px,\n                    transparent ${e.borderDash[0]+(e.borderDash[1]||e.borderDash[0])}px\n                  )`,height:"2px"}}):s.jsx("span",{className:"inline-block w-4 h-4 rounded-sm border flex-shrink-0",style:{backgroundColor:e.color,borderColor:e.borderColor||e.color,borderWidth:e.borderWidth||1}}),s.jsx("span",{className:"text-xs font-medium",style:{color:t?"#D1D5DB":"#374151"},children:e.label})]},`${e.label}-${e.datasetType||""}-${r}`))}),u&&s.jsxs("button",{onClick:()=>o(!n),className:"py-2 px-3 flex items-center justify-center gap-1 text-xs w-full text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",children:[s.jsx(lt,{name:n?"chevron-up":"chevron-down",className:"w-4 h-4"}),s.jsx("span",{children:n?i("legend.collapse"):i("legend.showMore",{count:m})})]})]})},qr=({items:e,isDarkMode:t=!1,onLegendClick:a,className:i=""})=>{const{t:n}=Fe(["charts"]),[o,l]=r.useState(!1),c=r.useRef(null);r.useEffect(()=>{const e=e=>{c.current&&!c.current.contains(e.target)&&l(!1)};return o&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[o]);return 0===e.length?null:s.jsxs("div",{ref:c,className:`relative ${i}`,children:[s.jsxs("button",{onClick:()=>l(!o),className:"px-3 py-1.5 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg border border-gray-200 dark:border-gray-600 hover:bg-white dark:hover:bg-gray-800 transition-colors flex items-center gap-2",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:n("charts:legend.title","凡例")}),s.jsx("svg",{className:"w-3 h-3 text-gray-500 dark:text-gray-400 transition-transform "+(o?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&s.jsx("div",{className:"absolute top-full left-0 z-20 mt-1 min-w-[200px] max-w-[300px] bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-600 shadow-xl max-h-[60vh] overflow-y-auto",children:s.jsx("div",{className:"py-1",children:e.map((e,r)=>s.jsxs("button",{onClick:()=>(e=>{e.onClick?.(),setTimeout(()=>{a?.()},50)})(e),className:"w-full flex items-center gap-2 px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-left "+(e.hidden?"opacity-50":""),title:e.label,children:[s.jsx("span",{className:"flex-shrink-0 w-4 h-4 rounded border-2 flex items-center justify-center "+(e.hidden?"border-gray-300 dark:border-gray-600 bg-transparent":"border-gray-400 dark:border-gray-500"),style:{borderColor:e.hidden?void 0:e.borderColor||e.color,backgroundColor:e.hidden?void 0:e.color},children:!e.hidden&&s.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.borderDash&&e.borderDash.length>0?s.jsx("span",{className:"inline-block w-4 flex-shrink-0",style:{background:`repeating-linear-gradient(\n                        to right,\n                        ${e.borderColor||e.color} 0,\n                        ${e.borderColor||e.color} ${e.borderDash[0]}px,\n                        transparent ${e.borderDash[0]}px,\n                        transparent ${e.borderDash[0]+(e.borderDash[1]||e.borderDash[0])}px\n                      )`,height:"2px"}}):s.jsx("span",{className:"inline-block w-4 h-3 rounded-sm border flex-shrink-0",style:{backgroundColor:e.color,borderColor:e.borderColor||e.color,borderWidth:e.borderWidth||1}}),s.jsx("span",{className:"text-xs font-medium flex-grow "+(e.hidden?"line-through":""),style:{color:t?"#D1D5DB":"#374151"},children:e.label})]},`${e.label}-${e.datasetType||""}-${r}`))})})]})},Yr=(e,t=1)=>`rgba(${getComputedStyle(document.documentElement).getPropertyValue(e).trim()}, ${t})`,Xr=(e,t=1)=>Yr(e?"--chart-accent-dark":"--chart-accent-light",t),_r=(e=1)=>Yr("--chart-median",e),Jr=[{light:"rgb(59, 130, 246)",dark:"rgb(96, 165, 250)"},{light:"rgb(239, 68, 68)",dark:"rgb(248, 113, 113)"},{light:"rgb(34, 197, 94)",dark:"rgb(74, 222, 128)"},{light:"rgb(168, 85, 247)",dark:"rgb(192, 132, 252)"},{light:"rgb(249, 115, 22)",dark:"rgb(251, 146, 60)"},{light:"rgb(236, 72, 153)",dark:"rgb(244, 114, 182)"},{light:"rgb(14, 165, 233)",dark:"rgb(56, 189, 248)"},{light:"rgb(132, 204, 22)",dark:"rgb(163, 230, 53)"},{light:"rgb(244, 63, 94)",dark:"rgb(251, 113, 133)"},{light:"rgb(99, 102, 241)",dark:"rgb(129, 140, 248)"}],Kr=(e,t,a=1)=>{const r=Jr[e%Jr.length];return`rgba(${(t?r.dark:r.light).replace("rgb(","").replace(")","")}, ${a})`};let Qr=null;function Gr(e,t){Qr||(Qr=function(){const e=document.createElement("div");return e.style.position="absolute",e.style.background="rgba(0, 0, 0, 0.8)",e.style.color="white",e.style.padding="8px 12px",e.style.borderRadius="4px",e.style.fontSize="14px",e.style.pointerEvents="none",e.style.zIndex="1000",e.style.display="none",e.style.whiteSpace="nowrap",document.body.appendChild(e),e}()),Qr.textContent=e,Qr.style.display="block",Qr.style.left=`${t.pageX+10}px`,Qr.style.top=`${t.pageY+10}px`}function Zr(){Qr&&(Qr.style.display="none")}function ei(){Qr&&Qr.parentNode&&(Qr.parentNode.removeChild(Qr),Qr=null)}function ti(e,t){const a=e.canvas;if(!a)return;const r=a._legendTooltipHandlers;if(r&&(a.removeEventListener("mousemove",r.mouseMove),a.removeEventListener("mouseleave",r.mouseLeave)),t)return a.style.cursor="default",void Zr();const i=t=>{const r=e.legend;if(!r)return void Zr();const i=a.getBoundingClientRect(),n=t.clientX-i.left,s=t.clientY-i.top,o=r.legendItems||[];let l=null;for(const e of o){const t=e._hitBox;if(t&&(n>=t.left&&n<=t.left+t.width&&s>=t.top&&s<=t.top+t.height)){l=e;break}}l&&l._fullText?(a.style.cursor="pointer",Gr(l._fullText,t)):(a.style.cursor="default",Zr())},n=()=>{a.style.cursor="default",Zr()};a.addEventListener("mousemove",i),a.addEventListener("mouseleave",n),a._legendTooltipHandlers={mouseMove:i,mouseLeave:n}}const ai=n.memo(({diceSets:e,onBinningSettingsChange:t,onChartTypeChange:a,onXAxisScaleChange:i,onYAxisScaleChange:n,chartSettings:c,currentChartSettingsId:d,isNarrowLayout:g=!1,chartRef:u,widgetType:h,onWidgetTypeChange:m,widget:p,onUpdateHiddenLegends:x,onOpenFullscreen:f,isFullscreen:y=!1,chartTitleProp:b})=>{const{t:v}=Fe(["charts","common"]),S=r.useRef(null),w=u||S,k=br(),C=jr(),[,j]=r.useState(0),D=Dr("result",w,p,x),N=r.useRef(null),A=r.useRef(null),T=c?.find(e=>e.id===d),{useBinning:M,setUseBinning:L,binningAlgorithm:R,setBinningAlgorithm:E,binWidthMultiple:I,setBinWidthMultiple:O}=function(e,t){const a=e?.[t],i=e?.id,[n,s]=r.useState(a?.useBinning??!1),[o,l]=r.useState(a?.binningAlgorithm??"equal-width"),[c,d]=r.useState(a?.binWidthMultiple??1);return r.useEffect(()=>{s(a?.useBinning??!1),l(a?.binningAlgorithm??"scott"),d(a?.binWidthMultiple??1)},[i,a]),{useBinning:n,setUseBinning:s,binningAlgorithm:o,setBinningAlgorithm:l,binWidthMultiple:c,setBinWidthMultiple:d}}(T,"resultChart"),{chartType:$,setChartType:P}=wr(T,"resultChartType"),{xAxisScale:F,setXAxisScale:W}=kr(T,"resultChartXScale"),{yAxisScale:V,setYAxisScale:B}=Cr(T,"resultChartYScale"),U=e=>{P(e),a?.(e)},H=e[0],z=e.length>1;r.useEffect(()=>{const e=setTimeout(()=>{w.current&&ti(w.current,g)},100);return()=>{clearTimeout(e),ei()}},[e,k,M,R,I,g,w]),r.useEffect(()=>{if(!w.current||!p?.hiddenLegends)return;const e=setTimeout(()=>{if(w.current){const e=w.current,t=p.hiddenLegends||[];e.data.datasets?.forEach((a,r)=>{const i=a.label||"";e.getDatasetMeta(r).hidden=t.includes(i)}),e.update()}},150);return()=>clearTimeout(e)},[w,p?.hiddenLegends,e]),r.useEffect(()=>{if("semi-auto"!==F.mode)return void(N.current&&(N.current=null));if(void 0!==F.initialMin&&void 0!==F.initialMax)return void(N.current||(N.current={min:F.initialMin,max:F.initialMax}));const e=setTimeout(()=>{if(w.current&&w.current.scales&&w.current.scales.x){const e=w.current.scales.x.min,t=w.current.scales.x.max;void 0!==e&&void 0!==t&&(N.current={min:e,max:t},W({...F,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[F.mode]),r.useEffect(()=>{if("semi-auto"!==V.mode)return void(A.current&&(A.current=null));if(void 0!==V.initialMin&&void 0!==V.initialMax)return void(A.current||(A.current={min:V.initialMin,max:V.initialMax}));const e=setTimeout(()=>{if(w.current&&w.current.scales&&w.current.scales.y){const e=w.current.scales.y.min,t=w.current.scales.y.max;void 0!==e&&void 0!==t&&(A.current={min:e,max:t},B({...V,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[V.mode]);const q=r.useMemo(()=>{if(!M||!z)return null;const t=[];return e.forEach(e=>{e.results.forEach(e=>{t.push(e.total)})}),0===t.length?1:"equal-width"===R?Math.max(I,1):sr(t,R,I)},[e,M,z,R,I]),Y=r.useMemo(()=>e.map((e,t)=>{const a=new Map;e.results.forEach(e=>{const t=a.get(e.total)||0;a.set(e.total,t+1)});const r=Array.from(a.entries()).sort((e,t)=>e[0]-t[0]);let i,n,s,o;if(M){let t;t=z&&q?q:"equal-width"===R?I:sr(e.results.map(e=>e.total),R,I);const a=or(r,t,R);i=a.data,n=a.isBinned,s=a.binCount,o=a.binWidth}else i=r,n=!1,s=r.length,o=1;const l=pt(e),c=e.resultsConfig||e.diceConfig;return{diceSet:e,chartData:i,isBinned:n,binCount:s,binWidth:o,diceSetName:l,diceCode:e.hasMultipleDiceConfigs||!1?v("charts:subtitle.custom"):dt(c),index:t}}),[e,M,R,I,z,q,v]),X=r.useMemo(()=>{if(z||!H)return null;const e=H.results.map(e=>e.total),{mean:t,median:a,stdDev:r}=function(e){const t=e.length;if(0===t)return{mean:0,median:0,stdDev:0};const a=e.reduce((e,t)=>e+t,0)/t,r=[...e].sort((e,t)=>e-t),i=t%2==0?(r[t/2-1]+r[t/2])/2:r[Math.floor(t/2)],n=e.reduce((e,t)=>e+Math.pow(t-a,2),0)/t,s=Math.sqrt(n);return{mean:a,median:i,stdDev:s}}(e);return{mean:t,median:a,medianBar:Math.round(a),stdDev:r,expectedValue:function(e){let t=e.diceCount*(e.diceFaces+1)/2;return"+"===e.modifierSign?t+=e.modifierValue:"-"===e.modifierSign&&(t-=e.modifierValue),t}(H.resultsConfig||H.diceConfig)}},[H,z]),_=r.useMemo(()=>{const t=Y[0],a=v("equal-width"===R?"charts:options.binning.equalWidth":"scott"===R?"charts:options.binning.scott":"charts:options.binning.fd"),r=t?.isBinned?` / ${v("charts:subtitle.binning",{algorithm:a,binCount:t.binCount})}`:"";return z?`${v("charts:title.totalDistribution")}\n（${v("charts:title.comparison",{count:e.length})}${r}）`:`${v("charts:title.totalDistribution")}\n（${t?.diceCode||""} / ${v("charts:subtitle.trialCount",{count:H?.results.length||0})}${r})`},[Y,z,e.length,H,R,v]);r.useEffect(()=>{y&&b&&b(_)},[y,_,b]);const J={labels:[],datasets:r.useMemo(()=>{const e=Y.map(({chartData:e,diceSetName:t,index:a,diceSet:r})=>{const i=r.resultsConfig||r.diceConfig,n=r.hasMultipleDiceConfigs||!1,s=z?Kr(a,k,"bar"===$?.6:.05):"bar"===$?e.map(([e])=>e===X?.medianBar?_r(.6):Xr(k,.5)):Xr(k,.05),o=z?Kr(a,k,1):"bar"===$?e.map(([e])=>e===X?.medianBar?_r(1):Xr(k,1)):Xr(k,1);return{label:`${n?v("charts:subtitle.custom"):dt(i)} - ${t} (${v("charts:subtitle.trialCount",{count:r.results.length})})`,data:e.map(([e,t])=>({x:e,y:t})),backgroundColor:s,borderColor:o,borderWidth:"bar"===$?1:2,fill:"line"===$,tension:"line"===$?.3:void 0,pointBackgroundColor:"line"===$&&!z&&X?e.map(([e])=>e===X.medianBar?_r(1):Xr(k,1)):void 0,pointBorderColor:"line"===$&&!z&&X?e.map(([e])=>e===X.medianBar?_r(1):Xr(k,1)):void 0,pointRadius:"line"===$?3:0}});if(!z&&H&&!H.hasMultipleDiceConfigs){const t=H.resultsConfig||H.diceConfig,a="+"===t.modifierSign?t.modifierValue:"-"===t.modifierSign?-t.modifierValue:0,r=t.diceCount*t.diceFaces>5e4,i=r?[]:lr(t.diceCount,t.diceFaces,a),n=H.results.length,s=i.map(([e,t])=>[e,t*n]);let o;if(M&&Y[0]){o=or(s,Y[0].binWidth,Y[0].isBinned?R:"equal-width").data}else o=s;const l=r?null:{label:v("charts:legend.theoretical"),data:o.map(([e,t])=>({x:e,y:t})),backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:k?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:"bar"===$?1:2,borderDash:[5,5],fill:!1,tension:"line"===$?.3:void 0,pointRadius:"line"===$?2:0,pointBackgroundColor:void 0,pointBorderColor:void 0};l&&e.push(l)}return e},[Y,k,$,X,z,H,M,R,v])},K=r.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:y,position:"top",labels:{color:k?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:_.split("\n"),font:{size:16},color:k?"#D1D5DB":"#374151"},decimation:{enabled:!0,algorithm:"lttb"},annotation:!z&&X?{annotations:{median:{type:"line",xMin:X.medianBar,xMax:X.medianBar,borderColor:"rgba(234, 88, 12, 0.8)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${v("charts:stats.median")}: ${X.median.toFixed(2)}`,position:"start",backgroundColor:"rgba(234, 88, 12, 0.8)",color:"white",font:{size:11},padding:4}},mean:{type:"line",xMin:X.mean,xMax:X.mean,borderColor:"rgba(16, 185, 129, 0.8)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${v("charts:stats.mean")}: ${X.mean.toFixed(2)}`,position:"end",backgroundColor:"rgba(16, 185, 129, 0.8)",color:"white",font:{size:11},padding:4}},stdDevPlus:{type:"line",xMin:X.mean+X.stdDev,xMax:X.mean+X.stdDev,borderColor:"rgba(139, 92, 246, 0.6)",borderWidth:1.5,borderDash:[3,3],label:{display:!0,content:"+1σ",position:"start",backgroundColor:"rgba(139, 92, 246, 0.6)",color:"white",font:{size:10},padding:3}},stdDevMinus:{type:"line",xMin:X.mean-X.stdDev,xMax:X.mean-X.stdDev,borderColor:"rgba(139, 92, 246, 0.6)",borderWidth:1.5,borderDash:[3,3],label:{display:!0,content:"-1σ",position:"start",backgroundColor:"rgba(139, 92, 246, 0.6)",color:"white",font:{size:10},padding:3}},expectedValue:{type:"line",xMin:X.expectedValue,xMax:X.expectedValue,borderColor:"rgb(241, 13, 120)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${v("charts:stats.expectedValue")}: ${X.expectedValue.toFixed(2)}`,position:"center",backgroundColor:"rgb(241, 13, 120)",color:"white",font:{size:11},padding:4}}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:v("charts:axis.frequency"),color:k?"#D1D5DB":"#374151"},ticks:{precision:0,color:k?"#9CA3AF":"#6B7280"},grid:{color:k?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===V.mode?V.min:"semi-auto"===V.mode&&void 0!==V.initialMin?V.initialMin:void 0,max:"manual"===V.mode?V.max:"semi-auto"===V.mode&&void 0!==V.initialMax?V.initialMax:void 0},x:{type:"linear",title:{display:!0,text:v("charts:axis.total"),color:k?"#D1D5DB":"#374151"},ticks:{color:k?"#9CA3AF":"#6B7280"},grid:{color:k?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===F.mode?F.min:"semi-auto"===F.mode&&void 0!==F.initialMin?F.initialMin:void 0,max:"manual"===F.mode?F.max:"semi-auto"===F.mode&&void 0!==F.initialMax?F.initialMax:void 0}}}),[_,k,z,y,X,v,F,V]),Q=()=>{hr(w,"total",C,k)},G=Or({showChartTypeToggle:!0,chartType:$,onChartTypeChange:U,showBinningSettings:!0,useBinning:M,binningAlgorithm:R,binWidthMultiple:I,onBinningChange:e=>{L(e.useBinning),E(e.binningAlgorithm),O(e.binWidthMultiple),t?.(e)},currentDataPoints:Y[0]?.chartData.length||0,isBinned:Y[0]?.isBinned||!1,binCount:Y[0]?.binCount||0,binWidth:Y[0]?.binWidth||1,showXAxisScaleSettings:!0,xAxisScale:F,onXAxisScaleChange:e=>{W(e),"semi-auto"!==e.mode&&(N.current=null),i?.(e)},showYAxisScaleSettings:!0,yAxisScale:V,onYAxisScaleChange:e=>{B(e),"semi-auto"!==e.mode&&(A.current=null),n?.(e)},showWidgetTypeSelector:!!h&&!!m,widgetType:h,onWidgetTypeChange:m,onOpenFullscreen:f,onDownloadImage:Q});return H&&0!==H.results.length?s.jsxs("div",{className:"relative",style:y?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(y?"justify-end":"justify-between"),children:[!y&&s.jsx(qr,{items:D,isDarkMode:k,onLegendClick:()=>{j(e=>e+1)}}),s.jsx($r,{chartType:$,onChartTypeChange:U,onDownloadImage:Q,menuManager:G.manager})]}),s.jsx("div",{className:"relative",style:{height:y?"calc(100% - 24px)":"400px"},children:"bar"===$?s.jsx(o,{ref:w,data:J,options:K},`bar-${g}`):s.jsx(l,{ref:w,data:J,options:K},`line-${g}`)}),!y&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("p",{children:v("charts:description.totalDistribution")}),!z&&s.jsx("p",{className:"mt-1",children:v("charts:description.theoreticalDistributionComparison")})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:v("charts:noData")})}),ri=e=>{const{t:t,...a}=Fe(e);return{t:(e,a)=>(e=>{if("string"!=typeof e)return e;const t=e.split("\n");return 1===t.length?e:t.map((e,a)=>s.jsxs("span",{children:[e,a<t.length-1&&s.jsx("br",{})]},a))})(t(e,a)),tRaw:t,...a}},ii=n.memo(({diceSets:e,onAggregationSettingsChange:t,onChartTypeChange:a,onXAxisScaleChange:i,onYAxisScaleChange:c,chartSettings:d,currentChartSettingsId:g,isNarrowLayout:u=!1,chartRef:h,widgetType:m,onWidgetTypeChange:p,widget:x,onUpdateHiddenLegends:f,onOpenFullscreen:y,isFullscreen:b=!1,chartTitleProp:v})=>{const{t:S,tRaw:w}=ri(["charts","common"]),k=r.useRef(null),C=h||k,j=br(),D=jr(),[,N]=r.useState(0),A=Dr("individual",C,x,f);r.useEffect(()=>{if(!C.current||!x?.hiddenLegends)return;const e=setTimeout(()=>{if(C.current){const e=C.current,t=x.hiddenLegends||[];e.data.datasets?.forEach((a,r)=>{const i=a.label||"";e.getDatasetMeta(r).hidden=t.includes(i)}),e.update()}},150);return()=>clearTimeout(e)},[C,x?.hiddenLegends,e]);const T=r.useRef(null),M=r.useRef(null),L=d?.find(e=>e.id===g),{useAggregation:R,setUseAggregation:E,aggregationInterval:I,setAggregationInterval:O}=Sr(L,"individualDiceChart"),{chartType:$,setChartType:P}=wr(L,"individualDiceChartType"),{xAxisScale:F,setXAxisScale:W}=kr(L,"individualDiceChartXScale"),{yAxisScale:V,setYAxisScale:B}=Cr(L,"individualDiceChartYScale"),U=e[0],H=e.length>1;n.useEffect(()=>{const e=setTimeout(()=>{C.current&&ti(C.current,u)},100);return()=>{clearTimeout(e),ei()}},[e,j,R,I,u,C]);const z=r.useMemo(()=>e.map((e,t)=>{const a=new Map;return e.results.forEach(e=>{e.diceValues.forEach(e=>{const t=a.get(e)||0;a.set(e,t+1)})}),{diceSet:e,frequencyMap:a,diceSetName:pt(e),diceCode:e.hasMultipleDiceConfigs?w("charts:subtitle.custom"):dt(e.resultsConfig||e.diceConfig),index:t}}),[e,w]),q=r.useMemo(()=>{const e=z.map(({frequencyMap:e,diceSetName:t,index:a,diceSet:r})=>{const i=Array.from(e.entries()).sort((e,t)=>e[0]-t[0]),{data:n}=rr(i,R?I:1),s=H?Kr(a,j,"bar"===$?.6:.05):Xr(j,"bar"===$?.5:.05),o=H?Kr(a,j,1):Xr(j,1);return{label:`${r.hasMultipleDiceConfigs?w("charts:subtitle.custom"):dt(r.resultsConfig||r.diceConfig)} - ${t} (${w("charts:subtitle.trialCount",{count:r.results.length})})`,data:n.map(([e,t])=>({x:e,y:t})),backgroundColor:s,borderColor:o,borderWidth:"bar"===$?1:2,fill:"line"===$,tension:"line"===$?.3:void 0,pointRadius:"line"===$?4:void 0,pointHoverRadius:"line"===$?6:void 0}});if(!H&&!U.hasMultipleDiceConfigs){const t=U.resultsConfig||U.diceConfig,a=U.results.length*t.diceCount,r=function(e,t){const a=t/e;return Array.from({length:e},(e,t)=>[t+1,a])}(t.diceFaces,a),{data:i}=rr(r,R?I:1),n={label:w("charts:legend.theoretical"),data:i.map(([e,t])=>({x:e,y:t})),backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:j?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:"bar"===$?1:2,borderDash:[5,5],fill:!1,tension:"line"===$?.3:void 0,pointRadius:"line"===$?3:void 0,pointHoverRadius:"line"===$?5:void 0};e.push(n)}const t=Array.from(z[0].frequencyMap.entries()).sort((e,t)=>e[0]-t[0]),{isAggregated:a}=rr(t,R?I:1);return{labels:[],datasets:e,isAggregated:a}},[z,j,$,R,I,H,U,w]),Y=r.useMemo(()=>{if(H)return null;const e=z[0].frequencyMap,t=Array.from(e.entries()).reduce((e,[,t])=>e+t,0),a=function(e){const t=Array.from(e.entries());if(0===t.length)return 0;const a=t.reduce((e,[,t])=>e+t,0);return 0===a?0:t.reduce((e,[t,a])=>e+t*a,0)/a}(e),r=function(e){const t=Array.from(e.entries());if(0===t.length)return[];const a=Math.max(...t.map(([,e])=>e));return t.filter(([,e])=>e===a).map(([e])=>e)}(e);return{mean:a,modes:r,totalCount:t}},[z,H]),X=e=>{P(e),a?.(e)},_=e=>{W(e),"semi-auto"!==e.mode&&(T.current=null),i?.(e)},J=e=>{B(e),"semi-auto"!==e.mode&&(M.current=null),c?.(e)},K=U?.resultsConfig||U?.diceConfig,Q=U?.hasMultipleDiceConfigs||!1?w("common:custom"):K?dt(K):"",G=H?`${w("charts:title.individualDice")}\n（${w("charts:title.comparison",{count:e.length})}${q.isAggregated?` / ${w("charts:subtitle.aggregation",{interval:I})}`:""}）`:`${w("charts:title.individualDice")}\n（${Q} / ${w("charts:subtitle.trialCount",{count:U?.results.length||0})}${q.isAggregated?` / ${w("charts:subtitle.aggregation",{interval:I})}`:""})`;r.useEffect(()=>{b&&v&&v(G)},[b,G,v]);const Z=r.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:b,position:"top",labels:{color:j?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},decimation:{enabled:!0,algorithm:"lttb"},title:{display:!0,text:G.split("\n"),font:{size:16},color:j?"#D1D5DB":"#374151"},tooltip:!H&&Y?{callbacks:{afterLabel:e=>{const t=Y.totalCount||0,a=e.parsed.y??0;return`${t>0?(a/t*100).toFixed(1):"0.0"}%`}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:w("charts:axis.frequency"),color:j?"#D1D5DB":"#374151"},ticks:{precision:0,color:j?"#9CA3AF":"#6B7280"},grid:{color:j?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===V.mode?V.min:"semi-auto"===V.mode&&void 0!==V.initialMin?V.initialMin:void 0,max:"manual"===V.mode?V.max:"semi-auto"===V.mode&&void 0!==V.initialMax?V.initialMax:void 0},x:{type:"linear",title:{display:!0,text:w("charts:axis.diceValue"),color:j?"#D1D5DB":"#374151"},ticks:{color:j?"#9CA3AF":"#6B7280"},grid:{color:j?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===F.mode?F.min:"semi-auto"===F.mode&&void 0!==F.initialMin?F.initialMin:void 0,max:"manual"===F.mode?F.max:"semi-auto"===F.mode&&void 0!==F.initialMax?F.initialMax:void 0}}}),[G,j,H,b,Y,w,F,V]),ee=()=>{hr(C,"individual",D,j)},te=e=>{E(e.useAggregation),O(e.aggregationInterval),t?.(e)},ae=Or({showChartTypeToggle:!0,chartType:$,onChartTypeChange:X,showAggregationSettings:!0,useAggregation:R,aggregationInterval:I,onAggregationChange:te,currentDataPoints:z[0]?.frequencyMap.size||0,isAggregated:q.isAggregated,showXAxisScaleSettings:!0,xAxisScale:F,onXAxisScaleChange:_,showYAxisScaleSettings:!0,yAxisScale:V,onYAxisScaleChange:J,showWidgetTypeSelector:!!m&&!!p,widgetType:m,onWidgetTypeChange:p,onOpenFullscreen:y,onDownloadImage:ee});return U&&0!==U.results.length?s.jsxs("div",{className:"relative",style:b?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(b?"justify-end":"justify-between"),children:[!b&&s.jsx(qr,{items:A,isDarkMode:j,onLegendClick:()=>{N(e=>e+1)}}),s.jsx($r,{chartType:$,onChartTypeChange:X,onDownloadImage:ee,showAggregationSettings:!0,useAggregation:R,aggregationInterval:I,onAggregationChange:te,currentDataPoints:z[0]?.frequencyMap.size||0,isAggregated:q.isAggregated,showXAxisScaleSettings:!0,xAxisScale:F,onXAxisScaleChange:_,showYAxisScaleSettings:!0,yAxisScale:V,onYAxisScaleChange:J,showWidgetTypeSelector:!!m&&!!p,widgetType:m,onWidgetTypeChange:p,menuManager:ae.manager})]}),s.jsx("div",{className:"relative",style:{height:b?"calc(100% - 24px)":"400px"},children:"bar"===$?s.jsx(o,{ref:C,data:q,options:Z},`bar-${u}`):s.jsx(l,{ref:C,data:q,options:Z},`line-${u}`)}),!b&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("p",{children:S("charts:description.individualDiceDescription")}),!H&&Y&&s.jsxs("p",{className:"mt-2 text-xs opacity-75",children:[S("charts:stats.mean"),": ",Ra(Y.mean)," /",S("charts:stats.mode"),": ",Y.modes.join(", ")," /",S("charts:stats.totalCount"),": ",La(Y.totalCount),S("common:unit.piece")]})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:S("charts:noData")})}),ni=n.memo(({diceSets:e,onChartTypeChange:t,chartSettings:a,currentChartSettingsId:i,onCumulativeSettingsChange:o,onYAxisScaleChange:l,isNarrowLayout:d=!1,chartRef:g,widgetType:u,onWidgetTypeChange:h,widget:m,onUpdateHiddenLegends:p,onOpenFullscreen:x,isFullscreen:f=!1,chartTitleProp:y})=>{const{t:b}=Fe(["charts","diceSets","common"]),v=r.useRef(null),S=g||v,w=br(),k=jr(),[,C]=r.useState(0),j=Dr("cumulative",S,m,p),D=a?.find(e=>e.id===i),N=r.useRef(null),[A,T]=n.useState(void 0!==D?.cumulativeQuantileCount?D.cumulativeQuantileCount:50),[M,L]=n.useState(D?.cumulativeDistributionType||"total"),[R,E]=n.useState(void 0===D?.cumulativeShowOnlyActualData||D.cumulativeShowOnlyActualData);n.useEffect(()=>{D&&(void 0!==D.cumulativeQuantileCount&&T(D.cumulativeQuantileCount),D.cumulativeDistributionType&&L(D.cumulativeDistributionType),void 0!==D.cumulativeShowOnlyActualData&&E(D.cumulativeShowOnlyActualData))},[D,i]);const{chartType:I,setChartType:O}=wr(D,"cumulativeChartType"),{yAxisScale:$,setYAxisScale:P}=Cr(D,"cumulativeChartYScale"),F=e=>{O(e),t?.(e)};n.useEffect(()=>{if("semi-auto"!==$.mode)return void(N.current&&(N.current=null));if(void 0!==$.initialMin&&void 0!==$.initialMax)return void(N.current||(N.current={min:$.initialMin,max:$.initialMax}));const e=setTimeout(()=>{if(S.current&&S.current.scales&&S.current.scales.y){const e=S.current.scales.y.min,t=S.current.scales.y.max;void 0!==e&&void 0!==t&&(N.current={min:e,max:t},P({...$,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[$.mode]),r.useEffect(()=>{if(!S.current||!m?.hiddenLegends)return;const e=setTimeout(()=>{if(S.current){const e=S.current,t=m.hiddenLegends||[];e.data.datasets?.forEach((a,r)=>{const i=a.label||"";e.getDatasetMeta(r).hidden=t.includes(i)}),e.update()}},150);return()=>clearTimeout(e)},[S,m?.hiddenLegends,e]);const W=e.length>1,V=r.useMemo(()=>{if(0===e.length||!e[0]||0===e[0].results.length)return[];let t;return t="total"===M?e.map((e,t)=>{const a=e.resultsConfig||e.diceConfig,r=(e=>"+"===e.modifierSign?e.modifierValue:"-"===e.modifierSign?-e.modifierValue:0)(a);let i=[],n=a.diceCount+r,s=a.diceCount*a.diceFaces+r;const o=a.diceCount*a.diceFaces>5e4;if(!e.hasMultipleDiceConfigs&&!o){const e=lr(a.diceCount,a.diceFaces,r);if(i=function(e){if(0===e.length)return[];const t=[...e].sort((e,t)=>e[0]-t[0]),a=t.reduce((e,[,t])=>e+t,0),r=[];let i=0;for(const[n,s]of t){const e=a-i;r.push([n,e]),i+=s}return r}(e),e.length>0){const t=e[0][0],a=e[e.length-1][0];t<=n&&a>=s&&(n=t,s=a)}}const l=e.results.map(e=>e.total),c=[...l].sort((e,t)=>e-t),d=l.length;let g;if(R){if(g=[...new Set(l)].sort((e,t)=>e-t),g.length>1e3){const e=Math.ceil(g.length/1e3);g=g.filter((t,a)=>a%e===0)}}else{const e=s-n+1;if(e>1e4){const t=Math.ceil(e/1e3);g=Array.from({length:Math.ceil(e/t)},(e,a)=>n+a*t)}else g=Array.from({length:e},(e,t)=>n+t)}const u=[];for(const h of g){let e=0,t=c.length;for(;e<t;){const a=Math.floor((e+t)/2);c[a]<h?e=a+1:t=a}const a=(c.length-e)/d;u.push([h,a])}return{diceSet:e,actualCDF:u,theoreticalCDF:i,diceSetName:pt(e),diceCode:e.hasMultipleDiceConfigs?b("charts:subtitle.custom"):dt(a),index:t}}):e.map((e,t)=>{const a=e.resultsConfig||e.diceConfig,r=function(e,t){if(0===e.length)return[];const a=[];if(e.forEach(e=>{e.forEach(e=>{void 0!==e&&a.push(e)})}),0===a.length)return[];const r=[...a].sort((e,t)=>e-t),i=r.length,n=[];for(let s=1;s<=t;s++){let e=0,t=r.length;for(;e<t;){const a=Math.floor((e+t)/2);r[a]<s?e=a+1:t=a}const a=(r.length-e)/i;n.push([s,a])}return n}(e.results.map(e=>e.diceValues),a.diceFaces);let i=[];return e.hasMultipleDiceConfigs||(i=function(e){const t=[];for(let a=1;a<=e;a++){const r=(e-a+1)/e;t.push([a,r])}return t}(a.diceFaces)),{diceSet:e,actualCDF:r,theoreticalCDF:i,diceSetName:pt(e),diceCode:e.hasMultipleDiceConfigs?b("charts:subtitle.custom"):dt(a),index:t}}),t},[e,M,R,b]),B=r.useMemo(()=>{const e=new Set;V.forEach(({actualCDF:t})=>{t.forEach(([t])=>e.add(t))});let t=Array.from(e).sort((e,t)=>e-t);if(A&&A>0&&t.length>A){const e=[];for(let a=0;a<A;a++){const r=a/(A-1)*(t.length-1),i=Math.round(r);e.push(t[i])}t=[...new Set(e)].sort((e,t)=>e-t)}const a=V.flatMap(({actualCDF:e,theoreticalCDF:a,diceSetName:r,diceSet:i,index:n})=>{const s=new Map(e),o=t.map(e=>{const t=s.get(e);return void 0!==t?100*t:null}),l=W?Kr(n,w,.8):Xr(w,.8),c=W?Kr(n,w,1):Xr(w,1),d={label:W?`${i.hasMultipleDiceConfigs?b("charts:subtitle.custom"):dt(i.resultsConfig||i.diceConfig)} - ${r} (${b("charts:subtitle.trialCount",{count:i.results.length})})`:`${i.hasMultipleDiceConfigs?b("charts:subtitle.custom"):dt(i.resultsConfig||i.diceConfig)} - ${b("charts:cumulative.actual")}`,data:o,backgroundColor:l,borderColor:c,borderWidth:"bar"===I?1:2,fill:!1,tension:"line"===I?.3:void 0,pointRadius:"line"===I?3:void 0,pointHoverRadius:"line"===I?5:void 0,spanGaps:!0,type:I};if(!W&&a.length>0){const e=new Map(a),r=a.map(([e])=>e).sort((e,t)=>e-t),i=[],n=10;if(r.length<=n)i.push(...r);else for(let t=0;t<n;t++){const e=t/(n-1)*(r.length-1),a=Math.round(e);i.push(r[a])}const s=t.map(t=>{let a=r[0],i=e.get(a)||0,n=r[r.length-1],s=e.get(n)||0;if(t<=a)return 100*i;if(t>=n)return 100*s;let o=0,l=r.length-1;for(;o<l;){const e=Math.floor((o+l+1)/2);r[e]<=t?o=e:l=e-1}if(a=r[o],i=e.get(a)||0,o+1<r.length){n=r[o+1],s=e.get(n)||0;return 100*(i+(t-a)/(n-a)*(s-i))}return 100*i});return[d,{label:b("charts:legend.theoreticalCumulative"),data:s,backgroundColor:"transparent",borderColor:w?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:2,borderDash:[5,5],fill:!1,tension:.3,pointRadius:2,pointHoverRadius:4,spanGaps:!0,type:"line"}]}return[d]});return{labels:t,datasets:a}},[V,w,W,A,I,b]),U=e[0],H=U?.resultsConfig||U?.diceConfig,z=U?.hasMultipleDiceConfigs||!1,q=z?b("charts:subtitle.custom"):H?dt(H):"",Y=A?` / ${b("charts:subtitle.quantilePoints",{count:A})}`:"",X=W?"individual"===M?`${b("charts:title.cumulativeIndividualBase")}\n（${b("charts:title.comparison",{count:e.length})}${Y}）`:`${b("charts:title.cumulativeTotalBase")}\n（${b("charts:title.comparison",{count:e.length})}${Y}）`:"individual"===M?`${b("charts:title.cumulativeIndividualBase")}\n（${q} / ${b("charts:subtitle.trialCount",{count:U?.results.length||0})}${Y})`:`${b("charts:title.cumulativeTotalBase")}\n（${q} / ${b("charts:subtitle.trialCount",{count:U?.results.length||0})}${Y})`,_=b("total"===M?"charts:axis.total":"charts:axis.diceValue");r.useEffect(()=>{f&&y&&y(X)},[f,X,y]);const J=r.useCallback(()=>{if(S.current){gr(S.current.canvas,`cumulative-distribution_${Date.now()}.png`,k,w)}},[S,k,w]),K=r.useCallback(e=>{L(e),o?.({distributionType:e,showOnlyActualData:R,quantileCount:A})},[R,A,o]),Q=r.useCallback(e=>{E(e),o?.({distributionType:M,showOnlyActualData:e,quantileCount:A})},[M,A,o]),G=r.useCallback(e=>{T(e),o?.({distributionType:M,showOnlyActualData:R,quantileCount:e})},[M,R,o]),Z=r.useCallback(e=>{P(e),"semi-auto"!==e.mode&&(N.current=null),l?.(e)},[P,l]),ee=Or({showChartTypeToggle:!0,chartType:I,onChartTypeChange:F,showYAxisScaleSettings:!0,yAxisScale:$,onYAxisScaleChange:Z,showWidgetTypeSelector:!!u&&!!h,widgetType:u,onWidgetTypeChange:h,onOpenFullscreen:x,onDownloadImage:J});r.useEffect(()=>(ee.addCustomItem({id:"cumulative-distribution-type",priority:450,render:()=>s.jsx(za,{id:"cumulative-distribution-type",title:b("charts:options.cumulative.distributionType"),children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("button",{onClick:()=>K("total"),className:"px-3 py-2 text-left text-sm rounded transition-colors "+("total"===M?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:b("charts:options.cumulative.total")}),s.jsx("button",{onClick:()=>K("individual"),className:"px-3 py-2 text-left text-sm rounded transition-colors "+("individual"===M?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:b("charts:options.cumulative.individual")})]})},"cumulative-distribution-type")}),ee.addCustomItem({id:"cumulative-data-range",priority:550,render:()=>s.jsx(za,{id:"cumulative-data-range",title:b("charts:options.cumulative.dataRange"),children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("button",{onClick:()=>Q(!1),className:"px-3 py-2 text-left text-sm rounded transition-colors "+(R?"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600":"bg-accent-light-500 dark:bg-accent-dark-500 text-white"),children:b("charts:options.cumulative.fullRange")}),s.jsx("button",{onClick:()=>Q(!0),className:"px-3 py-2 text-left text-sm rounded transition-colors "+(R?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:b("charts:options.cumulative.actualOnly")})]})},"cumulative-data-range")}),ee.addCustomItem({id:"cumulative-quantile-aggregation",priority:650,render:()=>s.jsx(za,{id:"cumulative-quantile-aggregation",title:b("charts:options.cumulative.quantileAggregation"),children:s.jsxs("select",{value:null===A?"none":A,onChange:e=>{const t="none"===e.target.value?null:Number(e.target.value);G(t)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[s.jsx("option",{value:"none",children:b("common:none")}),s.jsx("option",{value:"10",children:b("charts:options.cumulative.points",{count:10})}),s.jsx("option",{value:"20",children:b("charts:options.cumulative.points",{count:20})}),s.jsx("option",{value:"50",children:b("charts:options.cumulative.points",{count:50})}),s.jsx("option",{value:"100",children:b("charts:options.cumulative.points",{count:100})})]})},"cumulative-quantile-aggregation")}),()=>{ee.removeItem("cumulative-distribution-type"),ee.removeItem("cumulative-data-range"),ee.removeItem("cumulative-quantile-aggregation")}),[ee.addCustomItem,ee.removeItem,b,M,R,A,K,Q,G]);const te={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},plugins:{legend:{display:f,position:"top",labels:{color:w?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:X.split("\n"),color:w?"#D1D5DB":"#374151",font:{size:16}},decimation:{enabled:!0,algorithm:"lttb"},tooltip:{callbacks:{label:e=>{const t=e.dataset.label||"",a=e.parsed.y??0,r=e.parsed.x??0;return`${t}: ${a.toFixed(2)}% (${B.labels[r]}以上)`}}}},scales:{x:{title:{display:!0,text:_,color:w?"#D1D5DB":"#374151"},ticks:{color:w?"#9CA3AF":"#6B7280"},grid:{color:w?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}},y:{title:{display:!0,text:b("charts:axis.cumulativeProbability"),color:w?"#D1D5DB":"#374151"},ticks:{color:w?"#9CA3AF":"#6B7280",callback:e=>`${e}%`},grid:{color:w?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===$.mode?$.min:"semi-auto"===$.mode&&void 0!==$.initialMin?$.initialMin:void 0,max:"manual"===$.mode?$.max:"semi-auto"===$.mode&&void 0!==$.initialMax?$.initialMax:void 0}}};return U&&0!==U.results.length?s.jsxs("div",{className:"relative",style:f?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(f?"justify-end":"justify-between"),children:[!f&&s.jsx(qr,{items:j,isDarkMode:w,onLegendClick:()=>{C(e=>e+1)}}),s.jsx($r,{chartType:I,onChartTypeChange:F,onDownloadImage:J,showYAxisScaleSettings:!0,yAxisScale:$,onYAxisScaleChange:Z,showWidgetTypeSelector:!!u&&!!h,widgetType:u,onWidgetTypeChange:h,menuManager:ee.manager})]}),s.jsx("div",{className:"relative z-5",style:{height:f?"calc(100% - 24px)":"400px"},children:s.jsx(c,{ref:S,type:I,data:B,options:te},`chart-${e[0]?.id}-${M}-${A}`)}),!f&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:["total"===M?s.jsxs(s.Fragment,{children:[s.jsx("p",{children:b("charts:description.cumulativeTotal")}),!z&&s.jsx("p",{className:"mt-1",children:b("charts:description.theoreticalComparison")})]}):s.jsxs(s.Fragment,{children:[s.jsx("p",{children:b("charts:description.cumulativeIndividual")}),!z&&s.jsx("p",{className:"mt-1",children:b("charts:description.theoreticalComparison")})]}),!W&&s.jsxs("p",{className:"mt-2 text-xs opacity-75",children:[b("charts:stats.dataPoints",{count:B.labels.length}),R&&` (${b("charts:options.cumulative.actualOnly")})`,A&&` / ${b("charts:options.cumulative.aggregationLabel",{count:A})}`]})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:b("charts:noData")})}),si=n.memo(({diceSets:e,onChartTypeChange:t,onAggregationChange:a,onMovingAverageWindowChange:i,onXAxisScaleChange:n,onYAxisScaleChange:o,chartSettings:c,currentChartSettingsId:d,isNarrowLayout:g=!1,chartRef:u,widgetType:h,onWidgetTypeChange:m,widget:p,onUpdateHiddenLegends:x,onOpenFullscreen:f,isFullscreen:y=!1,chartTitleProp:b})=>{const{t:v}=Fe(["charts","common"]),S=r.useRef(null),w=u||S,k=br(),C=jr(),[,j]=r.useState(0),D=Dr("rollProgress",w,p,x),N=r.useRef(null),A=r.useRef(null),T=c?.find(e=>e.id===d),{chartType:M,setChartType:L}=wr(T,"rollProgressChartType"),R="bar"===M?"line":M,{aggregationInterval:E,useAggregation:I,setAggregationInterval:O,setUseAggregation:$}=Sr(T,"rollProgressChart"),{movingAverageWindow:P,setMovingAverageWindow:F}=function(e){const t=e?.rollProgressMovingAverageWindow,a=e?.id,[i,n]=r.useState(t??20);return r.useEffect(()=>{n(t??20)},[a,t]),{movingAverageWindow:i,setMovingAverageWindow:n}}(T),{xAxisScale:W,setXAxisScale:V}=kr(T,"rollProgressChartXScale"),{yAxisScale:B,setYAxisScale:U}=Cr(T,"rollProgressChartYScale"),H=e=>{L(e),t?.(e)},z=e[0],q=e.length>1;r.useEffect(()=>{const e=setTimeout(()=>{w.current&&ti(w.current,g)},100);return()=>{clearTimeout(e),ei()}},[e,k,E,P,g,w]),r.useEffect(()=>{if(!w.current||!p?.hiddenLegends)return;const e=setTimeout(()=>{if(w.current){const e=w.current,t=p.hiddenLegends||[];e.data.datasets?.forEach((a,r)=>{const i=a.label||"";e.getDatasetMeta(r).hidden=t.includes(i)}),e.update()}},150);return()=>clearTimeout(e)},[w,p?.hiddenLegends,e]),r.useEffect(()=>{if("semi-auto"!==W.mode)return void(N.current&&(N.current=null));if(void 0!==W.initialMin&&void 0!==W.initialMax)return void(N.current||(N.current={min:W.initialMin,max:W.initialMax}));const e=setTimeout(()=>{if(w.current&&w.current.scales&&w.current.scales.x){const e=w.current.scales.x.min,t=w.current.scales.x.max;void 0!==e&&void 0!==t&&(N.current={min:e,max:t},V({...W,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[W.mode]),r.useEffect(()=>{if("semi-auto"!==B.mode)return void(A.current&&(A.current=null));if(void 0!==B.initialMin&&void 0!==B.initialMax)return void(A.current||(A.current={min:B.initialMin,max:B.initialMax}));const e=setTimeout(()=>{if(w.current&&w.current.scales&&w.current.scales.y){const e=w.current.scales.y.min,t=w.current.scales.y.max;void 0!==e&&void 0!==t&&(A.current={min:e,max:t},U({...B,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[B.mode]);const Y=r.useMemo(()=>e.map((e,t)=>{const a=e.results.map(e=>e.total),r=e.results.map(e=>e.trialNumber);let i=r,n=a;if(I&&E>1){const e=[],t=[];for(let i=0;i<r.length;i+=E){const n=Math.min(i+E,r.length),s=r.slice(i,n),o=a.slice(i,n),l=s.reduce((e,t)=>e+t,0)/s.length,c=o.reduce((e,t)=>e+t,0)/o.length;e.push(l),t.push(c)}i=e,n=t}const s=((e,t)=>{const a=[];for(let r=0;r<e.length;r++)if(r<t-1)a.push(null);else{const i=e.slice(r-t+1,r+1).reduce((e,t)=>e+t,0);a.push(i/t)}return a})(n,P);let o=null;if(!e.hasMultipleDiceConfigs){const t=e.resultsConfig||e.diceConfig;o=t.diceCount*((t.diceFaces+1)/2)+("+"===t.modifierSign?t.modifierValue:"-"===t.modifierSign?-t.modifierValue:0)}const l=Math.min(...i),c=Math.max(...i),d="manual"===W.mode&&null!==W.min&&void 0!==W.min?W.min:l,g=("manual"===W.mode&&null!==W.max&&void 0!==W.max?W.max:c)-d<3e3,u=i.map((e,t)=>({x:e,y:n[t]})),{data:h,wasDownsampled:m}=g?{data:u,wasDownsampled:!1}:nr(u);let p=[];if(s.length>0){const e=i.map((e,t)=>({x:e,y:null!==s[t]?s[t]:NaN})).filter(e=>!isNaN(e.y));p=(g?e:nr(e).data).map(e=>({x:e.x,y:e.y}))}return{diceSet:e,actualData:h,movingAvgData:p,wasDownsampled:m,expectedValue:o,diceSetName:pt(e),diceCode:e.hasMultipleDiceConfigs?v("charts:subtitle.custom"):dt(e.resultsConfig||e.diceConfig),index:t}}),[e,P,I,E,W.mode,W.min,W.max,v]),X=r.useMemo(()=>{const e=Math.max(...Y.map(e=>e.diceSet.results.length));return{datasets:Y.flatMap(({actualData:t,movingAvgData:a,expectedValue:r,diceSetName:i,diceSet:n,index:s})=>{const o=[],l=q?Kr(s,k,.2):Xr(k,.2),c=q?Kr(s,k,.5):Xr(k,.5);if(o.push({label:q?`${n.hasMultipleDiceConfigs?v("charts:subtitle.custom"):dt(n.resultsConfig||n.diceConfig)} - ${i} (${v("charts:subtitle.trialCount",{count:n.results.length})})`:`${n.hasMultipleDiceConfigs?v("charts:subtitle.custom"):dt(n.resultsConfig||n.diceConfig)} - ${v("charts:rollProgress.actual")}`,data:t,backgroundColor:l,borderColor:c,borderWidth:1,fill:!1,tension:0,pointRadius:0,pointHoverRadius:3,parsing:!1}),a.length>0){const e=q?Kr(s,k,1):Xr(k,1);o.push({label:q?`${n.hasMultipleDiceConfigs?v("charts:subtitle.custom"):dt(n.resultsConfig||n.diceConfig)} - ${i} (${v("charts:legend.movingAverage")})`:`${n.hasMultipleDiceConfigs?v("charts:subtitle.custom"):dt(n.resultsConfig||n.diceConfig)} - ${v("charts:legend.movingAverageWindow",{window:P})}`,data:a,backgroundColor:e,borderColor:e,borderWidth:2,fill:!1,tension:.3,pointRadius:0,pointHoverRadius:4,parsing:!1})}if(!q&&null!==r){const a=t.length>0?t[0].x:1,i=t.length>0?t[t.length-1].x:e;o.push({type:"line",label:v("charts:legend.expectedValue",{value:r.toFixed(2)}),data:[{x:a,y:r},{x:i,y:r}],backgroundColor:"rgba(241, 13, 120, 0.2)",borderColor:k?"rgba(241, 13, 120, 0.8)":"rgb(241, 13, 120)",borderWidth:2,borderDash:[5,5],fill:!1,tension:0,pointRadius:0,parsing:!1})}return o})}},[Y,k,q,P,R,v]),_=z?.resultsConfig||z?.diceConfig,J=z?.hasMultipleDiceConfigs||!1,K=J?v("charts:subtitle.custom"):_?dt(_):"",Q=I&&E>1?` / ${v("charts:subtitle.aggregation",{interval:La(E)})}`:"",G=q?`${v("charts:title.rollProgressBase")}\n（${v("charts:title.comparison",{count:e.length})}${Q}）`:`${v("charts:title.rollProgressBase")}\n（${K} / ${v("charts:subtitle.trialCount",{count:z?.results.length||0})}${Q}）`;r.useEffect(()=>{y&&b&&b(G)},[y,G,b]);const Z=r.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:y,position:"top",labels:{color:k?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:G.split("\n"),color:k?"#D1D5DB":"#374151",font:{size:16}},tooltip:{mode:"index",intersect:!1}},scales:{x:{type:"linear",title:{display:!0,text:v("charts:axis.trialNumber"),color:k?"#D1D5DB":"#374151"},ticks:{color:k?"#9CA3AF":"#6B7280"},grid:{color:k?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===W.mode?W.min:"semi-auto"===W.mode&&void 0!==W.initialMin?W.initialMin:void 0,max:"manual"===W.mode?W.max:"semi-auto"===W.mode&&void 0!==W.initialMax?W.initialMax:void 0},y:{title:{display:!0,text:v("charts:axis.total"),color:k?"#D1D5DB":"#374151"},ticks:{color:k?"#9CA3AF":"#6B7280"},grid:{color:k?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:"manual"===B.mode?B.min:"semi-auto"===B.mode&&void 0!==B.initialMin?B.initialMin:void 0,max:"manual"===B.mode?B.max:"semi-auto"===B.mode&&void 0!==B.initialMax?B.initialMax:void 0}}}),[G,k,v,W,B,y]),ee=()=>{if(w.current){gr(w.current.canvas,`trial-progress_${Date.now()}.png`,C,k)}},te=e=>{V(e),"semi-auto"!==e.mode&&(N.current=null),n?.(e)},ae=e=>{U(e),"semi-auto"!==e.mode&&(A.current=null),o?.(e)},re=Or({chartType:R,onChartTypeChange:H,showChartTypeToggle:!1,showAggregationSettings:!0,useAggregation:I,aggregationInterval:E,onAggregationChange:e=>{$(e.useAggregation),O(e.aggregationInterval),a?.(e.useAggregation&&e.aggregationInterval>1?e.aggregationInterval:null)},currentDataPoints:z.results.length,isAggregated:I&&E>1,showMovingAverageSettings:!0,movingAverageWindow:P,onMovingAverageWindowChange:e=>{F(e),i?.(e)},showXAxisScaleSettings:!0,xAxisScale:W,onXAxisScaleChange:te,showYAxisScaleSettings:!0,yAxisScale:B,onYAxisScaleChange:ae,showWidgetTypeSelector:!!h&&!!m,widgetType:h,onWidgetTypeChange:m,onOpenFullscreen:f,onDownloadImage:ee});return z&&0!==z.results.length?s.jsxs("div",{className:"relative",style:y?{height:"100%"}:void 0,children:[s.jsxs("div",{className:"flex items-center mt-1 "+(y?"justify-end":"justify-between"),children:[!y&&s.jsx(qr,{items:D,isDarkMode:k,onLegendClick:()=>{j(e=>e+1)}}),s.jsx($r,{chartType:R,onChartTypeChange:H,onDownloadImage:ee,showChartTypeToggle:!1,showAggregationSettings:!0,useAggregation:I,aggregationInterval:E,onAggregationChange:e=>{$(e.useAggregation),O(e.aggregationInterval),a?.(e.useAggregation&&e.aggregationInterval>1?e.aggregationInterval:null)},currentDataPoints:z.results.length,isAggregated:I&&E>1,showMovingAverageSettings:!0,movingAverageWindow:P,onMovingAverageWindowChange:e=>{F(e),i?.(e)},showXAxisScaleSettings:!0,xAxisScale:W,onXAxisScaleChange:te,showYAxisScaleSettings:!0,yAxisScale:B,onYAxisScaleChange:ae,showWidgetTypeSelector:!!h&&!!m,widgetType:h,onWidgetTypeChange:m,menuManager:re.manager})]}),s.jsx("div",{className:"relative",style:{height:y?"calc(100% - 24px)":"400px"},children:s.jsx(l,{ref:w,data:X,options:Z},`line-${g}`)}),!y&&s.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[s.jsx("p",{children:v("charts:description.rollProgress")}),!J&&s.jsx("p",{className:"mt-1",children:v("charts:description.expectedValueComparison")})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:v("charts:noData")})});n.memo(({diceSets:e,targetValue:t,onTargetValueChange:a,onChartTypeChange:i,onYAxisScaleChange:c,chartSettings:d,currentChartSettingsId:g,isNarrowLayout:u=!1})=>{const{t:h}=Fe(["charts","common"]),m=r.useRef(null),p=br(),x=jr(),[f,y]=n.useState(t),b=r.useRef(null),v=d?.find(e=>e.id===g),{chartType:S,setChartType:w}=wr(v,"targetValueChartType"),{yAxisScale:k,setYAxisScale:C}=Cr(v,"targetValueChartYScale"),j=e=>{w(e),i?.(e)},D=e=>{C(e),"semi-auto"!==e.mode&&(b.current=null),c?.(e)},N=e[0];n.useEffect(()=>{const e=setTimeout(()=>{m.current&&ti(m.current,u)},100);return()=>{clearTimeout(e),ei()}},[e,p,f,u]),r.useEffect(()=>{if("semi-auto"!==k.mode)return void(b.current&&(b.current=null));if(void 0!==k.initialMin&&void 0!==k.initialMax)return void(b.current||(b.current={min:k.initialMin,max:k.initialMax}));const e=setTimeout(()=>{if(m.current&&m.current.scales&&m.current.scales.y){const e=m.current.scales.y.min,t=m.current.scales.y.max;void 0!==e&&void 0!==t&&(b.current={min:e,max:t},C({...k,initialMin:e,initialMax:t}))}},100);return()=>clearTimeout(e)},[k.mode]),n.useEffect(()=>{y(t)},[t]);const A=e=>{y(e),a?.(e)},T=e.length>1,M=r.useMemo(()=>e.map((e,t)=>{const a=e.results.length>0?Math.max(...e.results.map(e=>e.diceValues.length)):0,r=new Array(a).fill(0);return e.results.forEach(e=>{e.diceValues.forEach((e,t)=>{e===f&&r[t]++})}),{diceSet:e,counts:r,diceSetName:pt(e),diceCode:e.hasMultipleDiceConfigs?h("charts:subtitle.custom"):dt(e.resultsConfig||e.diceConfig),index:t}}),[e,f,h]),L=r.useMemo(()=>{const e=Math.max(...M.map(e=>e.counts.length)),t=M.map(({counts:e,diceSetName:t,index:a,diceSet:r})=>{const i=T?Kr(a,p,"bar"===S?.6:.05):Xr(p,"bar"===S?.5:.05),n=T?Kr(a,p,1):Xr(p,1);return{label:T?`${r.hasMultipleDiceConfigs?h("charts:subtitle.custom"):dt(r.resultsConfig||r.diceConfig)} - ${t} (${La(r.results.length)}${h("common:label.trial")})`:`${r.hasMultipleDiceConfigs?h("charts:subtitle.custom"):dt(r.resultsConfig||r.diceConfig)} - ${h("charts:targetStats.occurrences",{value:f})}`,data:e,backgroundColor:i,borderColor:n,borderWidth:"bar"===S?1:2,fill:"line"===S,tension:"line"===S?.3:void 0,pointRadius:"line"===S?4:void 0,pointHoverRadius:"line"===S?6:void 0}});return{labels:Array.from({length:e},(e,t)=>`${h("common:label.dice")}${t+1}`),datasets:t}},[M,p,S,f,T,h]),R=r.useMemo(()=>{if(T||!N||0===N.results.length)return null;const e=M[0].counts,t=e.reduce((e,t)=>e+t,0);return{totalCount:t,averagePerDice:t/e.length,maxCount:Math.max(...e),minCount:Math.min(...e)}},[M,T,N]),E=N?.resultsConfig||N?.diceConfig,I=N?.hasMultipleDiceConfigs||!1?h("charts:subtitle.custom"):E?dt(E):"",O=E?.diceFaces||6,$=T?`${h("charts:targetStats.title.base")}\n（${h("charts:subtitle.custom")}目: ${f} / ${h("charts:title.comparison",{count:e.length})}）`:`${h("charts:targetStats.title.base")}\n（${h("charts:subtitle.custom")}目: ${f} / ${I} / ${h("charts:subtitle.trialCount",{count:N?.results.length||0})}）`,P=r.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{position:"top",display:T,labels:T?{color:p?"#D1D5DB":"#374151",usePointStyle:!0,padding:u?15:8,generateLabels:e=>{const t=e.data;return t.datasets?t.datasets.map((t,a)=>{const r=e.getDatasetMeta(a),i=t.label||"",n=Array.isArray(t.backgroundColor)?t.backgroundColor[0]:t.backgroundColor,s=Array.isArray(t.borderColor)?t.borderColor[0]:t.borderColor;return{text:u?i:"",fillStyle:n,strokeStyle:s,lineWidth:t.borderWidth||1,hidden:!r.visible,index:a,datasetIndex:a,fontColor:p?"#D1D5DB":"#374151",_fullText:i}}):[]}}:{color:p?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},decimation:{enabled:!0,algorithm:"lttb"},title:{display:!0,text:$.split("\n"),font:{size:16}},tooltip:!T&&R?{callbacks:{afterLabel:e=>{const t=e.parsed.y;if(null===t)return"";const a=(t/N.results.length*100).toFixed(1);return h("charts:targetStats.occurrenceRate",{rate:a})}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:h("charts:targetStats.yAxis")},ticks:{precision:0},min:"manual"===k.mode?k.min:"semi-auto"===k.mode&&void 0!==k.initialMin?k.initialMin:void 0,max:"manual"===k.mode?k.max:"semi-auto"===k.mode&&void 0!==k.initialMax?k.initialMax:void 0},x:{title:{display:!0,text:h("common:label.dice")}}}}),[$,p,u,T,R,h,N,k]),F=()=>{hr(m,"target",x,p)},W=Or({chartType:S,onChartTypeChange:j,showTargetValueSettings:!0,targetValue:f,minTargetValue:1,maxTargetValue:O,onTargetValueChange:A,showYAxisScaleSettings:!0,yAxisScale:k,onYAxisScaleChange:D,onDownloadImage:F});return N&&0!==N.results.length?s.jsxs("div",{className:"relative",children:[s.jsx($r,{chartType:S,onChartTypeChange:j,onDownloadImage:F,showTargetValueSettings:!0,targetValue:f,minTargetValue:1,maxTargetValue:O,onTargetValueChange:A,showYAxisScaleSettings:!0,yAxisScale:k,onYAxisScaleChange:D,menuManager:W.manager}),s.jsx("div",{className:"pt-6",style:{height:"400px"},children:"bar"===S?s.jsx(o,{ref:m,data:L,options:P},`bar-${u}`):s.jsx(l,{ref:m,data:L,options:P},`line-${u}`)}),!T&&R&&s.jsxs("div",{className:"mt-4 border rounded-lg p-3 text-sm "+(p?"bg-accent-dark-50 dark:bg-accent-dark-900/20 border-accent-dark-200 dark:border-accent-dark-800":"bg-accent-light-50 dark:bg-accent-light-900/20 border-accent-light-200 dark:border-accent-light-800"),children:[s.jsx("div",{className:"font-semibold mb-2 "+(p?"text-accent-dark-700 dark:text-accent-dark-300":"text-accent-light-700 dark:text-accent-light-300"),children:h("charts:targetStats.summary.title",{value:f})}),s.jsxs("div",{className:"space-y-1 "+(p?"text-accent-dark-600 dark:text-accent-dark-400":"text-accent-light-600 dark:text-accent-light-400"),children:[s.jsx("div",{children:h("charts:targetStats.summary.total",{count:R.totalCount})}),s.jsx("div",{children:h("charts:targetStats.summary.average",{average:R.averagePerDice.toFixed(2)})}),s.jsx("div",{children:h("charts:targetStats.summary.rate",{rate:(R.totalCount/(N.results.length*M[0].counts.length)*100).toFixed(2)})}),s.jsx("div",{children:h("charts:targetStats.summary.range",{max:R.maxCount,min:R.minCount})})]})]})]}):s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:h("charts:noData")})});const oi=({diceSets:e,isDarkMode:t,recentRollsCount:a=1,onRecentRollsCountChange:i,widgetType:o,onWidgetTypeChange:l,highlightConditions:c=[],onHighlightConditionsChange:d,widget:g,onUpdateHiddenLegends:u})=>{const{t:h}=Fe(["charts","common"]),[,m]=r.useState(0),p=r.useMemo(()=>{const a=g?.hiddenLegends||[],r=e.length>1,i=t?"#a78bfa":"#3b82f6";return e.map(e=>{const t=r?pt(e):dt(e.diceConfig),n=a.includes(t);return{label:t,color:i,chartType:"result",hidden:n,onClick:()=>{const e=[...a],r=e.indexOf(t);n&&-1!==r?e.splice(r,1):n||-1!==r||e.push(t),u?.(e)}}})},[e,g?.hiddenLegends,t,u]),x=r.useMemo(()=>{const t=g?.hiddenLegends||[],r=e.length>1;return e.filter(e=>{const a=r?pt(e):dt(e.diceConfig);return!t.includes(a)}).map(e=>{const t=Math.min(a,e.results.length);return{diceSet:e,recentResults:[...e.results].reverse().slice(0,t)}})},[e,a,g?.hiddenLegends]);return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsx(qr,{items:p,isDarkMode:t,onLegendClick:()=>{m(e=>e+1)}}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx($r,{chartType:"bar",onChartTypeChange:()=>{},showChartTypeToggle:!1,showRecentRollsCountSettings:!0,recentRollsCount:a,onRecentRollsCountChange:i,showHighlightConditionsSettings:!0,highlightConditions:c,onHighlightConditionsChange:d,showWidgetTypeSelector:!!o&&!!l,widgetType:o,onWidgetTypeChange:l})})]}),s.jsx("div",{className:"mb-3",children:s.jsxs("div",{className:`inline-flex items-start gap-1.5 px-3 py-1.5 rounded text-sm flex-wrap ${t?"text-gray-400":"text-gray-500"} ${c.length>0?"flex-col md:flex-row":"flex-row"}`,children:[s.jsx("span",{className:"font-medium",children:h("charts:recentRolls.highlightLabel")}),c.length>0?s.jsx("span",{children:c.map((e,a)=>{let r="";if("single"===e.type)r=String(e.value);else if("range"===e.type)r=`${e.min}-${e.max}`;else{const{divisor:t,offset:a}=e;r=0===a?`${t}n`:a>0?`${t}n+${a}`:`${t}n${a}`}return s.jsxs(n.Fragment,{children:[a>0&&s.jsx("span",{className:t?"text-gray-400":"text-gray-500",children:", "}),s.jsx("span",{className:"font-mono px-1.5 py-0.5 rounded "+(t?"bg-accent-dark-500/30 text-accent-dark-300":"bg-accent-light-100 text-accent-light-700"),children:r})]},a)})}):s.jsx("span",{className:"font-bold "+(t?"text-gray-400":"text-gray-500"),children:h("common:none")})]})}),s.jsx("div",{className:"space-y-4",children:x.map(({diceSet:e,recentResults:r})=>s.jsxs("div",{className:"@container p-3 "+(t?"border-t border-gray-600":"border-t border-gray-200"),children:[s.jsxs("h3",{className:"flex gap-2 items-baseline font-medium mb-3 "+(t?"text-gray-200":"text-gray-700"),children:[s.jsx("span",{className:"text-md",children:dt(e.diceConfig)}),s.jsxs("span",{className:"font-mono text-xs "+(t?"text-gray-400":"text-gray-500"),children:["(",pt(e),")"]})]}),0===r.length?s.jsx("p",{className:"text-sm "+(t?"text-gray-400":"text-gray-500"),children:h("charts:recentRolls.noResultsYet")}):(()=>{const i=e.diceConfig.diceCount;let n="grid-cols-1";return n=1===a?"grid-cols-1":2===a?1===i?"grid-cols-2":"grid-cols-1 @sm:grid-cols-2":1===i?"grid-cols-3":2===i?"grid-cols-3 @sm:grid-cols-3":i<=4?"grid-cols-1 @sm:grid-cols-3":"grid-cols-1 @sm:grid-cols-2 @lg:grid-cols-3",s.jsx("div",{className:`grid ${n} gap-4`,children:r.map(e=>s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("span",{className:"text-sm font-bold "+(t?"text-gray-300":"text-gray-600"),children:h("charts:recentRolls.trialNumber",{number:La(e.trialNumber)})}),e.diceValues.length>1&&s.jsxs("span",{className:"text-xs font-medium "+(t?"text-gray-400":"text-gray-500"),children:["/ ",h("charts:recentRolls.total"),":"," ",La(e.total)]})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:e.diceValues.map((e,a)=>{const r=function(e,t){return!(!t||0===t.length)&&t.some(t=>"single"===t.type?e===t.value:"range"===t.type?e>=t.min&&e<=t.max:"modulo"===t.type&&e>=t.offset&&(e-t.offset)%t.divisor===0)}(e,c);return s.jsx("div",{className:"flex items-center justify-center min-w-[3rem] w-[3rem] h-[3rem] px-2 py-1.5 rounded border text-sm font-medium "+(r?"bg-accent-light-500 dark:bg-accent-dark-500 border-accent-light-600 dark:border-accent-dark-600 text-white":t?"bg-gray-700 border-gray-500 text-gray-100":"bg-white border-gray-300 text-gray-800"),children:e},a)})})]},e.trialNumber))})})()]},e.id))})]})},li=({isOpen:e,onClose:t,widget:a,diceSets:i,chartSettings:o,currentChartSettingsId:l,onUpdateWidget:c})=>{const{t:d}=Fe(["charts"]),g=r.useRef(null),[u,h]=n.useState(""),m=r.useCallback(e=>{a&&c(a.id,{hiddenLegends:e})},[a,c]);if(r.useEffect(()=>{if(!e||!g.current||!a)return;const t=g.current;if(t.options.plugins?.legend&&(t.options.plugins.legend.display=!0,t.options.plugins.legend.onClick=(e,t,a)=>{const r=t.datasetIndex;if(void 0===r)return;const i=a.chart,n=i.getDatasetMeta(r);n.hidden=null===n.hidden?!i.data.datasets[r].hidden:!n.hidden,i.update();const s=i.data.datasets,o=[];s.forEach((e,t)=>{i.getDatasetMeta(t).hidden&&o.push(e.label||"")}),m(o)}),a.hiddenLegends&&t.data.datasets){const e=a.hiddenLegends;t.data.datasets.forEach((a,r)=>{const i=a.label||"";t.getDatasetMeta(r).hidden=e.includes(i)})}t.resize(),t.update()},[e,a,m]),!a)return null;const p=e=>{c(a.id,{aggregationSettings:e})},x=e=>{c(a.id,{aggregationSettings:e})},f=e=>{c(a.id,{chartType:e})},y=e=>{c(a.id,{xAxisScale:e})},b=e=>{c(a.id,{yAxisScale:e})},v=e=>{c(a.id,{movingAverageWindow:e})},S=e=>{c(a.id,{distributionType:e.distributionType,showOnlyActualData:e.showOnlyActualData,quantileCount:e.quantileCount})},w=o?.find(e=>e.id===l),k=`${l}-${a.id}-fullscreen`,C=w?{...w,id:k,resultChart:"result"===a.type&&a.aggregationSettings||w.resultChart,individualDiceChart:"individual"===a.type&&a.aggregationSettings||w.individualDiceChart,rollProgressChart:"rollProgress"===a.type&&a.aggregationSettings||w.rollProgressChart,resultChartType:"result"===a.type&&a.chartType||w.resultChartType,individualDiceChartType:"individual"===a.type&&a.chartType||w.individualDiceChartType,rollProgressChartType:"rollProgress"===a.type&&a.chartType||w.rollProgressChartType,cumulativeChartType:"cumulative"===a.type&&a.chartType||w.cumulativeChartType,resultChartXScale:"result"===a.type&&a.xAxisScale||w.resultChartXScale,rollProgressChartXScale:"rollProgress"===a.type&&a.xAxisScale||w.rollProgressChartXScale,resultChartYScale:"result"===a.type&&a.yAxisScale||w.resultChartYScale,individualDiceChartYScale:"individual"===a.type&&a.yAxisScale||w.individualDiceChartYScale,rollProgressChartYScale:"rollProgress"===a.type&&a.yAxisScale||w.rollProgressChartYScale,cumulativeChartYScale:"cumulative"===a.type&&a.yAxisScale||w.cumulativeChartYScale,rollProgressMovingAverageWindow:"rollProgress"===a.type?a.movingAverageWindow??w.rollProgressMovingAverageWindow:w.rollProgressMovingAverageWindow,cumulativeDistributionType:"cumulative"===a.type&&a.distributionType||w.cumulativeDistributionType,cumulativeShowOnlyActualData:"cumulative"===a.type?a.showOnlyActualData??w.cumulativeShowOnlyActualData:w.cumulativeShowOnlyActualData,cumulativeQuantileCount:"cumulative"===a.type?a.quantileCount??w.cumulativeQuantileCount:w.cumulativeQuantileCount}:void 0,j=C?[C]:o,D=C?.id||l,N=u?u.replace(/\n/g," "):d("charts:menu.fullScreen");return s.jsxs(Ka,{isOpen:e,onClose:t,size:"fullscreen",maxHeight:"90vh",children:[s.jsx(Qa,{title:N,onClose:t}),s.jsx(Ga,{children:s.jsx("div",{style:{width:"100%",height:"calc(98vh - 100px)"},children:(()=>{const e={width:"100%",height:"100%"};switch(a.type){case"result":return s.jsx("div",{style:e,children:s.jsx(ai,{diceSets:i,onBinningSettingsChange:x,onChartTypeChange:f,onXAxisScaleChange:y,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:g,widget:a,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});case"cumulative":return s.jsx("div",{style:e,children:s.jsx(ni,{diceSets:i,onChartTypeChange:f,onCumulativeSettingsChange:S,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:g,widget:a,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});case"rollProgress":return s.jsx("div",{style:e,children:s.jsx(si,{diceSets:i,onChartTypeChange:f,onAggregationChange:e=>{p({useAggregation:null!==e&&e>1,aggregationInterval:e||1})},onMovingAverageWindowChange:v,onXAxisScaleChange:y,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:g,widget:a,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});case"individual":return s.jsx("div",{style:e,children:s.jsx(ii,{diceSets:i,onChartTypeChange:f,onAggregationSettingsChange:p,onYAxisScaleChange:b,chartSettings:j,currentChartSettingsId:D,isNarrowLayout:!1,chartRef:g,widget:a,onUpdateHiddenLegends:m,isFullscreen:!0,chartTitleProp:h})});default:return null}})()})})]})},ci=n.memo(({diceSet:e,onClose:t,onSave:a,isCreateMode:i=!1})=>{const{t:n}=Fe(["dice","common","messages"]),[o,l]=r.useState(!1),[c,d]=r.useState(e.name),[g,u]=r.useState(String(e.diceConfig.diceCount??"")),[h,m]=r.useState(String(e.diceConfig.diceFaces??"")),[p,x]=r.useState(e.diceConfig.modifierSign),[f,y]=r.useState(String(e.diceConfig.modifierValue??"")),[b,v]=r.useState(String(e.trialCount??"")),S=e=>e.replace(/[^0-9]/g,""),w=(e,t,a)=>Math.min(Math.max(e,t),a),k=dt({diceCount:parseInt(g,10)||e.diceConfig.diceCount,diceFaces:parseInt(h,10)||e.diceConfig.diceFaces,modifierSign:p,modifierValue:parseInt(f,10)||e.diceConfig.modifierValue});return s.jsxs(Ka,{isOpen:!0,onClose:t,size:"2xl",modalId:"dice-config-modal",children:[s.jsx(Qa,{title:n(i?"dice:config.titleCreate":"dice:config.titleEdit"),onClose:t}),s.jsxs(Ga,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.name.label")}),s.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:k,maxLength:128,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.count.label",{min:1,max:Ze})}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:g,onChange:e=>{const t=S(e.target.value);u(t)},onBlur:t=>{const a=t.target.value;if(""===a)u(String(e.diceConfig.diceCount));else{const e=w(parseInt(a,10),1,Ze);u(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.sides.label",{min:1,max:et})}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:h,onChange:e=>{const t=S(e.target.value);m(t)},onBlur:t=>{const a=t.target.value;if(""===a)m(String(e.diceConfig.diceFaces));else{const e=w(parseInt(a,10),1,et);m(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.modifier.label",{min:0,max:tt})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("select",{value:p,onChange:e=>x(e.target.value),className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500",children:[s.jsx("option",{value:"",children:n("dice:config.modifier.sign")}),s.jsx("option",{value:"+",children:"+"}),s.jsx("option",{value:"-",children:"-"})]}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:f,onChange:e=>{const t=S(e.target.value);y(t)},onBlur:t=>{const a=t.target.value;if(""===a)y(String(e.diceConfig.modifierValue));else{const e=w(parseInt(a,10),0,tt);y(String(e))}},disabled:!p,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 disabled:bg-gray-100 dark:disabled:bg-gray-600"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.trial.label",{min:1,max:at})}),s.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:b,onChange:e=>{const t=S(e.target.value);v(t)},onBlur:t=>{const a=t.target.value;if(""===a)v(String(e.trialCount));else{const e=w(parseInt(a,10),1,at);v(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]})]}),s.jsxs("div",{className:"mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg relative transition-colors",children:[s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[n("dice:config.notation.label"),":"]}),s.jsx("p",{className:"text-lg font-mono font-bold text-accent-light-600 dark:text-accent-dark-400",children:k}),s.jsx("button",{onClick:async()=>{try{await ur(k),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){}},title:n(o?"dice:config.notation.copied":"dice:config.notation.copy"),className:"absolute top-2 right-2 p-1.5 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors group",children:o?s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx(lt,{name:"clipboard",className:"h-4 w-4 text-gray-600 group-hover:text-gray-800 dark:text-gray-400 dark:group-hover:text-gray-200"})})]})]}),s.jsxs(Za,{align:"right",children:[s.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:n("common:button.cancel")}),s.jsx("button",{onClick:()=>{const r={};c!==e.name&&(r.name=c);const n={diceCount:w(parseInt(g,10)||e.diceConfig.diceCount,1,Ze),diceFaces:w(parseInt(h,10)||e.diceConfig.diceFaces,1,et),modifierSign:p,modifierValue:w(parseInt(f,10)||e.diceConfig.modifierValue,0,tt)};n.diceCount===e.diceConfig.diceCount&&n.diceFaces===e.diceConfig.diceFaces&&n.modifierSign===e.diceConfig.modifierSign&&n.modifierValue===e.diceConfig.modifierValue||(r.diceConfig=n);const s=w(parseInt(b,10)||e.trialCount,1,at);s!==e.trialCount&&(r.trialCount=s),(i||Object.keys(r).length>0)&&a(e.id,r),t()},className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors",children:n(i?"common:button.create":"common:button.save")})]})]})}),di=n.memo(({diceSets:e,selectedDiceSetIds:t,onToggleDiceSet:a,onClose:r,onApply:i,onDuplicateDiceSet:o,onDeleteDiceSet:l,onBulkDeleteDiceSets:c,onBulkDuplicateDiceSets:d,onUpdateDiceSet:g,onReorderDiceSets:u,onExportDiceSets:h,onImportDiceSets:m,onCreateDiceSet:p,onDeleteAllDiceSets:x})=>{const{t:f}=Fe(["diceSets","common"]),[y,b]=n.useState(t),[v,S]=n.useState(null),[w,k]=n.useState(null),[C,j]=n.useState(!1),[D,N]=n.useState(null),[A,T]=n.useState(()=>{const e=localStorage.getItem("isMultiSelectMode"),a=(()=>{try{if(!e)return!1;const t=JSON.parse(e);return"boolean"==typeof t&&t}catch{return!1}})();return t.length>1||a}),M=n.useRef({});n.useEffect(()=>{localStorage.setItem("isMultiSelectMode",JSON.stringify(A))},[A]),n.useEffect(()=>{y.length>1&&!A&&T(!0)},[y.length]),n.useEffect(()=>{b(t=>{const a=e.map(e=>e.id);return t.filter(e=>a.includes(e))})},[e]),e.forEach(e=>{M.current[e.id]||(M.current[e.id]=n.createRef())});const L=e=>{b(t=>A?t.includes(e)?t.filter(t=>t!==e):[...t,e]:t.includes(e)?t.filter(t=>t!==e):[e])},R=n.useCallback(()=>{T(e=>{const t=!e;return!t&&y.length>0&&setTimeout(()=>{b([])},0),t})},[y.length]);return s.jsxs(s.Fragment,{children:[s.jsxs(Ka,{isOpen:!0,onClose:r,size:"2xl",maxHeight:"80vh",modalId:"compare-dicesets-modal",children:[s.jsx(Qa,{title:f("diceSets:title"),onClose:r,closeButtonLabel:f("common:button.close"),actions:y.length>0?s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:f("diceSets:list.selected",{count:y.length})}):null,sticky:!1}),s.jsx("div",{className:"px-4 border-b border-gray-200 dark:border-gray-700",children:s.jsx(mi,{diceSets:e,compareDiceSetIds:y,isMultiSelectMode:A,onToggleMultiSelectMode:R,onCreateDiceSet:()=>{if(!p)return;const e={id:"",name:"",diceConfig:{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:1,results:[],targetValue:1,createdAt:String(Date.now()),updatedAt:String(Date.now())};N(e),j(!0)},onToggleCompareDiceSet:L,onExportDiceSets:h,onImportDiceSets:m,onBulkDuplicateDiceSets:d,onBulkDeleteDiceSets:c,onDeleteAllDiceSets:x||(()=>{})})}),s.jsx(Ga,{scrollable:!0,padding:!1,className:"shrink p-4",children:s.jsx(qa,{items:e,selectedIds:y,onToggleItem:L,emptyMessage:f("diceSets:empty"),showSelectionCount:!1,enableDragAndDrop:!!u,onReorder:u,renderItem:(t,a,r,i)=>s.jsx(hi,{diceSet:t,isSelected:a,onToggle:()=>L(t.id),showCheckbox:!1,showDragHandle:!!u,dragHandleProps:i,diceSetsLength:e.length,onSetEditingDiceSetId:k,onDuplicateDiceSet:o,onDeleteDiceSet:l,openMenuId:v,onOpenMenu:S,menuButtonRef:M.current[t.id]})})}),s.jsx(Za,{children:s.jsx("button",{onClick:()=>{i?i(y):(t.forEach(e=>{y.includes(e)||a(e)}),y.forEach(e=>{t.includes(e)||a(e)})),r()},className:"w-full px-6 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded transition-colors",children:f("common:button.apply")})})]}),w&&s.jsx(ci,{diceSet:e.find(e=>e.id===w),onClose:()=>k(null),onSave:g}),C&&D&&s.jsx(ci,{diceSet:D,onClose:()=>{j(!1),N(null)},onSave:(e,t)=>{j(!1),N(null),p&&p(t)},isCreateMode:!0})]})});function gi(e){const t=yt(),a=e;return t.map(e=>{const t={...e};switch(e.type){case"result":a.resultChart&&(t.aggregationSettings=a.resultChart),a.resultChartType&&(t.chartType=a.resultChartType),a.resultChartXScale&&(t.xAxisScale=a.resultChartXScale),a.resultChartYScale&&(t.yAxisScale=a.resultChartYScale);break;case"cumulative":a.cumulativeChartType&&(t.chartType=a.cumulativeChartType),a.cumulativeDistributionType&&(t.distributionType=a.cumulativeDistributionType),void 0!==a.cumulativeShowOnlyActualData&&(t.showOnlyActualData=a.cumulativeShowOnlyActualData),void 0!==a.cumulativeQuantileCount&&(t.quantileCount=a.cumulativeQuantileCount),a.cumulativeChartXScale&&(t.xAxisScale=a.cumulativeChartXScale),a.cumulativeChartYScale&&(t.yAxisScale=a.cumulativeChartYScale);break;case"rollProgress":a.rollProgressChart&&(t.aggregationSettings=a.rollProgressChart),a.rollProgressChartType&&(t.chartType=a.rollProgressChartType),a.rollProgressMovingAverageWindow&&(t.movingAverageWindow=a.rollProgressMovingAverageWindow),a.rollProgressChartXScale&&(t.xAxisScale=a.rollProgressChartXScale),a.rollProgressChartYScale&&(t.yAxisScale=a.rollProgressChartYScale);break;case"individual":a.individualDiceChart&&(t.aggregationSettings=a.individualDiceChart),a.individualDiceChartType&&(t.chartType=a.individualDiceChartType),a.individualDiceChartXScale&&(t.xAxisScale=a.individualDiceChartXScale),a.individualDiceChartYScale&&(t.yAxisScale=a.individualDiceChartYScale)}return t})}di.displayName="CompareDiceSetsModal";const ui=({mode:e,initialSettings:t={},initialName:a="",compareDiceSetIds:i,diceSets:n,onSubmit:o,onClose:l})=>{const{t:c}=Fe(["charts","common","messages","settings"]),[d,g]=r.useState(a),[u,h]=r.useState(""),[m,p]=r.useState(!1),[x,f]=r.useState(()=>{return(e=t).widgets&&e.widgets.length>0?e:{...e,widgets:gi(e)};var e}),y=async()=>{if(d.trim()){p(!0),h("");try{const{id:e,name:t,...a}=x;let r=a;if(r.rememberSelectedDiceSet){r={...r,selectedDiceSetIds:[...i||[]]};const e=new Set(n.map(e=>e.id));r.selectedDiceSetIds&&(r.selectedDiceSetIds=r.selectedDiceSetIds.filter(t=>e.has(t)))}await o(d.trim(),r),l()}catch(e){h(e instanceof Error?e.message:c("settings:chartSettings.errors.operationFailed"))}finally{p(!1)}}else h(c("settings:chartSettings.errors.nameRequired"))},b=()=>{switch(e){case"create":return c("common:button.create");case"edit":return c("settings:chartSettings.save");case"duplicate":return c("settings:chartSettings.duplicate")}};return s.jsxs(Ka,{isOpen:!0,onClose:l,size:"md",maxHeight:"80vh",children:[s.jsx(Qa,{title:(()=>{switch(e){case"create":return c("charts:options.createNew");case"edit":return c("settings:chartSettings.editTitle");case"duplicate":return c("settings:chartSettings.duplicateTitle")}})(),onClose:l}),s.jsxs(Ga,{scrollable:!0,children:[u&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:u})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:c("settings:chartSettings.nameLabel")}),s.jsx("input",{type:"text",value:d,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"===e.key&&y()},placeholder:c("settings:chartSettings.namePlaceholder"),maxLength:128,autoFocus:!0,disabled:m,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent disabled:opacity-50"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:c("settings:chartSettings.maxLength")})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{htmlFor:"remember-dice-set",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:c("settings:chartSettings.rememberDiceSet.label")}),s.jsx(ar,{checked:x.rememberSelectedDiceSet??!1,onChange:e=>{f(t=>({...t,rememberSelectedDiceSet:e,selectedDiceSetIds:e?[...i||[]]:t.selectedDiceSetIds}))},label:c("settings:chartSettings.rememberDiceSet.label")})]}),s.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:c("settings:chartSettings.rememberDiceSet.description")})]}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:c("settings:chartSettings.chartOptions")}),s.jsx(Wr,{settings:x,onChange:e=>{f(t=>({...t,...e}))},showAllCharts:!0})]})]})]}),s.jsxs(Za,{align:"right",children:[s.jsx("button",{onClick:l,disabled:m,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:c("settings:chartSettings.cancel")}),s.jsx("button",{onClick:y,disabled:m||!d.trim(),className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-medium rounded-lg transition-colors disabled:opacity-50",title:m?c("common:label.processing"):b(),children:b()})]})]})},hi=n.memo(({diceSet:e,isSelected:t,onToggle:a,showDragHandle:i=!1,dragHandleProps:n,showCheckbox:o=!1,diceSetsLength:l,onSetEditingDiceSetId:c,onDuplicateDiceSet:d,onDeleteDiceSet:g,openMenuId:u,onOpenMenu:h,menuButtonRef:m})=>{const[p,x]=r.useState(!1),f=((e,t,a,r,i)=>{const{t:n}=Fe();return[{id:"dice-config",label:n("common:menu.edit"),icon:"edit",onClick:()=>a(e.id)},{id:"duplicate",label:n("common:menu.duplicate"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),onClick:()=>r(e.id),disabled:t>=We,title:t>=We?n("diceSets:limit.reached",{max:We}):""},{id:"delete",label:n("common:menu.delete"),customIcon:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:()=>{window.confirm(n("diceSets:confirm.delete"))&&i(e.id)},danger:!0,separator:!0}]})(e,l,c,d,g);return s.jsxs(Xa,{isSelected:t,onToggle:a,showDragHandle:i,dragHandleProps:n,showCheckbox:o,actions:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:t=>{t.stopPropagation(),c(e.id)},className:`\n              ${t?"text-accent-light-800/75 dark:text-accent-dark-400 hover:bg-accent-light-500/20 dark:hover:bg-accent-dark-700/50":"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"}\n              p-2 rounded transition-colors\n              `,title:"編集","aria-label":"編集",children:s.jsx(lt,{name:"edit",className:"w-5 h-5"})}),s.jsx(tr,{buttonRef:m,isSelected:t,onClick:t=>{t.stopPropagation(),h(u===e.id?null:e.id)}}),s.jsx(er,{isOpen:u===e.id,buttonRef:m,items:f,onClose:()=>h(null)})]}),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-100 truncate",children:dt(e.diceConfig)}),s.jsx("button",{onClick:async t=>{t.stopPropagation();const a=dt(e.diceConfig);await ur(a),x(!0),setTimeout(()=>x(!1),2e3)},className:`\n            ${t?"text-accent-light-800/75 dark:text-accent-dark-400 hover:bg-accent-light-500/20 dark:hover:bg-accent-dark-700/50":"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"}\n            flex-shrink-0 p-1 rounded transition-colors\n            `,title:p?"コピーしました":"ダイス記法をコピー","aria-label":"ダイス記法をコピー",children:p?s.jsx("svg",{className:"w-4 h-4 text-green-600 dark:text-green-400",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):s.jsx(lt,{name:"clipboard",className:"w-4 h-4"})})]}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:pt(e)})]})});hi.displayName="DiceSetListItem";const mi=n.memo(({diceSets:e,compareDiceSetIds:t,isMultiSelectMode:a,onToggleMultiSelectMode:r,onCreateDiceSet:i,onToggleCompareDiceSet:o,onExportDiceSets:l,onImportDiceSets:c,onBulkDuplicateDiceSets:d,onBulkDeleteDiceSets:g,onDeleteAllDiceSets:u})=>{const{t:h}=Fe(["diceSets","common"]),[m,p]=n.useState(!1),x=n.useRef(null),f=n.useRef(null);n.useEffect(()=>{const e=e=>{f.current&&!f.current.contains(e.target)&&p(!1)};if(m)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[m]);const y=e=>{e(),p(!1)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between gap-2 my-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:i,disabled:e.length>=We,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",title:e.length>=We?h("diceSets:limit.reached",{max:We}):h("diceSets:tooltip.create"),children:["+ ",h("diceSets:action.createShort")]}),s.jsxs("div",{className:"flex items-center gap-3 px-2 py-2 rounded-md border border-gray-300 dark:border-gray-600",children:[s.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:h("diceSets:multiSelect.label")}),s.jsx(ar,{checked:a,onChange:r,label:h("diceSets:multiSelect.label"),size:"medium"})]})]}),s.jsxs("div",{className:"relative",ref:f,children:[s.jsx("button",{onClick:()=>p(!m),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:h("charts:menu.options"),children:s.jsx(lt,{name:"dots-vertical",className:"w-5 h-5"})}),m&&s.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[s.jsxs("label",{htmlFor:"dice-set-file-import",className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 cursor-pointer",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.import")})]}),s.jsxs("button",{onClick:()=>y(l),disabled:0===e.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.export")})]}),s.jsx("button",{onClick:()=>{t.forEach(e=>o(e))},disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:h("diceSets:action.clearSelection"),children:s.jsx("span",{className:"text-sm",children:h("diceSets:action.clearSelection")})}),s.jsxs("button",{onClick:()=>y(()=>d(t)),disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.bulkDuplicateShort")})]}),s.jsxs("button",{onClick:()=>y(()=>g(t)),disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.bulkDeleteShort")})]}),s.jsxs("button",{onClick:()=>{0!==e.length&&window.confirm(h("diceSets:confirm.deleteAll"))&&(u(),p(!1))},disabled:0===e.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),s.jsx("span",{className:"text-sm",children:h("diceSets:action.deleteAllShort")})]})]})]})]}),s.jsx("input",{id:"dice-set-file-import",ref:x,type:"file",accept:".json,application/json",onChange:e=>{const t=e.target.files?.[0];t&&(c(t),x.current&&(x.current.value="")),p(!1)},className:"hidden"})]})});mi.displayName="DiceSetListActionBar";const pi=n.memo(({diceSets:e,compareDiceSetIds:t,onToggleCompareDiceSet:a,onCreateDiceSet:r,onDuplicateDiceSet:i,onDeleteDiceSet:o,onDeleteAllDiceSets:l,onBulkDeleteDiceSets:c,onBulkDuplicateDiceSets:d,onReorderDiceSets:g,onExportDiceSets:u,onImportDiceSets:h,onUpdateDiceSet:m})=>{const{t:p}=Fe(["diceSets","common"]),[x,f]=n.useState(null),[y,b]=n.useState(null),[v,S]=n.useState(!1),[w,k]=n.useState(null),[C,j]=n.useState(()=>{const e=localStorage.getItem("isMultiSelectMode"),t=(()=>{try{if(!e)return!1;const t=JSON.parse(e);return"boolean"==typeof t&&t}catch{return!1}})(),a=(()=>{try{const e=localStorage.getItem("compareDiceSetIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}})(),r=a.length>1||t;return(!e||a.length>1)&&localStorage.setItem("isMultiSelectMode",JSON.stringify(r)),r}),D=n.useRef({});n.useEffect(()=>{localStorage.setItem("isMultiSelectMode",JSON.stringify(C))},[C]),n.useEffect(()=>{t.length>1&&!C&&j(!0)},[t.length]);const N=n.useCallback(()=>{j(e=>{const r=!e;return!r&&t.length>0&&setTimeout(()=>{t.forEach(e=>a(e))},0),r})},[t,a]),A=e=>{C||t.includes(e)||t.forEach(e=>a(e)),a(e)};n.useEffect(()=>{e.forEach(e=>{D.current[e.id]||(D.current[e.id]=n.createRef())})},[e]);return s.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-4 h-full flex flex-col transition-colors",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h2",{className:"text-md font-bold text-gray-800 dark:text-gray-100",children:p("diceSets:title")}),t.length>0&&s.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:p("diceSets:list.selected",{count:t.length})})]}),s.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[La(e.length),"/",La(We)]})]}),s.jsx(mi,{diceSets:e,compareDiceSetIds:t,isMultiSelectMode:C,onToggleMultiSelectMode:N,onCreateDiceSet:()=>{const e={id:"",name:p("dice:config.name.placeholder"),diceConfig:{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:1,results:[],targetValue:1,createdAt:String(Date.now()),updatedAt:String(Date.now())};k(e),S(!0)},onToggleCompareDiceSet:a,onExportDiceSets:u,onImportDiceSets:h,onBulkDuplicateDiceSets:d,onBulkDeleteDiceSets:c,onDeleteAllDiceSets:l}),s.jsx(qa,{className:"mt-2",items:e,selectedIds:t,onToggleItem:A,emptyMessage:p("diceSets:empty"),showSelectionCount:!1,enableDragAndDrop:!0,onReorder:g,renderItem:(t,a,r,n)=>s.jsx(hi,{diceSet:t,isSelected:a,onToggle:()=>A(t.id),showDragHandle:!0,dragHandleProps:n,showCheckbox:!1,diceSetsLength:e.length,onSetEditingDiceSetId:b,onDuplicateDiceSet:i,onDeleteDiceSet:o,openMenuId:x,onOpenMenu:f,menuButtonRef:D.current[t.id]})}),y&&s.jsx(ci,{diceSet:e.find(e=>e.id===y),onClose:()=>b(null),onSave:m}),v&&w&&s.jsx(ci,{diceSet:w,onClose:()=>{S(!1),k(null)},onSave:(e,t)=>{S(!1),k(null),r(t)},isCreateMode:!0})]})});pi.displayName="DiceSetList";const xi=({currentPage:e,totalPages:t,totalItems:a,itemsPerPage:r,onPageChange:i})=>{const{t:n}=Fe("common");if(t<=1)return null;const o=(e-1)*r,l=o+r,c=a=>{const r=e+a;r>=1&&r<=t&&i(r)};return s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[La(o+1)," - ",La(Math.min(l,a))," ",n("unit.count")," / ",n("label.all")," ",La(a)," ",n("unit.count")]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>i(1),disabled:1===e,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors","aria-label":n("label.firstPage"),children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 6v12M14 18l-7-6 7-6"})})}),s.jsx("button",{onClick:()=>c(-10),disabled:e<=10,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"-10"}),s.jsx("button",{onClick:()=>c(-1),disabled:1===e,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"-1"}),s.jsx("div",{className:"px-4 py-1 bg-accent-light-500 dark:bg-accent-dark-500 text-white font-bold rounded",children:e}),s.jsx("button",{onClick:()=>c(1),disabled:e===t,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"+1"}),s.jsx("button",{onClick:()=>c(10),disabled:e>t-10,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"+10"}),s.jsx("button",{onClick:()=>i(t),disabled:e===t,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors","aria-label":n("label.lastPage"),children:s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6l7 6-7 6M18 6v12"})})})]})]})},fi=n.memo(({diceSet:e,onSortConfigChange:t})=>{const{t:a}=Fe(["charts","common"]),{results:i}=e,[n,o]=r.useState(1),[l,c]=r.useState(e.sortConfig||{column:"trialNumber",direction:"desc"});r.useEffect(()=>{o(1),c(e.sortConfig||{column:"trialNumber",direction:"desc"})},[e.id,e.sortConfig]),r.useEffect(()=>{e.sortConfig&&c(e.sortConfig)},[e.sortConfig]);const d=r.useMemo(()=>{const e=[...i];return e.sort((e,t)=>{let a,r;if("trialNumber"===l.column)a=e.trialNumber,r=t.trialNumber;else if("total"===l.column)a=e.total,r=t.total;else if("modifier"===l.column){const i=e.diceValues.reduce((e,t)=>e+t,0),n=t.diceValues.reduce((e,t)=>e+t,0);a=e.total-i,r=t.total-n}else{if(!l.column.startsWith("dice-"))return 0;{const i=parseInt(l.column.split("-")[1]);a=e.diceValues[i]??-1/0,r=t.diceValues[i]??-1/0}}return"asc"===l.direction?a-r:r-a}),e},[i,l]),g=e=>{const a={column:e,direction:l.column===e&&"asc"===l.direction?"desc":"asc"};c(a),t&&t(a),o(1)},u=e=>l.column!==e?s.jsx("span",{className:"ml-1 text-gray-400 dark:text-gray-500",children:s.jsx(lt,{name:"chevron-up",className:"w-3 h-3 inline"})}):s.jsx("span",{className:"ml-1",children:s.jsx(lt,{name:"asc"===l.direction?"chevron-up":"chevron-down",className:"w-3 h-3 inline"})});if(0===i.length)return s.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:a("common:label.noData")});const h=Math.ceil(d.length/25),m=25*(n-1),p=m+25,x=d.slice(m,p),f=e=>{o(e)},y=i.reduce((e,t)=>Math.max(e,t.diceValues.length),0);return s.jsxs("div",{className:"mb-12",children:[s.jsx("div",{className:"mb-6",children:s.jsx(xi,{currentPage:n,totalPages:h,totalItems:i.length,itemsPerPage:25,onPageChange:f})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full border-collapse min-w-[1000px]",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-700",children:[s.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g("trialNumber"),children:["試行",s.jsx("br",{}),u("trialNumber")]}),Array.from({length:y},(e,t)=>s.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g(`dice-${t}`),children:[s.jsx(lt,{name:"dice",className:"w-3 h-3 inline"}),t+1,s.jsx("br",{}),u(`dice-${t}`)]},t)),s.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g("modifier"),children:["補正",s.jsx("br",{}),u("modifier")]}),s.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center font-bold text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g("total"),children:["合計",s.jsx("br",{}),u("total")]})]})}),s.jsx("tbody",{children:x.map(e=>{const t=e.diceValues.reduce((e,t)=>e+t,0),a=e.total-t,r=0===a?"0":a>0?`+${a}`:a.toString();return s.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[s.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:La(e.trialNumber)}),Array.from({length:y},(t,a)=>s.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:void 0!==e.diceValues[a]?e.diceValues[a]:"-"},a)),s.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:r}),s.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right font-bold text-gray-700 dark:text-gray-300",children:e.total})]},e.trialNumber)})})]})}),s.jsx("div",{className:"mt-6",children:s.jsx(xi,{currentPage:n,totalPages:h,totalItems:d.length,itemsPerPage:25,onPageChange:f})})]})}),yi=({widget:e,index:t,widgets:a,displayedDiceSets:r,chartSettings:i,currentChartSettingsId:n,chartLayout:o,dragHandleProps:l,isDragging:c,isDropTarget:d,draggedIndex:g,isTouchDragging:u,chartRef:h,setChartContainerRef:m,onChangeType:p,onDuplicate:x,onRemove:f,onUpdateSettings:y,onOpenFullscreen:b,onDragOver:v,onDrop:S,onTouchStart:w,onTouchMove:k,onTouchEnd:C,onUpdateHiddenLegends:j})=>{const{t:D}=Fe(["charts"]),N=br(),A="4row1col"===o||"2row1col3col"===o&&0===t,T=i?.find(e=>e.id===n),M=e=>{y({aggregationSettings:e})},L=e=>{y({aggregationSettings:e})},R=e=>{y({chartType:e})},E=e=>{y({xAxisScale:e})},I=e=>{y({yAxisScale:e})},O=e=>{y({movingAverageWindow:e})},$=e=>{y({distributionType:e.distributionType,showOnlyActualData:e.showOnlyActualData,quantileCount:e.quantileCount})},P=e=>{y({recentRollsCount:e})},F=e=>{y({highlightConditions:e})},W=`relative px-4 pb-3 border border-gray-200 dark:border-gray-600 transition-all rounded-lg ${c?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500 ring-offset-2 dark:ring-offset-gray-800 opacity-70 bg-gray-50 dark:bg-gray-700/30":""} ${d?g<t?"mb-4":"mt-4":""}`,V=`${n}-${e.id}`,B=T?{...T,id:V,resultChart:"result"===e.type&&e.aggregationSettings||T.resultChart,individualDiceChart:"individual"===e.type&&e.aggregationSettings||T.individualDiceChart,rollProgressChart:"rollProgress"===e.type&&e.aggregationSettings||T.rollProgressChart,resultChartType:"result"===e.type&&e.chartType||T.resultChartType,individualDiceChartType:"individual"===e.type&&e.chartType||T.individualDiceChartType,rollProgressChartType:"rollProgress"===e.type&&e.chartType||T.rollProgressChartType,cumulativeChartType:"cumulative"===e.type&&e.chartType||T.cumulativeChartType,resultChartXScale:"result"===e.type&&e.xAxisScale||T.resultChartXScale,rollProgressChartXScale:"rollProgress"===e.type&&e.xAxisScale||T.rollProgressChartXScale,resultChartYScale:"result"===e.type&&e.yAxisScale||T.resultChartYScale,individualDiceChartYScale:"individual"===e.type&&e.yAxisScale||T.individualDiceChartYScale,rollProgressChartYScale:"rollProgress"===e.type&&e.yAxisScale||T.rollProgressChartYScale,cumulativeChartYScale:"cumulative"===e.type&&e.yAxisScale||T.cumulativeChartYScale,rollProgressMovingAverageWindow:"rollProgress"===e.type?e.movingAverageWindow??T.rollProgressMovingAverageWindow:T.rollProgressMovingAverageWindow,cumulativeDistributionType:"cumulative"===e.type&&e.distributionType||T.cumulativeDistributionType,cumulativeShowOnlyActualData:"cumulative"===e.type?e.showOnlyActualData??T.cumulativeShowOnlyActualData:T.cumulativeShowOnlyActualData,cumulativeQuantileCount:"cumulative"===e.type?e.quantileCount??T.cumulativeQuantileCount:T.cumulativeQuantileCount}:void 0,U=B?[B]:i,H=B?V:n;return s.jsxs("div",{ref:m,className:W,onDragOver:v,onDrop:S,children:[d&&s.jsx("div",{className:`absolute left-0 right-0 h-1 bg-accent-light-500 dark:bg-accent-dark-500 rounded-full ${g<t?"-bottom-1":"-top-1"} z-10`}),s.jsxs("div",{className:"flex items-center gap-1 py-2 border-b border-gray-200 dark:border-gray-600 mb-2",children:[s.jsx(Ya,{dragHandleProps:l,onTouchStart:w,onTouchMove:k,onTouchEnd:C,isDragging:u&&c}),s.jsxs("div",{className:"flex items-center gap-1.5 px-2",children:[s.jsx(lt,{name:(e=>{switch(e){case"result":return"chart-total-distribution";case"cumulative":return"chart-cumulative-distribution";case"rollProgress":return"chart-roll-progress";case"individual":return"chart-individual-dice";case"recentRolls":return"dice";default:return"chart-bar"}})(e.type),className:"w-4 h-4 text-gray-600 dark:text-gray-400 flex-shrink-0"}),s.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:(()=>{if(e.customName)return e.customName;const r=a.filter((a,r)=>r<=t&&a.type===e.type).length;return bt(e.type,r,D)})()})]}),s.jsx("div",{className:"flex-grow"}),s.jsx("button",{onClick:x,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors",title:D("charts:widget.duplicate"),children:s.jsx("svg",{className:"w-4 h-4 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(z=e.type,"recentRolls"!==z&&s.jsx("button",{onClick:()=>b?.(),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors hidden lg:inline-flex",title:D("charts:menu.fullScreen"),children:s.jsx("svg",{className:"w-4 h-4 text-gray-600 dark:text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})),s.jsx("button",{onClick:f,className:"p-1 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-colors",title:D("charts:widget.remove"),children:s.jsx("svg",{className:"w-4 h-4 text-red-600 dark:text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s.jsx("div",{className:"w-full",children:(()=>{switch(e.type){case"result":return s.jsx(ai,{diceSets:r,onBinningSettingsChange:L,onChartTypeChange:R,onXAxisScaleChange:E,onYAxisScaleChange:I,chartSettings:U,currentChartSettingsId:H,isNarrowLayout:A,chartRef:h,widgetType:e.type,onWidgetTypeChange:p,widget:e,onUpdateHiddenLegends:j});case"cumulative":return s.jsx(ni,{diceSets:r,onChartTypeChange:R,onYAxisScaleChange:I,chartSettings:U,currentChartSettingsId:H,onCumulativeSettingsChange:$,isNarrowLayout:A,chartRef:h,widgetType:e.type,onWidgetTypeChange:p,widget:e,onUpdateHiddenLegends:j,onOpenFullscreen:b});case"rollProgress":return s.jsx(si,{diceSets:r,onChartTypeChange:R,onAggregationChange:e=>{M({useAggregation:null!==e&&e>1,aggregationInterval:e||1})},onMovingAverageWindowChange:O,onXAxisScaleChange:E,onYAxisScaleChange:I,chartSettings:U,currentChartSettingsId:H,isNarrowLayout:A,chartRef:h,widgetType:e.type,onWidgetTypeChange:p,widget:e,onUpdateHiddenLegends:j,onOpenFullscreen:b});case"individual":return s.jsx(ii,{diceSets:r,onChartTypeChange:R,onAggregationSettingsChange:M,onYAxisScaleChange:I,chartSettings:U,currentChartSettingsId:H,isNarrowLayout:A,chartRef:h,widgetType:e.type,onWidgetTypeChange:p,widget:e,onUpdateHiddenLegends:j,onOpenFullscreen:b});case"recentRolls":return s.jsx(oi,{diceSets:r,isDarkMode:N,recentRollsCount:e.recentRollsCount||1,onRecentRollsCountChange:P,widgetType:e.type,onWidgetTypeChange:p,highlightConditions:e.highlightConditions,onHighlightConditionsChange:F,widget:e,onUpdateHiddenLegends:j})}})()})]});var z},bi=({isOpen:e,onClose:t,menuRef:a,activeTab:r,chartLayout:i,onLayoutChange:n,widgetsCount:o,onAddWidget:l,onResetToDefault:c,chartSettings:d,onManageChartSettings:g,onDownloadCSV:u,onReset:h})=>{const{t:m}=Fe(["charts"]),p=e=>{n(e),t()},x=e=>{e(),t()};return s.jsxs("div",{ref:a,className:"absolute right-0 top-full mt-1 w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[20] overflow-hidden border border-gray-200 dark:border-gray-600 transition-opacity "+(e?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:["table"!==r&&s.jsx("div",{className:"hidden lg:block px-4 py-4 border-b border-gray-200 dark:border-gray-600",children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:[m("charts:view.layout","レイアウト"),":"]}),s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsx("button",{onClick:()=>p("4row1col"),className:"px-3 py-1.5 text-sm rounded-md transition-colors flex flex-1 justify-center items-center gap-1.5 "+("4row1col"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),title:m("charts:view.layoutType.4row1col"),children:s.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("rect",{x:"4",y:"3",width:"16",height:"4",rx:"1"}),s.jsx("rect",{x:"4",y:"10",width:"16",height:"4",rx:"1"}),s.jsx("rect",{x:"4",y:"17",width:"16",height:"4",rx:"1"})]})}),s.jsx("button",{onClick:()=>p("2row2col"),className:"px-3 py-1.5 text-sm rounded-md transition-colors flex flex-1 justify-center items-center gap-1.5 "+("2row2col"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),title:m("charts:view.layoutType.2row2col"),children:s.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("rect",{x:"3",y:"3",width:"8",height:"8",rx:"1"}),s.jsx("rect",{x:"13",y:"3",width:"8",height:"8",rx:"1"}),s.jsx("rect",{x:"3",y:"13",width:"8",height:"8",rx:"1"}),s.jsx("rect",{x:"13",y:"13",width:"8",height:"8",rx:"1"})]})}),s.jsx("button",{onClick:()=>p("2row1col3col"),className:"px-3 py-1.5 text-sm rounded-md transition-colors flex flex-1 justify-center items-center gap-1.5 "+("2row1col3col"===i?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),title:m("charts:view.layoutType.2row1col3col"),children:s.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("rect",{x:"3",y:"3",width:"18",height:"5",rx:"1"}),s.jsx("rect",{x:"3",y:"11",width:"5",height:"10",rx:"1"}),s.jsx("rect",{x:"9.5",y:"11",width:"5",height:"10",rx:"1"}),s.jsx("rect",{x:"16",y:"11",width:"5",height:"10",rx:"1"})]})})]})]})}),"table"!==r&&s.jsxs("button",{onClick:()=>{l(),t()},disabled:o>=st,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",title:m(o>=st?"charts:widget.limitReached":"charts:widget.add"),children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),s.jsx("span",{children:m("charts:widget.add")})]}),"table"!==r&&s.jsxs("button",{onClick:()=>{c(),t()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",title:m("charts:widget.resetToDefault"),children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),s.jsx("span",{children:m("charts:widget.resetToDefault")})]}),"table"!==r&&d&&d.length>0&&g&&s.jsxs("button",{onClick:g,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600",title:m("charts:view.manage"),children:[s.jsx(lt,{name:"settings",className:"w-5 h-5"}),s.jsx("span",{children:m("charts:view.manage")})]}),s.jsxs("button",{onClick:()=>x(u),className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[s.jsx(lt,{name:"download"}),s.jsx("span",{className:"text-sm",children:m("charts:menu.csvDownload")})]}),s.jsxs("button",{onClick:()=>x(h),className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600",children:[s.jsx(lt,{name:"trash"}),s.jsx("span",{className:"text-sm",children:m("charts:menu.rollReset")})]})]})};function vi(e,t){return"default"===e.id?t("charts:preset.default"):mt(e.name)}const Si=({chartSettings:e,currentChartSettingsId:t,onSelectChartSettings:a,onCreateChartSettings:r,onSaveChartSettings:i,onEditChartSettings:n,hasPendingChanges:o=!1,widgets:l})=>{const{t:c}=Fe(["charts","common"]);return s.jsxs("div",{className:"border border-t-0 bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700 rounded-bl-lg rounded-br-lg px-4 py-2 inline-flex justify-center items-center gap-2 w-full",children:[s.jsx("label",{className:"hidden sm:inline text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap",children:c("charts:view.selectView")}),s.jsxs("select",{value:t,onChange:e=>{var t;"__CREATE_NEW__"===(t=e.target.value)?r?.():a(t)},className:"h-8 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent w-auto max-w-[150px]",children:[r&&s.jsx("option",{value:"__CREATE_NEW__",children:c("charts:view.saveCurrentView")}),e.filter(e=>St(e.id)).length>0&&s.jsx("optgroup",{label:c("charts:view.presetGroup"),children:e.filter(e=>St(e.id)).map(e=>s.jsx("option",{value:e.id,children:vi(e,c)},e.id))}),e.filter(e=>!St(e.id)).length>0&&s.jsx("optgroup",{label:c("charts:view.customGroup"),children:e.filter(e=>!St(e.id)).map(e=>s.jsx("option",{value:e.id,children:mt(e.name)},e.id))})]}),t&&!St(t)&&n&&s.jsxs("button",{onClick:()=>{const a=e.find(e=>e.id===t);a&&n?.({...a,widgets:l})},className:"h-8 px-3 py-1.5 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md text-sm transition-colors whitespace-nowrap flex-shrink-0 flex items-center gap-1.5",title:c("common:action.edit"),children:[s.jsx(lt,{name:"edit",className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:c("common:action.edit")})]}),i&&t&&!St(t)&&s.jsx("button",{onClick:()=>i(t),disabled:!o,className:"h-8 px-3 py-1.5 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-300 disabled:dark:bg-gray-600 disabled:cursor-not-allowed disabled:opacity-50 text-white rounded-md text-sm transition-colors whitespace-nowrap flex-shrink-0 flex items-center gap-1.5",title:c(o?"charts:view.overwrite":"common:label.noChanges"),children:s.jsx("span",{children:c("charts:view.overwrite")})})]})},wi=({type:e,onShowCompareModal:t,onReroll:a,onAddRoll:r,isSimulating:i=!1,diceSets:n=[],selectedDiceSetIds:o=[],targetDiceSetType:l="selected",onTargetDiceSetTypeChange:c})=>{const{t:d}=Fe(["charts","diceSets"]);return"no-dice-set"===e?s.jsx("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-lg mb-6",children:d("diceSets:selectPrompt")}),s.jsxs("button",{onClick:()=>t?.(),className:"px-6 py-3 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors inline-flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),s.jsx("span",{children:d("diceSets:action.selectDiceSet")})]})]})}):s.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:d("charts:result.title")}),s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-gray-400 dark:text-gray-500 mb-6",children:d("charts:message.startRoll")}),s.jsx(Ba,{onReroll:a||(()=>{}),onAddRoll:r||(()=>{}),hasResults:!1,isSimulating:i,variant:"large",diceSets:n,selectedDiceSetIds:o,targetDiceSetType:l,onTargetDiceSetTypeChange:c})]})]})},ki=({diceSet:e,diceSets:t,compareDiceSetIds:a,onResetResults:i,onReroll:o,onAddRoll:l,isSimulating:c,simulationProgress:d=0,onSortConfigChange:g,chartSettings:u,currentChartSettingsId:h,onSelectChartSettings:m,onManageChartSettings:p,onCreateNewSettings:x,onSaveChartSettings:f,onUpdateChartSettings:y,hasPendingChanges:b=!1,onWidgetsChange:v,selectedDiceSetIds:S=[],targetDiceSetType:w="selected",onTargetDiceSetTypeChange:k,onShowCompareModal:C})=>{const{t:j}=Fe(["charts","common","diceSets"]),D=br(),[N,A]=r.useState(()=>{const e=localStorage.getItem("resultSectionActiveTab");return"table"===e||"chart"===e?e:"chart"}),[T,M]=r.useState(!1),[L,R]=r.useState(()=>localStorage.getItem("selectedTableDiceSetId")||e?.id||""),[E,I]=r.useState(!1),[O,$]=r.useState({isOpen:!1}),P=r.useRef(null),F=r.useRef(null),W=r.useRef(new Map),[V,B]=r.useState(0),[U,H]=r.useState(()=>{const e=localStorage.getItem("widgets");if(e)try{const t=JSON.parse(e);if(Array.isArray(t)&&t.every(e=>e.id&&e.type))return t}catch{}const t=localStorage.getItem("chartOrder");if(t)try{const e=JSON.parse(t);if(Array.isArray(e)){const t=e.map(e=>({id:ft(),type:e}));return localStorage.removeItem("chartOrder"),t}}catch{}return yt()}),[z,q]=r.useState("0"),[Y,X]=r.useState(()=>{const e=localStorage.getItem("chartLayout");return"4row1col"===e||"2row2col"===e||"2row1col3col"===e?e:"4row1col"}),[_,J]=r.useState(null),[K,Q]=r.useState(null),[G,Z]=r.useState(null),ee=r.useRef(new Map),te=r.useRef(null),[ae,re]=r.useState(!1),ie=r.useRef(0),ne=r.useRef(new Map);r.useEffect(()=>{localStorage.setItem("widgets",JSON.stringify(U)),v?.(U)},[U,v]);const se=r.useRef(void 0);r.useEffect(()=>{if(se.current!==h&&(se.current=h,h&&u)){const e=u.find(e=>e.id===h);e?.widgets&&e.widgets.length>0&&H(e.widgets)}},[h,u]),r.useEffect(()=>{localStorage.setItem("chartLayout",Y)},[Y]);const oe=e=>(ee.current.has(e)||ee.current.set(e,n.createRef()),ee.current.get(e)),le=()=>{Q(null),Z(null)},ce=e=>{if(null===K||!ae)return;e.preventDefault();const t=e.touches[0].clientY;let a=null;ne.current.forEach((e,r)=>{if(e&&r!==K){const i=e.getBoundingClientRect(),n=i.top+i.height/2;(t>i.top&&t<i.bottom||K<r&&t>n&&t<i.bottom+50||K>r&&t<n&&t>i.top-50)&&(a=r)}}),Z(a)},de=()=>{if(null!==K&&null!==G&&K!==G){const e=[...U],[t]=e.splice(K,1);e.splice(G,0,t),H(e),B(e=>e+1)}Q(null),Z(null),re(!1)},ge=r.useMemo(()=>{const r=a.map(e=>t.find(t=>t.id===e)).filter(Boolean);return r.length>0?r:e?[e]:[]},[a,t,e]);r.useEffect(()=>{!e||L&&ge.find(e=>e.id===L)||R(e.id)},[e,ge,L]),r.useEffect(()=>{localStorage.setItem("resultSectionActiveTab",N)},[N]),r.useEffect(()=>{L&&localStorage.setItem("selectedTableDiceSetId",L)},[L]);const ue=r.useMemo(()=>ge.find(e=>e.id===L)||e,[ge,L,e]);r.useEffect(()=>{const e=e=>{P.current&&!P.current.contains(e.target)&&F.current&&!F.current.contains(e.target)&&M(!1)};if(T)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[T]);const he=r.useMemo(()=>{if(0===a.length)return[];const e=new Set(a);return t.filter(t=>e.has(t.id))},[a,t]),me=r.useMemo(()=>he.length>0?he:e?[e]:[],[he,e]),pe=r.useMemo(()=>{const e={};return W.current.forEach((t,a)=>{e[a]=t}),function(e){const t=[];if(e.result?.current){const a=Nr("result",e.result);t.push(...a)}if(e.cumulative?.current){const a=Nr("cumulative",e.cumulative);t.push(...a)}if(e.rollProgress?.current){const a=Nr("rollProgress",e.rollProgress);t.push(...a)}if(e.individual?.current){const a=Nr("individual",e.individual);t.push(...a)}return t}(e)},[V]);if(r.useEffect(()=>{const e=setTimeout(()=>{B(e=>e+1)},500);return()=>clearTimeout(e)},[me,U,Y]),!e)return s.jsx(wi,{type:"no-dice-set",onShowCompareModal:C});if(0===e.results.length)return s.jsx(wi,{type:"no-results",onReroll:o,onAddRoll:l,isSimulating:c,diceSets:t,selectedDiceSetIds:S,targetDiceSetType:w,onTargetDiceSetTypeChange:k});const xe=()=>{if(U.length>=st)return void alert(j("charts:widget.limitReached",{max:st}));const e={id:ft(),type:"result"};H([...U,e]),B(e=>e+1)},fe=(e,t)=>{const a=[...U];a[e]={...a[e],...t},H(a),B(e=>e+1)},ye=(e,t)=>{const a={ref:oe(t),onDragStart:e=>((e,t)=>{Q(t),e.dataTransfer.effectAllowed="move",te.current&&e.dataTransfer.setDragImage(te.current,-10,20)})(e,t),onDragEnd:le},r=K===t,i=G===t&&null!==K&&K!==t,o=(l=e.id,W.current.has(l)||W.current.set(l,n.createRef()),W.current.get(l));var l;return s.jsx(yi,{widget:e,index:t,widgets:U,displayedDiceSets:me,chartSettings:u,currentChartSettingsId:h,chartLayout:Y,dragHandleProps:a,isDragging:r,isDropTarget:i,draggedIndex:K,isTouchDragging:ae,chartRef:o,setChartContainerRef:e=>{ne.current.set(t,e)},onChangeType:e=>((e,t)=>{const a=[...U];a[e]={...a[e],type:t},H(a),B(e=>e+1)})(t,e),onDuplicate:()=>(e=>{if(U.length>=st)return void alert(j("charts:widget.limitReached",{max:st}));const t=U[e],a={...t,id:ft(),customName:void 0,aggregationSettings:t.aggregationSettings?{...t.aggregationSettings}:void 0,xAxisScale:t.xAxisScale?{...t.xAxisScale}:void 0},r=[...U];r.splice(e+1,0,a),H(r),B(e=>e+1)})(t),onRemove:()=>(e=>{if(U.length<=1)return void alert(j("charts:widget.minLimitReached"));const t=parseInt(z);if(t===e){const t=Math.max(0,e-1);q(t.toString()),setTimeout(()=>{const e=document.querySelector(`[data-tab-index="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},100)}else t>e&&q((t-1).toString());const a=U.filter((t,a)=>a!==e);H(a),B(e=>e+1)})(t),onUpdateSettings:e=>fe(t,e),onOpenFullscreen:()=>J(e),onDragOver:e=>((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",null!==K&&K!==t&&Z(t)})(e,t),onDrop:e=>((e,t)=>{if(e.preventDefault(),null===K||K===t)return;const a=[...U],[r]=a.splice(K,1);a.splice(t,0,r),H(a),Q(null),Z(null),B(e=>e+1)})(e,t),onTouchStart:e=>((e,t)=>{e.stopPropagation(),ie.current=e.touches[0].clientY,Q(t),re(!0)})(e,t),onTouchMove:ce,onTouchEnd:de,onUpdateHiddenLegends:e=>fe(t,{hiddenLegends:e})},e.id)};return s.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:[s.jsxs("div",{ref:te,className:"fixed -left-[9999px] -top-[9999px] bg-accent-light-500 dark:bg-accent-dark-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",style:{zIndex:9999,opacity:1},children:[s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),s.jsx("span",{className:"font-medium text-sm",children:j("common:selection.moving")})]}),s.jsxs("div",{className:"flex justify-between border-b border-gray-200 dark:border-gray-600",children:[s.jsxs("div",{className:"flex justify-start start",children:[s.jsxs("button",{onClick:()=>A("chart"),className:"px-6 py-2 font-medium transition-colors flex items-center gap-2 "+("chart"===N?"text-accent-light-600 dark:text-accent-dark-400 border-b-2 border-accent-light-600 dark:border-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[s.jsx(lt,{name:"chart-bar"}),s.jsx("span",{className:"hidden sm:inline",children:j("charts:view.chart")})]}),s.jsxs("button",{onClick:()=>A("table"),className:"px-6 py-2 font-medium transition-colors flex items-center gap-2 "+("table"===N?"text-accent-light-600 dark:text-accent-dark-400 border-b-2 border-accent-light-600 dark:border-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[s.jsx(lt,{name:"table"}),s.jsx("span",{className:"hidden sm:inline",children:j("charts:view.table")})]})]}),s.jsx("div",{className:"flex gap-2 items-center",children:s.jsxs("div",{className:"relative",children:[s.jsx("button",{ref:F,onClick:()=>{M(!T)},className:"w-10 h-10 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white  rounded-tl-lg rounded-tr-lg  transition-colors inline-flex items-center justify-center",title:j("charts:menu.options"),children:s.jsx(lt,{name:"dots-vertical",className:"w-5 h-5"})}),s.jsx(bi,{isOpen:T,onClose:()=>M(!1),menuRef:P,activeTab:N,chartLayout:Y,onLayoutChange:X,widgetsCount:U.length,onAddWidget:xe,onResetToDefault:()=>{window.confirm(j("charts:widget.confirmReset"))&&(H(yt()),B(e=>e+1))},chartSettings:u,onManageChartSettings:p,onDownloadCSV:()=>{try{!function(e){const{results:t,name:a,diceConfig:r,resultsConfig:i}=e;if(0===t.length)throw new Error("ダウンロードする結果がありません");const n=t.reduce((e,t)=>Math.max(e,t.diceValues.length),0),s=["試行回数"];for(let m=1;m<=n;m++)s.push(`${m}個目`);s.push("修正値"),s.push("合計値");const o=[s];t.forEach(e=>{const t=[e.trialNumber.toString()];for(let i=0;i<n;i++)t.push(void 0!==e.diceValues[i]?e.diceValues[i].toString():"");const a=e.diceValues.reduce((e,t)=>e+t,0),r=e.total-a;t.push(r.toString()),t.push(e.total.toString()),o.push(t)});const l=o.map(e=>e.join(",")).join("\n"),c=new Blob(["\ufeff"+l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),g=document.createElement("a");g.href=d;const u=dt(i||r),h=(a||"名称未設定").replace(/[<>:"/\\|?*\x00-\x1F]/g,"_").trim();g.download=`${h}_${u}_${t.length}trials.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d)}(e)}catch(t){alert(j("charts:menu.csvDownloadFailed"))}},onReset:()=>{window.confirm(j("charts:menu.confirmReset"))&&i()}})]})})]}),"table"===N?s.jsx(s.Fragment,{children:ge.length>1&&s.jsxs("div",{className:"border border-t-0 bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700 rounded-bl-lg rounded-br-lg px-4 py-2 inline-flex justify-center items-center gap-2 w-full",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap",children:j("diceSets:title")}),s.jsx("select",{value:L,onChange:e=>R(e.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent w-auto max-w-[180px]",children:ge.map(e=>s.jsx("option",{value:e.id,children:xt(e)},e.id))})]})}):s.jsx(s.Fragment,{children:u&&u.length>0&&m&&s.jsx(Si,{chartSettings:u,currentChartSettingsId:h,onSelectChartSettings:m,onCreateChartSettings:()=>I(!0),onSaveChartSettings:f,onEditChartSettings:e=>{$({isOpen:!0,settingsId:e.id,initialSettings:e,initialName:e.name}),q("0")},hasPendingChanges:b,widgets:U})}),a.length>0&&s.jsxs("div",{className:"flex items-center justify-between sm:hidden my-4 bg-accent-light-50 dark:bg-accent-dark-900/20 border border-accent-light-200 dark:border-accent-dark-700 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(lt,{name:"diceSets",className:"w-5 h-5 text-accent-light-500 dark:text-accent-dark-400"}),s.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:j(1===a.length?"diceSets:viewing.single":"diceSets:viewing.multiple",{count:a.length})})]}),s.jsx("div",{className:"flex items-center gap-3 lg:hidden",children:s.jsx("button",{onClick:()=>C?.(),className:"text-sm text-accent-light-600 dark:text-accent-dark-400 hover:text-accent-light-700 dark:hover:text-accent-dark-300 font-medium underline",children:j("diceSets:action.change")})})]}),s.jsx("div",{children:"table"===N?s.jsx(s.Fragment,{children:s.jsx(fi,{diceSet:ue,onSortConfigChange:g})}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"my-4 sticky top-1 md:top-[60px] z-[15]",children:s.jsx(zr,{items:pe,isDarkMode:D,onLegendClick:()=>B(e=>e+1)})}),"4row1col"===Y?s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[U.map((e,t)=>ye(e,t)),U.length<st&&s.jsx("button",{onClick:xe,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 hover:border-accent-light-400 dark:hover:border-accent-dark-400 hover:bg-gray-50 dark:hover:bg-gray-750 transition-all min-h-[200px] flex items-center justify-center group","aria-label":j("charts:widget.add"),children:s.jsx(lt,{name:"plus",className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-accent-light-500 dark:group-hover:text-accent-dark-400 transition-colors"})})]}):"2row2col"===Y?s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[U.map((e,t)=>ye(e,t)),U.length<st&&s.jsx("button",{onClick:xe,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 hover:border-accent-light-400 dark:hover:border-accent-dark-400 hover:bg-gray-50 dark:hover:bg-gray-750 transition-all min-h-[200px] flex items-center justify-center group","aria-label":j("charts:widget.add"),children:s.jsx(lt,{name:"plus",className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-accent-light-500 dark:group-hover:text-accent-dark-400 transition-colors"})})]}):s.jsxs("div",{children:[s.jsx("div",{className:"mb-4",children:ye(U[0],0)}),s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[U.slice(1).map((e,t)=>ye(e,t+1)),U.length<st&&s.jsx("button",{onClick:xe,className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 hover:border-accent-light-400 dark:hover:border-accent-dark-400 hover:bg-gray-50 dark:hover:bg-gray-750 transition-all min-h-[200px] flex items-center justify-center group","aria-label":j("charts:widget.add"),children:s.jsx(lt,{name:"plus",className:"w-8 h-8 text-gray-400 dark:text-gray-500 group-hover:text-accent-light-500 dark:group-hover:text-accent-dark-400 transition-colors"})})]})]})]})}),s.jsx("div",{className:"hidden lg:block",children:s.jsx(Ba,{onReroll:o,onAddRoll:l,hasResults:!0,isSimulating:c,simulationProgress:d,variant:"floating",diceSets:t,selectedDiceSetIds:S,targetDiceSetType:w,onTargetDiceSetTypeChange:k})}),E&&x&&s.jsx(ui,{mode:"create",initialSettings:{widgets:U},compareDiceSetIds:a,diceSets:t,onSubmit:async(e,t)=>{await x(e,t),I(!1)},onClose:()=>I(!1)}),O.isOpen&&y&&O.settingsId&&s.jsx(ui,{mode:"edit",initialSettings:O.initialSettings,initialName:O.initialName,compareDiceSetIds:a,diceSets:t,onSubmit:async(e,t)=>{try{t.widgets&&H(t.widgets);const a={...t,name:e};await y(O.settingsId,a),$({isOpen:!1})}catch(a){throw a}},onClose:()=>$({isOpen:!1})},O.settingsId),s.jsx(li,{isOpen:!!_,onClose:()=>J(null),widget:_,diceSets:me,chartSettings:u,currentChartSettingsId:h,onUpdateWidget:(e,t)=>{const a=U.findIndex(t=>t.id===e);-1!==a&&fe(a,t)}})]})},Ci=r.lazy(()=>D(()=>import("./index-CEiIUMOo.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.AboutPage}))),ji=r.lazy(()=>D(()=>import("./index-CEiIUMOo.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.ChangelogModal})));function Di(){const{t:e,i18n:t}=Fe();r.useEffect(()=>{document.title=e("common:siteName")},[e,t.language]);const[a,i]=r.useState([]),[n,o]=r.useState(()=>{try{const e=localStorage.getItem("compareDiceSetIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}}),[l,c]=r.useState(null),[d,g]=r.useState(!1),[u,h]=r.useState(0),[m,p]=r.useState(()=>{const e=localStorage.getItem("mobileView");return"diceSets"===e||"results"===e?e:"results"}),[x,f]=r.useState(!0),[y,b]=r.useState(!1),[v,S]=r.useState(!1),[w,k]=r.useState("selected"),{chartSettings:C,currentSettingsId:j,setCurrentSettingsId:D,createSettings:N,duplicateSettings:A,updateSettings:T,deleteSettings:M,renameSettings:L,reorderSettings:R}=vr(),[E,I]=r.useState({}),[O,$]=r.useState({}),[P,F]=r.useState(void 0),[W,V]=r.useState({}),[B,U]=r.useState({}),[H,z]=r.useState({}),[q,Y]=r.useState(void 0),[X,_]=r.useState(()=>"undefined"!=typeof window&&window.innerWidth<1024),[J,K]=r.useState(()=>{const e=localStorage.getItem("themeMode");if("light"===e||"dark"===e||"system"===e)return e;const t=localStorage.getItem("darkMode");if(t)try{const e=JSON.parse(t);if("boolean"==typeof e)return localStorage.removeItem("darkMode"),e?"dark":"light"}catch{}return"system"}),[Q,G]=r.useState(()=>!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches),Z="system"===J?Q:"dark"===J,[ee,te]=r.useState(()=>"true"===localStorage.getItem("transparentExport")),[ae,re]=r.useState(()=>"#about"===window.location.hash),[ie,ne]=r.useState(()=>"#changelog"===window.location.hash);r.useEffect(()=>{if("undefined"!=typeof window&&window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{G(e.matches)};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[]),r.useEffect(()=>{Z?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[Z]),r.useEffect(()=>{localStorage.setItem("themeMode",J)},[J]),r.useEffect(()=>{const e=()=>{_(window.innerWidth<1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),r.useEffect(()=>{const e=()=>{re("#about"===window.location.hash),ne("#changelog"===window.location.hash)};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[]),r.useEffect(()=>{ae?"#about"!==window.location.hash&&(window.location.hash="#about"):"#about"===window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search)},[ae]),r.useEffect(()=>{ie?"#changelog"!==window.location.hash&&(window.location.hash="#changelog"):"#changelog"===window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search)},[ie]);const se=r.useCallback(()=>{K(e=>"system"===e?Q?"light":"dark":"light"===e?"dark":"light")},[Q]),oe=r.useCallback(e=>{K(e)},[]),le=r.useCallback(e=>{te(e),localStorage.setItem("transparentExport",e.toString()),window.dispatchEvent(new Event("transparentExportChanged"))},[]);r.useEffect(()=>{I({})},[j]),r.useEffect(()=>{const e=C.find(e=>e.id===j);if(e?.rememberSelectedDiceSet&&e.selectedDiceSetIds){const t=new Set(a.map(e=>e.id)),r=e.selectedDiceSetIds.filter(e=>t.has(e));r.length>0&&o(r)}},[j,C,a]),r.useEffect(()=>{localStorage.setItem("compareDiceSetIds",JSON.stringify(n))},[n]),r.useEffect(()=>{localStorage.setItem("mobileView",m)},[m]);const ce=r.useMemo(()=>0===n.length?null:a.find(e=>e.id===n[0])||null,[a,n]);r.useEffect(()=>{let t=!0;return(async()=>{try{await async function(){return At.migrateFromLocalStorage()}()&&c({type:"success",text:e("messages:success.migrated")});const a=await async function(){return At.loadDiceSets()}();let r=!1;const n=await Promise.all(a.map(async e=>{const t={targetValue:e.targetValue??1};return void 0===e.numericUid&&(t.numericUid=await It(),r=!0),{...e,...t}}));if(r&&await Mt(n),t){i(n);const e=(()=>{try{const e=localStorage.getItem("compareDiceSetIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}})(),t=e.filter(e=>n.some(t=>t.id===e));t.length>0&&JSON.stringify(t)!==JSON.stringify(e)?o(t):0===t.length&&n.length>0&&0===e.length&&o([n[0].id])}}catch(a){t&&c({type:"error",text:e("messages:error.loadFailed")})}finally{t&&f(!1)}})(),()=>{t=!1}},[e]);const de=r.useCallback(async t=>{if(a.length>=We)return void c({type:"error",text:e("messages:error.diceSetLimitReached",{max:We})});const r={id:gt(),numericUid:await It(),name:t?.name||e("common:unnamed"),diceConfig:t?.diceConfig||{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:t?.trialCount||1,results:[],targetValue:1,createdAt:ut(),updatedAt:ut()};try{await Tt(r),i(e=>[...e,r]),o([r.id]),c({type:"success",text:e("messages:success.diceSetCreated")})}catch{c({type:"error",text:e("messages:error.diceSetCreateFailed")})}},[a.length,e]),ge=r.useCallback(async t=>{try{await Lt(t),i(e=>e.filter(e=>e.id!==t)),o(e=>{const r=e.filter(e=>e!==t);if(0===r.length&&a.length>1){const e=a.find(e=>e.id!==t);return e?[e.id]:[]}return r}),c({type:"success",text:e("messages:success.diceSetDeleted")})}catch{c({type:"error",text:e("messages:error.diceSetDeleteFailed")})}},[a,e]),ue=r.useCallback(async()=>{try{const t=a.map(e=>e.id);await Promise.all(t.map(e=>Lt(e))),i([]),o([]),c({type:"success",text:e("messages:success.bulkDeleted",{count:t.length})})}catch{c({type:"error",text:e("messages:error.bulkDeleteFailed")})}},[a,e]),he=r.useCallback(async t=>{i(t);try{await Mt(t)}catch{c({type:"error",text:e("messages:error.diceSetUpdateFailed")})}},[e]),me=r.useCallback(async t=>{if(a.length>=We)return void c({type:"error",text:e("messages:error.diceSetLimitReached",{max:We})});const r=a.find(e=>e.id===t);if(!r)return;const n={...r,id:gt(),numericUid:await It(),name:r.name,results:[],targetValue:r.targetValue??1,createdAt:ut(),updatedAt:ut()};try{await Tt(n),i(e=>[...e,n]),c({type:"success",text:e("messages:success.diceSetDuplicated")})}catch{c({type:"error",text:e("messages:error.diceSetDuplicateFailed")})}},[a,e]),pe=r.useCallback(async t=>{if(0===t.length)return;const r=e("diceSets:confirm.bulkDeleteWarning",{count:t.length});if(window.confirm(r))try{await Promise.all(t.map(e=>Lt(e))),i(e=>e.filter(e=>!t.includes(e.id))),o(e=>{const r=e.filter(e=>!t.includes(e));if(0===r.length&&a.length>t.length){const e=a.find(e=>!t.includes(e.id));return e?[e.id]:[]}return r}),c({type:"success",text:e("messages:success.bulkDeleted",{count:t.length})})}catch{c({type:"error",text:e("messages:error.bulkDeleteFailed")})}},[a,e]),xe=r.useCallback(async t=>{if(0===t.length)return;const r=We-a.length;if(t.length>r)c({type:"error",text:e("messages:error.bulkDuplicateLimitReached",{count:r})});else try{const r=[];for(const e of t){const t=a.find(t=>t.id===e);if(!t)continue;const i={...t,id:gt(),numericUid:await It(),name:t.name,results:[],targetValue:t.targetValue??1,createdAt:ut(),updatedAt:ut()};await Tt(i),r.push(i)}i(e=>[...e,...r]),c({type:"success",text:e("messages:success.bulkDuplicated",{count:r.length})})}catch{c({type:"error",text:e("messages:error.bulkDuplicateFailed")})}},[a,e]),fe=r.useCallback(async t=>{try{await Tt(t),i(e=>e.map(e=>e.id===t.id?t:e))}catch{c({type:"error",text:e("messages:error.diceSetUpdateFailed")})}},[e]),ye=r.useCallback((t,r)=>{const n=a.find(e=>e.id===t);if(!n)return;const s={...n,...void 0!==r.name&&{name:r.name},...void 0!==r.diceConfig&&{diceConfig:r.diceConfig},...void 0!==r.trialCount&&{trialCount:r.trialCount},updatedAt:ut()};i(e=>e.map(e=>e.id===s.id?s:e)),Tt(s).then(()=>{c({type:"success",text:e("messages:success.diceSetUpdated")})}).catch(t=>{c({type:"error",text:e("messages:error.diceSetUpdateFailed")})})},[a,e]),be=r.useCallback(async()=>{const t="selected"===w?a.filter(e=>n.includes(e.id)):a.filter(e=>e.id===w);if(0===t.length)return!1;const r=[];for(const a of t){const t=Rr(a.diceConfig,a.trialCount);t.length>0&&r.push({diceSetName:a.name,errors:t.map(e=>e.message)}),a.trialCount>rt&&r.push({diceSetName:a.name,errors:[e("messages:error.trialCountExceeded",{max:rt.toLocaleString()})]})}if(r.length>0){const e=r.map(({diceSetName:e,errors:t})=>`${e}: ${t.join(", ")}`).join("\n");return c({type:"error",text:e}),!1}g(!0),h(0);try{const a=t.reduce((e,t)=>e+t.trialCount,0);let r=0;const n=[],o=[];for(const i of t)try{const e=await ct(i.diceConfig,i.trialCount,e=>{const t=i.trialCount*e/100;h((r+t)/a*100)}),t={...i,results:e,resultsConfig:{...i.diceConfig},hasMultipleDiceConfigs:!1,targetValue:i.targetValue,updatedAt:ut()};await Tt(t),n.push(t),r+=i.trialCount}catch(s){const t=s instanceof Error?s.message:e("messages:error.generic");o.push(`${i.name}: ${t}`),r+=i.trialCount}return i(e=>e.map(e=>n.find(t=>t.id===e.id)||e)),o.length>0&&c({type:"warning",text:e("messages:error.partialSuccess",{completed:n.length,failed:o.length,errors:o.join("\n")})}),!0}catch(s){const t=s instanceof Error?s.message:e("messages:error.rollFailed");return c({type:"error",text:t}),!1}finally{g(!1),h(0)}},[a,n,w,e]),ve=r.useCallback(async()=>{const t="selected"===w?a.filter(e=>n.includes(e.id)&&e.results.length>0):a.filter(e=>e.id===w&&e.results.length>0);if(0===t.length)return!1;const r=[];for(const a of t){const t=Rr(a.diceConfig,a.trialCount);t.length>0&&r.push({diceSetName:a.name,errors:t.map(e=>e.message)});a.results.length+a.trialCount>rt&&r.push({diceSetName:a.name,errors:[e("messages:error.maxRecordsExceeded",{max:rt.toLocaleString()})]})}if(r.length>0){const e=r.map(({diceSetName:e,errors:t})=>`${e}: ${t.join(", ")}`).join("\n");return c({type:"error",text:e}),!1}g(!0),h(0);try{const a=t.reduce((e,t)=>e+t.trialCount,0);let r=0;const n=[],o=[];for(const i of t)try{const e=await ct(i.diceConfig,i.trialCount,e=>{const t=i.trialCount*e/100;h((r+t)/a*100)}),t=i.results.length>0?i.results[i.results.length-1].trialNumber+1:1,s=e.map((e,a)=>({...e,trialNumber:t+a})),o=[...i.results,...s],l=i.resultsConfig&&!ht(i.resultsConfig,i.diceConfig),c={...i,results:o,resultsConfig:i.resultsConfig||{...i.diceConfig},hasMultipleDiceConfigs:i.hasMultipleDiceConfigs||l,updatedAt:ut()};await Tt(c),n.push(c),r+=i.trialCount}catch(s){const t=s instanceof Error?s.message:e("messages:error.generic");o.push(`${i.name}: ${t}`),r+=i.trialCount}return i(e=>e.map(e=>n.find(t=>t.id===e.id)||e)),o.length>0&&c({type:"warning",text:e("messages:error.partialSuccess",{completed:n.length,failed:o.length,errors:o.join("\n")})}),!0}catch(s){const t=s instanceof Error?s.message:e("messages:error.rollFailed");return c({type:"error",text:t}),!1}finally{g(!1),h(0)}},[a,n,w,e]),Se=r.useCallback(()=>{if(!ce)return;const t={...ce,results:[],updatedAt:ut()};fe(t),c({type:"info",text:e("messages:info.resetResults")})},[ce,fe,e]),we=r.useCallback(e=>{Y(e)},[]),ke=r.useCallback(async t=>{if(t===Be)throw new Error(e("messages:error.cannotModifyDefault"));const a={};E.resultChart&&(a.resultChart=E.resultChart),E.individualDiceChart&&(a.individualDiceChart=E.individualDiceChart),E.rollProgressChart&&(a.rollProgressChart=E.rollProgressChart),O.resultChartType&&(a.resultChartType=O.resultChartType),O.individualDiceChartType&&(a.individualDiceChartType=O.individualDiceChartType),O.targetValueChartType&&(a.targetValueChartType=O.targetValueChartType),O.rollProgressChartType&&(a.rollProgressChartType=O.rollProgressChartType),O.cumulativeChartType&&(a.cumulativeChartType=O.cumulativeChartType),void 0!==P&&(a.rollProgressMovingAverageWindow=P),void 0!==W.distributionType&&(a.cumulativeDistributionType=W.distributionType),void 0!==W.showOnlyActualData&&(a.cumulativeShowOnlyActualData=W.showOnlyActualData),void 0!==W.quantileCount&&(a.cumulativeQuantileCount=W.quantileCount),B.resultChartXScale&&(a.resultChartXScale=B.resultChartXScale),B.individualDiceChartXScale&&(a.individualDiceChartXScale=B.individualDiceChartXScale),B.rollProgressChartXScale&&(a.rollProgressChartXScale=B.rollProgressChartXScale),B.targetValueChartXScale&&(a.targetValueChartXScale=B.targetValueChartXScale),B.cumulativeChartXScale&&(a.cumulativeChartXScale=B.cumulativeChartXScale),H.resultChartYScale&&(a.resultChartYScale=H.resultChartYScale),H.individualDiceChartYScale&&(a.individualDiceChartYScale=H.individualDiceChartYScale),H.rollProgressChartYScale&&(a.rollProgressChartYScale=H.rollProgressChartYScale),H.targetValueChartYScale&&(a.targetValueChartYScale=H.targetValueChartYScale),H.cumulativeChartYScale&&(a.cumulativeChartYScale=H.cumulativeChartYScale),void 0!==q&&(a.widgets=q),Object.keys(a).length>0&&(await T(t,a),I({}),$({}),F(void 0),V({}),U({}),z({}),Y(void 0),c({type:"success",text:e("messages:success.settingsSaved")}))},[E,O,P,W,B,H,q,T,e]),Ce=r.useCallback(()=>{I({}),$({}),F(void 0),V({}),U({}),z({})},[]),je=r.useMemo(()=>Object.keys(E).length>0||Object.keys(O).length>0||void 0!==P||Object.keys(W).length>0||Object.keys(B).length>0||Object.keys(H).length>0||void 0!==q,[E,O,P,W,B,H,q]),De=r.useCallback(e=>{if(!ce)return;const t={...ce,sortConfig:e,updatedAt:ut()};fe(t)},[ce,fe]),Ne=r.useCallback(e=>{o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),Ae=r.useCallback(()=>{try{!function(e,t){const a=t.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-"));if(0===e.length&&0===a.length)throw new Error("エクスポートするデータがありません");const r={version:"1.0",exportedAt:(new Date).toISOString(),diceSets:e.map(({numericUid:e,...t})=>t),chartSettings:a},i=JSON.stringify(r,null,2),n=new Blob([i],{type:"application/json;charset=utf-8;"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s;const l=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5);o.download=`dice-sim-backup_${l}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}(a,C),c({type:"success",text:e("messages:success.dataExported")})}catch(t){t instanceof Error?c({type:"error",text:t.message}):c({type:"error",text:e("messages:error.exportFailed")})}},[a,C,e]),Te=r.useCallback(async t=>{try{const{diceSets:n,chartSettings:s}=await function(e){return new Promise((t,a)=>{const r=new FileReader;r.onload=e=>{try{const r=e.target?.result;let i=JSON.parse(r);if(i.sessions&&!i.diceSets&&(i={...i,diceSets:i.sessions},delete i.sessions),i.version&&i.diceSets&&i.chartSettings){if(!Array.isArray(i.diceSets))return void a(new Error("バックアップファイルの形式が正しくありません（diceSetsが配列である必要があります）"));if(!Array.isArray(i.chartSettings))return void a(new Error("バックアップファイルの形式が正しくありません（chartSettingsが配列である必要があります）"));if(i.diceSets.length>We)return void a(new Error("ダイスセットの数が上限（20件）を超えています。不正なデータの可能性があります。"));const e=i.diceSets.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const a=e;if(!a.id||"string"!=typeof a.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(void 0===a.name||null===a.name||"string"!=typeof a.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(a.name.length>it)throw new Error(`ダイスセット${t+1}: 名前が長すぎます（最大128文字）`);if(dr(a.diceConfig,t),"number"!=typeof a.trialCount||a.trialCount<1||a.trialCount>at)throw new Error(`ダイスセット${t+1}: 試行回数が不正です`);if(!Array.isArray(a.results))throw new Error(`ダイスセット${t+1}: 結果が不正です`);if(!cr(a.createdAt))throw new Error(`ダイスセット${t+1}: 作成日時が不正です`);if(!cr(a.updatedAt))throw new Error(`ダイスセット${t+1}: 更新日時が不正です`);return{id:a.id,name:a.name,diceConfig:a.diceConfig,trialCount:a.trialCount,results:a.results,resultsConfig:a.resultsConfig,hasMultipleDiceConfigs:a.hasMultipleDiceConfigs||!1,aggregationSettings:a.aggregationSettings,targetValue:"number"==typeof a.targetValue?a.targetValue:1,resultsTargetValue:a.resultsTargetValue,createdAt:a.createdAt,updatedAt:a.updatedAt,sortOrder:a.sortOrder}}),r=i.chartSettings.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`ウィジェットセット設定${t+1}: データが不正です`);const a=e;if(!a.id||"string"!=typeof a.id)throw new Error(`ウィジェットセット設定${t+1}: IDが不正です`);if(!a.name||"string"!=typeof a.name)throw new Error(`ウィジェットセット設定${t+1}: 名前が不正です`);if(a.name.length>it)throw new Error(`ウィジェットセット設定${t+1}: 名前が長すぎます`);if(!cr(a.createdAt))throw new Error(`ウィジェットセット設定${t+1}: 作成日時が不正です`);if(!cr(a.updatedAt))throw new Error(`ウィジェットセット設定${t+1}: 更新日時が不正です`);return{id:a.id,name:a.name,resultChart:a.resultChart,individualDiceChart:a.individualDiceChart,rollProgressChart:a.rollProgressChart,resultChartType:a.resultChartType,individualDiceChartType:a.individualDiceChartType,targetValueChartType:a.targetValueChartType,rollProgressMovingAverageWindow:a.rollProgressMovingAverageWindow,cumulativeDistributionType:a.cumulativeDistributionType,cumulativeShowOnlyActualData:a.cumulativeShowOnlyActualData,cumulativeQuantileCount:a.cumulativeQuantileCount,createdAt:a.createdAt,updatedAt:a.updatedAt,sortOrder:a.sortOrder}});t({diceSets:e,chartSettings:r})}else if(Array.isArray(i)){const e=i.map((e,t)=>{if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const a=e;if(!a.id||"string"!=typeof a.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(void 0===a.name||null===a.name||"string"!=typeof a.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(a.name.length>it)throw new Error(`ダイスセット${t+1}: 名前が長すぎます`);if(dr(a.diceConfig,t),"number"!=typeof a.trialCount||a.trialCount<1||a.trialCount>at)throw new Error(`ダイスセット${t+1}: 試行回数が不正です`);if(!Array.isArray(a.results))throw new Error(`ダイスセット${t+1}: 結果が不正です`);if(!cr(a.createdAt))throw new Error(`ダイスセット${t+1}: 作成日時が不正です`);if(!cr(a.updatedAt))throw new Error(`ダイスセット${t+1}: 更新日時が不正です`);return{id:a.id,name:a.name,diceConfig:a.diceConfig,trialCount:a.trialCount,results:a.results,resultsConfig:a.resultsConfig,hasMultipleDiceConfigs:a.hasMultipleDiceConfigs||!1,aggregationSettings:a.aggregationSettings,targetValue:"number"==typeof a.targetValue?a.targetValue:1,resultsTargetValue:a.resultsTargetValue,createdAt:a.createdAt,updatedAt:a.updatedAt,sortOrder:a.sortOrder}});t({diceSets:e,chartSettings:[]})}else a(new Error("ファイル形式が正しくありません"))}catch(r){r instanceof Error?a(r):a(new Error("ファイルのパースに失敗しました"))}},r.onerror=()=>{a(new Error("ファイルの読み込みに失敗しました"))},r.readAsText(e)})}(t);let o=0;if(n.length>0){const e=new Set(a.map(e=>e.id)),t=n.map(t=>e.has(t.id)?{...t,id:gt(),name:`${t.name}（インポート）`,createdAt:ut(),updatedAt:ut()}:t);for(const a of t)await Tt(a);i(e=>[...e,...t]),o+=t.length}if(s.length>0){const e=new Set(C.map(e=>e.id));let t=0;for(const a of s)if(!e.has(a.id))try{await N(a.name,a),t++}catch(r){}t>0&&(o+=t)}if(0===o)return void c({type:"warning",text:e("messages:warning.noImportableData")});const l=[];n.length>0&&l.push(e("messages:import.diceSetsCount",{count:n.length})),s.length>0&&l.push(e("messages:import.chartSettingsCount",{count:s.length})),c({type:"success",text:e("messages:import.successWithDetails",{details:l.join(e("common:punctuation.comma"))})})}catch(n){n instanceof Error?c({type:"error",text:n.message}):c({type:"error",text:e("messages:error.importFailed")})}},[a,C,N,e]);return s.jsx(Ja,{children:s.jsxs("div",{className:"min-h-screen flex flex-col bg-white dark:bg-gray-800 lg:bg-gray-50 lg:dark:bg-gray-900 pb-16 lg:pb-0",children:[s.jsx(Bt,{darkMode:Z,onToggleDarkMode:se,diceSetName:ce?.name,isMobileView:X&&"diceSets"!==m,showDiceSetName:X&&"results"===m,onBackToDiceSets:()=>p("diceSets"),onAboutClick:()=>re(!0),onChangelogClick:()=>ne(!0),themeMode:J,onChangeThemeMode:oe,transparentExport:ee,onChangeTransparentExport:le,onExportData:Ae,onImportData:Te,diceSetsCount:a.length,chartSettingsCount:C.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-")).length}),x?s.jsx("div",{className:"w-100 lg:container lg:mx-auto mt-4 lg:mt-0 lg:px-4 pb-20 pt-12 lg:pb-6 lg:pt-20 flex-grow",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:e("common:label.loading")})})}):s.jsxs("div",{className:"w-100 lg:container lg:mx-auto mt-4 lg:mt-0 lg:px-4 pb-20 pt-12 lg:pb-6 lg:pt-20 flex-grow",children:[s.jsx(Pa,{message:l,onClose:()=>c(null)}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 xl:grid-cols-11 2xl:grid-cols-12 gap-6",children:[s.jsx("div",{className:"hidden lg:block lg:col-span-4 xl:col-span-3 2xl:col-span-3",children:s.jsx(pi,{diceSets:a,compareDiceSetIds:n,onToggleCompareDiceSet:Ne,onCreateDiceSet:de,onDuplicateDiceSet:me,onDeleteDiceSet:ge,onDeleteAllDiceSets:ue,onBulkDeleteDiceSets:pe,onBulkDuplicateDiceSets:xe,onReorderDiceSets:he,onExportDiceSets:Ae,onImportDiceSets:Te,onUpdateDiceSet:ye})}),s.jsx("div",{className:"lg:col-span-8 xl:col-span-8 2xl:col-span-9",children:ce?s.jsx(s.Fragment,{children:s.jsx("div",{className:"results"!==m?"hidden lg:block":"",children:s.jsx(ki,{diceSet:ce,diceSets:a,compareDiceSetIds:n,onResetResults:Se,onReroll:be,onAddRoll:ve,isSimulating:d,simulationProgress:u,onSortConfigChange:De,selectedDiceSetIds:n,targetDiceSetType:w,onTargetDiceSetTypeChange:k,chartSettings:C,currentChartSettingsId:j,onSelectChartSettings:e=>{D(e),I({}),$({}),F(void 0),V({}),U({}),z({}),Y(void 0)},onManageChartSettings:()=>{b(!0)},onCreateChartSettings:()=>{b(!0)},onCreateNewSettings:async(t,a)=>{if(a&&Object.keys(a).length>0){return void(await N(t,a)&&c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})}))}const r=C.find(e=>e.id===j),i={};r&&(i.resultChart=r.resultChart,i.individualDiceChart=r.individualDiceChart,i.rollProgressChart=r.rollProgressChart,i.resultChartType=r.resultChartType,i.individualDiceChartType=r.individualDiceChartType,i.targetValueChartType=r.targetValueChartType,i.rollProgressMovingAverageWindow=r.rollProgressMovingAverageWindow,i.cumulativeDistributionType=r.cumulativeDistributionType,i.cumulativeShowOnlyActualData=r.cumulativeShowOnlyActualData,i.cumulativeQuantileCount=r.cumulativeQuantileCount),E.resultChart&&(i.resultChart=E.resultChart),E.individualDiceChart&&(i.individualDiceChart=E.individualDiceChart),E.rollProgressChart&&(i.rollProgressChart=E.rollProgressChart),O.resultChartType&&(i.resultChartType=O.resultChartType),O.individualDiceChartType&&(i.individualDiceChartType=O.individualDiceChartType),O.targetValueChartType&&(i.targetValueChartType=O.targetValueChartType),void 0!==P&&(i.rollProgressMovingAverageWindow=P),void 0!==W.distributionType&&(i.cumulativeDistributionType=W.distributionType),void 0!==W.showOnlyActualData&&(i.cumulativeShowOnlyActualData=W.showOnlyActualData),void 0!==W.quantileCount&&(i.cumulativeQuantileCount=W.quantileCount);await N(t,Object.keys(i).length>0?i:void 0)&&(I({}),$({}),F(void 0),V({}),Y(void 0)),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})})},onSaveChartSettings:ke,onUpdateChartSettings:async(t,a)=>{await T(t,a),c({type:"success",text:e("messages:success.settingsUpdated")})},hasPendingChanges:je,onWidgetsChange:we,onShowCompareModal:()=>S(!0)})})}):s.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-12 text-center transition-colors",children:[s.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-lg mb-6",children:e("diceSets:selectOrCreatePrompt")}),X&&s.jsxs("button",{onClick:()=>S(!0),className:"px-6 py-3 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors inline-flex items-center gap-2",children:[s.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),s.jsx("span",{children:e("diceSets:action.selectDiceSet")})]})]})})]})]}),s.jsx($a,{onReroll:async()=>{await be()&&p("results")},onAddRoll:async()=>{await ve()&&p("results")},isSimulating:d,hasResults:!!ce?.results.length&&ce.results.length>0,isAddRollDisabled:!1,diceSets:a,selectedDiceSetIds:n,targetDiceSetType:w,onTargetDiceSetTypeChange:k,onOpenDiceSetList:()=>S(!0),themeMode:J,onChangeThemeMode:oe,transparentExport:ee,onChangeTransparentExport:le,onExportData:Ae,onImportData:Te,diceSetsCount:a.length,chartSettingsCount:C.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-")).length,onAboutClick:()=>re(!0),onChangelogClick:()=>ne(!0)}),!X&&s.jsx(Ut,{}),ae&&s.jsx(r.Suspense,{fallback:s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsx("div",{className:"text-white",children:"読み込み中..."})}),children:s.jsx(Ci,{onClose:()=>re(!1)})}),ie&&s.jsx(r.Suspense,{fallback:s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsx("div",{className:"text-white",children:"読み込み中..."})}),children:s.jsx(ji,{onClose:()=>ne(!1)})}),y&&s.jsx(Hr,{chartSettings:C,currentSettingsId:j,diceSets:a,compareDiceSetIds:n,onCreateSettings:async t=>{const a={};E.resultChart&&(a.resultChart=E.resultChart),E.individualDiceChart&&(a.individualDiceChart=E.individualDiceChart),O.resultChartType&&(a.resultChartType=O.resultChartType),O.individualDiceChartType&&(a.individualDiceChartType=O.individualDiceChartType),O.targetValueChartType&&(a.targetValueChartType=O.targetValueChartType);await N(t,Object.keys(a).length>0?a:void 0)&&(I({}),$({})),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})})},onCreateSettingsWithConfig:async(t,a)=>{await N(t,a)&&(I({}),$({}),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})}))},onDuplicateSettings:async(t,a)=>{const r=await A(t,a);r&&c({type:"success",text:e("messages:success.settingsDuplicatedWithName",{name:r.name})})},onDuplicateSettingsWithConfig:async(t,a,r)=>{const i=C.find(e=>e.id===t);if(!i)return;const n={...i,...r,name:a};await N(a,n)&&c({type:"success",text:e("messages:success.settingsDuplicatedWithName",{name:a})})},onRenameSettings:async(t,a)=>{await L(t,a),c({type:"success",text:e("messages:success.settingsRenamed")})},onUpdateSettings:async(t,a)=>{await T(t,a),c({type:"success",text:e("messages:success.settingsUpdated")})},onDeleteSettings:async t=>{await M(t),c({type:"success",text:e("messages:success.settingsDeleted")})},onClose:()=>{b(!1)},hasUnsavedChanges:Object.keys(E).length>0||Object.keys(O).length>0,onSaveToSettings:ke,onDiscardChanges:Ce,onReorderSettings:R}),v&&s.jsx(di,{diceSets:a,selectedDiceSetIds:n,onToggleDiceSet:Ne,onApply:e=>{n.forEach(t=>{e.includes(t)||Ne(t)}),e.forEach(e=>{n.includes(e)||Ne(e)})},onClose:()=>S(!1),onDuplicateDiceSet:me,onDeleteDiceSet:ge,onBulkDeleteDiceSets:pe,onBulkDuplicateDiceSets:xe,onUpdateDiceSet:ye,onReorderDiceSets:he,onExportDiceSets:Ae,onImportDiceSets:Te,onCreateDiceSet:de,onDeleteAllDiceSets:ue})]})})}d.register(g,u,h,m,p,x,f,y,b,v),C.createRoot(document.getElementById("root")).render(s.jsx(n.StrictMode,{children:s.jsx(Di,{})}));export{li as C,ci as D,lt as I,Ka as M,ui as S,ar as T,Qa as a,Ga as b,Za as c,ri as d,Ot as e,La as f,di as g,Pt as s,Fe as u};
