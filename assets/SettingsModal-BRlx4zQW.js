import{a as e,j as a}from"./chart-js-B92AkZbw.js";import{u as t,I as s,s as r,f as n,c as d}from"./index-DzjJWMpI.js";import"./vendor-CcyvE6mB.js";const i=[{code:"ja",label:"日本語",badge:"JA"},{code:"en",label:"English",badge:"EN"}],l=({isOpen:l,onClose:o,darkMode:g,onChangeDarkMode:c,onExportData:x,onImportData:m,sessionsCount:h,chartSettingsCount:b,onAboutClick:y})=>{const{t:p,i18n:u}=t(["settings","common"]),[k,j]=e.useState(!1),[f,w]=e.useState(!1),N=e.useRef(null);if(!l)return null;return a.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-black/50",onClick:o,children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4 flex justify-between items-center",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:p("settings:title")}),a.jsx("button",{onClick:o,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors text-gray-800 dark:text-gray-200","aria-label":p("settings:close"),children:a.jsx(s,{name:"close"})})]}),a.jsxs("div",{className:"px-6 py-4",children:[a.jsxs("section",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:"w-1 h-6 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:p("settings:appearance.title")})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[a.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-2",children:p("settings:appearance.theme.title")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:p("settings:appearance.theme.description")}),a.jsxs("div",{className:"inline-flex rounded-lg bg-gray-200 dark:bg-gray-800 p-1 w-full",children:[a.jsxs("button",{onClick:()=>c("light"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md font-medium transition-all "+("light"===g?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[a.jsx(s,{name:"sun",className:"w-5 h-5"}),a.jsx("span",{className:"hidden sm:inline",children:p("settings:appearance.theme.light")})]}),a.jsxs("button",{onClick:()=>c("dark"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md font-medium transition-all "+("dark"===g?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[a.jsx(s,{name:"moon",className:"w-5 h-5"}),a.jsx("span",{className:"hidden sm:inline",children:p("settings:appearance.theme.dark")})]}),a.jsxs("button",{onClick:()=>c("system"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md font-medium transition-all "+("system"===g?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[a.jsx(s,{name:"settings",className:"w-5 h-5"}),a.jsx("span",{className:"hidden sm:inline",children:p("settings:appearance.theme.system")})]})]})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700 mt-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-2",children:p("settings:appearance.language.title")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:p("settings:appearance.language.description")}),a.jsx("div",{className:"inline-flex rounded-lg bg-gray-200 dark:bg-gray-800 p-1 w-full",children:i.map(e=>a.jsxs("button",{onClick:()=>{u.language!==e.code&&(u.changeLanguage(e.code),r(e.code))},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 rounded-md font-medium transition-all "+(u.language===e.code?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[a.jsx("span",{className:"font-bold text-xs px-1.5 py-0.5 rounded bg-gray-300 dark:bg-gray-600",children:e.badge}),a.jsx("span",{children:e.label})]},e.code))})]})]}),a.jsxs("section",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:"w-1 h-6 bg-gray-400 dark:bg-gray-500 rounded-full"}),a.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-white",children:p("settings:dataManagement.title")})]}),a.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-700 mb-4",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(s,{name:"info",className:"w-5 h-5 text-gray-600 dark:text-gray-400 flex-shrink-0 mt-0.5"}),a.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[a.jsx("p",{className:"font-medium mb-1",children:p("settings:dataManagement.currentData.title")}),a.jsx("p",{children:p("settings:dataManagement.currentData.diceSets").replace("{{count}}",n(h))}),a.jsx("p",{children:p("settings:dataManagement.currentData.chartSettings").replace("{{count}}",n(b))})]})]})}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700 mb-4",children:[a.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-2",children:p("settings:dataManagement.backup.title")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:p("settings:dataManagement.backup.description")}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("button",{onClick:x,disabled:0===h,className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-800 dark:bg-gray-600 dark:hover:bg-gray-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[a.jsx(s,{name:"download",className:"w-4 h-4"}),p("settings:dataManagement.backup.export")]}),a.jsxs("button",{onClick:()=>{N.current?.click()},className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-800 dark:bg-gray-600 dark:hover:bg-gray-700 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2",children:[a.jsx(s,{name:"upload",className:"w-4 h-4"}),p("settings:dataManagement.backup.import")]}),a.jsx("input",{ref:N,type:"file",accept:".json",onChange:e=>{const a=e.target.files?.[0];a&&(m(a),N.current&&(N.current.value=""))},className:"hidden"})]})]}),a.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[a.jsx("h4",{className:"font-semibold text-gray-800 dark:text-white mb-2",children:p("settings:dataManagement.reset.title")}),a.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:p("settings:dataManagement.reset.description")}),k?a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400",children:p("settings:dataManagement.reset.confirm")}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:async()=>{w(!0);try{if(await d(),await new Promise((e,a)=>{const t=indexedDB.deleteDatabase("DiceSimulatorDB");t.onsuccess=()=>{e()},t.onerror=()=>{a(new Error(p("settings:system.resetError")))},t.onblocked=()=>{setTimeout(()=>e(),1e3)}}),localStorage.clear(),sessionStorage.clear(),"caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}window.location.reload()}catch(e){setTimeout(()=>{window.location.reload()},500)}},className:"flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:f,children:f?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx(s,{name:"spinner",className:"w-4 h-4 animate-spin"}),p("settings:dataManagement.reset.processing")]}):p("settings:dataManagement.reset.confirmButton")}),a.jsx("button",{onClick:()=>j(!1),className:"flex-1 px-4 py-2 bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-medium rounded-lg transition-colors",disabled:f,children:p("settings:dataManagement.reset.cancel")})]})]}):a.jsx("button",{onClick:()=>j(!0),className:"w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:f,children:p("settings:dataManagement.reset.button")})]})]}),y&&a.jsx("section",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:a.jsxs("button",{onClick:()=>{y(),o()},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center justify-between group",children:[a.jsx("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-300",children:p("about:sections.app.title")}),a.jsx(s,{name:"chevron-right",className:"w-5 h-5 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors"})]})})]})]})})};export{l as SettingsModal};
