const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HelpModal-DfWSJ1mF.js","assets/chart-js-B92AkZbw.js","assets/vendor-CcyvE6mB.js","assets/SettingsModal-BRlx4zQW.js","assets/AboutPage-eriucDfn.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,a)=>((t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a)(t,"symbol"!=typeof r?r+"":r,a);import{g as r,a,r as s,R as n,j as i,B as o,L as l,C as c,b as d,c as g,d as u,e as h,f as p,P as m,p as f,h as x,i as b,k as y,l as v}from"./chart-js-B92AkZbw.js";import{r as k}from"./vendor-CcyvE6mB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var w,C={};const S=r(function(){if(w)return C;w=1;var e=k();return C.createRoot=e.createRoot,C.hydrateRoot=e.hydrateRoot,C}()),j={},N=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),s=r?.nonce||r?.getAttribute("nonce");a=e(t.map(e=>{if((e=function(e){return"/dice/"+e}(e))in j)return;j[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})},D=e=>"string"==typeof e,L=()=>{let e,t;const r=new Promise((r,a)=>{e=r,t=a});return r.resolve=e,r.reject=t,r},A=e=>null==e?"":""+e,M=/###/g,E=e=>e&&e.indexOf("###")>-1?e.replace(M,"."):e,R=e=>!e||D(e),T=(e,t,r)=>{const a=D(t)?t.split("."):t;let s=0;for(;s<a.length-1;){if(R(e))return{};const t=E(a[s]);!e[t]&&r&&(e[t]=new r),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++s}return R(e)?{}:{obj:e,k:E(a[s])}},O=(e,t,r)=>{const{obj:a,k:s}=T(e,t,Object);if(void 0!==a||1===t.length)return void(a[s]=r);let n=t[t.length-1],i=t.slice(0,t.length-1),o=T(e,i,Object);for(;void 0===o.obj&&i.length;)n=`${i[i.length-1]}.${n}`,i=i.slice(0,i.length-1),o=T(e,i,Object),o?.obj&&void 0!==o.obj[`${o.k}.${n}`]&&(o.obj=void 0);o.obj[`${o.k}.${n}`]=r},I=(e,t)=>{const{obj:r,k:a}=T(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,a))return r[a]},P=(e,t,r)=>{for(const a in t)"__proto__"!==a&&"constructor"!==a&&(a in e?D(e[a])||e[a]instanceof String||D(t[a])||t[a]instanceof String?r&&(e[a]=t[a]):P(e[a],t[a],r):e[a]=t[a]);return e},$=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const V=e=>D(e)?e.replace(/[&<>"'\/]/g,e=>F[e]):e;const B=[" ",",","?","!",";"],W=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}(20),U=(e,t,r=".")=>{if(!e)return;if(e[t]){if(!Object.prototype.hasOwnProperty.call(e,t))return;return e[t]}const a=t.split(r);let s=e;for(let n=0;n<a.length;){if(!s||"object"!=typeof s)return;let e,t="";for(let i=n;i<a.length;++i)if(i!==n&&(t+=r),t+=a[i],e=s[t],void 0!==e){if(["string","number","boolean"].indexOf(typeof e)>-1&&i<a.length-1)continue;n+=i-n+1;break}s=e}return s},z=e=>e?.replace("_","-"),H={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){}};class q{constructor(e,t={}){this.init(e,t)}init(e,t={}){this.prefix=t.prefix||"i18next:",this.logger=e||H,this.options=t,this.debug=t.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,a){return a&&!this.debug?null:(D(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new q(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new q(this.logger,e)}}var _=new q;class J{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(e=>{this.observers[e]||(this.observers[e]=new Map);const r=this.observers[e].get(t)||0;this.observers[e].set(t,r+1)}),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e,...t){if(this.observers[e]){Array.from(this.observers[e].entries()).forEach(([e,r])=>{for(let a=0;a<r;a++)e(...t)})}if(this.observers["*"]){Array.from(this.observers["*"].entries()).forEach(([r,a])=>{for(let s=0;s<a;s++)r.apply(r,[e,...t])})}}}class K extends J{constructor(e,t={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r,a={}){const s=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,n=void 0!==a.ignoreJSONStructure?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;e.indexOf(".")>-1?i=e.split("."):(i=[e,t],r&&(Array.isArray(r)?i.push(...r):D(r)&&s?i.push(...r.split(s)):i.push(r)));const o=I(this.data,i);return!o&&!t&&!r&&e.indexOf(".")>-1&&(e=i[0],t=i[1],r=i.slice(2).join(".")),!o&&n&&D(r)?U(this.data?.[e]?.[t],r,s):o}addResource(e,t,r,a,s={silent:!1}){const n=void 0!==s.keySeparator?s.keySeparator:this.options.keySeparator;let i=[e,t];r&&(i=i.concat(n?r.split(n):r)),e.indexOf(".")>-1&&(i=e.split("."),a=t,t=i[1]),this.addNamespaces(t),O(this.data,i,a),s.silent||this.emit("added",e,t,r,a)}addResources(e,t,r,a={silent:!1}){for(const s in r)(D(r[s])||Array.isArray(r[s]))&&this.addResource(e,t,s,r[s],{silent:!0});a.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,a,s,n={silent:!1,skipCopy:!1}){let i=[e,t];e.indexOf(".")>-1&&(i=e.split("."),a=r,r=t,t=i[1]),this.addNamespaces(t);let o=I(this.data,i)||{};n.skipCopy||(r=JSON.parse(JSON.stringify(r))),a?P(o,r,s):o={...o,...r},O(this.data,i,o),n.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(e=>t[e]&&Object.keys(t[e]).length>0)}toJSON(){return this.data}}var G={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,a,s){return e.forEach(e=>{t=this.processors[e]?.process(t,r,a,s)??t}),t}};const Y=Symbol("i18next/PATH_KEY");function Q(e,t){const{[Y]:r}=e(function(){const e=[],t=Object.create(null);let r;return t.get=(a,s)=>(r?.revoke?.(),s===Y?e:(e.push(s),r=Proxy.revocable(a,t),r.proxy)),Proxy.revocable(Object.create(null),t).proxy}());return r.join(t?.keySeparator??".")}const Z={},X=e=>!D(e)&&"boolean"!=typeof e&&"number"!=typeof e;class ee extends J{constructor(e,t={}){var r,a;super(),r=e,a=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach(e=>{r[e]&&(a[e]=r[e])}),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=_.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,t={interpolation:{}}){const r={...t};if(null==e)return!1;const a=this.resolve(e,r);if(void 0===a?.res)return!1;const s=X(a.res);return!1!==r.returnObjects||!s}extractFromKey(e,t){let r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");const a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let s=t.ns||this.options.defaultNS||[];const n=r&&e.indexOf(r)>-1,i=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||((e,t,r)=>{t=t||"",r=r||"";const a=B.filter(e=>t.indexOf(e)<0&&r.indexOf(e)<0);if(0===a.length)return!0;const s=W.getRegExp(`(${a.map(e=>"?"===e?"\\?":e).join("|")})`);let n=!s.test(e);if(!n){const t=e.indexOf(r);t>0&&!s.test(e.substring(0,t))&&(n=!0)}return n})(e,r,a));if(n&&!i){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:D(s)?[s]:s};const n=e.split(r);(r!==a||r===a&&this.options.ns.indexOf(n[0])>-1)&&(s=n.shift()),e=n.join(a)}return{key:e,namespaces:D(s)?[s]:s}}translate(e,t,r){let a="object"==typeof t?{...t}:t;if("object"!=typeof a&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof a&&(a={...a}),a||(a={}),null==e)return"";"function"==typeof e&&(e=Q(e,{...this.options,...a})),Array.isArray(e)||(e=[String(e)]);const s=void 0!==a.returnDetails?a.returnDetails:this.options.returnDetails,n=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,{key:i,namespaces:o}=this.extractFromKey(e[e.length-1],a),l=o[o.length-1];let c=void 0!==a.nsSeparator?a.nsSeparator:this.options.nsSeparator;void 0===c&&(c=":");const d=a.lng||this.language,g=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if("cimode"===d?.toLowerCase())return g?s?{res:`${l}${c}${i}`,usedKey:i,exactUsedKey:i,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(a)}:`${l}${c}${i}`:s?{res:i,usedKey:i,exactUsedKey:i,usedLng:d,usedNS:l,usedParams:this.getUsedParamsDetails(a)}:i;const u=this.resolve(e,a);let h=u?.res;const p=u?.usedKey||i,m=u?.exactUsedKey||i,f=void 0!==a.joinArrays?a.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject,b=void 0!==a.count&&!D(a.count),y=ee.hasDefaultValue(a),v=b?this.pluralResolver.getSuffix(d,a.count,a):"",k=a.ordinal&&b?this.pluralResolver.getSuffix(d,a.count,{ordinal:!1}):"",w=b&&!a.ordinal&&0===a.count,C=w&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${v}`]||a[`defaultValue${k}`]||a.defaultValue;let S=h;x&&!h&&y&&(S=C);const j=X(S),N=Object.prototype.toString.apply(S);if(!(x&&S&&j&&["[object Number]","[object Function]","[object RegExp]"].indexOf(N)<0)||D(f)&&Array.isArray(S))if(x&&D(f)&&Array.isArray(h))h=h.join(f),h&&(h=this.extendTranslation(h,e,a,r));else{let t=!1,s=!1;!this.isValidLookup(h)&&y&&(t=!0,h=C),this.isValidLookup(h)||(s=!0,h=i);const o=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&s?void 0:h,g=y&&C!==h&&this.options.updateMissing;if(s||t||g){if(this.logger.log(g?"updateKey":"missingKey",d,l,i,g?C:h),n){const e=this.resolve(i,{...a,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const t=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if("fallback"===this.options.saveMissingTo&&t&&t[0])for(let a=0;a<t.length;a++)e.push(t[a]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(a.lng||this.language):e.push(a.lng||this.language);const r=(e,t,r)=>{const s=y&&r!==h?r:o;this.options.missingKeyHandler?this.options.missingKeyHandler(e,l,t,s,g,a):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(e,l,t,s,g,a),this.emit("missingKey",e,l,t,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&b?e.forEach(e=>{const t=this.pluralResolver.getSuffixes(e,a);w&&a[`defaultValue${this.options.pluralSeparator}zero`]&&t.indexOf(`${this.options.pluralSeparator}zero`)<0&&t.push(`${this.options.pluralSeparator}zero`),t.forEach(t=>{r([e],i+t,a[`defaultValue${t}`]||C)})}):r(e,i,C))}h=this.extendTranslation(h,e,a,u,r),s&&h===i&&this.options.appendNamespaceToMissingKey&&(h=`${l}${c}${i}`),(s||t)&&this.options.parseMissingKeyHandler&&(h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${c}${i}`:i,t?h:void 0,a))}else{if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(p,S,{...a,ns:o}):`key '${i} (${this.language})' returned an object instead of string.`;return s?(u.res=e,u.usedParams=this.getUsedParamsDetails(a),u):e}if(n){const e=Array.isArray(S),t=e?[]:{},r=e?m:p;for(const s in S)if(Object.prototype.hasOwnProperty.call(S,s)){const e=`${r}${n}${s}`;t[s]=y&&!h?this.translate(e,{...a,defaultValue:X(C)?C[s]:void 0,joinArrays:!1,ns:o}):this.translate(e,{...a,joinArrays:!1,ns:o}),t[s]===e&&(t[s]=S[s])}h=t}}return s?(u.res=h,u.usedParams=this.getUsedParamsDetails(a),u):h}extendTranslation(e,t,r,a,s){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const n=D(e)&&(void 0!==r?.interpolation?.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let i;if(n){const t=e.match(this.interpolator.nestingRegexp);i=t&&t.length}let o=r.replace&&!D(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),e=this.interpolator.interpolate(e,o,r.lng||this.language||a.usedLng,r),n){const t=e.match(this.interpolator.nestingRegexp);i<(t&&t.length)&&(r.nest=!1)}!r.lng&&a&&a.res&&(r.lng=this.language||a.usedLng),!1!==r.nest&&(e=this.interpolator.nest(e,(...e)=>s?.[0]!==e[0]||r.context?this.translate(...e,t):(this.logger.warn(`It seems you are nesting recursively key: ${e[0]} in key: ${t[0]}`),null),r)),r.interpolation&&this.interpolator.reset()}const n=r.postProcess||this.options.postProcess,i=D(n)?[n]:n;return null!=e&&i?.length&&!1!==r.applyPostProcessor&&(e=G.handle(i,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,t={}){let r,a,s,n,i;return D(e)&&(e=[e]),e.forEach(e=>{if(this.isValidLookup(r))return;const o=this.extractFromKey(e,t),l=o.key;a=l;let c=o.namespaces;this.options.fallbackNS&&(c=c.concat(this.options.fallbackNS));const d=void 0!==t.count&&!D(t.count),g=d&&!t.ordinal&&0===t.count,u=void 0!==t.context&&(D(t.context)||"number"==typeof t.context)&&""!==t.context,h=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);c.forEach(e=>{this.isValidLookup(r)||(i=e,Z[`${h[0]}-${e}`]||!this.utils?.hasLoadedNamespace||this.utils?.hasLoadedNamespace(i)||(Z[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${a}" for languages "${h.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach(a=>{if(this.isValidLookup(r))return;n=a;const i=[l];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(i,l,a,e,t);else{let e;d&&(e=this.pluralResolver.getSuffix(a,t.count,t));const r=`${this.options.pluralSeparator}zero`,s=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(t.ordinal&&0===e.indexOf(s)&&i.push(l+e.replace(s,this.options.pluralSeparator)),i.push(l+e),g&&i.push(l+r)),u){const a=`${l}${this.options.contextSeparator||"_"}${t.context}`;i.push(a),d&&(t.ordinal&&0===e.indexOf(s)&&i.push(a+e.replace(s,this.options.pluralSeparator)),i.push(a+e),g&&i.push(a+r))}}let o;for(;o=i.pop();)this.isValidLookup(r)||(s=o,r=this.getResource(a,e,o,t))}))})}),{res:r,usedKey:a,exactUsedKey:s,usedLng:n,usedNS:i}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,r,a={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,t,r,a):this.resourceStore.getResource(e,t,r,a)}getUsedParamsDetails(e={}){const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!D(e.replace);let a=r?e.replace:e;if(r&&void 0!==e.count&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!r){a={...a};for(const e of t)delete a[e]}return a}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,12)&&void 0!==e[r])return!0;return!1}}class te{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=_.create("languageUtils")}getScriptPartFromCode(e){if(!(e=z(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=z(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(D(e)&&e.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(e)[0]}catch(t){}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(e=>{if(t)return;const r=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(r)||(t=r)}),!t&&this.options.supportedLngs&&e.forEach(e=>{if(t)return;const r=this.getScriptPartFromCode(e);if(this.isSupportedCode(r))return t=r;const a=this.getLanguagePartFromCode(e);if(this.isSupportedCode(a))return t=a;t=this.options.supportedLngs.find(e=>e===a?e:e.indexOf("-")<0&&a.indexOf("-")<0?void 0:e.indexOf("-")>0&&a.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===a||0===e.indexOf(a)&&a.length>1?e:void 0)}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),D(e)&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes((!1===t?[]:t)||this.options.fallbackLng||[],e),a=[],s=e=>{e&&(this.isSupportedCode(e)?a.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return D(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):D(e)&&s(this.formatLanguageCode(e)),r.forEach(e=>{a.indexOf(e)<0&&s(this.formatLanguageCode(e))}),a}}const re={zero:0,one:1,two:2,few:3,many:4,other:5},ae={select:e=>1===e?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class se{constructor(e,t={}){this.languageUtils=e,this.options=t,this.logger=_.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e,t={}){const r=z("dev"===e?"en":e),a=t.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:a});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let n;try{n=new Intl.PluralRules(r,{type:a})}catch(i){if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),ae;if(!e.match(/-|_/))return ae;const r=this.languageUtils.getLanguagePartFromCode(e);n=this.getRule(r,t)}return this.pluralRulesCache[s]=n,n}needsPlural(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,t,r={}){return this.getSuffixes(e,r).map(e=>`${t}${e}`)}getSuffixes(e,t={}){let r=this.getRule(e,t);return r||(r=this.getRule("dev",t)),r?r.resolvedOptions().pluralCategories.sort((e,t)=>re[e]-re[t]).map(e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`):[]}getSuffix(e,t,r={}){const a=this.getRule(e,r);return a?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",t,r))}}const ne=(e,t,r,a=".",s=!0)=>{let n=((e,t,r)=>{const a=I(e,r);return void 0!==a?a:I(t,r)})(e,t,r);return!n&&s&&D(r)&&(n=U(e,r,a),void 0===n&&(n=U(t,r,a))),n},ie=e=>e.replace(/\$/g,"$$$$");class oe{constructor(e={}){this.logger=_.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(e=>e),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:a,prefix:s,prefixEscaped:n,suffix:i,suffixEscaped:o,formatSeparator:l,unescapeSuffix:c,unescapePrefix:d,nestingPrefix:g,nestingPrefixEscaped:u,nestingSuffix:h,nestingSuffixEscaped:p,nestingOptionsSeparator:m,maxReplaces:f,alwaysFormat:x}=e.interpolation;this.escape=void 0!==t?t:V,this.escapeValue=void 0===r||r,this.useRawValueToEscape=void 0!==a&&a,this.prefix=s?$(s):n||"{{",this.suffix=i?$(i):o||"}}",this.formatSeparator=l||",",this.unescapePrefix=c?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":c||"",this.nestingPrefix=g?$(g):u||$("$t("),this.nestingSuffix=h?$(h):p||$(")"),this.nestingOptionsSeparator=m||",",this.maxReplaces=f||1e3,this.alwaysFormat=void 0!==x&&x,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e?.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,t,r,a){let s,n,i;const o=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=e=>{if(e.indexOf(this.formatSeparator)<0){const s=ne(t,o,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(s,void 0,r,{...a,...t,interpolationkey:e}):s}const s=e.split(this.formatSeparator),n=s.shift().trim(),i=s.join(this.formatSeparator).trim();return this.format(ne(t,o,n,this.options.keySeparator,this.options.ignoreJSONStructure),i,r,{...a,...t,interpolationkey:n})};this.resetRegExp();const c=a?.missingInterpolationHandler||this.options.missingInterpolationHandler,d=void 0!==a?.interpolation?.skipOnVariables?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>ie(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?ie(this.escape(e)):ie(e)}].forEach(t=>{for(i=0;s=t.regex.exec(e);){const r=s[1].trim();if(n=l(r),void 0===n)if("function"==typeof c){const t=c(e,s,a);n=D(t)?t:""}else if(a&&Object.prototype.hasOwnProperty.call(a,r))n="";else{if(d){n=s[0];continue}this.logger.warn(`missed to pass in variable ${r} for interpolating ${e}`),n=""}else D(n)||this.useRawValueToEscape||(n=A(n));const o=t.safeValue(n);if(e=e.replace(s[0],o),d?(t.regex.lastIndex+=n.length,t.regex.lastIndex-=s[0].length):t.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),e}nest(e,t,r={}){let a,s,n;const i=(e,t)=>{const r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;const a=e.split(new RegExp(`${r}[ ]*{`));let s=`{${a[1]}`;e=a[0],s=this.interpolate(s,n);const i=s.match(/'/g),o=s.match(/"/g);((i?.length??0)%2==0&&!o||o.length%2!=0)&&(s=s.replace(/'/g,'"'));try{n=JSON.parse(s),t&&(n={...t,...n})}catch(l){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,l),`${e}${r}${s}`}return n.defaultValue&&n.defaultValue.indexOf(this.prefix)>-1&&delete n.defaultValue,e};for(;a=this.nestingRegexp.exec(e);){let o=[];n={...r},n=n.replace&&!D(n.replace)?n.replace:n,n.applyPostProcessor=!1,delete n.defaultValue;const l=/{.*}/.test(a[1])?a[1].lastIndexOf("}")+1:a[1].indexOf(this.formatSeparator);if(-1!==l&&(o=a[1].slice(l).split(this.formatSeparator).map(e=>e.trim()).filter(Boolean),a[1]=a[1].slice(0,l)),s=t(i.call(this,a[1].trim(),n),n),s&&a[0]===e&&!D(s))return s;D(s)||(s=A(s)),s||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${e}`),s=""),o.length&&(s=o.reduce((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:a[1].trim()}),s.trim())),e=e.replace(a[0],s),this.regexp.lastIndex=0}return e}}const le=e=>{const t={};return(r,a,s)=>{let n=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(n={...n,[s.interpolationkey]:void 0});const i=a+JSON.stringify(n);let o=t[i];return o||(o=e(z(a),s),t[i]=o),o(r)}},ce=e=>(t,r,a)=>e(z(r),a)(t);class de{constructor(e={}){this.logger=_.create("formatter"),this.options=e,this.init(e)}init(e,t={interpolation:{}}){this.formatSeparator=t.interpolation.formatSeparator||",";const r=t.cacheInBuiltFormats?le:ce;this.formats={number:r((e,t)=>{const r=new Intl.NumberFormat(e,{...t});return e=>r.format(e)}),currency:r((e,t)=>{const r=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>r.format(e)}),datetime:r((e,t)=>{const r=new Intl.DateTimeFormat(e,{...t});return e=>r.format(e)}),relativetime:r((e,t)=>{const r=new Intl.RelativeTimeFormat(e,{...t});return e=>r.format(e,t.range||"day")}),list:r((e,t)=>{const r=new Intl.ListFormat(e,{...t});return e=>r.format(e)})}}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=le(t)}format(e,t,r,a={}){const s=t.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(e=>e.indexOf(")")>-1)){const e=s.findIndex(e=>e.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,e)].join(this.formatSeparator)}return s.reduce((e,t)=>{const{formatName:s,formatOptions:n}=(e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const a=e.split("(");t=a[0].toLowerCase().trim();const s=a[1].substring(0,a[1].length-1);"currency"===t&&s.indexOf(":")<0?r.currency||(r.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?r.range||(r.range=s.trim()):s.split(";").forEach(e=>{if(e){const[t,...a]=e.split(":"),s=a.join(":").trim().replace(/^'+|'+$/g,""),n=t.trim();r[n]||(r[n]=s),"false"===s&&(r[n]=!1),"true"===s&&(r[n]=!0),isNaN(s)||(r[n]=parseInt(s,10))}})}return{formatName:t,formatOptions:r}})(t);if(this.formats[s]){let t=e;try{const i=a?.formatParams?.[a.interpolationkey]||{},o=i.locale||i.lng||a.locale||a.lng||r;t=this.formats[s](e,o,{...n,...a,...i})}catch(i){this.logger.warn(i)}return t}return this.logger.warn(`there was no format function for ${s}`),e},e)}}class ge extends J{constructor(e,t,r,a={}){super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=a,this.logger=_.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,a.backend,a)}queueLoad(e,t,r,a){const s={},n={},i={},o={};return e.forEach(e=>{let a=!0;t.forEach(t=>{const i=`${e}|${t}`;!r.reload&&this.store.hasResourceBundle(e,t)?this.state[i]=2:this.state[i]<0||(1===this.state[i]?void 0===n[i]&&(n[i]=!0):(this.state[i]=1,a=!1,void 0===n[i]&&(n[i]=!0),void 0===s[i]&&(s[i]=!0),void 0===o[t]&&(o[t]=!0)))}),a||(i[e]=!0)}),(Object.keys(s).length||Object.keys(n).length)&&this.queue.push({pending:n,pendingCount:Object.keys(n).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(s),pending:Object.keys(n),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(o)}}loaded(e,t,r){const a=e.split("|"),s=a[0],n=a[1];t&&this.emit("failedLoading",s,n,t),!t&&r&&this.store.addResourceBundle(s,n,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const i={};this.queue.forEach(r=>{((e,t,r)=>{const{obj:a,k:s}=T(e,t,Object);a[s]=a[s]||[],a[s].push(r)})(r.loaded,[s],n),((e,t)=>{void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)})(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach(e=>{i[e]||(i[e]={});const t=r.loaded[e];t.length&&t.forEach(t=>{void 0===i[e][t]&&(i[e][t]=!0)})}),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(e=>!e.done)}read(e,t,r,a=0,s=this.retryTimeout,n){if(!e.length)return n(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:a,wait:s,callback:n});this.readingCalls++;const i=(i,o)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}i&&o&&a<this.maxRetries?setTimeout(()=>{this.read.call(this,e,t,r,a+1,2*s,n)},s):n(i,o)},o=this.backend[r].bind(this.backend);if(2!==o.length)return o(e,t,i);try{const r=o(e,t);r&&"function"==typeof r.then?r.then(e=>i(null,e)).catch(i):i(null,r)}catch(l){i(l)}}prepareLoading(e,t,r={},a){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();D(e)&&(e=this.languageUtils.toResolveHierarchy(e)),D(t)&&(t=[t]);const s=this.queueLoad(e,t,r,a);if(!s.toLoad.length)return s.pending.length||a(),null;s.toLoad.forEach(e=>{this.loadOne(e)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e,t=""){const r=e.split("|"),a=r[0],s=r[1];this.read(a,s,"read",void 0,void 0,(r,n)=>{r&&this.logger.warn(`${t}loading namespace ${s} for language ${a} failed`,r),!r&&n&&this.logger.log(`${t}loaded namespace ${s} for language ${a}`,n),this.loaded(e,r,n)})}saveMissing(e,t,r,a,s,n={},i=()=>{}){if(!this.services?.utils?.hasLoadedNamespace||this.services?.utils?.hasLoadedNamespace(t)){if(null!=r&&""!==r){if(this.backend?.create){const l={...n,isUpdate:s},c=this.backend.create.bind(this.backend);if(c.length<6)try{let s;s=5===c.length?c(e,t,r,a,l):c(e,t,r,a),s&&"function"==typeof s.then?s.then(e=>i(null,e)).catch(i):i(null,s)}catch(o){i(o)}else c(e,t,r,a,i,l)}e&&e[0]&&this.store.addResource(e[0],t,r,a)}}else this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")}}const ue=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if("object"==typeof e[1]&&(t=e[1]),D(e[1])&&(t.defaultValue=e[1]),D(e[2])&&(t.tDescription=e[2]),"object"==typeof e[2]||"object"==typeof e[3]){const r=e[3]||e[2];Object.keys(r).forEach(e=>{t[e]=r[e]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),he=e=>(D(e.ns)&&(e.ns=[e.ns]),D(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),D(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs?.indexOf?.("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),"boolean"==typeof e.initImmediate&&(e.initAsync=e.initImmediate),e),pe=()=>{};class me extends J{constructor(e={},t){var r;if(super(),this.options=he(e),this.services={},this.logger=_,this.modules={external:[]},r=this,Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach(e=>{"function"==typeof r[e]&&(r[e]=r[e].bind(r))}),t&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(e={},t){this.isInitializing=!0,"function"==typeof e&&(t=e,e={}),null==e.defaultNS&&e.ns&&(D(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=ue();this.options={...r,...this.options,...he(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},void 0!==e.keySeparator&&(this.options.userDefinedKeySeparator=e.keySeparator),void 0!==e.nsSeparator&&(this.options.userDefinedNsSeparator=e.nsSeparator),"function"!=typeof this.options.overloadTranslationOptionHandler&&(this.options.overloadTranslationOptionHandler=r.overloadTranslationOptionHandler);const a=e=>e?"function"==typeof e?new e:e:null;if(!this.options.isClone){let e;this.modules.logger?_.init(a(this.modules.logger),this.options):_.init(null,this.options),e=this.modules.formatter?this.modules.formatter:de;const t=new te(this.options);this.store=new K(this.options.resources,this.options);const s=this.services;s.logger=_,s.resourceStore=this.store,s.languageUtils=t,s.pluralResolver=new se(t,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix});this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),!e||this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format||(s.formatter=a(e),s.formatter.init&&s.formatter.init(s,this.options),this.options.interpolation.format=s.formatter.format.bind(s.formatter)),s.interpolator=new oe(this.options),s.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},s.backendConnector=new ge(a(this.modules.backend),s.resourceStore,s,this.options),s.backendConnector.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.languageDetector&&(s.languageDetector=a(this.modules.languageDetector),s.languageDetector.init&&s.languageDetector.init(s,this.options.detection,this.options)),this.modules.i18nFormat&&(s.i18nFormat=a(this.modules.i18nFormat),s.i18nFormat.init&&s.i18nFormat.init(this)),this.translator=new ee(this.services,this.options),this.translator.on("*",(e,...t)=>{this.emit(e,...t)}),this.modules.external.forEach(e=>{e.init&&e.init(this)})}if(this.format=this.options.interpolation.format,t||(t=pe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const e=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);e.length>0&&"dev"!==e[0]&&(this.options.lng=e[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(e=>{this[e]=(...t)=>this.store[e](...t)});["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(e=>{this[e]=(...t)=>(this.store[e](...t),this)});const s=L(),n=()=>{const e=(e,r)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),s.resolve(r),t(e,r)};if(this.languages&&!this.isInitialized)return e(null,this.t.bind(this));this.changeLanguage(this.options.lng,e)};return this.options.resources||!this.options.initAsync?n():setTimeout(n,0),s}loadResources(e,t=pe){let r=t;const a=D(e)?e:this.language;if("function"==typeof e&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if("cimode"===a?.toLowerCase()&&(!this.options.preload||0===this.options.preload.length))return r();const e=[],t=t=>{if(!t)return;if("cimode"===t)return;this.services.languageUtils.toResolveHierarchy(t).forEach(t=>{"cimode"!==t&&e.indexOf(t)<0&&e.push(t)})};if(a)t(a);else{this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(e=>t(e))}this.options.preload?.forEach?.(e=>t(e)),this.services.backendConnector.load(e,this.options.ns,e=>{e||this.resolvedLanguage||!this.language||this.setResolvedLanguage(this.language),r(e)})}else r(null)}reloadResources(e,t,r){const a=L();return"function"==typeof e&&(r=e,e=void 0),"function"==typeof t&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=pe),this.services.backendConnector.reload(e,t,e=>{a.resolve(),r(e)}),a}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&G.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}setResolvedLanguage(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1)){for(let e=0;e<this.languages.length;e++){const t=this.languages[e];if(!(["cimode","dev"].indexOf(t)>-1)&&this.store.hasLanguageSomeTranslations(t)){this.resolvedLanguage=t;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,t){this.isLanguageChangingTo=e;const r=L();this.emit("languageChanging",e);const a=e=>{this.language=e,this.languages=this.services.languageUtils.toResolveHierarchy(e),this.resolvedLanguage=void 0,this.setResolvedLanguage(e)},s=(s,n)=>{n?this.isLanguageChangingTo===e&&(a(n),this.translator.changeLanguage(n),this.isLanguageChangingTo=void 0,this.emit("languageChanged",n),this.logger.log("languageChanged",n)):this.isLanguageChangingTo=void 0,r.resolve((...e)=>this.t(...e)),t&&t(s,(...e)=>this.t(...e))},n=t=>{e||t||!this.services.languageDetector||(t=[]);const r=D(t)?t:t&&t[0],n=this.store.hasLanguageSomeTranslations(r)?r:this.services.languageUtils.getBestMatchFromCodes(D(t)?[t]:t);n&&(this.language||a(n),this.translator.language||this.translator.changeLanguage(n),this.services.languageDetector?.cacheUserLanguage?.(n)),this.loadResources(n,e=>{s(e,n)})};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(n):this.services.languageDetector.detect(n):n(e):n(this.services.languageDetector.detect()),r}getFixedT(e,t,r){const a=(e,t,...s)=>{let n;n="object"!=typeof t?this.options.overloadTranslationOptionHandler([e,t].concat(s)):{...t},n.lng=n.lng||a.lng,n.lngs=n.lngs||a.lngs,n.ns=n.ns||a.ns,""!==n.keyPrefix&&(n.keyPrefix=n.keyPrefix||r||a.keyPrefix);const i=this.options.keySeparator||".";let o;return n.keyPrefix&&Array.isArray(e)?o=e.map(e=>("function"==typeof e&&(e=Q(e,{...this.options,...t})),`${n.keyPrefix}${i}${e}`)):("function"==typeof e&&(e=Q(e,{...this.options,...t})),o=n.keyPrefix?`${n.keyPrefix}${i}${e}`:e),this.t(o,n)};return D(e)?a.lng=e:a.lngs=e,a.ns=t,a.keyPrefix=r,a}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,t={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],a=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;const n=(e,t)=>{const r=this.services.backendConnector.state[`${e}|${t}`];return-1===r||0===r||2===r};if(t.precheck){const e=t.precheck(this,n);if(void 0!==e)return e}return!!this.hasResourceBundle(r,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!n(r,e)||a&&!n(s,e)))}loadNamespaces(e,t){const r=L();return this.options.ns?(D(e)&&(e=[e]),e.forEach(e=>{this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=L();D(e)&&(e=[e]);const a=this.options.preload||[],s=e.filter(e=>a.indexOf(e)<0&&this.services.languageUtils.isSupportedCode(e));return s.length?(this.options.preload=a.concat(s),this.loadResources(e=>{r.resolve(),t&&t(e)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const t=new Intl.Locale(e);if(t&&t.getTextInfo){const e=t.getTextInfo();if(e&&e.direction)return e.direction}}catch(r){}const t=this.services?.languageUtils||new te(ue());return e.toLowerCase().indexOf("-latn")>1?"ltr":["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},t){const r=new me(e,t);return r.createInstance=me.createInstance,r}cloneInstance(e={},t=pe){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const a={...this.options,...e,isClone:!0},s=new me(a);void 0===e.debug&&void 0===e.prefix||(s.logger=s.logger.clone(e));if(["store","services","language"].forEach(e=>{s[e]=this[e]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const e=Object.keys(this.store.data).reduce((e,t)=>(e[t]={...this.store.data[t]},e[t]=Object.keys(e[t]).reduce((r,a)=>(r[a]={...e[t][a]},r),e[t]),e),{});s.store=new K(e,a),s.services.resourceStore=s.store}return e.interpolation&&(s.services.interpolator=new oe(a)),s.translator=new ee(s.services,a),s.translator.on("*",(e,...t)=>{s.emit(e,...t)}),s.init(a,t),s.translator.options=a,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const fe=me.createInstance();fe.createInstance,fe.dir,fe.init,fe.loadResources,fe.reloadResources,fe.use,fe.changeLanguage,fe.getFixedT,fe.t,fe.exists,fe.setDefaultNamespace,fe.hasLoadedNamespace,fe.loadNamespaces,fe.loadLanguages;const xe={},be=(e,t,r,a)=>{we(r)&&xe[r]||(we(r)&&(xe[r]=new Date),((e,t,r,a)=>{const s=[r,{code:t,...a||{}}];if(e?.services?.logger?.forward)return e.services.logger.forward(s,"warn","react-i18next::",!0);we(s[0])&&(s[0]=`react-i18next:: ${s[0]}`),e?.services?.logger?.warn?e.services.logger.warn(...s):console})(e,t,r,a))},ye=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},ve=(e,t,r)=>{e.loadNamespaces(t,ye(e,r))},ke=(e,t,r,a)=>{if(we(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return ve(e,r,a);r.forEach(t=>{e.options.ns.indexOf(t)<0&&e.options.ns.push(t)}),e.loadLanguages(t,ye(e,a))},we=e=>"string"==typeof e,Ce=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,Se={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},je=e=>Se[e];let Ne={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:e=>e.replace(Ce,je),transDefaultProps:void 0};let De;const Le={type:"3rdParty",init(e){((e={})=>{Ne={...Ne,...e}})(e.options.react),(e=>{De=e})(e)}},Ae=a.createContext();class Me{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(e=>{this.usedNamespaces[e]||(this.usedNamespaces[e]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var Ee,Re,Te={exports:{}},Oe={};var Ie=(Re||(Re=1,Te.exports=function(){if(Ee)return Oe;Ee=1;var e=s(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=e.useState,a=e.useEffect,n=e.useLayoutEffect,i=e.useDebugValue;function o(e){var r=e.getSnapshot;e=e.value;try{var a=r();return!t(e,a)}catch(s){return!0}}var l="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var s=t(),l=r({inst:{value:s,getSnapshot:t}}),c=l[0].inst,d=l[1];return n(function(){c.value=s,c.getSnapshot=t,o(c)&&d({inst:c})},[e,s,t]),a(function(){return o(c)&&d({inst:c}),e(function(){o(c)&&d({inst:c})})},[e]),i(s),s};return Oe.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:l,Oe}()),Te.exports);const Pe={t:(e,t)=>{return we(t)?t:"object"==typeof(r=t)&&null!==r&&we(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e;var r},ready:!1},$e=()=>()=>{},Fe=(e,t={})=>{const{i18n:r}=t,{i18n:s,defaultNS:n}=a.useContext(Ae)||{},i=r||s||De;i&&!i.reportNamespaces&&(i.reportNamespaces=new Me),i||be(i,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const o=a.useMemo(()=>({...Ne,...i?.options?.react,...t}),[i,t]),{useSuspense:l,keyPrefix:c}=o,d=e||n||i?.options?.defaultNS,g=we(d)?[d]:d||["translation"],u=a.useMemo(()=>g,g);i?.reportNamespaces?.addUsedNamespaces?.(u);const h=a.useRef(0),p=a.useCallback(e=>{if(!i)return $e;const{bindI18n:t,bindI18nStore:r}=o,a=()=>{h.current+=1,e()};return t&&i.on(t,a),r&&i.store.on(r,a),()=>{t&&t.split(" ").forEach(e=>i.off(e,a)),r&&r.split(" ").forEach(e=>i.store.off(e,a))}},[i,o]),m=a.useRef(),f=a.useCallback(()=>{if(!i)return Pe;const e=!(!i.isInitialized&&!i.initializedStoreOnce)&&u.every(e=>((e,t,r={})=>t.languages&&t.languages.length?t.hasLoadedNamespace(e,{lng:r.lng,precheck:(t,a)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&t.services.backendConnector.backend&&t.isLanguageChangingTo&&!a(t.isLanguageChangingTo,e))return!1}}):(be(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0))(e,i,o)),r=t.lng||i.language,a=h.current,s=m.current;if(s&&s.ready===e&&s.lng===r&&s.keyPrefix===c&&s.revision===a)return s;const n={t:i.getFixedT(r,"fallback"===o.nsMode?u:u[0],c),ready:e,lng:r,keyPrefix:c,revision:a};return m.current=n,n},[i,u,c,o,t.lng]),[x,b]=a.useState(0),{t:y,ready:v}=Ie.useSyncExternalStore(p,f,f);a.useEffect(()=>{if(i&&!v&&!l){const e=()=>b(e=>e+1);t.lng?ke(i,t.lng,u,e):ve(i,u,e)}},[i,t.lng,u,v,l,x]);const k=i||{},w=a.useRef(null),C=a.useRef(),S=e=>{const t=Object.getOwnPropertyDescriptors(e);t.__original&&delete t.__original;const r=Object.create(Object.getPrototypeOf(e),t);if(!Object.prototype.hasOwnProperty.call(r,"__original"))try{Object.defineProperty(r,"__original",{value:e,writable:!1,enumerable:!1,configurable:!1})}catch(a){}return r},j=a.useMemo(()=>{const e=k,t=e?.language;let r=e;e&&(w.current&&w.current.__original===e?C.current!==t?(r=S(e),w.current=r,C.current=t):r=w.current:(r=S(e),w.current=r,C.current=t));const a=[y,r,v];return a.t=y,a.i18n=r,a.ready=v,a},[y,k,v,k.resolvedLanguage,k.language,k.languages]);if(i&&l&&!v)throw new Promise(e=>{const r=()=>e();t.lng?ke(i,t.lng,u,r):ve(i,u,r)});return j},Ve=20,Be="default",We="preset-2digit",Ue="preset-4digit",ze=[Be,We,Ue],He=10,qe=9999,_e=99999,Je=1e3,Ke=1e5,Ge=128,Ye=20,Qe=5e3,Ze={"site-logo":(e,t)=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9.66,7.94l-3.92,2.08c-.68.36-1.09,1.07-1.06,1.84l.22,6.02c.02.66.37,1.27.94,1.62l5.1,3.2c.65.41,1.48.41,2.13,0l5.1-3.2c.56-.35.91-.96.94-1.62l.22-6.02c.03-.77-.38-1.48-1.06-1.84l-3.92-2.08"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M13.92,5.61c1.07.71,2.51,1.39,4.08,1.39,2.21,0,4-1.34,4-3,0-1.66-1.79-3-4-3-3.31,0-6,3-6,3,0,0-2.69,3-6,3-2.21,0-4-1.34-4-3S3.79,1,6,1c.18,0,.37,0,.55.03,1.31.13,2.47.69,3.39,1.53"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M14.25,10.98c0,.69-1.01,1.24-2.25,1.24s-2.25-.56-2.25-1.24"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M11.99,7.01c0,.1,0,.2,0,.3v2.42"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"8.78",cy:"16.77",rx:".62",ry:"1.12",transform:"translate(-7.21 6.64) rotate(-30)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"10.49",cy:"19.73",rx:".62",ry:"1.12",transform:"translate(-8.46 7.89) rotate(-30)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"7.07",cy:"13.8",rx:".62",ry:"1.12",transform:"translate(-5.95 5.38) rotate(-30)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"16.96",cy:"13.75",rx:"1.12",ry:".62",transform:"translate(-3.43 21.56) rotate(-60)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"13.54",cy:"19.68",rx:"1.12",ry:".62",transform:"translate(-10.27 21.56) rotate(-60)"})]}),dice:(e,t)=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.33,16.08l.32-8.65c.03-.77-.38-1.48-1.06-1.84L12.94,1.55c-.59-.31-1.29-.31-1.87,0L3.42,5.59c-.68.36-1.09,1.07-1.06,1.84l.32,8.65c.02.66.37,1.27.94,1.62l7.33,4.6c.65.41,1.48.41,2.13,0l7.33-4.6c.56-.35.91-.96.94-1.62Z"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"12",cy:"6.68",rx:"2.96",ry:"1.64"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"7.77",cy:"14.29",rx:".82",ry:"1.48",transform:"translate(-6.1 5.8) rotate(-30)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"10.02",cy:"18.19",rx:".82",ry:"1.48",transform:"translate(-7.75 7.45) rotate(-30)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"5.52",cy:"10.39",rx:".82",ry:"1.48",transform:"translate(-4.46 4.15) rotate(-30)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"18.52",cy:"10.32",rx:"1.48",ry:".82",transform:"translate(.33 21.2) rotate(-60)"}),i.jsx("ellipse",{strokeWidth:"0",style:{fill:t},cx:"14.02",cy:"18.12",rx:"1.48",ry:".82",transform:"translate(-8.68 21.2) rotate(-60)"})]}),"chevron-left":e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M15 19l-7-7 7-7"}),"chevron-right":e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5l7 7-7 7"}),"chevron-up":e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5*e,d:"M6 15l6-6 6 6"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,opacity:"0.5",d:"M6 18l6-6 6 6"})]}),"chevron-down":e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5*e,d:"M6 9l6 6 6-6"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,opacity:"0.5",d:"M6 6l6 6 6-6"})]}),help:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),sun:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"}),moon:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"}),sessions:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"}),settings:e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"chart-bar":e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"}),results:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"}),menu:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 6h16M4 12h16M4 18h16"}),"dots-vertical":()=>i.jsxs(i.Fragment,{children:[i.jsx("circle",{fill:"currentColor",cx:"12",cy:"5",r:"1"}),i.jsx("circle",{fill:"currentColor",cx:"12",cy:"12",r:"1"}),i.jsx("circle",{fill:"currentColor",cx:"12",cy:"19",r:"1"})]}),close:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M6 18L18 6M6 6l12 12"}),download:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"}),upload:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"}),edit:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"}),save:e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M3 7v11a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-7l-2-2H5a2 2 0 00-2 2z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M9 16v-3m3 3v-5m3 5v-2"})]}),trash:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}),copy:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"}),export:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"}),import:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"}),reroll:e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.4,15.6l.28-7.55c.04-1.15-.58-2.22-1.59-2.76l-6.68-3.53c-.88-.46-1.93-.46-2.81,0l-6.68,3.53c-1.02.54-1.64,1.61-1.59,2.76l.28,7.55c.04.99.56,1.9,1.4,2.43l6.4,4.01c.98.61,2.21.61,3.19,0l6.4-4.01c.84-.53,1.37-1.44,1.4-2.43Z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M13.97,7.75c1.09.51,1.98,1.43,2.42,2.65.89,2.43-.37,5.12-2.8,6.01s-5.12-.37-6.01-2.8c-.89-2.43.37-5.12,2.8-6.01"}),i.jsx("polyline",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",points:"8.13 6.99 10.39 7.6 9.78 9.86"})]}),"add-roll":e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21.4,15.6l.28-7.55c.04-1.15-.58-2.22-1.59-2.76l-6.68-3.53c-.88-.46-1.93-.46-2.81,0l-6.68,3.53c-1.02.54-1.64,1.61-1.59,2.76l.28,7.55c.04.99.56,1.9,1.4,2.43l6.4,4.01c.98.61,2.21.61,3.19,0l6.4-4.01c.84-.53,1.37-1.44,1.4-2.43Z"}),i.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",x1:"8.25",y1:"12",x2:"15.75",y2:"12"}),i.jsx("line",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",x1:"12",y1:"8.25",x2:"12",y2:"15.75"})]}),refresh:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"}),plus:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M12 4v16m8-8H4"}),spinner:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M21 12a9 9 0 1 1-6.219-8.56"}),table:()=>i.jsxs(i.Fragment,{children:[i.jsx("rect",{strokeWidth:"2",x:"2",y:"3",width:"20",height:"18",rx:"2",ry:"2"}),i.jsx("line",{strokeWidth:"2",x1:"2",y1:"9",x2:"22",y2:"9"}),i.jsx("line",{strokeWidth:"2",x1:"2",y1:"15",x2:"22",y2:"15"}),i.jsx("line",{strokeWidth:"2",x1:"12",y1:"3",x2:"12",y2:"21"})]}),reset:e=>i.jsxs(i.Fragment,{children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M22 21H7"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"m5 11 9 9"})]}),info:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),filter:e=>i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:e,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})},Xe=n.memo(({name:e,className:t="w-6 h-6",strokeWidth:r=2})=>{const a=Ze[e];return a?i.jsx("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a(r,"currentColor")}):null});Xe.displayName="Icon";const et=128;function tt(e){return ze.includes(e)}function rt(){const e=(new Date).toISOString();return{id:Be,name:"デフォルト設定",resultChart:{useAggregation:!1,aggregationInterval:Ye},individualDiceChart:{useAggregation:!1,aggregationInterval:Ye},rollProgressMovingAverageWindow:20,createdAt:e,updatedAt:e}}function at(){return`chart-settings-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function st(e){return e&&0!==e.trim().length?e.length>et?{valid:!1,error:"設定名は128文字以内で入力してください"}:{valid:!0}:{valid:!1,error:"設定名を入力してください"}}const nt="sessions",it="chartSettings";const ot=new class{constructor(){t(this,"dbPromise",null)}async closeDB(){if(this.dbPromise){try{(await this.dbPromise).close()}catch(e){}this.dbPromise=null}}async getDB(){return this.dbPromise||(this.dbPromise=new Promise((e,t)=>{const r=indexedDB.open("DiceSimulatorDB",4);r.onerror=()=>{t(new Error("IndexedDBを開けませんでした"))},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=e=>{const t=e.target.result,r=e.oldVersion;if(t.objectStoreNames.contains(nt)){if(r<2){const t=e.target.transaction.objectStore(nt);t.indexNames.contains("by-sortOrder")||t.createIndex("by-sortOrder","sortOrder",{unique:!1})}}else{const e=t.createObjectStore(nt,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}if(r<3&&!t.objectStoreNames.contains(it)){const e=t.createObjectStore(it,{keyPath:"id"});e.createIndex("by-sortOrder","sortOrder",{unique:!1}),e.createIndex("by-updated","updatedAt",{unique:!1})}if(r<4&&r>=3){const t=e.target.transaction.objectStore(it);t.indexNames.contains("by-sortOrder")||t.createIndex("by-sortOrder","sortOrder",{unique:!1})}}})),this.dbPromise}async loadSessions(){try{const e=await this.getDB(),t=e.transaction(nt,"readonly").objectStore(nt);return new Promise((e,r)=>{const a=t.getAll();a.onsuccess=()=>{const t=a.result;t.sort((e,t)=>void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()),e(t)},a.onerror=()=>{r(new Error("ダイスセットの読み込みに失敗しました"))}})}catch(e){return[]}}async saveSession(e){const t=await this.getDB();let r=e;if(void 0===e.sortOrder)try{const t=await this.getSession(e.id);if(t&&void 0!==t.sortOrder)r={...e,sortOrder:t.sortOrder};else{const t=(await this.loadSessions()).reduce((e,t)=>void 0!==t.sortOrder&&t.sortOrder>e?t.sortOrder:e,-1);r={...e,sortOrder:t+1}}}catch(s){}const a=t.transaction(nt,"readwrite").objectStore(nt);return new Promise((e,t)=>{const s=a.put(r);s.onsuccess=()=>{e()},s.onerror=()=>{t(new Error("ダイスセットの保存に失敗しました"))}})}async saveSessions(e){const t=(await this.getDB()).transaction(nt,"readwrite").objectStore(nt);return await new Promise((e,r)=>{const a=t.clear();a.onsuccess=()=>e(),a.onerror=()=>r(new Error("データのクリアに失敗しました"))}),new Promise((r,a)=>{let s=0;const n=e.length;0!==n?e.forEach((e,i)=>{const o={...e,sortOrder:i},l=t.put(o);l.onsuccess=()=>{s++,s===n&&r()},l.onerror=()=>{a(new Error("ダイスセットの保存に失敗しました"))}}):r()})}async deleteSession(e){const t=(await this.getDB()).transaction(nt,"readwrite").objectStore(nt);return new Promise((r,a)=>{const s=t.delete(e);s.onsuccess=()=>{r()},s.onerror=()=>{a(new Error("ダイスセットの削除に失敗しました"))}})}async getSession(e){const t=(await this.getDB()).transaction(nt,"readonly").objectStore(nt);return new Promise((r,a)=>{const s=t.get(e);s.onsuccess=()=>{r(s.result)},s.onerror=()=>{a(new Error("ダイスセットの取得に失敗しました"))}})}async getSessionCount(){const e=(await this.getDB()).transaction(nt,"readonly").objectStore(nt);return new Promise((t,r)=>{const a=e.count();a.onsuccess=()=>{t(a.result)},a.onerror=()=>{r(new Error("ダイスセット数の取得に失敗しました"))}})}async migrateFromLocalStorage(){try{const t="dice-simulator-sessions",r=localStorage.getItem(t);if(!r)return!1;let a;try{a=JSON.parse(r)}catch(e){return localStorage.removeItem(t),!1}if(!a||"object"!=typeof a)throw new Error("LocalStorageのデータ形式が不正です");const s=a,n=Array.isArray(s.sessions)?s.sessions:[];if(!Array.isArray(n))throw new Error("sessionsが配列ではありません");return n.length>0&&(n.forEach((e,t)=>{!function(e,t){if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: データが不正です`);const r=e;if(!r.id||"string"!=typeof r.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(!r.name||"string"!=typeof r.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(r.name.length>Ge)throw new Error(`ダイスセット${t+1}: 名前が長すぎます（最大128文字）`);if(!r.diceConfig||"object"!=typeof r.diceConfig)throw new Error(`ダイスセット${t+1}: ダイス設定が不正です`);const a=r.diceConfig;if("number"!=typeof a.diceCount||a.diceCount<1||a.diceCount>He)throw new Error(`ダイスセット${t+1}: ダイス数が範囲外です`);if("number"!=typeof a.diceFaces||a.diceFaces<1||a.diceFaces>qe)throw new Error(`ダイスセット${t+1}: ダイス面数が範囲外です`);if(""!==a.modifierSign&&"+"!==a.modifierSign&&"-"!==a.modifierSign)throw new Error(`ダイスセット${t+1}: 修正値符号が不正です`);if("number"!=typeof a.modifierValue||a.modifierValue<0||a.modifierValue>_e)throw new Error(`ダイスセット${t+1}: 修正値が範囲外です`);if("number"!=typeof r.trialCount||r.trialCount<1||r.trialCount>Je)throw new Error(`ダイスセット${t+1}: 試行回数が範囲外です`);if(!Array.isArray(r.results))throw new Error(`ダイスセット${t+1}: 結果が配列ではありません`)}(e,t)}),await this.saveSessions(n),localStorage.removeItem(t),!0)}catch(e){return!1}}async loadChartSettings(){try{const e=await this.getDB(),t=e.transaction(it,"readonly").objectStore(it);return new Promise((e,r)=>{const a=t.getAll();a.onsuccess=()=>{const t=a.result;if(!t.some(e=>e.id===Be)){const e=rt();t.unshift(e)}t.sort((e,t)=>{const r=ze.includes(e.id),a=ze.includes(t.id);return r&&a?e.id===Be?-1:t.id===Be?1:ze.indexOf(e.id)-ze.indexOf(t.id):r?-1:a?1:void 0!==e.sortOrder&&void 0!==t.sortOrder?e.sortOrder-t.sortOrder:new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()}),e(t)},a.onerror=()=>{r(new Error("チャート設定の読み込みに失敗しました"))}})}catch(e){return[rt()]}}async saveChartSettings(e){const t=(await this.getDB()).transaction(it,"readwrite").objectStore(it);return new Promise((r,a)=>{const s=t.put(e);s.onsuccess=()=>{r()},s.onerror=()=>{a(new Error("チャート設定の保存に失敗しました"))}})}async deleteChartSettings(e){if(e===Be)throw new Error("デフォルト設定は削除できません");const t=(await this.getDB()).transaction(it,"readwrite").objectStore(it);return new Promise((r,a)=>{const s=t.delete(e);s.onsuccess=()=>{r()},s.onerror=()=>{a(new Error("チャート設定の削除に失敗しました"))}})}async getChartSettings(e){const t=(await this.getDB()).transaction(it,"readonly").objectStore(it);return new Promise((r,a)=>{const s=t.get(e);s.onsuccess=()=>{s.result?r(s.result):r(e===Be?rt():void 0)},s.onerror=()=>{a(new Error("チャート設定の取得に失敗しました"))}})}async ensureDefaultChartSettings(){await this.getChartSettings(Be)||await this.saveChartSettings(rt());await this.getChartSettings(We)||await this.saveChartSettings(function(){const e=(new Date).toISOString();return{id:"preset-2digit",name:"2桁面向け",resultChart:{useAggregation:!0,aggregationInterval:20},individualDiceChart:{useAggregation:!0,aggregationInterval:20},resultChartType:"bar",individualDiceChartType:"bar",targetValueChartType:"bar",rollProgressMovingAverageWindow:20,createdAt:e,updatedAt:e}}());await this.getChartSettings(Ue)||await this.saveChartSettings(function(){const e=(new Date).toISOString();return{id:"preset-4digit",name:"4桁面向け",resultChart:{useAggregation:!0,aggregationInterval:2e3},individualDiceChart:{useAggregation:!0,aggregationInterval:2e3},resultChartType:"line",individualDiceChartType:"line",targetValueChartType:"line",rollProgressMovingAverageWindow:20,createdAt:e,updatedAt:e}}())}};async function lt(e){return ot.saveSession(e)}async function ct(e){return ot.deleteSession(e)}async function dt(){return ot.loadChartSettings()}async function gt(e){return ot.saveChartSettings(e)}async function ut(){return ot.closeDB()}const ht="language";function pt(e){localStorage.setItem(ht,e)}const mt=[{code:"ja",label:"日本語",subtitle:"Japanese",badge:"JA"},{code:"en",label:"English",subtitle:"English",badge:"EN"}],ft=a.lazy(()=>N(()=>import("./HelpModal-DfWSJ1mF.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.HelpModal}))),xt=a.lazy(()=>N(()=>import("./SettingsModal-BRlx4zQW.js"),__vite__mapDeps([3,1,2])).then(e=>({default:e.SettingsModal}))),bt=n.memo(({darkMode:e,onToggleDarkMode:t,onAboutClick:r,themeMode:s,onChangeThemeMode:n,onExportData:o,onImportData:l,sessionsCount:c,chartSettingsCount:d})=>{const{i18n:g,t:u}=Fe("common"),[h,p]=a.useState(!1),[m,f]=a.useState(!1),[x,b]=a.useState(!0),[y,v]=a.useState(!1),k=a.useRef(0),w=a.useRef(null),C=a.useRef(null),S=u("common:siteName");a.useEffect(()=>{const e=()=>{if(window.innerWidth>=768)return void b(!0);const e=window.scrollY;if(e<=0)return b(!0),void(k.current=e);Math.abs(e-k.current)<10||(e>k.current?b(!1):b(!0),k.current=e)};return e(),window.addEventListener("scroll",e,{passive:!0}),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]),a.useEffect(()=>{const e=e=>{y&&C.current&&!C.current.contains(e.target)&&w.current&&!w.current.contains(e.target)&&v(!1)},t=e=>{"Escape"===e.key&&v(!1)};if(y)return document.addEventListener("mousedown",e),document.addEventListener("keydown",t),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",t)}},[y]);const j=mt.find(e=>e.code===g.language)||mt[0];return i.jsxs(i.Fragment,{children:[i.jsx("header",{className:"h-18 fixed top-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 text-gray-800 dark:text-white py-2 px-4 shadow-md transition-all duration-300 "+(x?"translate-y-0":"-translate-y-full"),children:i.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[i.jsxs("div",{className:"flex items-center flex-1 min-w-0 mr-2",children:[i.jsx("div",{className:"mr-2 flex-shrink-0",children:i.jsx(Xe,{name:"site-logo",className:"w-10 h-10",strokeWidth:1})}),i.jsx("h1",{className:"text-xl font-bold truncate",children:S})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"relative",children:[i.jsxs("button",{ref:w,onClick:()=>v(e=>!e),className:"flex items-center gap-1 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none text-sm font-medium","aria-label":u("label.toggleLanguage"),"aria-haspopup":"listbox","aria-expanded":y,children:[i.jsx("span",{children:j.badge}),i.jsx(Xe,{name:"chevron-down",className:"w-4 h-4 transition-transform "+(y?"rotate-180":""),strokeWidth:2})]}),y&&i.jsx("div",{ref:C,className:"absolute right-0 mt-2 w-40 bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-1 z-50",children:i.jsx("ul",{role:"listbox","aria-label":u("label.toggleLanguage"),children:mt.map(e=>{const t=e.code===g.language;return i.jsx("li",{children:i.jsxs("button",{type:"button",onClick:()=>{return t=e.code,g.language!==t&&(g.changeLanguage(t),pt(t)),void v(!1);var t},className:"w-full text-left px-4 py-2 text-sm transition-colors flex items-center justify-between "+(t?"bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white font-medium":"hover:bg-gray-50 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200"),role:"option","aria-selected":t,children:[i.jsx("span",{children:e.label}),i.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.badge})]})},e.code)})})})]}),i.jsx("button",{onClick:()=>p(!0),className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none","aria-label":u("label.help"),children:i.jsx(Xe,{name:"help"})}),i.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none","aria-label":u("label.toggleTheme"),children:i.jsx(Xe,{name:e?"moon":"sun"})}),i.jsx("button",{onClick:()=>f(!0),className:"hidden md:flex p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-white/10 transition-colors focus:outline-none mr-2 flex-shrink-0","aria-label":u("label.settings"),children:i.jsx(Xe,{name:"settings"})})]})]})}),h&&i.jsx(a.Suspense,{fallback:null,children:i.jsx(ft,{isOpen:h,onClose:()=>p(!1),onOpenAbout:r})}),m&&i.jsx(a.Suspense,{fallback:null,children:i.jsx(xt,{isOpen:m,onClose:()=>f(!1),darkMode:s,onChangeDarkMode:n,onExportData:o,onImportData:l,sessionsCount:c,chartSettingsCount:d,onAboutClick:r})})]})});function yt(e,t,r,a){return new Promise((s,n)=>{const i=new Worker(new URL("/dice/assets/diceSimulation.worker-DCJS2b41.js",import.meta.url),{type:"module"});i.onmessage=e=>{const t=e.data;"progress"===t.type?r?.(t.progress,t.processed,t.total):"complete"===t.type?(i.terminate(),s(t.results)):"error"===t.type&&(i.terminate(),n(new Error(t.error)))},i.onerror=e=>{i.terminate(),n(e)};const o={type:"simulate",config:e,trialCount:t,chunkSize:a};i.postMessage(o)})}function vt(e){let t=`dice${e.diceCount}d${e.diceFaces}`;return e.modifierSign&&e.modifierValue>0&&(t+=`${e.modifierSign}${e.modifierValue}`),t}function kt(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function wt(){return(new Date).toISOString()}function Ct(e,t){return e.diceCount===t.diceCount&&e.diceFaces===t.diceFaces&&e.modifierSign===t.modifierSign&&e.modifierValue===t.modifierValue}function St(e,t=8){return e.length<=t?e:e.substring(0,t)+"..."}function jt(e){return e.replace(/[<>:"\/\\|?*\x00-\x1F]/g,"_").trim()}function Nt(e){if("string"!=typeof e)return!1;const t=new Date(e);return!isNaN(t.getTime())&&e===t.toISOString()}function Dt(e,t,r="ダイス設定"){if(!e||"object"!=typeof e)throw new Error(`ダイスセット${t+1}: ${r}が不正です`);if("number"!=typeof e.diceCount||e.diceCount<1||e.diceCount>He)throw new Error(`ダイスセット${t+1}: ${r}のダイス数が不正です（1-10の範囲）`);if("number"!=typeof e.diceFaces||e.diceFaces<1||e.diceFaces>qe)throw new Error(`ダイスセット${t+1}: ${r}のダイス面数が不正です（1-9999の範囲）`);if(""!==e.modifierSign&&"+"!==e.modifierSign&&"-"!==e.modifierSign)throw new Error(`ダイスセット${t+1}: ${r}の修正値符号が不正です`);if("number"!=typeof e.modifierValue||e.modifierValue<0||e.modifierValue>_e)throw new Error(`ダイスセット${t+1}: ${r}の修正値が不正です（0-99999の範囲）`)}function Lt(e,t){e.toBlob(e=>{if(!e)throw new Error("画像の生成に失敗しました");const r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},"image/png")}function At(e,t,r){if(!e.current)return;const a=e.current.canvas,s=t.resultsConfig||t.diceConfig,n=t.hasMultipleDiceConfigs||!1?"カスタム":vt(s);Lt(a,`${jt(t.name||"名称未設定")}_${{total:"合計値",individual:"個別の出目",target:"特定の目"}[r]}_${n}_${t.results.length}trials.png`)}const Mt=n.memo(({session:e,onClose:t,onSave:r,isCreateMode:s=!1})=>{const{t:n}=Fe(["dice","common","messages"]),[o,l]=a.useState(!1),[c,d]=a.useState(e.name),[g,u]=a.useState(String(e.diceConfig.diceCount??"")),[h,p]=a.useState(String(e.diceConfig.diceFaces??"")),[m,f]=a.useState(e.diceConfig.modifierSign),[x,b]=a.useState(String(e.diceConfig.modifierValue??"")),[y,v]=a.useState(String(e.trialCount??"")),k=e=>e.replace(/[^0-9]/g,""),w=(e,t,r)=>Math.min(Math.max(e,t),r),C=vt({diceCount:parseInt(g,10)||e.diceConfig.diceCount,diceFaces:parseInt(h,10)||e.diceConfig.diceFaces,modifierSign:m,modifierValue:parseInt(x,10)||e.diceConfig.modifierValue});a.useEffect(()=>{const e=e=>{"Escape"===e.key&&t()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t]);return i.jsx("div",{className:"fixed inset-0 z-[10001] flex items-center justify-center bg-black/50 p-4",onClick:e=>{e.target===e.currentTarget&&t()},children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[i.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100",children:n(s?"dice:config.titleCreate":"dice:config.titleEdit")}),i.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",children:i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.name.label")}),i.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:n("dice:config.name.placeholder"),maxLength:128,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.count.label",{min:1,max:He})}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:g,onChange:e=>{const t=k(e.target.value);u(t)},onBlur:t=>{const r=t.target.value;if(""===r)u(String(e.diceConfig.diceCount));else{const e=w(parseInt(r,10),1,He);u(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.sides.label",{min:1,max:qe})}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:h,onChange:e=>{const t=k(e.target.value);p(t)},onBlur:t=>{const r=t.target.value;if(""===r)p(String(e.diceConfig.diceFaces));else{const e=w(parseInt(r,10),1,qe);p(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.modifier.label",{min:0,max:_e})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("select",{value:m,onChange:e=>f(e.target.value),className:"w-24 px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500",children:[i.jsx("option",{value:"",children:n("dice:config.modifier.sign")}),i.jsx("option",{value:"+",children:"+"}),i.jsx("option",{value:"-",children:"-"})]}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:x,onChange:e=>{const t=k(e.target.value);b(t)},onBlur:t=>{const r=t.target.value;if(""===r)b(String(e.diceConfig.modifierValue));else{const e=w(parseInt(r,10),0,_e);b(String(e))}},disabled:!m,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 disabled:bg-gray-100 dark:disabled:bg-gray-600"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:n("dice:config.trial.label",{min:1,max:Je})}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:y,onChange:e=>{const t=k(e.target.value);v(t)},onBlur:t=>{const r=t.target.value;if(""===r)v(String(e.trialCount));else{const e=w(parseInt(r,10),1,Je);v(String(e))}},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500"})]})]}),i.jsxs("div",{className:"mb-6 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg relative transition-colors",children:[i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:[n("dice:config.notation.label"),":"]}),i.jsx("p",{className:"text-lg font-mono font-bold text-accent-light-600 dark:text-accent-dark-400",children:C}),i.jsx("button",{onClick:async()=>{try{await async function(e){try{await navigator.clipboard.writeText(e)}catch(t){const a=document.createElement("textarea");a.value=e,a.style.position="fixed",a.style.left="-999999px",document.body.appendChild(a),a.focus(),a.select();try{document.execCommand("copy")}catch(r){throw new Error("クリップボードへのコピーに失敗しました")}finally{document.body.removeChild(a)}}}(C),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){}},title:n(o?"dice:config.notation.copied":"dice:config.notation.copy"),className:"absolute top-2 right-2 p-1.5 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors group",children:o?i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-600 group-hover:text-gray-800",viewBox:"0 0 20 20",fill:"currentColor",children:[i.jsx("path",{d:"M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"}),i.jsx("path",{d:"M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"})]})})]})]}),i.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[i.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:n("common:button.cancel")}),i.jsx("button",{onClick:()=>{const a={};c!==e.name&&(a.name=c);const n={diceCount:w(parseInt(g,10)||e.diceConfig.diceCount,1,He),diceFaces:w(parseInt(h,10)||e.diceConfig.diceFaces,1,qe),modifierSign:m,modifierValue:w(parseInt(x,10)||e.diceConfig.modifierValue,0,_e)};n.diceCount===e.diceConfig.diceCount&&n.diceFaces===e.diceConfig.diceFaces&&n.modifierSign===e.diceConfig.modifierSign&&n.modifierValue===e.diceConfig.modifierValue||(a.diceConfig=n);const i=w(parseInt(y,10)||e.trialCount,1,Je);i!==e.trialCount&&(a.trialCount=i),(s||Object.keys(a).length>0)&&r(e.id,a),t()},className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors",children:n(s?"common:button.create":"common:button.save")})]})]})})});function Et({items:e,selectedIds:t,onDeselectAll:r,renderItem:a,emptyMessage:s,className:o="",itemClassName:l="",footer:c,showSelectionCount:d=!0,enableDragAndDrop:g=!1,onReorder:u}){const{t:h}=Fe(),[p,m]=n.useState(null),[f,x]=n.useState(null),[b,y]=n.useState(null),[v,k]=n.useState(null),[w,C]=n.useState(null),[S,j]=n.useState(null),N=n.useRef(new Map),D=n.useRef(null),L=s||h("common:emptyState.noItems");n.useEffect(()=>{N.current.clear()},[e.length]);const A=e=>(N.current.has(e)||N.current.set(e,n.createRef()),N.current.get(e)),M=e=>{g&&(e.target.style.opacity="1",m(null),x(null))};return i.jsxs("div",{className:`flex flex-col pb-10 h-full ${o}`,children:[i.jsxs("div",{ref:D,className:"fixed -left-[9999px] -top-[9999px] bg-accent-light-500 dark:bg-accent-dark-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",style:{zIndex:9999,opacity:1},children:[i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}),i.jsx("span",{className:"font-medium text-sm",children:"移動中..."})]}),i.jsx("div",{className:"flex-1 space-y-2 pb-10",children:0===e.length?i.jsx("p",{className:"text-center text-gray-400 dark:text-gray-500 py-8",children:L}):e.map((r,s)=>{const n=t.includes(r.id),o=p===s,c=w===s,d=f===s&&(null!==p||null!==w)&&p!==s&&w!==s,h={};if(c&&null!==b&&null!==v&&S){const e=v-b;h.position="fixed",h.top=S.top+e,h.left=S.left,h.width=S.width,h.zIndex=1e3,h.pointerEvents="none",h.transition="none",h.opacity=.7}else h.transition="all 0.2s",h.opacity=o?.5:1;return i.jsxs("div",{onDragOver:e=>((e,t)=>{g&&(e.preventDefault(),e.dataTransfer.dropEffect="move",null!==p&&p!==t&&f!==t&&x(t))})(e,s),onDrop:t=>((t,r)=>{if(!g||!u)return;if(t.preventDefault(),null===p||p===r)return;const a=[...e],[s]=a.splice(p,1);a.splice(r,0,s),u(a),m(null),x(null)})(t,s),onTouchStart:e=>((e,t)=>{if(!g)return;const r=e.target,a=A(t).current;if(!a||!a.contains(r))return;e.stopPropagation(),e.preventDefault();const s=e.currentTarget;j(s.getBoundingClientRect()),y(e.touches[0].clientY),k(e.touches[0].clientY),C(t)})(e,s),onTouchMove:t=>((t,r)=>{if(!g||w!==r||null===b)return;t.preventDefault(),t.stopPropagation();const a=t.touches[0].clientY;k(a);const s=t.currentTarget.getBoundingClientRect().height,n=a-b,i=.5*s;if(Math.abs(n)>i){const t=Math.round(n/s),a=Math.max(0,Math.min(e.length-1,r+t));x(a!==r?a:null)}else x(null)})(t,s),onTouchEnd:()=>(t=>{if(g&&w===t){if(null!==f&&f!==t&&u){const r=[...e],[a]=r.splice(t,1);r.splice(f,0,a),u(r)}j(null),y(null),k(null),C(null),x(null)}})(s),onTouchCancel:()=>(e=>{g&&w===e&&(j(null),y(null),k(null),C(null),x(null))})(s),style:h,className:`${c?"":"relative"} ${l} ${d?(p??w)<s?"mb-4":"mt-4":""} ${o?"ring-2 ring-accent-light-500 dark:ring-accent-dark-500 ring-offset-2 dark:ring-offset-gray-800 rounded-lg":""}`,children:[d&&i.jsx("div",{className:`absolute left-0 right-0 h-1 bg-accent-light-500 dark:bg-accent-dark-500 rounded-full ${(p??w)<s?"-bottom-1":"-top-1"} z-10`}),a(r,n,s,g?{ref:A(s),onDragStart:e=>((e,t)=>{g&&(m(t),e.dataTransfer.effectAllowed="move",D.current&&e.dataTransfer.setDragImage(D.current,-10,20))})(e,s),onDragEnd:M,isDraggingOther:null!==p&&p!==s||null!==w&&w!==s}:void 0)]},r.id)})}),c&&i.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:[d&&i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.length,"件選択中"]}),r&&i.jsx("button",{onClick:r,disabled:0===t.length,className:"px-4 py-1.5 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-50 text-gray-800 dark:text-gray-200 font-medium rounded transition-colors",children:"選択解除"})]}),c]})]})}const Rt=({isSelected:e,onToggle:t,children:r,actions:a,showDragHandle:s=!1,dragHandleProps:n,clickable:o=!0,className:l="",showCheckbox:c=!0})=>i.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg transition-colors ${e?"bg-accent-light-100 dark:bg-accent-dark-900/30 border-2 border-accent-light-500 dark:border-accent-dark-500":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 border-2 border-transparent"} ${l}`,children:[s&&i.jsx("div",{ref:n?.ref,draggable:!!n,onDragStart:n?.onDragStart,onDragEnd:n?.onDragEnd,className:"touch-none select-none p-2 -m-2 cursor-grab active:cursor-grabbing",style:{touchAction:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none"},children:i.jsxs("svg",{className:"w-4 h-8 text-gray-400 flex-shrink-0",fill:"currentColor",viewBox:"0 0 16 16",children:[i.jsx("circle",{cx:"6",cy:"2",r:"1"}),i.jsx("circle",{cx:"10",cy:"2",r:"1"}),i.jsx("circle",{cx:"6",cy:"6",r:"1"}),i.jsx("circle",{cx:"10",cy:"6",r:"1"}),i.jsx("circle",{cx:"6",cy:"10",r:"1"}),i.jsx("circle",{cx:"10",cy:"10",r:"1"}),i.jsx("circle",{cx:"6",cy:"14",r:"1"}),i.jsx("circle",{cx:"10",cy:"14",r:"1"})]})}),c&&i.jsx("input",{type:"checkbox",checked:e,onChange:t,className:"mt-1 w-5 h-5 rounded border-gray-300 text-accent-light-500 focus:ring-accent-light-500 dark:border-gray-600 dark:bg-gray-700 dark:text-accent-dark-500 dark:focus:ring-accent-dark-500 cursor-pointer",onClick:e=>e.stopPropagation()}),i.jsx("div",{className:"flex-1 min-w-0 "+(o?"cursor-pointer":""),onClick:o?t:void 0,children:r}),a&&i.jsx("div",{className:"flex-shrink-0 relative",children:a})]}),Tt=({isOpen:e,buttonRef:t,items:r,onClose:s,iconClassName:o="w-4 h-4"})=>{const l=a.useRef(null);a.useEffect(()=>{const r=e=>{l.current&&!l.current.contains(e.target)&&t.current&&!t.current.contains(e.target)&&s()};if(e)return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[e,s,t]);return i.jsx("div",{ref:l,className:"absolute right-0 top-full mt-1 w-44 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[100] overflow-hidden border border-gray-200 dark:border-gray-600 transition-opacity "+(e?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:r.map((e,t)=>i.jsxs(n.Fragment,{children:[e.separator&&t>0&&i.jsx("div",{className:"border-t border-gray-200 dark:border-gray-600"}),i.jsxs("button",{onClick:t=>{t.stopPropagation(),(0,e.onClick)(),s()},disabled:e.disabled,title:e.title,className:"w-full px-4 py-2.5 text-left transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed "+(e.danger?"hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400":"hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white"),children:[e.customIcon?e.customIcon:e.icon?i.jsx(Xe,{name:e.icon,className:o}):i.jsx("div",{className:o}),i.jsx("span",{className:"text-sm",children:e.label})]})]},e.id))})},Ot=({buttonRef:e,onClick:t,title:r,iconClassName:a="w-4 h-4"})=>i.jsx("button",{ref:e,onClick:t,className:"w-8 h-8 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded transition-colors inline-flex items-center justify-center",title:r,children:i.jsx(Xe,{name:"dots-vertical",className:a})}),It=n.memo(({session:e,isSelected:t,onToggle:r,showDragHandle:a=!1,dragHandleProps:s,showCheckbox:n=!1,sessionsLength:o,onSetEditingSessionId:l,onDuplicateSession:c,onDeleteSession:d,openMenuId:g,onOpenMenu:u,menuButtonRef:h})=>{const p=((e,t,r,a,s)=>{const{t:n}=Fe();return[{id:"dice-config",label:n("common:menu.edit"),icon:"edit",onClick:()=>r(e.id)},{id:"duplicate",label:n("common:menu.duplicate"),customIcon:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),onClick:()=>a(e.id),disabled:t>=Ve,title:t>=Ve?n("sessions:limit.reached",{max:Ve}):""},{id:"delete",label:n("common:menu.delete"),customIcon:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:()=>{window.confirm(n("sessions:confirm.delete"))&&s(e.id)},danger:!0,separator:!0}]})(e,o,l,c,d);return i.jsxs(Rt,{isSelected:t,onToggle:r,showDragHandle:a,dragHandleProps:s,showCheckbox:n,actions:i.jsxs(i.Fragment,{children:[i.jsx(Ot,{buttonRef:h,onClick:t=>{t.stopPropagation(),u(g===e.id?null:e.id)}}),i.jsx(Tt,{isOpen:g===e.id,buttonRef:h,items:p,onClose:()=>u(null)})]}),children:[i.jsx("h3",{className:"font-semibold text-gray-800 dark:text-gray-100 truncate",children:vt(e.diceConfig)}),i.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:e.name||""})]})});It.displayName="SessionListItem";const Pt=n.memo(({sessions:e,compareSessionIds:t,isMultiSelectMode:r,onToggleMultiSelectMode:a,onCreateSession:s,onToggleCompareSession:o,onExportSessions:l,onImportSessions:c,onBulkDuplicateSessions:d,onBulkDeleteSessions:g,onDeleteAllSessions:u})=>{const{t:h}=Fe(["sessions","common"]),[p,m]=n.useState(!1),f=n.useRef(null),x=n.useRef(null);n.useEffect(()=>{const e=e=>{x.current&&!x.current.contains(e.target)&&m(!1)};if(p)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[p]);const b=e=>{e(),m(!1)},y=()=>{0!==e.length&&window.confirm(h("sessions:confirm.deleteAll"))&&u()};return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-between gap-2 mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:s,disabled:e.length>=Ve,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",title:e.length>=Ve?h("sessions:limit.reached",{max:Ve}):h("sessions:tooltip.create"),children:["+ ",h("sessions:action.createShort")]}),i.jsxs("label",{className:"flex items-center gap-3 cursor-pointer select-none px-2 py-2 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[i.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:h("sessions:multiSelect.label")}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",checked:r,onChange:a,className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-300 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-accent-light-300 dark:peer-focus:ring-accent-dark-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-light-500 dark:peer-checked:bg-accent-dark-500"})]})]})]}),i.jsxs("div",{className:"relative",ref:x,children:[i.jsx("button",{onClick:()=>m(!p),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:h("charts:menu.options"),children:i.jsx(Xe,{name:"dots-vertical",className:"w-5 h-5"})}),p&&i.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[i.jsxs("label",{htmlFor:"session-file-import",className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 cursor-pointer",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),i.jsx("span",{className:"text-sm",children:h("sessions:action.import")})]}),i.jsxs("button",{onClick:()=>b(l),disabled:0===e.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),i.jsx("span",{className:"text-sm",children:h("sessions:action.export")})]}),i.jsx("button",{onClick:()=>{t.forEach(e=>o(e))},disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",title:h("sessions:action.clearSelection"),children:i.jsx("span",{className:"text-sm",children:h("sessions:action.clearSelection")})}),i.jsxs("button",{onClick:()=>b(()=>d(t)),disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),i.jsx("span",{className:"text-sm",children:h("sessions:action.bulkDuplicateShort")})]}),i.jsxs("button",{onClick:()=>b(()=>g(t)),disabled:0===t.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),i.jsx("span",{className:"text-sm",children:h("sessions:action.bulkDeleteShort")})]}),i.jsxs("button",{onClick:()=>b(y),disabled:0===e.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),i.jsx("span",{className:"text-sm",children:h("sessions:action.deleteAllShort")})]})]})]})]}),i.jsx("input",{id:"session-file-import",ref:f,type:"file",accept:".json,application/json",onChange:e=>{const t=e.target.files?.[0];t&&(c(t),f.current&&(f.current.value="")),m(!1)},className:"hidden"})]})});Pt.displayName="SessionListActionBar";const{slice:$t,forEach:Ft}=[];const Vt=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,Bt={create(e,t,r,a){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/",sameSite:"strict"};r&&(s.expires=new Date,s.expires.setTime(s.expires.getTime()+60*r*1e3)),a&&(s.domain=a),document.cookie=function(e,t){const r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{path:"/"};let a=`${e}=${encodeURIComponent(t)}`;if(r.maxAge>0){const e=r.maxAge-0;if(Number.isNaN(e))throw new Error("maxAge should be a Number");a+=`; Max-Age=${Math.floor(e)}`}if(r.domain){if(!Vt.test(r.domain))throw new TypeError("option domain is invalid");a+=`; Domain=${r.domain}`}if(r.path){if(!Vt.test(r.path))throw new TypeError("option path is invalid");a+=`; Path=${r.path}`}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");a+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.sameSite)switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(a+="; Partitioned"),a}(e,t,s)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let a=0;a<r.length;a++){let e=r[a];for(;" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(t))return e.substring(t.length,e.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var Wt={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&"undefined"!=typeof document)return Bt.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:a,cookieDomain:s,cookieOptions:n}=t;r&&"undefined"!=typeof document&&Bt.create(r,e,a,s,n)}},Ut={name:"querystring",lookup(e){let t,{lookupQuerystring:r}=e;if("undefined"!=typeof window){let{search:e}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(e=window.location.hash.substring(window.location.hash.indexOf("?")));const a=e.substring(1).split("&");for(let s=0;s<a.length;s++){const e=a[s].indexOf("=");if(e>0){a[s].substring(0,e)===r&&(t=a[s].substring(e+1))}}}return t}},zt={name:"hash",lookup(e){let t,{lookupHash:r,lookupFromHashIndex:a}=e;if("undefined"!=typeof window){const{hash:e}=window.location;if(e&&e.length>2){const s=e.substring(1);if(r){const e=s.split("&");for(let a=0;a<e.length;a++){const s=e[a].indexOf("=");if(s>0){e[a].substring(0,s)===r&&(t=e[a].substring(s+1))}}}if(t)return t;if(!t&&a>-1){const t=e.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(t))return;const r="number"==typeof a?a:0;return t[r]?.replace("/","")}}}return t}};let Ht=null;const qt=()=>{if(null!==Ht)return Ht;try{if(Ht="undefined"!=typeof window&&null!==window.localStorage,!Ht)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch(e){Ht=!1}return Ht};var _t={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&qt())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&qt()&&window.localStorage.setItem(r,e)}};let Jt=null;const Kt=()=>{if(null!==Jt)return Jt;try{if(Jt="undefined"!=typeof window&&null!==window.sessionStorage,!Jt)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch(e){Jt=!1}return Jt};var Gt={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&Kt())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&Kt()&&window.sessionStorage.setItem(r,e)}},Yt={name:"navigator",lookup(e){const t=[];if("undefined"!=typeof navigator){const{languages:e,userLanguage:r,language:a}=navigator;if(e)for(let s=0;s<e.length;s++)t.push(e[s]);r&&t.push(r),a&&t.push(a)}return t.length>0?t:void 0}},Qt={name:"htmlTag",lookup(e){let t,{htmlTag:r}=e;const a=r||("undefined"!=typeof document?document.documentElement:null);return a&&"function"==typeof a.getAttribute&&(t=a.getAttribute("lang")),t}},Zt={name:"path",lookup(e){let{lookupFromPathIndex:t}=e;if("undefined"==typeof window)return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(!Array.isArray(r))return;const a="number"==typeof t?t:0;return r[a]?.replace("/","")}},Xt={name:"subdomain",lookup(e){let{lookupFromSubdomainIndex:t}=e;const r="number"==typeof t?t+1:1,a="undefined"!=typeof window&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(a)return a[r]}};let er=!1;try{document.cookie,er=!0}catch(da){}const tr=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];er||tr.splice(1,1);class rr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{languageUtils:{}},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=function(e){return Ft.call($t.call(arguments,1),t=>{if(t)for(const r in t)void 0===e[r]&&(e[r]=t[r])}),e}(t,this.options||{},{order:tr,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e}),"string"==typeof this.options.convertDetectedLanguage&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=e=>e.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(Wt),this.addDetector(Ut),this.addDetector(_t),this.addDetector(Gt),this.addDetector(Yt),this.addDetector(Qt),this.addDetector(Zt),this.addDetector(Xt),this.addDetector(zt)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.order,t=[];return e.forEach(e=>{if(this.detectors[e]){let r=this.detectors[e].lookup(this.options);r&&"string"==typeof r&&(r=[r]),r&&(t=t.concat(r))}}),t=t.filter(e=>{return null!=e&&!("string"==typeof(t=e)&&[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(e=>e.test(t)));var t}).map(e=>this.options.convertDetectedLanguage(e)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.caches;t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(t=>{this.detectors[t]&&this.detectors[t].cacheUserLanguage(e,this.options)}))}}rr.type="languageDetector";const ar={button:{start:"開始",reroll:"振り直し",addRoll:"追加ロール",save:"保存",cancel:"キャンセル",close:"閉じる",delete:"削除",duplicate:"複製",edit:"編集",apply:"適用",confirm:"確認",create:"作成",export:"エクスポート",import:"インポート",copy:"コピー",reset:"リセット",ok:"OK",yes:"はい",no:"いいえ",back:"戻る",next:"次へ"},unit:{count:"件",piece:"個",times:"回",session:"ダイスセット"},label:{loading:"読み込み中...",processing:"処理中...",noData:"データがありません",help:"ヘルプ",toggleTheme:"テーマ切り替え",toggleLanguage:"言語切り替え",settings:"設定",firstPage:"最初のページ",lastPage:"最後のページ",quantile:"分位点",aggregation:"集約",target:"対象",all:"すべて",preview:"プレビュー",list:"リスト",roll:"ロール",start:"開始",addMore:"さらに振る",noChanges:"変更なし",trial:"試行",dice:"ダイス",modifier:"補正",total:"合計"},punctuation:{comma:"、"},none:"なし",unnamed:"名称未設定",siteName:"てすとDice",menu:{options:"オプション",edit:"編集",duplicate:"複製",delete:"削除"},emptyState:{noItems:"アイテムがありません"},custom:"カスタム"},sr={title:"ガイド",closeButton:"閉じる",aboutSection:{description:{before:"当アプリの詳細情報やプライバシーポリシーについては",after:"をご覧ください。"},linkText:"こちら"},basicSettings:{diceNotation:{title:"ダイス記法について",description:"ダイス記法は以下の形式で指定します：",format:"dice[個数]d[面数](+|-)[修正値]",parameters:{count:{label:"個数",description:"振るダイスの数（1〜10）"},sides:{label:"面数",description:"ダイスの面の数（1〜9,999）"},modifier:{label:"修正値",description:"オプション。結果に加算または減算する値（0〜99,999）"}}},examples:{title:"使用例",items:[{notation:"dice1d6",description:"→ 6面ダイスを1個振る"},{notation:"dice3d6+2",description:"→ 6面ダイスを3個振り、合計に2を加算"},{notation:"dice2d10-5",description:"→ 10面ダイスを2個振り、合計から5を減算"}]},trials:{title:"試行回数",description:"同じダイスロールを複数回実行できます（1〜1,000回）。\n試行回数を増やすことで、より正確な確率分布を確認できます。"}},diceSetManagement:{diceSetFeatures:{title:"ダイスセット機能",features:["各ダイスセットに任意の名前を付けて保存できます（最大128文字）","最大20個のダイスセットを保存可能","結果はブラウザのIndexedDBに自動保存されます","ダイスセットの複製と削除が可能","ドラッグ&ドロップでダイスセットの並び替えが可能","ダイスセット全体をJSON形式でエクスポート/インポート可能","複数のダイスセットを選択して一括で複製・削除が可能","全ダイスセットを一括削除する機能（確認ダイアログ付き）"]},comparison:{title:"ダイスセットの比較",features:["複数のダイスセットを選択してグラフで比較表示が可能","比較モードでは各ダイスセットが異なる色で表示されます","最大20個のダイスセットまで同時比較可能","比較時は各ダイスセットのラベルに試行回数が表示されます"]}},resultDisplay:{title:"結果の表示",table:{label:"表形式",description:"各試行の詳細な結果を一覧表示",features:["試行番号、各ダイスの値、合計値を表示","ページネーション機能（1ページあたり25件表示）","CSV形式でのエクスポートが可能"]},chart:{label:"グラフ形式",description:"結果の分布を視覚化（4種類のグラフ）",types:{distribution:{icon:"📊",title:"合計値の分布",features:["全試行の合計値の分布をヒストグラムで表示","棒グラフと折れ線グラフの切り替え可能","統計情報をアノテーションラインで表示（平均値：緑、中央値：オレンジ、期待値：ピンク、±1σ：紫）","中央値に該当するバー/ポイントをオレンジ色でハイライト","理論分布を灰色の点線で重ねて表示（単一セッション時のみ）","データ集約機能で大量データを見やすく表示"]},cumulative:{icon:"📈",title:"累積分布",features:["確率の累積分布を表示","合計値と個別のダイスの両方に対応","実測値と理論値の比較が可能","分位点（10分位、20分位など）の表示切り替え機能","「この値以下が出る確率」を視覚的に把握可能"]},progress:{icon:"📉",title:"試行の推移",features:["各試行での合計値の推移を表示","時系列で結果の変動を確認可能","移動平均線を表示してトレンドを把握","移動平均のウィンドウサイズを調整可能（5〜100試行）"]},individualDice:{icon:"🎲",title:"個別の出目の分布",features:["各ダイスの出目の分布を表示（ダイスが2個以上の場合）","棒グラフと折れ線グラフの切り替え可能","理論分布を灰色の点線で重ねて表示","データ集約機能で大量データを見やすく表示"]}}}},advancedFeatures:{dataAggregation:{title:"データ集約機能",description:"グラフ表示時、データポイント数が多い場合は集約機能を使用することで、見やすく表示できます。",features:[{label:"データ集約を使用する",description:"指定した間隔を目安にデータを均等にまとめて表示"},{label:"集約間隔の目安",description:"おおよそ何件ずつにまとめるかを設定（2〜5,000、デフォルト: 20）"},{label:"対応グラフ",description:"合計値の分布グラフ、個別の出目の分布グラフ"},{label:"例: 間隔を20に設定すると、全体を約20件ずつの均等なグループに分割します",subFeatures:["端数が出ないよう、各グループはできるだけ均等なサイズに自動調整されます"]},{label:"集約時はグラフタイトルに「集約：XX」と表示されます"}]},chartSettings:{title:"チャート設定の保存",description:"グラフの表示設定（チャートタイプ、集約設定など）を保存して再利用できます。",features:["複数の設定プリセットを作成・管理可能","設定の名前変更、複製、削除が可能","未保存の変更がある場合は警告を表示","各グラフの表示設定を個別に保存","デフォルト設定は削除・変更不可"]}},globalSettings:{title:"全体設定",description:"ヘッダー（モバイル版はフッター）の歯車アイコンから全体設定を開くことができます。",appearance:{label:"外観",features:["テーマ切り替え（ライト/ダーク/システム設定に従う）","選択はブラウザに自動保存されます"]},dataManagement:{label:"データ管理",features:[{label:"データのエクスポート",description:"全ダイスセットとカスタムグラフ設定をJSON形式でバックアップ",subFeatures:["デフォルト設定とプリセット設定は除外されます"]},{label:"データのインポート",description:"エクスポートしたJSONファイルから復元",subFeatures:["既存データとマージされます（上書きではありません）"]},{label:"全データの削除",description:"全てのダイスセットとグラフ設定を削除（確認ダイアログ付き）"},{label:"保存されているダイスセット数とグラフ設定数を表示"}]}},operations:{retryAndRoll:{title:"再試行と追加ロール",features:[{label:"結果リセット",description:"現在のダイスセットの結果をクリア（確認ダイアログ付き）"},{label:"再試行",description:"既存の結果をクリアして新しい結果に置き換え"},{label:"追加ロール",description:"既存の結果を保持したまま追加でダイスロールを実行",subFeatures:["ダイス設定が変更されている場合は警告を表示","追加実行時は既存データと統合されます"]}]},dataExport:{title:"データのエクスポート",description:"結果とダイスセットデータを様々な形式でエクスポートできます。",features:[{label:"CSV形式",description:"結果を表形式のCSVファイルでダウンロード"},{label:"PNG形式",description:"グラフを画像でダウンロード"},{label:"JSON形式",description:"ダイスセット全体をJSON形式でエクスポート/インポート"},{label:"クリップボードコピー",description:"ダイス設定のプレビュー文字列をコピー"}]}}},nr={title:"About / Privacy",close:"閉じる",sections:{app:{title:"このアプリについて",description:"{{siteName}}は、複数のダイスロールをシミュレーションし、結果を統計的に分析するためのWebアプリケーションです。TRPG（テーブルトークRPG）やボードゲームなどで使用するダイスの確率分布を確認することができます。"},data:{title:"データの取り扱い",items:["このアプリケーションはすべてのデータをブラウザ内にローカル保存します","ダイスセットデータ: IndexedDBに保存","設定（ダークモード等）: LocalStorageに保存","サーバーへのデータ送信は一切行いません","個人情報の収集は行いません","外部サービスとの連携はありません","データの管理はユーザー自身の責任で行ってください。ブラウザのデータクリアやアップデートにより保存データが消失する可能性があるため、重要なデータは定期的にエクスポート機能でバックアップすることを推奨します"]},disclaimer:{title:"免責事項",items:["このアプリケーションは無保証で提供されます","動作の正確性や継続性についても保証いたしかねます","本アプリの使用により生じた損害について、開発者は一切の責任を負いません"]},libraries:{title:"使用ライブラリ",description:"このアプリケーションは以下のオープンソースライブラリを使用しています：",items:["React (MIT License)","Chart.js (MIT License)","Tailwind CSS (MIT License)","Vite (MIT License)"]},version:{version:"Version: {{version}}",lastUpdated:"Last Updated: {{date}}"}}},ir={title:"全体設定",close:"閉じる",appearance:{title:"外観",theme:{title:"テーマ",description:"アプリの表示テーマを選択できます",light:"ライト",dark:"ダーク",system:"システム"},language:{title:"言語",description:"アプリの表示言語を選択できます"}},dataManagement:{title:"データ管理",currentData:{title:"保存されているデータ",diceSets:"ダイスセット: {{count}}件",chartSettings:"グラフ設定: {{count}}件"},backup:{title:"バックアップと復元",description:"すべてのダイスセットとチャート設定を含む完全なバックアップをJSON形式でエクスポート・インポートできます。旧形式のダイスセットのみのファイルにも対応しています。",export:"エクスポート",exportDescription:"すべてのデータをJSON形式で保存",import:"インポート",importDescription:"バックアップファイルから復元"},reset:{title:"データの完全消去",description:"すべてのダイスセット、チャート設定、アプリケーション設定を削除します。この操作は元に戻せません。",button:"すべてのデータを削除",confirm:"本当にすべてのデータを削除しますか？",confirmButton:"削除する",cancel:"キャンセル",processing:"削除中...",resetError:"データの初期化に失敗しました"}},system:{resetError:"IndexedDBの削除に失敗しました"},chartSettings:{title:"グラフビュー管理",renameTitle:"設定名を変更",duplicateTitle:"設定を複製",close:"閉じる",new:"+ 新規",create:"新規作成",rename:"名前変更",duplicate:"複製",delete:"削除",save:"保存",change:"変更",cancel:"キャンセル",discard:"破棄",preset:"プリセット",custom:"カスタム",inUse:"使用中",selected:"{{count}}件選択",emptyMessage:"設定がありません",maxLength:"最大128文字",copyNameSuffix:"のコピー",unsavedChanges:"未保存の変更があります",unsavedWarning:"未保存の変更があります。保存したい設定の「保存」ボタンをクリックしてください。",savePrompt:"変更を保存しますか？",nameLabel:"設定名",namePlaceholder:"設定名を入力",moreOptions:"その他のオプション",bulkActions:{title:"一括操作",duplicate:"選択を一括複製",delete:"選択を一括削除",selectAll:"すべて選択",deselectAll:"選択解除"},errors:{nameRequired:"設定名を入力してください",duplicateFailed:"設定の複製に失敗しました",renameFailed:"設定の名前変更に失敗しました",deleteFailed:"設定の削除に失敗しました",saveFailed:"保存に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",cannotDeletePreset:"プリセット設定は削除できません",noSelection:"削除可能な設定が選択されていません",noDuplicateSelection:"複製する設定を選択してください"},confirmDelete:"設定「{{name}}」を削除しますか？",confirmBulkDelete:"{{count}}件の設定を削除しますか？"},about:{link:"About / Privacy"}},or={type:{bar:"棒グラフ",line:"線グラフ"},title:{totalDistribution:"合計値の分布",cumulative:"累積分布 - {{diceCode}} / {{trials}}回試行{{quantile}}",cumulativeTotalBase:"累積分布（合計値）",cumulativeIndividualBase:"累積分布（全ダイスの出目）",cumulativeIndividual:"累積分布 (全ダイスの出目) - {{diceCode}} / {{trials}}回試行{{quantile}}",cumulativeComparison:"累積分布の比較 - {{count}}件のダイスセット比較{{quantile}}",cumulativeComparisonIndividual:"累積分布の比較 (全ダイスの出目) - {{count}}件のダイスセット比較{{quantile}}",cumulativeAggregated:"累積分布 - {{diceCode}} (集約)",individualDice:"個別の出目の分布",rollProgress:"試行推移 - {{diceCode}} / {{trials}}回試行{{aggregation}}",rollProgressBase:"試行推移",rollProgressComparison:"試行推移の比較 - {{count}}件のダイスセット比較{{aggregation}}",targetValue:"特定の目の出現",comparison:"{{count}}件のダイスセット比較"},subtitle:{trialCount:"{{count}}回試行",aggregation:"集約：{{interval}}",quantilePoints:"分位点：{{count}}",custom:"カスタム"},legend:{actual:"実測値",actualSampled:"実測値 (サンプリング)",actualCumulative:"累積分布 (実測)",theoretical:"期待頻度 (理論値)",theoreticalCumulative:"理論値",movingAverage:"移動平均",movingAverageWindow:"移動平均 ({{window}}試行)",expectedValue:"期待値 ({{value}})"},axis:{total:"合計値",diceValue:"ダイスの出目",trialNumber:"試行回数",frequency:"出現回数",cumulativeProbability:"累積確率 (%)",dicePosition:"ダイス位置"},stats:{mean:"平均",median:"中央値",mode:"最頻値",stdDev:"標準偏差",expectedValue:"期待値",totalCount:"合計",averagePerDice:"平均（各ダイス）",maxCount:"最大",minCount:"最小",individualStats:"個別の出目の統計",dataPoints:"表示データポイント数: {{count}}点"},options:{title:"グラフオプション",chartType:"グラフタイプ",displaySettings:"表示設定",manageSettings:"設定を管理",createNew:"新しい設定を作成",settingsName:"設定名",settingsNamePlaceholder:"設定名を入力",maxLength:"最大128文字",download:"画像ダウンロード",aggregation:{title:"データ集約",useAggregation:"集約を使用",intervalLabel:"集約間隔の目安（件数）",apply:"適用",reset:"リセット",status:"データポイント数: {{count}}",statusAggregated:"✓ 集約中（約{{interval}}件ずつ）"},targetValue:{title:"特定の目を集計",label:"集計する目の値",range:"{{min}}-{{max}}の範囲で指定"},movingAverage:{title:"移動平均の設定",windowLabel:"移動平均ウィンドウ（試行数）",apply:"適用",reset:"リセット",description:"移動平均を表示: {{window}}試行"},cumulative:{title:"累積分布の設定",distributionType:"分布タイプ",total:"合計値",individual:"出目（全ダイス統合）",dataRange:"データ表示範囲",fullRange:"全範囲",actualOnly:"実データのみ",quantileAggregation:"分位点による集約",points:"{{count}}点",aggregationLabel:"集約: {{count}}点",apply:"適用",reset:"リセット"}},noData:"結果がありません",message:{startRoll:"ダイスロールを実行すると、ここに結果が表示されます"},description:{totalDistribution:"全試行における合計値の出現頻度をヒストグラムで表示します。",theoreticalDistributionComparison:"期待頻度（理論値）と比較して、実際の分布の偏りを確認できます。",cumulativeTotal:"特定の合計値以上が出る確率の累積分布を表示しています。",cumulativeIndividual:"特定の出目以上が出る確率の累積分布を表示しています。",theoreticalComparison:"理論値（点線）と実測値を比較できます。",rollProgress:"各試行での合計値の推移を表示しています。移動平均により傾向を把握できます。",expectedValueComparison:"期待値ライン（点線）との比較で、偏りの有無を確認できます。",progressDescription:"各試行での合計値の推移を表示しています。移動平均により傾向を把握できます。",expectedLineDescription:"期待値ライン（点線）との比較で、偏りの有無を確認できます。",individualDiceDescription:"このグラフは、複数のダイスを振った際に、それぞれのダイスで出た目を個別に集計したものです。\n各出目が全体で何回出現したかを表示しています。"},view:{chart:"グラフ",table:"表形式",manage:"グラフビュー管理",saveCurrentView:"現在のビューを保存",overwrite:"上書き",selectView:"グラフビュー",presetGroup:"プリセット設定",customGroup:"カスタム設定"},preset:{default:"デフォルト設定","2digit":"2桁面向け","4digit":"4桁面向け"},menu:{options:"その他のオプション",csvDownload:"CSVダウンロード",rollReset:"ロールリセット",confirmReset:"結果をリセットしてもよろしいですか？",csvDownloadFailed:"CSVのダウンロードに失敗しました"},targetStats:{title:{base:"特定の目の集計",single:"特定の目（{{value}}）の集計 - {{dice}} / {{trials}}回試行",comparison:"特定の目（{{value}}）の比較 - {{count}}件のダイスセット比較"},occurrences:"{{value}}の出現回数",occurrenceRate:"（出現率: {{rate}}%）",yAxis:"出現回数",summary:{title:"【{{value}}】の統計サマリー",total:"合計出現回数: {{count}}回",average:"ダイスあたり平均: {{average}}回",rate:"全試行中の出現率: {{rate}}%",range:"最大: {{max}}回 / 最小: {{min}}回"},totalAppearances:"合計出現回数",averagePerDice:"ダイスあたり平均",appearanceRate:"出現率",maxMin:"最大: {{max}}回 / 最小: {{min}}回"},result:{title:"結果表示"}},lr={config:{title:"ダイス設定",titleEdit:"ダイス設定の編集",titleCreate:"ダイス設定の新規追加",editingMultiple:"{{count}}件編集",name:{label:"ダイスセット名（128文字まで）",placeholder:"名称未設定"},count:{label:"ダイスの数 ({{min}}-{{max}})",description:"振るダイスの数"},sides:{label:"面の数 ({{min}}-{{max}})",description:"ダイスの面の数"},modifier:{label:"修正値 ({{min}}-{{max}})",sign:"符号",value:"値",add:"加算",subtract:"減算"},trial:{label:"試行回数 ({{min}}-{{max}})",description:"実行する試行の回数"},notation:{label:"ダイス記法",copy:"クリップボードにコピー",copied:"コピー完了",preview:"プレビュー"},editing:{multipleMessage:"{{count}}件のダイスセットを編集中です"},unspecified:"未指定"},action:{simulate:"ダイスロール開始",reroll:"振り直し",addRoll:"追加ロール",reset:"結果をリセット",export:"CSVでエクスポート"}},cr={title:"ダイスセット一覧",empty:"ダイスセットがありません",selectPrompt:"ダイスセットを選択してください",selectOrCreatePrompt:"ダイスセットを選択または作成してください",list:{multiSelectMode:"複数選択モード",selected:"{{count}}件選択中",comparing:"{{count}}件のダイスセットを比較中"},action:{create:"新規作成",createShort:"新規",compare:"比較",export:"エクスポート",import:"インポート",bulkDelete:"一括削除",bulkDuplicate:"一括複製",bulkDuplicateShort:"選択を一括複製",bulkDeleteShort:"選択を一括削除",deleteAll:"全て削除",deleteAllShort:"全削除",reorder:"並び替え",clearSelection:"選択解除",change:"変更",selectSession:"ダイスセットを選択"},confirm:{delete:"このダイスセットを削除してもよろしいですか？",deleteAll:"全てのダイスセットを削除してもよろしいですか？",bulkDelete:"選択した{{count}}件のダイスセットを削除してもよろしいですか？",bulkDeleteWarning:"選択中の{{count}}件のダイスセットを削除してもよろしいですか？\nこの操作は取り消せません。"},copy:{suffix:"のコピー"},limit:{reached:"ダイスセット数が上限（{{max}}個）に達しています",maxRecords:"記録可能な最大試行数（{{max}}回）を超えています"},target:{label:"対象",all:"すべて ({{count}})",selected:"選択中"},multiSelect:{label:"複数選択"},viewing:{single:"{{count}}件のダイスセットを閲覧中",multiple:"{{count}}件のダイスセットを比較中"},tooltip:{create:"新しいダイスセットを作成",maxReached:"ダイスセット数が上限に達しています",addRollDisabled:"特定の目が変更されたため追加ロールできません"}},dr={dice:{count:{required:"ダイスの数を入力してください",range:"ダイスの数は{{min}}〜{{max}}の範囲で指定してください",invalid:"ダイスの数が不正です"},sides:{required:"面の数を入力してください",range:"面の数は{{min}}〜{{max}}の範囲で指定してください",invalid:"面の数が不正です"},modifier:{range:"修正値は{{min}}〜{{max}}の範囲で指定してください",invalid:"修正値が不正です"}},trial:{required:"試行回数を入力してください",range:"試行回数は{{min}}〜{{max}}の範囲で指定してください",invalid:"試行回数が不正です"},session:{nameRequired:"ダイスセット名を入力してください",nameTooLong:"ダイスセット名は{{max}}文字以内で入力してください",limitReached:"ダイスセット数の上限に達しています"},file:{invalidFormat:"ファイル形式が不正です",parseError:"ファイルのパースに失敗しました",readError:"ファイルの読み込みに失敗しました"},chart:{aggregationRange:"集約間隔は{{min}}〜{{max}}の範囲で指定してください",targetValueRange:"目の値は{{min}}〜{{max}}の範囲で指定してください"}},gr={success:{sessionCreated:"新しいダイスセットを作成しました",sessionDeleted:"ダイスセットを削除しました",sessionDuplicated:"ダイスセットを複製しました",sessionUpdated:"ダイス設定を更新しました",bulkDeleted:"{{count}}件のダイスセットを削除しました",bulkDuplicated:"{{count}}件のダイスセットを複製しました",rollCompleted:"{{count}}回のダイスロールが完了しました",dataExported:"データをエクスポートしました",dataImported:"データをインポートしました",migrated:"LocalStorageからIndexedDBへ移行しました",copied:"クリップボードにコピーしました",settingsCreated:"設定を作成しました",settingsCreatedWithName:"設定「{{name}}」を作成しました",settingsDuplicatedWithName:"設定「{{name}}」を複製しました",settingsSaved:"設定を保存しました",settingsRenamed:"設定名を変更しました",settingsDeleted:"設定を削除しました"},error:{sessionCreateFailed:"ダイスセットの作成に失敗しました",sessionDeleteFailed:"ダイスセットの削除に失敗しました",sessionDuplicateFailed:"ダイスセットの複製に失敗しました",sessionUpdateFailed:"ダイスセットの更新に失敗しました",bulkDeleteFailed:"一括削除に失敗しました",bulkDuplicateFailed:"一括複製に失敗しました",rollFailed:"ダイスロールに失敗しました",loadFailed:"データの読み込みに失敗しました",exportFailed:"エクスポートに失敗しました",importFailed:"インポートに失敗しました",copyFailed:"クリップボードへのコピーに失敗しました",csvDownloadFailed:"CSVのダウンロードに失敗しました",imageGenerationFailed:"画像の生成に失敗しました",generic:"エラーが発生しました",partialSuccess:"{{completed}}件完了、{{failed}}件エラー:\n{{errors}}",cannotModifyDefault:"デフォルト設定は変更できません",sessionLimitReached:"ダイスセット数が上限（{{max}}個）に達しています",bulkDuplicateLimitReached:"ダイスセット数の上限により、{{count}}件までしか複製できません",trialCountExceeded:"試行回数が上限の{{max}}件を超えています",maxRecordsExceeded:"記録可能な上限（{{max}}件）を超えるため、追加ロールできません",settingImportSkipped:'チャート設定 "{{name}}" のインポートをスキップ:'},import:{successWithDetails:"{{details}}をインポートしました",sessionsCount:"ダイスセット{{count}}件",chartSettingsCount:"チャート設定{{count}}件"},info:{processing:"処理中...",simulating:"シミュレーション中... ({{progress}}%)",noResults:"結果がありません",noSessions:"ダイスセットがありません",resetResults:"結果をリセットしました",selectSession:"ダイスセットを選択してください"},warning:{unsavedChanges:"未保存の変更があります",configChanged:"ダイス設定が変更されています",noImportableData:"インポートできるデータがありません（すべて既に存在します）",addRollDisabled:"特定の目が変更されたため追加ロールできません"}},ur={button:{start:"Start",reroll:"Reroll",addRoll:"Add Roll",save:"Save",cancel:"Cancel",close:"Close",delete:"Delete",duplicate:"Duplicate",edit:"Edit",apply:"Apply",confirm:"Confirm",create:"Create",export:"Export",import:"Import",copy:"Copy",reset:"Reset",ok:"OK",yes:"Yes",no:"No",back:"Back",next:"Next"},unit:{count:"items",piece:"pcs",times:"times",session:"dice set"},label:{loading:"Loading...",processing:"Processing...",noData:"No data available",help:"Help",toggleTheme:"Toggle Theme",toggleLanguage:"Toggle Language",settings:"Settings",firstPage:"First Page",lastPage:"Last Page",quantile:"Quantile",aggregation:"Aggregation",target:"Target",all:"All",preview:"Preview",list:"List",roll:"Roll",start:"Start",addMore:"Roll more",noChanges:"No changes",trial:"Trial",dice:"Dice",modifier:"Modifier",total:"Total"},punctuation:{comma:", "},none:"None",unnamed:"Unnamed",siteName:"Dice Simulator",menu:{options:"Options",edit:"Edit",duplicate:"Duplicate",delete:"Delete"},emptyState:{noItems:"No items available"},custom:"Custom"},hr={title:"Guide",closeButton:"Close",aboutSection:{description:{before:"For more information about this app and privacy policy, please see",after:"."},linkText:"here"},basicSettings:{diceNotation:{title:"About Dice Notation",description:"Dice notation is specified in the following format:",format:"dice[count]d[sides](+|-)[modifier]",parameters:{count:{label:"Count",description:"Number of dice to roll (1-10)"},sides:{label:"Sides",description:"Number of sides on each die (1-9,999)"},modifier:{label:"Modifier",description:"Optional. Value to add or subtract from result (0-99,999)"}}},examples:{title:"Usage Examples",items:[{notation:"dice1d6",description:"→ Roll one 6-sided die"},{notation:"dice3d6+2",description:"→ Roll three 6-sided dice and add 2 to the total"},{notation:"dice2d10-5",description:"→ Roll two 10-sided dice and subtract 5 from the total"}]},trials:{title:"Number of Trials",description:"You can execute the same dice roll multiple times (1-1,000 times).\nIncreasing the number of trials allows you to verify more accurate probability distributions."}},diceSetManagement:{diceSetFeatures:{title:"Dice Set Features",features:["Save each dice set with any name (up to 128 characters)","Store up to 20 dice sets","Results are automatically saved to browser IndexedDB","Duplicate and delete dice sets","Reorder dice sets via drag and drop","Export/import entire dice sets in JSON format","Select multiple dice sets for bulk duplicate/delete","Bulk delete all dice sets (with confirmation dialog)"]},comparison:{title:"Dice Set Comparison",features:["Select multiple dice sets to compare in charts","In comparison mode, each dice set is displayed in a different color","Compare up to 20 dice sets simultaneously","Trial count is displayed in each dice set's label during comparison"]}},resultDisplay:{title:"Result Display",table:{label:"Table Format",description:"Display detailed results of each trial in list format",features:["Shows trial number, each die value, and total value","Pagination feature (25 items per page)","Export to CSV format available"]},chart:{label:"Chart Format",description:"Visualize result distribution (4 chart types)",types:{distribution:{icon:"📊",title:"Total Value Distribution",features:["Display histogram of total value distribution across all trials","Toggle between bar chart and line chart","Display statistical information as annotation lines (mean: green, median: orange, expected value: pink, ±1σ: purple)","Highlight bars/points corresponding to median in orange","Overlay theoretical distribution as gray dotted line (single session only)","Data aggregation feature for viewing large datasets clearly"]},cumulative:{icon:"📈",title:"Cumulative Distribution",features:["Display cumulative probability distribution","Support both total values and individual dice","Compare actual and theoretical values","Toggle display of quantiles (deciles, vigintiles, etc.)",'Visually grasp "probability of rolling this value or less"']},progress:{icon:"📉",title:"Trial Progress",features:["Display progression of total values across trials","Verify result variation in time series","Display moving average line to understand trends","Adjust moving average window size (5-100 trials)"]},individualDice:{icon:"🎲",title:"Individual Die Value Distribution",features:["Display distribution of each die's values (when 2+ dice)","Toggle between bar chart and line chart","Overlay theoretical distribution as gray dotted line","Data aggregation feature for viewing large datasets clearly"]}}}},advancedFeatures:{dataAggregation:{title:"Data Aggregation Feature",description:"When displaying charts, if there are many data points, you can use the aggregation feature to display them more clearly.",features:[{label:"Use Data Aggregation",description:"Group and display data evenly based on specified interval"},{label:"Aggregation Interval",description:"Set approximately how many items to group together (2-5,000, default: 20)"},{label:"Supported Charts",description:"Total value distribution chart, individual die value distribution chart"},{label:"Example: Setting interval to 20 divides the whole into approximately 20 evenly sized groups",subFeatures:["Each group is automatically adjusted to be as even as possible to avoid remainders"]},{label:'When aggregated, "Aggregation: XX" is displayed in the chart title'}]},chartSettings:{title:"Saving Chart Settings",description:"Save and reuse chart display settings (chart type, aggregation settings, etc.).",features:["Create and manage multiple setting presets","Rename, duplicate, and delete settings","Display warning when there are unsaved changes","Save display settings for each chart individually","Default settings cannot be deleted or modified"]}},globalSettings:{title:"Global Settings",description:"You can open global settings from the gear icon in the header (footer on mobile).",appearance:{label:"Appearance",features:["Theme switching (light/dark/follow system settings)","Selection is automatically saved to browser"]},dataManagement:{label:"Data Management",features:[{label:"Export Data",description:"Backup all dice sets and custom chart settings in JSON format",subFeatures:["Default and preset settings are excluded"]},{label:"Import Data",description:"Restore from exported JSON file",subFeatures:["Merged with existing data (not overwritten)"]},{label:"Delete All Data",description:"Delete all dice sets and chart settings (with confirmation dialog)"},{label:"Display saved dice set count and chart settings count"}]}},operations:{retryAndRoll:{title:"Retry and Add Roll",features:[{label:"Reset Results",description:"Clear current dice set results (with confirmation dialog)"},{label:"Retry",description:"Clear existing results and replace with new results"},{label:"Add Roll",description:"Execute additional dice rolls while preserving existing results",subFeatures:["Display warning if dice configuration has changed","Integrated with existing data during additional execution"]}]},dataExport:{title:"Data Export",description:"Export results and dice set data in various formats.",features:[{label:"CSV Format",description:"Download results as tabular CSV file"},{label:"PNG Format",description:"Download chart as image"},{label:"JSON Format",description:"Export/import entire dice sets in JSON format"},{label:"Clipboard Copy",description:"Copy dice configuration preview string"}]}}},pr={title:"About / Privacy",close:"Close",sections:{app:{title:"About This App",description:"{{siteName}} is a web application for simulating multiple dice rolls and analyzing results statistically. You can verify probability distributions of dice used in TRPGs (Tabletop Role-Playing Games), board games, and more."},data:{title:"Data Handling",items:["This application stores all data locally in your browser","Dice set data: Stored in IndexedDB","Settings (dark mode, etc.): Stored in LocalStorage","No data is sent to any server","No personal information is collected","No integration with external services","Data management is the user's responsibility. Saved data may be lost due to browser data clearing or updates, so we recommend regularly backing up important data using the export feature"]},disclaimer:{title:"Disclaimer",items:["This application is provided without warranty","We cannot guarantee the accuracy or continuity of operation","The developer assumes no responsibility for damages arising from use of this app"]},libraries:{title:"Libraries Used",description:"This application uses the following open-source libraries:",items:["React (MIT License)","Chart.js (MIT License)","Tailwind CSS (MIT License)","Vite (MIT License)"]},version:{version:"Version: {{version}}",lastUpdated:"Last Updated: {{date}}"}}},mr={title:"Global Settings",close:"Close",appearance:{title:"Appearance",theme:{title:"Theme",description:"Select the application display theme",light:"Light",dark:"Dark",system:"System"},language:{title:"Language",description:"Select the application display language"}},dataManagement:{title:"Data Management",currentData:{title:"Saved Data",diceSets:"Dice Sets: {{count}}",chartSettings:"Chart Settings: {{count}}"},backup:{title:"Backup and Restore",description:"Export or import a complete backup including all dice sets and chart settings in JSON format. Compatible with legacy dice-set-only files.",export:"Export",exportDescription:"Save all data as JSON",import:"Import",importDescription:"Restore from backup file"},reset:{title:"Complete Data Deletion",description:"Delete all dice sets, chart settings, and application settings. This action cannot be undone.",button:"Delete All Data",confirm:"Are you sure you want to delete all data?",confirmButton:"Delete",cancel:"Cancel",processing:"Deleting...",resetError:"Failed to reset data"}},system:{resetError:"Failed to delete IndexedDB"},chartSettings:{title:"Manage Chart Views",renameTitle:"Rename Settings",duplicateTitle:"Duplicate Settings",close:"Close",new:"+ New",create:"Create New",rename:"Rename",duplicate:"Duplicate",delete:"Delete",save:"Save",change:"Change",cancel:"Cancel",discard:"Discard",preset:"Preset",custom:"Custom",inUse:"In Use",selected:"{{count}} selected",emptyMessage:"No settings available",maxLength:"Max 128 characters",copyNameSuffix:" Copy",unsavedChanges:"You have unsaved changes",unsavedWarning:"You have unsaved changes. Click the Save button for the settings you want to save.",savePrompt:"Do you want to save your changes?",nameLabel:"Settings Name",namePlaceholder:"Enter settings name",moreOptions:"More options",bulkActions:{title:"Bulk Actions",duplicate:"Bulk Duplicate Selected",delete:"Bulk Delete Selected",selectAll:"Select All",deselectAll:"Deselect All"},errors:{nameRequired:"Please enter a settings name",duplicateFailed:"Failed to duplicate settings",renameFailed:"Failed to rename settings",deleteFailed:"Failed to delete settings",saveFailed:"Failed to save",bulkDeleteFailed:"Failed to bulk delete",bulkDuplicateFailed:"Failed to bulk duplicate",cannotDeletePreset:"Cannot delete preset settings",noSelection:"No deletable settings selected",noDuplicateSelection:"Please select settings to duplicate"},confirmDelete:'Delete settings "{{name}}"?',confirmBulkDelete:"Delete {{count}} settings?"},about:{link:"About / Privacy"}},fr={type:{bar:"Bar Chart",line:"Line Chart"},title:{totalDistribution:"Total Value Distribution",cumulative:"Cumulative Distribution - {{diceCode}} / {{trials}} trials{{quantile}}",cumulativeTotalBase:"Cumulative Distribution (Total)",cumulativeIndividualBase:"Cumulative Distribution (All Dice)",cumulativeIndividual:"Cumulative Distribution (All Dice Values) - {{diceCode}} / {{trials}} trials{{quantile}}",cumulativeComparison:"Cumulative Distribution Comparison - {{count}} dice sets{{quantile}}",cumulativeComparisonIndividual:"Cumulative Distribution Comparison (All Dice Values) - {{count}} dice sets{{quantile}}",cumulativeAggregated:"Cumulative Distribution - {{diceCode}} (Aggregated)",individualDice:"Individual Die Value Distribution",rollProgress:"Trial Progress - {{diceCode}} / {{trials}} trials{{aggregation}}",rollProgressBase:"Trial Progress",rollProgressComparison:"Trial Progress Comparison - {{count}} dice sets{{aggregation}}",targetValue:"Specific Value Occurrences",comparison:"Comparing {{count}} dice sets"},subtitle:{trialCount:"{{count}} trials",aggregation:"Aggregation: {{interval}}",quantilePoints:"{{count}} points",custom:"Custom"},legend:{actual:"Actual",actualSampled:"Actual (Sampled)",actualCumulative:"Cumulative Distribution (Actual)",theoretical:"Expected Frequency (Theoretical)",theoreticalCumulative:"Theoretical",movingAverage:"Moving Average",movingAverageWindow:"Moving Average ({{window}} trials)",expectedValue:"Expected Value ({{value}})"},axis:{total:"Total Value",diceValue:"Die Value",trialNumber:"Trial Number",frequency:"Frequency",cumulativeProbability:"Cumulative Probability (%)",dicePosition:"Die Position"},stats:{mode:"Mode",stdDev:"Standard Deviation",expectedValue:"Expected Value",totalCount:"Total",averagePerDice:"Average (per die)",maxCount:"Maximum",minCount:"Minimum",individualStats:"Individual Die Statistics",dataPoints:"Data points displayed: {{count}}"},options:{title:"Chart Options",chartType:"Chart Type",displaySettings:"Display Settings",manageSettings:"Manage Settings",createNew:"Create New Settings",settingsName:"Settings Name",settingsNamePlaceholder:"Enter settings name",maxLength:"Maximum 128 characters",download:"Download Image",aggregation:{title:"Data Aggregation",useAggregation:"Use Aggregation",intervalLabel:"Aggregation Interval (approximate count)",apply:"Apply",reset:"Reset",status:"Data points: {{count}}",statusAggregated:"✓ Aggregated (approx. every {{interval}} items)"},targetValue:{title:"Specific Value Count",label:"Value to count",range:"Specify in range {{min}}-{{max}}"},movingAverage:{title:"Moving Average Settings",windowLabel:"Moving Average Window (trials)",apply:"Apply",reset:"Reset",description:"Show moving average: {{window}} trials"},cumulative:{title:"Cumulative Distribution Settings",distributionType:"Distribution Type",total:"Total Value",individual:"Individual Die (All Dice Combined)",dataRange:"Data Display Range",fullRange:"Full Range",actualOnly:"Actual Data Only",quantileAggregation:"Quantile Aggregation",points:"{{count}} points",aggregationLabel:"Aggregation: {{count}} points",apply:"Apply",reset:"Reset"}},noData:"No results",message:{startRoll:"Results will appear here when you roll the dice"},description:{totalDistribution:"Displays a histogram of total value frequencies across all trials.",theoreticalDistributionComparison:"Compare with expected frequency (theoretical) to check for distribution bias.",cumulativeTotal:"Displays the cumulative probability distribution of getting a total value or higher.",cumulativeIndividual:"Displays the cumulative probability distribution of getting a die value or higher.",theoreticalComparison:"You can compare the theoretical values (dashed line) with actual measurements.",rollProgress:"Shows the progression of total values for each trial. Use moving average to identify trends.",expectedValueComparison:"Compare with the expected value line (dashed) to check for bias.",progressDescription:"Shows the progression of total values for each trial. Use moving average to identify trends.",expectedLineDescription:"Compare with the expected value line (dashed) to check for bias.",individualDiceDescription:"This chart aggregates individual dice outcomes when rolling multiple dice. \nIt shows how many times each outcome appeared in total."},view:{chart:"Chart",table:"Table",manage:"Manage Chart Views",saveCurrentView:"Save current view",overwrite:"Overwrite",selectView:"Chart View",presetGroup:"Preset Settings",customGroup:"Custom Settings"},preset:{default:"Default Settings","2digit":"For 2-Digit Dice","4digit":"For 4-Digit Dice"},menu:{options:"More options",csvDownload:"Download CSV",rollReset:"Reset Rolls",confirmReset:"Are you sure you want to reset the results?",csvDownloadFailed:"Failed to download CSV"},targetStats:{title:{base:"Target Value Statistics",single:"Target Value ({{value}}) Statistics - {{dice}} / {{trials}} trials",comparison:"Target Value ({{value}}) Comparison - {{count}} dice sets"},occurrences:"Occurrences of {{value}}",occurrenceRate:"(Rate: {{rate}}%)",yAxis:"Occurrences",summary:{title:"Summary for [{{value}}]",total:"Total occurrences: {{count}}",average:"Average per die: {{average}}",rate:"Occurrence rate: {{rate}}%",range:"Max: {{max}} / Min: {{min}}"},totalAppearances:"Total appearances",averagePerDice:"Average per die",appearanceRate:"Appearance rate",maxMin:"Max: {{max}} / Min: {{min}}"},result:{title:"Results"}},xr={config:{title:"Dice Configuration",titleEdit:"Edit Dice Configuration",titleCreate:"Create New Dice Configuration",editingMultiple:"Editing {{count}} items",name:{label:"Dice Set Name (up to 128 characters)",placeholder:"Untitled"},count:{label:"Number of Dice ({{min}}-{{max}})",description:"Number of dice to roll"},sides:{label:"Number of Sides ({{min}}-{{max}})",description:"Number of sides on each die"},modifier:{label:"Modifier ({{min}}-{{max}})",sign:"Sign",value:"Value",add:"Add",subtract:"Subtract"},trial:{label:"Number of Trials ({{min}}-{{max}})",description:"Number of trials to execute"},notation:{label:"Dice Notation",copy:"Copy to clipboard",copied:"Copied",preview:"Preview"},editing:{multipleMessage:"Editing {{count}} dice sets"},unspecified:"Unspecified"},action:{simulate:"Start Rolling",reroll:"Reroll",addRoll:"Add Roll",reset:"Reset Results",export:"Export as CSV"}},br={title:"Dice Set List",empty:"No dice sets available",selectPrompt:"Please select a dice set",selectOrCreatePrompt:"Please select or create a dice set",list:{multiSelectMode:"Multi-select mode",selected:"{{count}} selected",comparing:"Comparing {{count}} dice sets"},action:{create:"Create New",createShort:"New",compare:"Compare",export:"Export",import:"Import",bulkDelete:"Bulk Delete",bulkDuplicate:"Bulk Duplicate",bulkDuplicateShort:"Bulk duplicate selected",bulkDeleteShort:"Bulk delete selected",deleteAll:"Delete All",deleteAllShort:"Delete all",reorder:"Reorder",clearSelection:"Clear selection",change:"Change",selectSession:"Select dice set"},confirm:{delete:"Are you sure you want to delete this dice set?",deleteAll:"Are you sure you want to delete all dice sets?",bulkDelete:"Are you sure you want to delete {{count}} selected dice sets?",bulkDeleteWarning:"Are you sure you want to delete {{count}} selected dice sets?\nThis operation cannot be undone."},copy:{suffix:" (Copy)"},limit:{reached:"Maximum number of dice sets ({{max}}) reached",maxRecords:"Exceeds maximum number of trials ({{max}})"},target:{label:"Target",all:"All ({{count}})",selected:"Selected"},multiSelect:{label:"Multi-select"},viewing:{single:"Viewing {{count}} dice set",multiple:"Comparing {{count}} dice sets"},tooltip:{create:"Create a new dice set",maxReached:"Maximum number of dice sets reached",addRollDisabled:"Cannot add rolls because specific values were modified"}},yr={dice:{count:{required:"Please enter the number of dice",range:"Number of dice must be between {{min}} and {{max}}",invalid:"Invalid number of dice"},sides:{required:"Please enter the number of sides",range:"Number of sides must be between {{min}} and {{max}}",invalid:"Invalid number of sides"},modifier:{range:"Modifier must be between {{min}} and {{max}}",invalid:"Invalid modifier"}},trial:{required:"Please enter the number of trials",range:"Number of trials must be between {{min}} and {{max}}",invalid:"Invalid number of trials"},session:{nameRequired:"Please enter a dice set name",nameTooLong:"Dice set name must be {{max}} characters or less",limitReached:"Maximum number of dice sets reached"},file:{invalidFormat:"Invalid file format",parseError:"Failed to parse file",readError:"Failed to read file"},chart:{aggregationRange:"Aggregation interval must be between {{min}} and {{max}}",targetValueRange:"Die value must be between {{min}} and {{max}}"}},vr={success:{sessionCreated:"New dice set created",sessionDeleted:"Dice set deleted",sessionDuplicated:"Dice set duplicated",sessionUpdated:"Dice configuration updated",bulkDeleted:"{{count}} dice sets deleted",bulkDuplicated:"{{count}} dice sets duplicated",rollCompleted:"{{count}} dice rolls completed",dataExported:"Data exported",dataImported:"Data imported",migrated:"Migrated from LocalStorage to IndexedDB",copied:"Copied to clipboard",settingsCreated:"Settings created",settingsCreatedWithName:'Settings "{{name}}" created',settingsDuplicatedWithName:'Settings "{{name}}" duplicated',settingsSaved:"Settings saved",settingsRenamed:"Settings renamed",settingsDeleted:"Settings deleted"},error:{sessionCreateFailed:"Failed to create dice set",sessionDeleteFailed:"Failed to delete dice set",sessionDuplicateFailed:"Failed to duplicate dice set",sessionUpdateFailed:"Failed to update dice set",bulkDeleteFailed:"Bulk delete failed",bulkDuplicateFailed:"Bulk duplicate failed",rollFailed:"Dice roll failed",loadFailed:"Failed to load data",exportFailed:"Export failed",importFailed:"Import failed",copyFailed:"Failed to copy to clipboard",csvDownloadFailed:"Failed to download CSV",imageGenerationFailed:"Failed to generate image",generic:"An error occurred",partialSuccess:"{{completed}} completed, {{failed}} errors:\n{{errors}}",cannotModifyDefault:"Cannot modify default settings",sessionLimitReached:"Dice set limit ({{max}}) reached",bulkDuplicateLimitReached:"Can only duplicate {{count}} due to dice set limit",trialCountExceeded:"Trial count exceeds the limit of {{max}}",maxRecordsExceeded:"Cannot add roll because it exceeds the maximum limit ({{max}} records)",settingImportSkipped:'Skipping import of chart settings "{{name}}":'},import:{successWithDetails:"Imported {{details}}",sessionsCount:"{{count}} dice sets",chartSettingsCount:"{{count}} chart settings"},info:{processing:"Processing...",simulating:"Simulating... ({{progress}}%)",noResults:"No results",noSessions:"No dice sets",resetResults:"Results have been reset",selectSession:"Please select a dice set"},warning:{unsavedChanges:"You have unsaved changes",configChanged:"Dice configuration has been changed",noImportableData:"No importable data (all already exist)",addRollDisabled:"Cannot add roll because specific die values were changed"}};function kr(){return"ja"===fe.language?"ja-JP":"en-US"}function wr(e){return e.toLocaleString(kr())}function Cr(e,t=2){return e.toLocaleString(kr(),{minimumFractionDigits:t,maximumFractionDigits:t})}fe.use(rr).use(Le).init({resources:{ja:{common:ar,help:sr,about:nr,settings:ir,charts:or,dice:lr,sessions:cr,validation:dr,messages:gr},en:{common:ur,help:hr,about:pr,settings:mr,charts:fr,dice:xr,sessions:br,validation:yr,messages:vr}},fallbackLng:"ja",defaultNS:"common",ns:["common","help","about","settings","charts","dice","sessions","validation","messages"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"],lookupLocalStorage:"language"}});const Sr=n.memo(({sessions:e,compareSessionIds:t,onToggleCompareSession:r,onCreateSession:a,onDuplicateSession:s,onDeleteSession:o,onDeleteAllSessions:l,onBulkDeleteSessions:c,onBulkDuplicateSessions:d,onReorderSessions:g,onExportSessions:u,onImportSessions:h,onUpdateSession:p})=>{const{t:m}=Fe(["sessions","common"]),[f,x]=n.useState(null),[b,y]=n.useState(null),[v,k]=n.useState(!1),[w,C]=n.useState(null),[S,j]=n.useState(()=>{const e=localStorage.getItem("isMultiSelectMode"),t=(()=>{try{if(!e)return!1;const t=JSON.parse(e);return"boolean"==typeof t&&t}catch{return!1}})(),r=(()=>{try{const e=localStorage.getItem("compareSessionIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}})(),a=r.length>1||t;return(!e||r.length>1)&&localStorage.setItem("isMultiSelectMode",JSON.stringify(a)),a}),N=n.useRef({});n.useEffect(()=>{localStorage.setItem("isMultiSelectMode",JSON.stringify(S))},[S]),n.useEffect(()=>{t.length>1&&!S&&j(!0)},[t.length]);const D=n.useCallback(()=>{j(e=>{const a=!e;return!a&&t.length>0&&setTimeout(()=>{t.forEach(e=>r(e))},0),a})},[t,r]),L=e=>{S||t.includes(e)||t.forEach(e=>r(e)),r(e)};n.useEffect(()=>{e.forEach(e=>{N.current[e.id]||(N.current[e.id]=n.createRef())})},[e]);return i.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-4 h-full flex flex-col transition-colors",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:m("sessions:title")}),t.length>0&&i.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:m("sessions:list.selected",{count:t.length})})]}),i.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[wr(e.length),"/",wr(Ve)]})]}),i.jsx(Pt,{sessions:e,compareSessionIds:t,isMultiSelectMode:S,onToggleMultiSelectMode:D,onCreateSession:()=>{const e={id:"",name:m("dice:config.name.placeholder"),diceConfig:{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:1,results:[],targetValue:1,createdAt:String(Date.now()),updatedAt:String(Date.now())};C(e),k(!0)},onToggleCompareSession:r,onExportSessions:u,onImportSessions:h,onBulkDuplicateSessions:d,onBulkDeleteSessions:c,onDeleteAllSessions:l}),i.jsx(Et,{items:e,selectedIds:t,onToggleItem:L,emptyMessage:m("sessions:empty"),showSelectionCount:!1,enableDragAndDrop:!0,onReorder:g,renderItem:(t,r,a,n)=>i.jsx(It,{session:t,isSelected:r,onToggle:()=>L(t.id),showDragHandle:!0,dragHandleProps:n,showCheckbox:!1,sessionsLength:e.length,onSetEditingSessionId:y,onDuplicateSession:s,onDeleteSession:o,openMenuId:f,onOpenMenu:x,menuButtonRef:N.current[t.id]})}),b&&i.jsx(Mt,{session:e.find(e=>e.id===b),onClose:()=>y(null),onSave:p}),v&&w&&i.jsx(Mt,{session:w,onClose:()=>{k(!1),C(null)},onSave:(e,t)=>{k(!1),C(null),a(t)},isCreateMode:!0})]})});Sr.displayName="SessionList";const jr=({currentPage:e,totalPages:t,totalItems:r,itemsPerPage:a,onPageChange:s})=>{const{t:n}=Fe("common");if(t<=1)return null;const o=(e-1)*a,l=o+a,c=r=>{const a=e+r;a>=1&&a<=t&&s(a)};return i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[wr(o+1)," - ",wr(Math.min(l,r))," ",n("unit.count")," / ",n("label.all")," ",wr(r)," ",n("unit.count")]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>s(1),disabled:1===e,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors","aria-label":n("label.firstPage"),children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 6v12M14 18l-7-6 7-6"})})}),i.jsx("button",{onClick:()=>c(-10),disabled:e<=10,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"-10"}),i.jsx("button",{onClick:()=>c(-1),disabled:1===e,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"-1"}),i.jsx("div",{className:"px-4 py-1 bg-accent-light-500 dark:bg-accent-dark-500 text-white font-bold rounded",children:e}),i.jsx("button",{onClick:()=>c(1),disabled:e===t,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"+1"}),i.jsx("button",{onClick:()=>c(10),disabled:e>t-10,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors text-sm",children:"+10"}),i.jsx("button",{onClick:()=>s(t),disabled:e===t,className:"px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-700 dark:text-gray-200 transition-colors","aria-label":n("label.lastPage"),children:i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6l7 6-7 6M18 6v12"})})})]})]})},Nr=n.memo(({session:e,onSortConfigChange:t})=>{const{t:r}=Fe(["charts","common"]),{results:s}=e,[n,o]=a.useState(1),[l,c]=a.useState(e.sortConfig||{column:"trialNumber",direction:"desc"});a.useEffect(()=>{o(1),c(e.sortConfig||{column:"trialNumber",direction:"desc"})},[e.id,e.sortConfig]),a.useEffect(()=>{e.sortConfig&&c(e.sortConfig)},[e.sortConfig]);const d=a.useMemo(()=>{const e=[...s];return e.sort((e,t)=>{let r,a;if("trialNumber"===l.column)r=e.trialNumber,a=t.trialNumber;else if("total"===l.column)r=e.total,a=t.total;else if("modifier"===l.column){const s=e.diceValues.reduce((e,t)=>e+t,0),n=t.diceValues.reduce((e,t)=>e+t,0);r=e.total-s,a=t.total-n}else{if(!l.column.startsWith("dice-"))return 0;{const s=parseInt(l.column.split("-")[1]);r=e.diceValues[s]??-1/0,a=t.diceValues[s]??-1/0}}return"asc"===l.direction?r-a:a-r}),e},[s,l]),g=e=>{const r={column:e,direction:l.column===e&&"asc"===l.direction?"desc":"asc"};c(r),t&&t(r),o(1)},u=e=>l.column!==e?i.jsx("span",{className:"ml-1 text-gray-400 dark:text-gray-500",children:i.jsx(Xe,{name:"chevron-up",className:"w-3 h-3 inline"})}):i.jsx("span",{className:"ml-1",children:i.jsx(Xe,{name:"asc"===l.direction?"chevron-up":"chevron-down",className:"w-3 h-3 inline"})});if(0===s.length)return i.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:r("common:label.noData")});const h=Math.ceil(d.length/25),p=25*(n-1),m=p+25,f=d.slice(p,m),x=e=>{o(e)},b=s.reduce((e,t)=>Math.max(e,t.diceValues.length),0);return i.jsxs("div",{className:"mb-12",children:[i.jsx("div",{className:"mb-6",children:i.jsx(jr,{currentPage:n,totalPages:h,totalItems:s.length,itemsPerPage:25,onPageChange:x})}),i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full border-collapse min-w-[1000px]",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-700",children:[i.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g("trialNumber"),children:["試行",i.jsx("br",{}),u("trialNumber")]}),Array.from({length:b},(e,t)=>i.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g(`dice-${t}`),children:[i.jsx(Xe,{name:"dice",className:"w-3 h-3 inline"}),t+1,i.jsx("br",{}),u(`dice-${t}`)]},t)),i.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g("modifier"),children:["補正",i.jsx("br",{}),u("modifier")]}),i.jsxs("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-center font-bold text-gray-800 dark:text-gray-100 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 select-none",onClick:()=>g("total"),children:["合計",i.jsx("br",{}),u("total")]})]})}),i.jsx("tbody",{children:f.map(e=>{const t=e.diceValues.reduce((e,t)=>e+t,0),r=e.total-t,a=0===r?"0":r>0?`+${r}`:r.toString();return i.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[i.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:wr(e.trialNumber)}),Array.from({length:b},(t,r)=>i.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:void 0!==e.diceValues[r]?e.diceValues[r]:"-"},r)),i.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right text-gray-700 dark:text-gray-300",children:a}),i.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-right font-bold text-gray-700 dark:text-gray-300",children:e.total})]},e.trialNumber)})})]})}),i.jsx("div",{className:"mt-6",children:i.jsx(jr,{currentPage:n,totalPages:h,totalItems:d.length,itemsPerPage:25,onPageChange:x})})]})});function Dr(e,t=1){if(0===e.length)return{data:[],isAggregated:!1};if(t<=1)return{data:e,isAggregated:!1};const r=e[0][0],a=e[e.length-1][0]-r+1,s=Math.ceil(a/t),n=Math.floor(a/s),i=a%s,o=[];let l=r;for(let c=0;c<s;c++){const t=n+(c<i?1:0),r=l+t-1,a=e.filter(([e])=>e>=l&&e<=r);if(a.length>0){const e=l+t/2,r=a.reduce((e,[,t])=>e+t,0);o.push([Math.round(e),r])}l+=t}return{data:o,isAggregated:!0}}function Lr(e,t=1e3){const r=e.length;if(r<=t)return e;const a=[];a.push(e[0]);const s=(r-2)/(t-2);let n=0;for(let i=0;i<t-2;i++){const t=Math.floor((i+1)*s)+1,o=Math.floor((i+2)*s)+1,l=Math.min(o,r)-t;let c=0,d=0;for(let a=t;a<Math.min(o,r);a++)c+=e[a].x,d+=e[a].y;c/=l,d/=l;const g=Math.floor(i*s)+1,u=Math.floor((i+1)*s)+1,h=e[n].x,p=e[n].y;let m=-1,f=g;for(let a=g;a<Math.min(u,r);a++){const t=.5*Math.abs((h-c)*(e[a].y-p)-(h-e[a].x)*(d-p));t>m&&(m=t,f=a)}a.push(e[f]),n=f}return a.push(e[r-1]),a}function Ar(e){return e.length>2e3?{data:Lr(e,1e3),wasDownsampled:!0}:{data:e,wasDownsampled:!1}}function Mr(e,t,r=0){if(0===e||0===t)return[];const a=e,s=e*t,n=Array(s+1).fill(0);n[0]=1;for(let l=0;l<e;l++){const e=Array(s+1).fill(0);for(let r=0;r<=s;r++)if(0!==n[r])for(let a=1;a<=t;a++){const t=r+a;t<=s&&(e[t]+=n[r])}n.splice(0,n.length,...e)}const i=Math.pow(t,e),o=[];for(let l=a;l<=s;l++){const e=n[l];if(e>0){const t=e/i;o.push([l+r,t])}}return o}function Er(){const[e,t]=a.useState(document.documentElement.classList.contains("dark"));return a.useEffect(()=>{const e=new MutationObserver(()=>{t(document.documentElement.classList.contains("dark"))});return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),e}function Rr(){const[e,t]=a.useState([]),[r,s]=a.useState(()=>localStorage.getItem("current-chart-settings-id")||Be),[n,i]=a.useState(!0);a.useEffect(()=>{(async()=>{try{await async function(){return ot.ensureDefaultChartSettings()}();const e=await dt();t(e);const r=localStorage.getItem("current-chart-settings-id");r&&!e.some(e=>e.id===r)&&(s(Be),localStorage.setItem("current-chart-settings-id",Be))}catch(e){}finally{i(!1)}})()},[]),a.useEffect(()=>{r&&localStorage.setItem("current-chart-settings-id",r)},[r]);const o=a.useCallback(()=>e.find(e=>e.id===r),[e,r]),l=a.useCallback(async()=>{const e=await dt();return t(e),e},[]),c=a.useCallback(async(e,t)=>{const r=st(e);if(!r.valid)throw new Error(r.error);const a=function(e){const t=(new Date).toISOString();return{id:at(),name:e.slice(0,et),resultChart:{useAggregation:!1,aggregationInterval:Ye},individualDiceChart:{useAggregation:!1,aggregationInterval:Ye},rollProgressMovingAverageWindow:20,createdAt:t,updatedAt:t}}(e),n=t?{...a,...t,id:a.id,name:a.name}:a;return await gt(n),await l(),s(n.id),n},[l]),d=a.useCallback(async(t,r)=>{const a=e.find(e=>e.id===t);if(!a)throw new Error("複製元の設定が見つかりません");const n=function(e,t){const r=(new Date).toISOString();return{...e,id:at(),name:(t||`${e.name}のコピー`).slice(0,et),createdAt:r,updatedAt:r}}(a,r),i=st(n.name);if(!i.valid)throw new Error(i.error);return await gt(n),await l(),s(n.id),n},[e,l]),g=a.useCallback(async(t,r)=>{const a=e.find(e=>e.id===t);if(!a)throw new Error("設定が見つかりません");if(tt(t))throw new Error("プリセット設定は変更できません");const s={...a,...r,id:a.id,updatedAt:(new Date).toISOString()};if(r.name){const e=st(r.name);if(!e.valid)throw new Error(e.error)}await gt(s),await l()},[e,l]),u=a.useCallback(async e=>{if(tt(e))throw new Error("プリセット設定は削除できません");await async function(e){return ot.deleteChartSettings(e)}(e),r===e&&s(Be),await l()},[r,l]),h=a.useCallback(async(e,t)=>{await g(e,{name:t})},[g]),p=a.useCallback(async e=>{t(e);try{for(let t=0;t<e.length;t++){const r={...e[t],sortOrder:t};await gt(r)}}catch(r){throw new Error("設定の並び替えに失敗しました")}},[]),m=a.useCallback(async(e,t,r)=>{await g(e,{[t]:r})},[g]);return{chartSettings:e,currentSettingsId:r,setCurrentSettingsId:s,getCurrentSettings:o,isLoading:n,createSettings:c,duplicateSettings:d,updateSettings:g,deleteSettings:u,renameSettings:h,reorderSettings:p,updateAggregationSettings:m,reloadSettings:l}}function Tr(e,t){const r=e?.[t],s=e?.id,[n,i]=a.useState(r?.useAggregation??!1),[o,l]=a.useState(r?.aggregationInterval??Ye);return a.useEffect(()=>{i(r?.useAggregation??!1),l(r?.aggregationInterval??Ye)},[s,r?.useAggregation,r?.aggregationInterval]),{useAggregation:n,setUseAggregation:i,aggregationInterval:o,setAggregationInterval:l}}function Or(e,t){const r=e?.[t],s=e?.id,[n,i]=a.useState(r??"bar");return a.useEffect(()=>{i(r??"bar")},[s,r]),{chartType:n,setChartType:i}}const Ir=({chartType:e,onChartTypeChange:t,onDownloadImage:r,showChartTypeToggle:s=!0,showAggregationSettings:o=!1,useAggregation:l=!1,aggregationInterval:c=10,onAggregationChange:d,currentDataPoints:g=0,isAggregated:u=!1,showTargetValueSettings:h=!1,targetValue:p=1,minTargetValue:m=1,maxTargetValue:f=6,onTargetValueChange:x,showMovingAverageSettings:b=!1,movingAverageWindow:y=20,onMovingAverageWindowChange:v,showChartSettingsSelector:k=!1,chartSettings:w=[],currentChartSettingsId:C="",onSelectChartSettings:S,onManageChartSettings:j,children:N})=>{const{t:D}=Fe(["charts"]),[L,A]=n.useState(!1),M=a.useRef(null),E=a.useRef(null),[R,T]=a.useState(!1),[O,I]=a.useState(String(c)),[P,$]=a.useState(String(p)),[F,V]=a.useState(String(y)),[B,W]=n.useState(l),[U,z]=n.useState(c),[H,q]=n.useState(y);n.useEffect(()=>{W(l),z(c),I(String(c))},[l,c]),n.useEffect(()=>{$(String(p))},[p]),n.useEffect(()=>{q(y),V(String(y))},[y]);const _=()=>T(!0),J=e=>t=>{T(!1),e(t.currentTarget.value)},K=e=>e.replace(/[^0-9]/g,""),G=(e,t,r)=>Math.min(Math.max(e,t),r),Y=(e,t)=>{if(!t&&R)return;const r=K(e);if(I(r),""===r)return void z(2);const a=parseInt(r,10);z(a)},Q=(e,t)=>{if(!t&&R)return;const r=K(e);if(""===r)return $(""),void x?.(m);const a=G(parseInt(r,10),m,f);$(a.toString()),x?.(a)},Z=(e,t)=>{if(!t&&R)return;const r=K(e);if(V(r),""===r)return void q(2);const a=parseInt(r,10);q(a)};a.useEffect(()=>{const e=e=>{M.current&&!M.current.contains(e.target)&&E.current&&!E.current.contains(e.target)&&A(!1)};if(L)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[L]);return i.jsxs("div",{className:"absolute right-0 top-0",children:[i.jsx("button",{ref:E,onClick:()=>{A(!L)},className:"w-8 h-8 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:D("charts:options.title"),children:i.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("circle",{cx:"12",cy:"5",r:"1"}),i.jsx("circle",{cx:"12",cy:"12",r:"1"}),i.jsx("circle",{cx:"12",cy:"19",r:"1"})]})}),i.jsxs("div",{ref:M,className:"absolute right-0 top-full mt-2 w-52 bg-white dark:bg-gray-700 rounded-lg shadow-lg overflow-hidden border border-gray-200 dark:border-gray-600 z-[10] max-h-[80vh] overflow-y-auto transition-opacity "+(L?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:[k&&w&&S&&i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:D("charts:options.displaySettings")}),i.jsx("select",{value:C,onChange:e=>{S(e.target.value)},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:w.map(e=>i.jsx("option",{value:e.id,children:St(e.name)},e.id))}),j&&i.jsx("button",{onClick:()=>{j(),A(!1)},className:"w-full mt-2 px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-xs transition-colors",children:D("charts:options.manageSettings")})]}),s&&i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:D("charts:options.chartType")}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>{t("bar"),A(!1)},className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center "+("bar"===e?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),title:D("charts:type.bar"),children:i.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[i.jsx("rect",{x:"4",y:"14",width:"3",height:"6"}),i.jsx("rect",{x:"10.5",y:"8",width:"3",height:"12"}),i.jsx("rect",{x:"17",y:"4",width:"3",height:"16"})]})}),i.jsx("button",{onClick:()=>{t("line"),A(!1)},className:"flex-1 px-3 py-2 rounded text-sm transition-colors flex items-center justify-center "+("line"===e?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"bg-gray-100 dark:bg-gray-600 text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-500"),title:D("charts:type.line"),children:i.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("polyline",{points:"4,18 8,12 12,14 16,8 20,10"}),i.jsx("circle",{cx:"4",cy:"18",r:"1.5",fill:"currentColor"}),i.jsx("circle",{cx:"8",cy:"12",r:"1.5",fill:"currentColor"}),i.jsx("circle",{cx:"12",cy:"14",r:"1.5",fill:"currentColor"}),i.jsx("circle",{cx:"16",cy:"8",r:"1.5",fill:"currentColor"}),i.jsx("circle",{cx:"20",cy:"10",r:"1.5",fill:"currentColor"})]})})]})]}),o&&i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:D("charts:options.aggregation.title")}),i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("input",{type:"checkbox",id:"useAggregation",checked:B,onChange:e=>{W(e.target.checked)},className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-2"}),i.jsx("label",{htmlFor:"useAggregation",className:"text-sm text-gray-700 dark:text-gray-300 cursor-pointer",onClick:e=>{e.preventDefault(),W(!B)},children:D("charts:options.aggregation.useAggregation")})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:D("charts:options.aggregation.intervalLabel")}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",min:2,max:Qe,value:O,onChange:e=>{const t=e.target.value;I(t),R||Y(t)},onCompositionStart:_,onCompositionEnd:J(e=>Y(e,!0)),onBlur:e=>Y(e.target.value,!0),disabled:!B,className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100 disabled:opacity-50 disabled:cursor-not-allowed"})]}),i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("button",{onClick:()=>{let e=U;(""===O||U<2||U>Qe)&&(e=G(U,2,Qe),(""===O||isNaN(U))&&(e=2),z(e),I(e.toString())),d?.({useAggregation:B,aggregationInterval:e})},className:"flex-1 px-3 py-1.5 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white rounded text-xs transition-colors font-medium",children:D("charts:options.aggregation.apply")}),i.jsx("button",{onClick:()=>{W(!1),z(10),I("10"),d?.({useAggregation:!1,aggregationInterval:10})},className:"flex-1 px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-xs transition-colors",children:D("charts:options.aggregation.reset")})]}),i.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 space-y-1",children:[i.jsx("p",{children:D("charts:options.aggregation.status",{count:g})}),u&&i.jsx("p",{className:"text-accent-light-600 dark:text-accent-dark-400",children:D("charts:options.aggregation.statusAggregated",{interval:c})})]})]}),h&&x&&i.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:D("charts:options.targetValue.title")}),i.jsxs("div",{className:"mb-2",children:[i.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:D("charts:options.targetValue.label")}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",min:m,max:f,value:P,onChange:e=>{const t=e.target.value;$(t),R||Q(t)},onCompositionStart:_,onCompositionEnd:J(e=>Q(e,!0)),onBlur:e=>Q(e.target.value,!0),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:D("charts:options.targetValue.range",{min:m,max:f})})]})]}),b&&v&&i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:D("charts:options.movingAverage.title")}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-1",children:D("charts:options.movingAverage.windowLabel")}),i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",min:2,max:100,value:F,onChange:e=>{const t=e.target.value;V(t),R||Z(t)},onCompositionStart:_,onCompositionEnd:J(e=>Z(e,!0)),onBlur:e=>Z(e.target.value,!0),className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100"}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"2-100の範囲で指定"})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>{let e=H;(""===F||H<2||H>100)&&(e=G(H,2,100),(""===F||isNaN(H))&&(e=2),q(e),V(e.toString())),v(e)},className:"flex-1 px-3 py-1.5 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white rounded text-xs transition-colors font-medium",children:D("charts:options.movingAverage.apply")}),i.jsx("button",{onClick:()=>{q(20),V("20"),v(20)},className:"flex-1 px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-xs transition-colors",children:D("charts:options.movingAverage.reset")})]})]}),N,i.jsxs("button",{onClick:()=>{r(),A(!1)},className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[i.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),i.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),i.jsx("polyline",{points:"21 15 16 10 5 21"})]}),i.jsx("span",{className:"text-sm",children:D("charts:options.download")})]})]})]})},Pr=(e,t=1)=>`rgba(${getComputedStyle(document.documentElement).getPropertyValue(e).trim()}, ${t})`,$r=(e,t=1)=>Pr(e?"--chart-accent-dark":"--chart-accent-light",t),Fr=(e=1)=>Pr("--chart-median",e),Vr=[{light:"rgb(59, 130, 246)",dark:"rgb(96, 165, 250)"},{light:"rgb(239, 68, 68)",dark:"rgb(248, 113, 113)"},{light:"rgb(34, 197, 94)",dark:"rgb(74, 222, 128)"},{light:"rgb(168, 85, 247)",dark:"rgb(192, 132, 252)"},{light:"rgb(249, 115, 22)",dark:"rgb(251, 146, 60)"},{light:"rgb(236, 72, 153)",dark:"rgb(244, 114, 182)"},{light:"rgb(14, 165, 233)",dark:"rgb(56, 189, 248)"},{light:"rgb(132, 204, 22)",dark:"rgb(163, 230, 53)"},{light:"rgb(244, 63, 94)",dark:"rgb(251, 113, 133)"},{light:"rgb(99, 102, 241)",dark:"rgb(129, 140, 248)"}],Br=(e,t,r=1)=>{const a=Vr[e%Vr.length];return`rgba(${(t?a.dark:a.light).replace("rgb(","").replace(")","")}, ${r})`},Wr=n.memo(({sessions:e,onAggregationSettingsChange:t,onChartTypeChange:r,chartSettings:s,currentChartSettingsId:n})=>{const{t:c}=Fe(["charts","common"]),d=a.useRef(null),g=Er(),u=s?.find(e=>e.id===n),{useAggregation:h,setUseAggregation:p,aggregationInterval:m,setAggregationInterval:f}=Tr(u,"resultChart"),{chartType:x,setChartType:b}=Or(u,"resultChartType"),y=e[0],v=e.length>1,k=a.useMemo(()=>e.map((e,t)=>{const r=new Map;e.results.forEach(e=>{const t=r.get(e.total)||0;r.set(e.total,t+1)});const a=Array.from(r.entries()).sort((e,t)=>e[0]-t[0]),{data:s,isAggregated:n}=Dr(a,h?m:1),i=e.name||c("common:unnamed"),o=e.resultsConfig||e.diceConfig;return{session:e,chartData:s,isAggregated:n,sessionName:i,diceCode:e.hasMultipleDiceConfigs||!1?c("charts:subtitle.custom"):vt(o),index:t}}),[e,h,m,c]),w=a.useMemo(()=>{if(v||!y)return null;const e=y.results.map(e=>e.total),{mean:t,median:r,stdDev:a}=function(e){const t=e.length;if(0===t)return{mean:0,median:0,stdDev:0};const r=e.reduce((e,t)=>e+t,0)/t,a=[...e].sort((e,t)=>e-t),s=t%2==0?(a[t/2-1]+a[t/2])/2:a[Math.floor(t/2)],n=e.reduce((e,t)=>e+Math.pow(t-r,2),0)/t,i=Math.sqrt(n);return{mean:r,median:s,stdDev:i}}(e);return{mean:t,median:r,medianBar:Math.round(r),stdDev:a,expectedValue:function(e){let t=e.diceCount*(e.diceFaces+1)/2;return"+"===e.modifierSign?t+=e.modifierValue:"-"===e.modifierSign&&(t-=e.modifierValue),t}(y.resultsConfig||y.diceConfig)}},[y,v]);if(!y||0===y.results.length)return i.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:c("charts:noData")});const C=v?`${c("charts:title.totalDistribution")}\n（${c("charts:title.comparison",{count:e.length})}${k[0]?.isAggregated?` / ${c("charts:subtitle.aggregation",{interval:m})}`:""}）`:`${c("charts:title.totalDistribution")}\n（${k[0].diceCode} / ${c("charts:subtitle.trialCount",{count:y.results.length})}${k[0].isAggregated?` / ${c("charts:subtitle.aggregation",{interval:m})}`:""})`,S=k.map(({chartData:e,sessionName:t,index:r,session:a})=>{const s=St(t),n=v?Br(r,g,"bar"===x?.6:.05):"bar"===x?e.map(([e])=>e===w?.medianBar?Fr(.6):$r(g,.5)):$r(g,.05),i=v?Br(r,g,1):"bar"===x?e.map(([e])=>e===w?.medianBar?Fr(1):$r(g,1)):$r(g,1);return{label:v?`${s} (${c("charts:subtitle.trialCount",{count:a.results.length})})`:c("charts:legend.actual"),data:e.map(([e,t])=>({x:e,y:t})),backgroundColor:n,borderColor:i,borderWidth:"bar"===x?1:2,fill:"line"===x,tension:"line"===x?.3:void 0,pointBackgroundColor:"line"===x&&!v&&w?e.map(([e])=>e===w.medianBar?Fr(1):$r(g,1)):void 0,pointBorderColor:"line"===x&&!v&&w?e.map(([e])=>e===w.medianBar?Fr(1):$r(g,1)):void 0,pointRadius:"line"===x?3:0}});if(!v&&!y.hasMultipleDiceConfigs){const e=y.resultsConfig||y.diceConfig,t="+"===e.modifierSign?e.modifierValue:"-"===e.modifierSign?-e.modifierValue:0,r=e.diceCount*e.diceFaces>5e4,a=r?[]:Mr(e.diceCount,e.diceFaces,t),s=y.results.length,n=a.map(([e,t])=>[e,t*s]),{data:i}=Dr(n,h?m:1),o=r?null:{label:c("charts:legend.theoretical"),data:i.map(([e,t])=>({x:e,y:t})),backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:g?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:"bar"===x?1:2,borderDash:[5,5],fill:!1,tension:"line"===x?.3:void 0,pointRadius:"line"===x?2:0,pointBackgroundColor:void 0,pointBorderColor:void 0};o&&S.push(o)}const j={labels:[],datasets:S},N={responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{position:"top",display:!0,labels:{color:g?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:C.split("\n"),font:{size:16},color:g?"#D1D5DB":"#374151"},decimation:{enabled:!0,algorithm:"lttb"},annotation:!v&&w?{annotations:{median:{type:"line",xMin:w.medianBar,xMax:w.medianBar,borderColor:"rgba(234, 88, 12, 0.8)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${c("charts:stats.median")}: ${w.median.toFixed(2)}`,position:"start",backgroundColor:"rgba(234, 88, 12, 0.8)",color:"white",font:{size:11},padding:4}},mean:{type:"line",xMin:w.mean,xMax:w.mean,borderColor:"rgba(16, 185, 129, 0.8)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${c("charts:stats.mean")}: ${w.mean.toFixed(2)}`,position:"end",backgroundColor:"rgba(16, 185, 129, 0.8)",color:"white",font:{size:11},padding:4}},stdDevPlus:{type:"line",xMin:w.mean+w.stdDev,xMax:w.mean+w.stdDev,borderColor:"rgba(139, 92, 246, 0.6)",borderWidth:1.5,borderDash:[3,3],label:{display:!0,content:"+1σ",position:"start",backgroundColor:"rgba(139, 92, 246, 0.6)",color:"white",font:{size:10},padding:3}},stdDevMinus:{type:"line",xMin:w.mean-w.stdDev,xMax:w.mean-w.stdDev,borderColor:"rgba(139, 92, 246, 0.6)",borderWidth:1.5,borderDash:[3,3],label:{display:!0,content:"-1σ",position:"start",backgroundColor:"rgba(139, 92, 246, 0.6)",color:"white",font:{size:10},padding:3}},expectedValue:{type:"line",xMin:w.expectedValue,xMax:w.expectedValue,borderColor:"rgb(241, 13, 120)",borderWidth:2,borderDash:[6,6],label:{display:!0,content:`${c("charts:stats.expectedValue")}: ${w.expectedValue.toFixed(2)}`,position:"center",backgroundColor:"rgb(241, 13, 120)",color:"white",font:{size:11},padding:4}}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:c("charts:axis.frequency"),color:g?"#D1D5DB":"#374151"},ticks:{precision:0,color:g?"#9CA3AF":"#6B7280"},grid:{color:g?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}},x:{type:"linear",title:{display:!0,text:c("charts:axis.total"),color:g?"#D1D5DB":"#374151"},ticks:{color:g?"#9CA3AF":"#6B7280"},grid:{color:g?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}}}};return i.jsxs("div",{className:"relative",children:[i.jsx(Ir,{chartType:x,onChartTypeChange:e=>{b(e),r?.(e)},onDownloadImage:()=>{At(d,y,"total")},showAggregationSettings:!0,useAggregation:h,aggregationInterval:m,onAggregationChange:e=>{p(e.useAggregation),f(e.aggregationInterval),t?.(e)},currentDataPoints:k[0]?.chartData.length||0,isAggregated:k[0]?.isAggregated||!1}),i.jsx("div",{style:{height:"400px"},children:"bar"===x?i.jsx(o,{ref:d,data:j,options:N}):i.jsx(l,{ref:d,data:j,options:N})}),i.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[i.jsx("p",{children:c("charts:description.totalDistribution")}),!v&&i.jsx("p",{className:"mt-1",children:c("charts:description.theoreticalDistributionComparison")})]})]})}),Ur=e=>{const{t:t,...r}=Fe(e);return{t:(e,r)=>(e=>{if("string"!=typeof e)return e;const t=e.split("\n");return 1===t.length?e:t.map((e,r)=>i.jsxs("span",{children:[e,r<t.length-1&&i.jsx("br",{})]},r))})(t(e,r)),tRaw:t,...r}},zr=n.memo(({sessions:e,onAggregationSettingsChange:t,onChartTypeChange:r,chartSettings:s,currentChartSettingsId:n})=>{const{t:c,tRaw:d}=Ur(["charts","common"]),g=a.useRef(null),u=Er(),h=s?.find(e=>e.id===n),{useAggregation:p,setUseAggregation:m,aggregationInterval:f,setAggregationInterval:x}=Tr(h,"individualDiceChart"),{chartType:b,setChartType:y}=Or(h,"individualDiceChartType"),v=e[0],k=e.length>1,w=a.useMemo(()=>e.map((e,t)=>{const r=new Map;return e.results.forEach(e=>{e.diceValues.forEach(e=>{const t=r.get(e)||0;r.set(e,t+1)})}),{session:e,frequencyMap:r,sessionName:e.name||d("common:unnamed"),diceCode:e.hasMultipleDiceConfigs?d("charts:subtitle.custom"):vt(e.resultsConfig||e.diceConfig),index:t}}),[e,d]),C=a.useMemo(()=>{const e=w.map(({frequencyMap:e,sessionName:t,index:r,session:a})=>{const s=St(t),n=Array.from(e.entries()).sort((e,t)=>e[0]-t[0]),{data:i}=Dr(n,p?f:1),o=k?Br(r,u,"bar"===b?.6:.05):$r(u,"bar"===b?.5:.05),l=k?Br(r,u,1):$r(u,1);return{label:k?`${s} (${d("charts:subtitle.trialCount",{count:a.results.length})})`:d("charts:legend.actual"),data:i.map(([e,t])=>({x:e,y:t})),backgroundColor:o,borderColor:l,borderWidth:"bar"===b?1:2,fill:"line"===b,tension:"line"===b?.3:void 0,pointRadius:"line"===b?4:void 0,pointHoverRadius:"line"===b?6:void 0}});if(!k&&!v.hasMultipleDiceConfigs){const t=v.resultsConfig||v.diceConfig,r=v.results.length*t.diceCount,a=function(e,t){const r=t/e;return Array.from({length:e},(e,t)=>[t+1,r])}(t.diceFaces,r),{data:s}=Dr(a,p?f:1),n={label:d("charts:legend.theoretical"),data:s.map(([e,t])=>({x:e,y:t})),backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:u?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:"bar"===b?1:2,borderDash:[5,5],fill:!1,tension:"line"===b?.3:void 0,pointRadius:"line"===b?3:void 0,pointHoverRadius:"line"===b?5:void 0};e.push(n)}const t=Array.from(w[0].frequencyMap.entries()).sort((e,t)=>e[0]-t[0]),{isAggregated:r}=Dr(t,p?f:1);return{labels:[],datasets:e,isAggregated:r}},[w,u,b,p,f,k,v,d]),S=a.useMemo(()=>{if(k)return null;const e=w[0].frequencyMap,t=Array.from(e.entries()).reduce((e,[,t])=>e+t,0),r=function(e){const t=Array.from(e.entries());if(0===t.length)return 0;const r=t.reduce((e,[,t])=>e+t,0);return 0===r?0:t.reduce((e,[t,r])=>e+t*r,0)/r}(e),a=function(e){const t=Array.from(e.entries());if(0===t.length)return[];const r=Math.max(...t.map(([,e])=>e));return t.filter(([,e])=>e===r).map(([e])=>e)}(e);return{mean:r,modes:a,totalCount:t}},[w,k]);if(!v||0===v.results.length)return i.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:c("charts:noData")});const j=v.resultsConfig||v.diceConfig,N=v.hasMultipleDiceConfigs||!1?d("common:custom"):vt(j),D=k?`${d("charts:title.individualDice")}\n（${d("charts:title.comparison",{count:e.length})}${C.isAggregated?` / ${d("charts:subtitle.aggregation",{interval:f})}`:""}）`:`${d("charts:title.individualDice")}\n（${N} / ${d("charts:subtitle.trialCount",{count:v.results.length})}${C.isAggregated?` / ${d("charts:subtitle.aggregation",{interval:f})}`:""})`,L={responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{position:"top",display:!0,labels:{color:u?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},decimation:{enabled:!0,algorithm:"lttb"},title:{display:!0,text:D.split("\n"),font:{size:16},color:u?"#D1D5DB":"#374151"},tooltip:!k&&S?{callbacks:{afterLabel:e=>{const t=S.totalCount||0,r=e.parsed.y??0;return`${t>0?(r/t*100).toFixed(1):"0.0"}%`}}}:void 0},scales:{y:{beginAtZero:!0,title:{display:!0,text:d("charts:axis.frequency"),color:u?"#D1D5DB":"#374151"},ticks:{precision:0,color:u?"#9CA3AF":"#6B7280"},grid:{color:u?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}},x:{type:"linear",title:{display:!0,text:d("charts:axis.diceValue"),color:u?"#D1D5DB":"#374151"},ticks:{color:u?"#9CA3AF":"#6B7280"},grid:{color:u?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}}}};return i.jsxs("div",{className:"relative",children:[i.jsx(Ir,{chartType:b,onChartTypeChange:e=>{y(e),r?.(e)},onDownloadImage:()=>{At(g,v,"individual")},showAggregationSettings:!0,useAggregation:p,aggregationInterval:f,onAggregationChange:e=>{m(e.useAggregation),x(e.aggregationInterval),t?.(e)},currentDataPoints:w[0]?.frequencyMap.size||0,isAggregated:C.isAggregated}),i.jsx("div",{style:{height:"400px"},children:"bar"===b?i.jsx(o,{ref:g,data:C,options:L}):i.jsx(l,{ref:g,data:C,options:L})}),i.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[i.jsx("p",{children:c("charts:description.individualDiceDescription")}),!k&&S&&i.jsxs("p",{className:"mt-2 text-xs opacity-75",children:[c("charts:stats.mean"),": ",Cr(S.mean)," /",c("charts:stats.mode"),": ",S.modes.join(", ")," /",c("charts:stats.totalCount"),": ",wr(S.totalCount),c("common:unit.piece")]})]})]})}),Hr=n.memo(({sessions:e,onChartTypeChange:t,chartSettings:r,currentChartSettingsId:s,onCumulativeSettingsChange:o})=>{const{t:l}=Fe(["charts","sessions","common"]),d=a.useRef(null),g=Er(),u=r?.find(e=>e.id===s),[h,p]=n.useState(void 0!==u?.cumulativeQuantileCount?u.cumulativeQuantileCount:50),[m,f]=n.useState(u?.cumulativeDistributionType||"total"),[x,b]=n.useState(void 0===u?.cumulativeShowOnlyActualData||u.cumulativeShowOnlyActualData);n.useEffect(()=>{u&&(void 0!==u.cumulativeQuantileCount&&p(u.cumulativeQuantileCount),u.cumulativeDistributionType&&f(u.cumulativeDistributionType),void 0!==u.cumulativeShowOnlyActualData&&b(u.cumulativeShowOnlyActualData))},[u,s]);const{chartType:y,setChartType:v}=Or(u,"resultChartType"),k=e.length>1,w=a.useMemo(()=>{if(0===e.length||!e[0]||0===e[0].results.length)return[];let t;return t="total"===m?e.map((e,t)=>{const r=e.resultsConfig||e.diceConfig,a=(e=>"+"===e.modifierSign?e.modifierValue:"-"===e.modifierSign?-e.modifierValue:0)(r);let s=[],n=r.diceCount+a,i=r.diceCount*r.diceFaces+a;const o=r.diceCount*r.diceFaces>5e4;if(!e.hasMultipleDiceConfigs&&!o){const e=Mr(r.diceCount,r.diceFaces,a);if(s=function(e){if(0===e.length)return[];const t=[...e].sort((e,t)=>e[0]-t[0]),r=t.reduce((e,[,t])=>e+t,0),a=[];let s=0;for(const[n,i]of t){const e=r-s;a.push([n,e]),s+=i}return a}(e),e.length>0){const t=e[0][0],r=e[e.length-1][0];t<=n&&r>=i&&(n=t,i=r)}}const c=e.results.map(e=>e.total),d=[...c].sort((e,t)=>e-t),g=c.length;let u;if(x){if(u=[...new Set(c)].sort((e,t)=>e-t),u.length>1e3){const e=Math.ceil(u.length/1e3);u=u.filter((t,r)=>r%e===0)}}else{const e=i-n+1;if(e>1e4){const t=Math.ceil(e/1e3);u=Array.from({length:Math.ceil(e/t)},(e,r)=>n+r*t)}else u=Array.from({length:e},(e,t)=>n+t)}const h=[];for(const l of u){let e=0,t=d.length;for(;e<t;){const r=Math.floor((e+t)/2);d[r]<l?e=r+1:t=r}const r=(d.length-e)/g;h.push([l,r])}return{session:e,actualCDF:h,theoreticalCDF:s,sessionName:e.name||l("sessions:unnamed"),diceCode:e.hasMultipleDiceConfigs?l("charts:subtitle.custom"):vt(r),index:t}}):e.map((e,t)=>{const r=e.resultsConfig||e.diceConfig,a=function(e,t){if(0===e.length)return[];const r=[];if(e.forEach(e=>{e.forEach(e=>{void 0!==e&&r.push(e)})}),0===r.length)return[];const a=[...r].sort((e,t)=>e-t),s=a.length,n=[];for(let i=1;i<=t;i++){let e=0,t=a.length;for(;e<t;){const r=Math.floor((e+t)/2);a[r]<i?e=r+1:t=r}const r=(a.length-e)/s;n.push([i,r])}return n}(e.results.map(e=>e.diceValues),r.diceFaces);let s=[];return e.hasMultipleDiceConfigs||(s=function(e){const t=[];for(let r=1;r<=e;r++){const a=(e-r+1)/e;t.push([r,a])}return t}(r.diceFaces)),{session:e,actualCDF:a,theoreticalCDF:s,sessionName:e.name||l("sessions:unnamed"),diceCode:e.hasMultipleDiceConfigs?l("charts:subtitle.custom"):vt(r),index:t}}),t},[e,m,x,l]),C=a.useMemo(()=>{const e=new Set;w.forEach(({actualCDF:t})=>{t.forEach(([t])=>e.add(t))});let t=Array.from(e).sort((e,t)=>e-t);if(h&&h>0&&t.length>h){const e=[];for(let r=0;r<h;r++){const a=r/(h-1)*(t.length-1),s=Math.round(a);e.push(t[s])}t=[...new Set(e)].sort((e,t)=>e-t)}const r=w.flatMap(({actualCDF:e,theoreticalCDF:r,sessionName:a,index:s})=>{const n=St(a),i=new Map(e),o=t.map(e=>{const t=i.get(e);return void 0!==t?100*t:null}),c=k?Br(s,g,.8):$r(g,.8),d=k?Br(s,g,1):$r(g,1),u={label:k?`${n} (${l("charts:legend.actual")})`:l("charts:legend.actualCumulative"),data:o,backgroundColor:c,borderColor:d,borderWidth:"bar"===y?1:2,fill:!1,tension:"line"===y?.3:void 0,pointRadius:"line"===y?3:void 0,pointHoverRadius:"line"===y?5:void 0,spanGaps:!0,type:y};if(!k&&r.length>0){const e=new Map(r),a=r.map(([e])=>e).sort((e,t)=>e-t),s=[],n=10;if(a.length<=n)s.push(...a);else for(let t=0;t<n;t++){const e=t/(n-1)*(a.length-1),r=Math.round(e);s.push(a[r])}const i=t.map(t=>{let r=a[0],s=e.get(r)||0,n=a[a.length-1],i=e.get(n)||0;if(t<=r)return 100*s;if(t>=n)return 100*i;let o=0,l=a.length-1;for(;o<l;){const e=Math.floor((o+l+1)/2);a[e]<=t?o=e:l=e-1}if(r=a[o],s=e.get(r)||0,o+1<a.length){n=a[o+1],i=e.get(n)||0;return 100*(s+(t-r)/(n-r)*(i-s))}return 100*s});return[u,{label:l("charts:legend.theoreticalCumulative"),data:i,backgroundColor:"transparent",borderColor:g?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:2,borderDash:[5,5],fill:!1,tension:.3,pointRadius:2,pointHoverRadius:4,spanGaps:!0,type:"line"}]}return[u]});return{labels:t,datasets:r}},[w,g,k,h,y,l]),S=e[0];if(!S||0===S.results.length)return i.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:l("charts:noData")});const j=S.resultsConfig||S.diceConfig,N=S.hasMultipleDiceConfigs||!1,D=N?l("charts:subtitle.custom"):vt(j),L=h?` / ${l("charts:subtitle.quantilePoints",{count:h})}`:"",A=k?"individual"===m?`${l("charts:title.cumulativeIndividualBase")}\n（${l("charts:title.comparison",{count:e.length})}${L}）`:`${l("charts:title.cumulativeTotalBase")}\n（${l("charts:title.comparison",{count:e.length})}${L}）`:"individual"===m?`${l("charts:title.cumulativeIndividualBase")}\n（${D} / ${l("charts:subtitle.trialCount",{count:S.results.length})}${L})`:`${l("charts:title.cumulativeTotalBase")}\n（${D} / ${l("charts:subtitle.trialCount",{count:S.results.length})}${L})`,M=l("total"===m?"charts:axis.total":"charts:axis.diceValue"),E={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:g?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:A.split("\n"),color:g?"#D1D5DB":"#374151",font:{size:16}},decimation:{enabled:!0,algorithm:"lttb"},tooltip:{callbacks:{label:e=>{const t=e.dataset.label||"",r=e.parsed.y??0,a=e.parsed.x??0;return`${t}: ${r.toFixed(2)}% (${C.labels[a]}以上)`}}}},scales:{x:{title:{display:!0,text:M,color:g?"#D1D5DB":"#374151"},ticks:{color:g?"#9CA3AF":"#6B7280"},grid:{color:g?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}},y:{title:{display:!0,text:l("charts:axis.cumulativeProbability"),color:g?"#D1D5DB":"#374151"},ticks:{color:g?"#9CA3AF":"#6B7280",callback:e=>`${e}%`},grid:{color:g?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"},min:0,max:100}}},R=e=>{f(e),o?.({distributionType:e,showOnlyActualData:x,quantileCount:h})},T=e=>{b(e),o?.({distributionType:m,showOnlyActualData:e,quantileCount:h})};return i.jsxs("div",{className:"relative",children:[i.jsxs(Ir,{chartType:y,onChartTypeChange:e=>{v(e),t?.(e)},onDownloadImage:()=>{if(d.current){Lt(d.current.canvas,k?`cumulative-distribution-comparison-${Date.now()}.png`:`cumulative-distribution-${D}-${Date.now()}.png`)}},children:[i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium mb-2",children:l("charts:options.cumulative.distributionType")}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("button",{onClick:()=>R("total"),className:"px-3 py-2 text-left text-sm rounded transition-colors "+("total"===m?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:l("charts:options.cumulative.total")}),i.jsx("button",{onClick:()=>R("individual"),className:"px-3 py-2 text-left text-sm rounded transition-colors "+("individual"===m?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:l("charts:options.cumulative.individual")})]})]}),i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium mb-2",children:l("charts:options.cumulative.dataRange")}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("button",{onClick:()=>T(!1),className:"px-3 py-2 text-left text-sm rounded transition-colors "+(x?"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600":"bg-accent-light-500 dark:bg-accent-dark-500 text-white"),children:l("charts:options.cumulative.fullRange")}),i.jsx("button",{onClick:()=>T(!0),className:"px-3 py-2 text-left text-sm rounded transition-colors "+(x?"bg-accent-light-500 dark:bg-accent-dark-500 text-white":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"),children:l("charts:options.cumulative.actualOnly")})]})]}),i.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-medium mb-2",children:l("charts:options.cumulative.quantileAggregation")}),i.jsxs("select",{value:null===h?"none":h,onChange:e=>{const t="none"===e.target.value?null:Number(e.target.value);var r;p(r=t),o?.({distributionType:m,showOnlyActualData:x,quantileCount:r})},className:"w-full px-2 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-600 text-gray-900 dark:text-gray-100",children:[i.jsx("option",{value:"none",children:l("common:none")}),i.jsx("option",{value:"10",children:l("charts:options.cumulative.points",{count:10})}),i.jsx("option",{value:"20",children:l("charts:options.cumulative.points",{count:20})}),i.jsx("option",{value:"50",children:l("charts:options.cumulative.points",{count:50})})]})]})]}),i.jsx("div",{style:{height:"400px"},children:i.jsx(c,{ref:d,type:y,data:C,options:E},`chart-${e[0]?.id}-${m}-${h}`)}),i.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:["total"===m?i.jsxs(i.Fragment,{children:[i.jsx("p",{children:l("charts:description.cumulativeTotal")}),!N&&i.jsx("p",{className:"mt-1",children:l("charts:description.theoreticalComparison")})]}):i.jsxs(i.Fragment,{children:[i.jsx("p",{children:l("charts:description.cumulativeIndividual")}),!N&&i.jsx("p",{className:"mt-1",children:l("charts:description.theoreticalComparison")})]}),!k&&i.jsxs("p",{className:"mt-2 text-xs opacity-75",children:[l("charts:stats.dataPoints",{count:C.labels.length}),x&&` (${l("charts:options.cumulative.actualOnly")})`,h&&` / ${l("charts:options.cumulative.aggregationLabel",{count:h})}`]})]})]})}),qr=n.memo(({sessions:e,onChartTypeChange:t,onAggregationChange:r,onMovingAverageWindowChange:s,chartSettings:n,currentChartSettingsId:c})=>{const{t:d}=Fe(["charts","common"]),g=a.useRef(null),u=Er(),h=n?.find(e=>e.id===c),{chartType:p,setChartType:m}=Or(h,"individualDiceChartType"),{aggregationInterval:f,useAggregation:x,setAggregationInterval:b,setUseAggregation:y}=Tr(h,"rollProgressChart"),{movingAverageWindow:v,setMovingAverageWindow:k}=function(e){const t=e?.rollProgressMovingAverageWindow,r=e?.id,[s,n]=a.useState(t??20);return a.useEffect(()=>{n(t??20)},[r,t]),{movingAverageWindow:s,setMovingAverageWindow:n}}(h),w=e[0],C=e.length>1,S=a.useMemo(()=>e.map((e,t)=>{const r=e.results.map(e=>e.total),a=e.results.map(e=>e.trialNumber);let s=a,n=r;if(x&&f>1){const e=[],t=[];for(let s=0;s<a.length;s+=f){const n=Math.min(s+f,a.length),i=a.slice(s,n),o=r.slice(s,n),l=i.reduce((e,t)=>e+t,0)/i.length,c=o.reduce((e,t)=>e+t,0)/o.length;e.push(l),t.push(c)}s=e,n=t}const i=((e,t)=>{const r=[];for(let a=0;a<e.length;a++)if(a<t-1)r.push(null);else{const s=e.slice(a-t+1,a+1).reduce((e,t)=>e+t,0);r.push(s/t)}return r})(n,v);let o=null;if(!e.hasMultipleDiceConfigs){const t=e.resultsConfig||e.diceConfig;o=t.diceCount*((t.diceFaces+1)/2)+("+"===t.modifierSign?t.modifierValue:"-"===t.modifierSign?-t.modifierValue:0)}const l=s.map((e,t)=>({x:e,y:n[t]})),{data:c,wasDownsampled:g}=Ar(l);let u=[];if(i.length>0){const e=s.map((e,t)=>({x:e,y:null!==i[t]?i[t]:NaN})).filter(e=>!isNaN(e.y)),{data:t}=Ar(e);u=t.map(e=>({x:e.x,y:e.y}))}return{session:e,actualData:c,movingAvgData:u,wasDownsampled:g,expectedValue:o,sessionName:e.name||d("common:unnamed"),diceCode:e.hasMultipleDiceConfigs?d("charts:subtitle.custom"):vt(e.resultsConfig||e.diceConfig),index:t}}),[e,v,x,f,d]),j=a.useMemo(()=>{const e=Math.max(...S.map(e=>e.session.results.length));return{datasets:S.flatMap(({actualData:t,movingAvgData:r,expectedValue:a,sessionName:s,index:n,wasDownsampled:i})=>{const o=St(s),l=[],c=C?Br(n,u,.2):$r(u,.2),g=C?Br(n,u,.5):$r(u,.5);if(l.push({label:C?`${o} (${d("charts:legend.actual")})`:d(i?"charts:legend.actualSampled":"charts:legend.actual"),data:t,backgroundColor:c,borderColor:g,borderWidth:1,fill:!1,tension:0,pointRadius:0,pointHoverRadius:3,parsing:!1}),r.length>0){const e=C?Br(n,u,1):$r(u,1);l.push({label:C?`${o} (${d("charts:legend.movingAverage")})`:d("charts:legend.movingAverageWindow",{window:v}),data:r,backgroundColor:e,borderColor:e,borderWidth:2,fill:!1,tension:.3,pointRadius:0,pointHoverRadius:4,parsing:!1})}if(!C&&null!==a){const r=t.length>0?t[0].x:1,s=t.length>0?t[t.length-1].x:e;l.push({type:"line",label:d("charts:legend.expectedValue",{value:a.toFixed(2)}),data:[{x:r,y:a},{x:s,y:a}],backgroundColor:"rgba(156, 163, 175, 0.3)",borderColor:u?"rgba(156, 163, 175, 0.8)":"rgba(107, 114, 128, 0.8)",borderWidth:2,borderDash:[5,5],fill:!1,tension:0,pointRadius:0,parsing:!1})}return l})}},[S,u,C,v,p,d]);if(!w||0===w.results.length)return i.jsx("div",{className:"text-center py-8 text-gray-400 dark:text-gray-500",children:d("charts:noData")});const N=w.resultsConfig||w.diceConfig,D=w.hasMultipleDiceConfigs||!1,L=D?d("charts:subtitle.custom"):vt(N),A=x&&f>1?` / ${d("charts:subtitle.aggregation",{interval:wr(f)})}`:"",M=C?`${d("charts:title.rollProgressBase")}\n（${d("charts:title.comparison",{count:e.length})}${A}）`:`${d("charts:title.rollProgressBase")}\n（${L} / ${d("charts:subtitle.trialCount",{count:w.results.length})}${A}）`,E={responsive:!0,maintainAspectRatio:!1,animation:!1,plugins:{legend:{display:!0,position:"top",labels:{color:u?"#D1D5DB":"#374151",usePointStyle:!0,padding:15}},title:{display:!0,text:M.split("\n"),color:u?"#D1D5DB":"#374151",font:{size:16}},tooltip:{mode:"index",intersect:!1}},scales:{x:{type:"linear",title:{display:!0,text:d("charts:axis.trialNumber"),color:u?"#D1D5DB":"#374151"},ticks:{color:u?"#9CA3AF":"#6B7280"},grid:{color:u?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}},y:{title:{display:!0,text:d("charts:axis.total"),color:u?"#D1D5DB":"#374151"},ticks:{color:u?"#9CA3AF":"#6B7280"},grid:{color:u?"rgba(75, 85, 99, 0.3)":"rgba(229, 231, 235, 0.8)"}}}};return i.jsxs("div",{className:"relative",children:[i.jsx(Ir,{chartType:p,onChartTypeChange:e=>{m(e),t?.(e)},onDownloadImage:()=>{if(g.current){Lt(g.current.canvas,C?`roll-progress-comparison-${Date.now()}.png`:`roll-progress-${L}-${Date.now()}.png`)}},showAggregationSettings:!0,useAggregation:x,aggregationInterval:f,onAggregationChange:e=>{y(e.useAggregation),b(e.aggregationInterval),r?.(e.useAggregation&&e.aggregationInterval>1?e.aggregationInterval:null)},currentDataPoints:w.results.length,isAggregated:x&&f>1,showMovingAverageSettings:!0,movingAverageWindow:v,onMovingAverageWindowChange:e=>{k(e),s?.(e)}}),i.jsx("div",{style:{height:"400px"},children:"bar"===p?i.jsx(o,{ref:g,data:j,options:E}):i.jsx(l,{ref:g,data:j,options:E})}),i.jsxs("div",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400",children:[i.jsx("p",{children:d("charts:description.rollProgress")}),!D&&i.jsx("p",{className:"mt-1",children:d("charts:description.expectedValueComparison")})]})]})}),_r="bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 text-white rounded-lg transition-colors inline-flex items-center justify-center gap-2",Jr=(e,t)=>({name:e?"spinner":t,className:e?"w-6 h-6 animate-spin":"w-6 h-6"}),Kr=({targetSessionType:e,onChange:t,disabled:r,selectedSessionsCount:a,selectedSessions:s,className:n="",t:o})=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-sm text-gray-700 dark:text-gray-200 font-medium whitespace-nowrap",children:o("sessions:target.label")}),i.jsxs("select",{value:e,onChange:e=>t(e.target.value),disabled:r,className:`flex-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-200 disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent transition-colors text-sm ${n}`,children:[i.jsx("option",{value:"selected",children:o("sessions:target.all",{count:a})}),s.map(e=>i.jsx("option",{value:e.id,children:St(e.name)},e.id))]})]}),Gr=({onReroll:e,onAddRoll:t,isSimulating:r,simulationProgress:a=0,hasResults:s,variant:n="large",className:o="",isAddRollDisabled:l=!1,sessions:c=[],selectedSessionIds:d=[],targetSessionType:g="selected",onTargetSessionTypeChange:u})=>{const{t:h}=Fe(["dice","sessions","messages","common"]),p=d.length,m=c.filter(e=>d.includes(e.id)),f=u&&p>1,x=h(s?"dice:action.reroll":"dice:action.simulate"),b=h(s?"dice:action.reroll":"common:button.start"),y=h("dice:action.addRoll"),v=h("common:button.addRoll");return"large"===n?i.jsxs("div",{className:`flex flex-col gap-2 ${o}`,children:[r&&a>0&&i.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5",children:i.jsx("div",{className:"bg-accent-light-500 dark:bg-accent-dark-500 h-2.5 rounded-full transition-all duration-300",style:{width:`${a}%`}})}),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 items-stretch lg:items-center",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-1",children:[s&&i.jsxs("button",{onClick:t,disabled:r||l,className:`${_r} font-bold py-3 px-3 text-lg flex-1`,title:l?h("messages:warning.addRollDisabled"):"",children:[i.jsx(Xe,{...Jr(r,"add-roll"),strokeWidth:1}),i.jsx("span",{className:"hidden lg:inline",children:y}),i.jsx("span",{className:"lg:hidden",children:v})]}),i.jsxs("button",{onClick:e,disabled:r,className:`${_r} font-bold py-3 px-3 text-lg flex-1`,children:[i.jsx(Xe,{...Jr(r,"reroll"),strokeWidth:1}),i.jsx("span",{className:"hidden lg:inline",children:x}),i.jsx("span",{className:"lg:hidden",children:b}),r&&a>0&&i.jsxs("span",{className:"ml-2 text-sm",children:["(",Math.round(a),"%)"]})]})]}),f&&i.jsx(Kr,{targetSessionType:g,onChange:u,disabled:r,selectedSessionsCount:p,selectedSessions:m,className:"px-4 py-3 lg:w-auto",t:h})]})]}):i.jsx("div",{className:"fixed bottom-20 mb-4 right-6 left-6 lg:left-auto lg:bottom-6 lg:mb-0 z-40 lg:w-auto",children:i.jsxs("div",{className:"w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-2",children:[f&&i.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4 pb-4 px-4 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"w-10 py-2 text-xs text-gray-500 dark:text-gray-400 font-medium",children:h("sessions:target.label")}),i.jsxs("select",{value:g,onChange:e=>{u?.(e.target.value)},disabled:r,className:"flex-1 px-4 py-3 bg-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer focus:outline-none disabled:opacity-50",children:[i.jsx("option",{value:"selected",children:h("sessions:target.all",{count:p})}),m.map(e=>i.jsx("option",{value:e.id,children:St(e.name)},e.id))]})]}),i.jsxs("div",{className:"flex flex-row mt-2 px-4 text-xs text-gray-500 dark:text-gray-400",children:[s&&i.jsxs("button",{onClick:t,disabled:r||l,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(r||l?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":h("dice:action.addRoll"),title:l?h("messages:warning.addRollDisabled"):"",children:[i.jsx("div",{className:"mb-1",children:i.jsx(Xe,{name:r?"spinner":"add-roll",className:r?"w-6 h-6 animate-spin":"w-6 h-6"})}),i.jsx("span",{className:"text-xs font-medium",children:v})]}),i.jsxs("button",{onClick:e,disabled:r,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(r?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":x,children:[i.jsx("div",{className:"mb-1",children:i.jsx(Xe,{name:r?"spinner":"reroll",className:r?"w-6 h-6 animate-spin":"w-6 h-6"})}),i.jsx("span",{className:"text-xs font-medium",children:b})]})]})]})})},Yr=({onCreateSettings:e,onClose:t})=>{const{t:r}=Fe(["charts","common","messages"]),[s,n]=a.useState(""),[o,l]=a.useState(""),[c,d]=a.useState(!1),g=async()=>{if(s.trim()){d(!0),l("");try{await e(s.trim()),t()}catch(a){l(a instanceof Error?a.message:r("messages:error.generic"))}finally{d(!1)}}else l(r("messages:error.generic"))};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:t,children:i.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full flex flex-col",onClick:e=>e.stopPropagation(),children:[i.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:r("charts:options.createNew")}),i.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),i.jsxs("div",{className:"p-6",children:[o&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:i.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:o})}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:r("charts:options.settingsName")}),i.jsx("input",{type:"text",value:s,onChange:e=>n(e.target.value),onKeyPress:e=>{"Enter"===e.key&&g()},placeholder:r("charts:options.settingsNamePlaceholder"),maxLength:128,autoFocus:!0,disabled:c,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent disabled:opacity-50"}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:r("charts:options.maxLength")})]})]}),i.jsx("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:t,disabled:c,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:r("common:button.cancel")}),i.jsx("button",{onClick:g,disabled:c||!s.trim(),className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-medium rounded-lg transition-colors disabled:opacity-50",title:r(c?"common:label.processing":"common:button.create"),children:r("common:button.create")})]})})]})})};function Qr(e,t){return e.id===Be?t("charts:preset.default"):"preset-2digit"===e.id?t("charts:preset.2digit"):"preset-4digit"===e.id?t("charts:preset.4digit"):St(e.name)}const Zr=({session:e,sessions:t,compareSessionIds:r,onResetResults:s,onReroll:n,onAddRoll:o,isSimulating:l,simulationProgress:c=0,onResultChartAggregationChange:d,onIndividualDiceChartAggregationChange:g,onRollProgressChartAggregationChange:u,onResultChartTypeChange:h,onIndividualDiceChartTypeChange:p,onRollProgressMovingAverageWindowChange:m,onCumulativeSettingsChange:f,onSortConfigChange:x,chartSettings:b,currentChartSettingsId:y,onSelectChartSettings:v,onManageChartSettings:k,onCreateChartSettings:w,onCreateNewSettings:C,onSaveChartSettings:S,hasPendingChanges:j=!1,selectedSessionIds:N=[],targetSessionType:D="selected",onTargetSessionTypeChange:L,onShowCompareModal:A})=>{const{t:M}=Fe(["charts","common","sessions"]),[E,R]=a.useState(()=>{const e=localStorage.getItem("resultSectionActiveTab");return"table"===e||"chart"===e?e:"chart"}),[T,O]=a.useState(!1),[I,P]=a.useState(()=>localStorage.getItem("selectedTableSessionId")||e?.id||""),[$,F]=a.useState(!1),V=a.useRef(null),B=a.useRef(null),W=a.useMemo(()=>{const a=r.map(e=>t.find(t=>t.id===e)).filter(Boolean);return a.length>0?a:e?[e]:[]},[r,t,e]);a.useEffect(()=>{!e||I&&W.find(e=>e.id===I)||P(e.id)},[e,W,I]),a.useEffect(()=>{localStorage.setItem("resultSectionActiveTab",E)},[E]),a.useEffect(()=>{I&&localStorage.setItem("selectedTableSessionId",I)},[I]);const U=a.useMemo(()=>W.find(e=>e.id===I)||e,[W,I,e]);a.useEffect(()=>{const e=e=>{V.current&&!V.current.contains(e.target)&&B.current&&!B.current.contains(e.target)&&O(!1)};if(T)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[T]);if(!e)return i.jsx("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:i.jsxs("div",{className:"text-center py-12",children:[i.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-lg mb-6",children:M("sessions:selectPrompt")}),i.jsxs("button",{onClick:()=>A?.(),className:"px-6 py-3 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors inline-flex items-center gap-2",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),i.jsx("span",{children:M("sessions:action.selectSession")})]})]})});if(0===e.results.length)return i.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:[i.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-4",children:M("charts:result.title")}),i.jsxs("div",{className:"text-center py-12",children:[i.jsx("p",{className:"text-gray-400 dark:text-gray-500 mb-6",children:M("charts:message.startRoll")}),i.jsx(Gr,{onReroll:n,onAddRoll:o,hasResults:!1,isSimulating:l,variant:"large",sessions:t,selectedSessionIds:N,targetSessionType:D,onTargetSessionTypeChange:L})]})]});const z=()=>{try{!function(e){const{results:t,name:r,diceConfig:a,resultsConfig:s}=e;if(0===t.length)throw new Error("ダウンロードする結果がありません");const n=t.reduce((e,t)=>Math.max(e,t.diceValues.length),0),i=["試行回数"];for(let p=1;p<=n;p++)i.push(`${p}個目`);i.push("修正値"),i.push("合計値");const o=[i];t.forEach(e=>{const t=[e.trialNumber.toString()];for(let s=0;s<n;s++)t.push(void 0!==e.diceValues[s]?e.diceValues[s].toString():"");const r=e.diceValues.reduce((e,t)=>e+t,0),a=e.total-r;t.push(a.toString()),t.push(e.total.toString()),o.push(t)});const l=o.map(e=>e.join(",")).join("\n"),c=new Blob(["\ufeff"+l],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(c),g=document.createElement("a");g.href=d;const u=vt(s||a),h=jt(r||"名称未設定");g.download=`${h}_${u}_${t.length}trials.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(d)}(e)}catch(t){alert(M("charts:menu.csvDownloadFailed"))}},H=()=>{window.confirm(M("charts:menu.confirmReset"))&&s()},q=e=>{e(),O(!1)},_=r.map(e=>t.find(t=>t.id===e)).filter(Boolean),J=_.length>0?_:[e];return i.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-2 px-6 pb-6 transition-colors",children:[i.jsxs("div",{className:"flex justify-between border-b border-gray-200 dark:border-gray-600",children:[i.jsxs("div",{className:"flex justify-start start",children:[i.jsxs("button",{onClick:()=>R("chart"),className:"px-6 py-2 font-medium transition-colors flex items-center gap-2 "+("chart"===E?"text-accent-light-600 dark:text-accent-dark-400 border-b-2 border-accent-light-600 dark:border-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[i.jsx(Xe,{name:"chart-bar"}),i.jsx("span",{className:"hidden sm:inline",children:M("charts:view.chart")})]}),i.jsxs("button",{onClick:()=>R("table"),className:"px-6 py-2 font-medium transition-colors flex items-center gap-2 "+("table"===E?"text-accent-light-600 dark:text-accent-dark-400 border-b-2 border-accent-light-600 dark:border-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:[i.jsx(Xe,{name:"table"}),i.jsx("span",{className:"hidden sm:inline",children:M("charts:view.table")})]})]}),i.jsx("div",{className:"flex gap-2 items-center",children:i.jsxs("div",{className:"relative",children:[i.jsx("button",{ref:B,onClick:()=>{O(!T)},className:"w-10 h-10 hover:bg-gray-300 dark:hover:bg-gray-700 text-gray-800 dark:text-white  rounded-tl-lg rounded-tr-lg  transition-colors inline-flex items-center justify-center",title:M("charts:menu.options"),children:i.jsx(Xe,{name:"dots-vertical",className:"w-5 h-5"})}),i.jsxs("div",{ref:V,className:"absolute right-0 top-full mt-1 w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-[10] overflow-hidden border border-gray-200 dark:border-gray-600 transition-opacity "+(T?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:["table"!==E&&b&&b.length>0&&k&&i.jsxs("button",{onClick:k,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",title:M("charts:view.manage"),children:[i.jsx(Xe,{name:"settings",className:"w-5 h-5"}),i.jsx("span",{children:M("charts:view.manage")})]}),i.jsxs("button",{onClick:()=>q(z),className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3",children:[i.jsx(Xe,{name:"download"}),i.jsx("span",{className:"text-sm",children:M("charts:menu.csvDownload")})]}),i.jsxs("button",{onClick:()=>q(H),className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600",children:[i.jsx(Xe,{name:"trash"}),i.jsx("span",{className:"text-sm",children:M("charts:menu.rollReset")})]})]})]})})]}),"table"===E?i.jsx(i.Fragment,{children:W.length>1&&i.jsxs("div",{className:"border border-t-0 bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700 rounded-bl-lg rounded-br-lg px-4 py-2 inline-flex justify-center items-center gap-2 w-full",children:[i.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap",children:M("sessions:list.multiSelectMode")}),i.jsx("select",{value:I,onChange:e=>P(e.target.value),className:"px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent w-auto max-w-[180px]",children:W.map(e=>i.jsx("option",{value:e.id,children:St(e.name)},e.id))})]})}):i.jsx(i.Fragment,{children:b&&b.length>0&&v&&i.jsxs("div",{className:"border border-t-0 bg-gray-50 dark:bg-gray-700/50 border-gray-200 dark:border-gray-700 rounded-bl-lg rounded-br-lg px-4 py-2 inline-flex justify-center items-center gap-2 w-full",children:[i.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap",children:M("charts:view.selectView")}),i.jsxs("select",{value:y,onChange:e=>{const t=e.target.value;"__CREATE_NEW__"===t?F(!0):v(t)},className:"h-8 px-3 py-1.5 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent w-auto max-w-[150px]",children:[w&&i.jsx("option",{value:"__CREATE_NEW__",children:M("charts:view.saveCurrentView")}),"                  ",b.filter(e=>tt(e.id)).length>0&&i.jsx("optgroup",{label:M("charts:view.presetGroup"),children:b.filter(e=>tt(e.id)).map(e=>i.jsx("option",{value:e.id,children:Qr(e,M)},e.id))}),b.filter(e=>!tt(e.id)).length>0&&i.jsx("optgroup",{label:M("charts:view.customGroup"),children:b.filter(e=>!tt(e.id)).map(e=>i.jsx("option",{value:e.id,children:St(e.name)},e.id))})]}),S&&y&&!tt(y)&&i.jsx("button",{onClick:()=>S(y),disabled:!j,className:"h-8 px-3 py-1.5 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-300 disabled:dark:bg-gray-600 disabled:cursor-not-allowed disabled:opacity-50 text-white rounded-md text-sm transition-colors whitespace-nowrap flex-shrink-0 flex items-center gap-1.5",title:M(j?"charts:view.overwrite":"common:label.noChanges"),children:i.jsx("span",{children:M("charts:view.overwrite")})})]})}),r.length>0&&i.jsxs("div",{className:"my-4 bg-accent-light-50 dark:bg-accent-dark-900/20 border border-accent-light-200 dark:border-accent-dark-700 rounded-lg p-3 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Xe,{name:"sessions",className:"w-5 h-5 text-accent-light-500 dark:text-accent-dark-400"}),i.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:M(1===r.length?"sessions:viewing.single":"sessions:viewing.multiple",{count:r.length})})]}),i.jsx("div",{className:"flex items-center gap-3 lg:hidden",children:i.jsx("button",{onClick:()=>A?.(),className:"text-sm text-accent-light-600 dark:text-accent-dark-400 hover:text-accent-light-700 dark:hover:text-accent-dark-300 font-medium underline",children:M("sessions:action.change")})})]}),i.jsx("div",{children:"table"===E?i.jsx(i.Fragment,{children:i.jsx(Nr,{session:U,onSortConfigChange:x})}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"py-4 border-t border-gray-200 dark:border-gray-600",children:i.jsx(Wr,{sessions:J,onAggregationSettingsChange:d,onChartTypeChange:h,chartSettings:b,currentChartSettingsId:y})}),i.jsx("div",{className:"py-4 border-t border-gray-200 dark:border-gray-600",children:i.jsx(Hr,{sessions:J,onChartTypeChange:h,chartSettings:b,currentChartSettingsId:y,onCumulativeSettingsChange:f})}),i.jsx("div",{className:"py-4 border-t border-gray-200 dark:border-gray-600",children:i.jsx(qr,{sessions:J,onChartTypeChange:p,onAggregationChange:e=>{u?.({useAggregation:null!==e&&e>1,aggregationInterval:e||1})},onMovingAverageWindowChange:m,chartSettings:b,currentChartSettingsId:y})}),i.jsx("div",{className:"py-4 border-t border-gray-200 dark:border-gray-600",children:i.jsx(zr,{sessions:J,onAggregationSettingsChange:g,onChartTypeChange:p,chartSettings:b,currentChartSettingsId:y})})]})}),i.jsx("div",{className:"hidden lg:block",children:i.jsx(Gr,{onReroll:n,onAddRoll:o,hasResults:!0,isSimulating:l,simulationProgress:c,variant:"floating",sessions:t,selectedSessionIds:N,targetSessionType:D,onTargetSessionTypeChange:L})}),$&&C&&i.jsx(Yr,{onCreateSettings:async e=>{await C(e),F(!1)},onClose:()=>F(!1)})]})},Xr=n.memo(({message:e,onClose:t})=>{const[r,s]=a.useState(!1),[n,o]=a.useState(!1);a.useEffect(()=>{if(e){s(!0),setTimeout(()=>{o(!0)},10);const e=setTimeout(()=>{o(!1),setTimeout(()=>{t(),s(!1)},500)},5e3);return()=>clearTimeout(e)}s(!1),o(!1)},[e,t]);if(!e||!r)return null;const l={success:"border-green-500 dark:border-green-400",error:"border-red-500 dark:border-red-400",warning:"border-yellow-500 dark:border-yellow-400",info:"border-accent-light-500 dark:border-accent-dark-400"}[e.type],c={success:"text-green-500 dark:text-green-400",error:"text-red-500 dark:text-red-400",warning:"text-yellow-500 dark:text-yellow-400",info:"text-accent-light-500 dark:text-accent-dark-400"}[e.type];return i.jsx("div",{className:"fixed top-18 left-1/2 -translate-x-1/2 z-[10000] w-full max-w-2xl px-4 transition-all duration-500 "+(n?"opacity-100 blur-0":"opacity-0 blur-sm"),children:i.jsxs("div",{className:`bg-white dark:bg-gray-800 text-sm text-gray-900 dark:text-gray-100 px-3 py-2 rounded-md shadow-lg border-l-4 ${l} flex items-center justify-between`,children:[i.jsxs("div",{className:"flex items-center",children:[i.jsxs("span",{className:`mr-3 text-xl font-bold ${c}`,children:["success"===e.type&&"✓","error"===e.type&&"✕","warning"===e.type&&"⚠","info"===e.type&&"ℹ"]}),i.jsx("span",{className:"whitespace-pre-line",children:e.text})]}),i.jsx("button",{onClick:()=>{o(!1),setTimeout(()=>{t(),s(!1)},500)},className:"ml-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-bold",children:"×"})]})})}),ea=a.lazy(()=>N(()=>import("./SettingsModal-BRlx4zQW.js"),__vite__mapDeps([3,1,2])).then(e=>({default:e.SettingsModal}))),ta=({onReroll:e,onAddRoll:t,isSimulating:r=!1,hasResults:s=!1,isAddRollDisabled:n=!1,sessions:o=[],selectedSessionIds:l=[],targetSessionType:c="selected",onTargetSessionTypeChange:d,onOpenSessionList:g,themeMode:u,onChangeThemeMode:h,onExportData:p,onImportData:m,sessionsCount:f,chartSettingsCount:x,onAboutClick:b})=>{const{t:y}=Fe(["common","sessions"]),[v,k]=a.useState(!1),[w,C]=a.useState(!1),S=a.useRef(null),j=a.useRef(null),N=l.length,D=o.filter(e=>l.includes(e.id)),L=d&&N>0,A=d&&N>1;return a.useEffect(()=>{const e=e=>{j.current&&!j.current.contains(e.target)&&S.current&&!S.current.contains(e.target)&&k(!1)};if(v)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[v]),i.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 pt-2 pb-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 lg:hidden z-50 transition-colors",children:[v&&L&&i.jsxs("div",{ref:j,className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 bg-white dark:bg-gray-700 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600 py-2 z-50",children:[A&&i.jsxs("div",{className:"flex flex-row gap-2 items-center mb-4 pb-4 px-4 border-b border-gray-200 dark:border-gray-600",children:[i.jsx("div",{className:"w-10 py-2 text-xs text-gray-500 dark:text-gray-400 font-medium",children:y("common:label.target")}),i.jsxs("select",{value:c,onChange:e=>{d?.(e.target.value)},className:"flex-1 px-4 py-3 bg-transparent text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors cursor-pointer focus:outline-none",children:[i.jsx("option",{value:"selected",children:y("sessions:target.all",{count:N})}),D.map(e=>i.jsx("option",{value:e.id,children:St(e.name)},e.id))]})]}),i.jsxs("div",{className:"flex flex-row mt-2 px-4 text-xs text-gray-500 dark:text-gray-400",children:[s&&i.jsxs("button",{onClick:t,disabled:r||n,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(r||n?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":y("common:button.addRoll"),title:n?y("sessions:tooltip.addRollDisabled"):"",children:[i.jsx("div",{className:"mb-1",children:i.jsx(Xe,{name:r?"spinner":"add-roll",className:r?"w-6 h-6 animate-spin":"w-6 h-6"})}),i.jsx("span",{className:"text-xs font-medium",children:y("common:label.addMore")})]}),i.jsxs("button",{onClick:e,disabled:r,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors "+(r?"text-gray-400 dark:text-gray-600 cursor-not-allowed":"text-gray-500 dark:text-gray-400 hover:text-accent-light-600 dark:hover:text-accent-dark-400"),"aria-label":y(s?"common:button.reroll":"common:label.start"),children:[i.jsx("div",{className:"mb-1",children:i.jsx(Xe,{name:r?"spinner":"reroll",className:r?"w-6 h-6 animate-spin":"w-6 h-6"})}),i.jsx("span",{className:"text-xs font-medium",children:y(s?"common:button.reroll":"common:label.start")})]})]})]}),i.jsxs("div",{className:"flex justify-around items-center h-16",children:[i.jsxs("button",{onClick:g,className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300","aria-label":y("common:label.list"),children:[i.jsxs("div",{className:"mb-1 relative",children:[i.jsx(Xe,{name:"sessions",className:"w-6 h-6"}),l.length>0&&i.jsx("span",{className:"absolute -top-3 -right-3 bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center",children:wr(l.length)})]}),i.jsx("span",{className:"text-xs font-medium",children:y("common:label.list")})]}),L&&i.jsxs("button",{ref:S,onClick:()=>k(!v),className:"flex flex-col items-center justify-center flex-1 h-full transition-colors relative "+(v?"text-accent-light-600 dark:text-accent-dark-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),"aria-label":y("common:label.roll"),disabled:r,children:[i.jsx("div",{className:"mb-1",children:i.jsx(Xe,{name:"dice",className:"w-6 h-6"})}),i.jsx("span",{className:"text-xs font-medium",children:y("common:label.roll")})]}),i.jsxs("button",{onClick:()=>C(!0),className:"flex flex-col items-center justify-center flex-1 h-full transition-colors text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300","aria-label":y("common:label.settings"),children:[i.jsx("div",{className:"mb-1",children:i.jsx(Xe,{name:"settings",className:"w-6 h-6"})}),i.jsx("span",{className:"text-xs font-medium",children:y("common:label.settings")})]})]}),w&&i.jsx(a.Suspense,{fallback:null,children:i.jsx(ea,{isOpen:w,onClose:()=>C(!1),darkMode:u,onChangeDarkMode:h,onExportData:p,onImportData:m,sessionsCount:f,chartSettingsCount:x,onAboutClick:b})})]})},ra=n.memo(()=>{const{t:e}=Fe("common");return i.jsx("footer",{className:"mt-auto py-10 px-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800",children:i.jsx("div",{className:"max-w-7xl mx-auto flex justify-center items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:i.jsxs("span",{children:["© 2025 ",e("siteName")]})})})}),aa=({chartSettings:e,currentSettingsId:t,onCreateSettings:r,onDuplicateSettings:s,onRenameSettings:o,onDeleteSettings:l,onClose:c,hasUnsavedChanges:d,onSaveToSettings:g,onDiscardChanges:u,onReorderSettings:h})=>{const{t:p}=Fe(["settings","common"]),[m,f]=a.useState("list"),[x,b]=a.useState(""),[y,v]=a.useState(""),[k,w]=a.useState(""),[C,S]=a.useState(!1),[j,N]=a.useState([]),[D,L]=a.useState(null),[A,M]=a.useState(!1),[E,R]=a.useState(!1),T=a.useRef({}),O=a.useRef(null);e.forEach(e=>{T.current[e.id]||(T.current[e.id]=n.createRef())}),n.useEffect(()=>{const e=e=>{O.current&&!O.current.contains(e.target)&&M(!1)};if(A)return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[A]);const I=async()=>{if(x.trim()){S(!0),w("");try{await s(y,x.trim()),f("list"),b(""),v("")}catch(e){w(e instanceof Error?e.message:p("settings:chartSettings.errors.duplicateFailed"))}finally{S(!1)}}else w(p("settings:chartSettings.errors.nameRequired"))},P=async()=>{if(x.trim()){S(!0),w("");try{await o(y,x.trim()),f("list"),b(""),v("")}catch(e){w(e instanceof Error?e.message:p("settings:chartSettings.errors.renameFailed"))}finally{S(!1)}}else w(p("settings:chartSettings.errors.nameRequired"))},$=e=>{j.includes(e)?N(j.filter(t=>t!==e)):N([...j,e])},F=t=>{const r=tt(t.id),a=[];return d&&g&&!r&&a.push({id:"save",label:p("settings:chartSettings.save"),customIcon:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),onClick:async()=>{S(!0);try{await g(t.id),w("")}catch(e){w(e instanceof Error?e.message:p("settings:chartSettings.errors.saveFailed"))}finally{S(!1)}},disabled:C}),a.push({id:"duplicate",label:p("settings:chartSettings.duplicate"),customIcon:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),onClick:()=>(t=>{const r=e.find(e=>e.id===t);r&&(v(t),b(`${r.name}${p("settings:chartSettings.copyNameSuffix")}`),f("duplicate"),w(""))})(t.id),disabled:C},{id:"rename",label:p("settings:chartSettings.rename"),customIcon:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),onClick:()=>(t=>{const r=e.find(e=>e.id===t);r&&(v(t),b(r.name),f("rename"),w(""))})(t.id),disabled:C||r},{id:"delete",label:p("settings:chartSettings.delete"),customIcon:i.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),onClick:()=>(async t=>{if(tt(t))return void w(p("settings:chartSettings.errors.cannotDeletePreset"));const r=e.find(e=>e.id===t);if(r&&confirm(p("settings:chartSettings.confirmDelete",{name:r.name}))){S(!0),w("");try{await l(t)}catch(a){w(a instanceof Error?a.message:p("settings:chartSettings.errors.deleteFailed"))}finally{S(!1)}}})(t.id),disabled:C||r,danger:!0,separator:!0}),a};return i.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:c,children:[i.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["rename"===m&&p("settings:chartSettings.renameTitle"),"duplicate"===m&&p("settings:chartSettings.duplicateTitle"),"list"===m&&p("settings:chartSettings.title")]}),"list"===m&&j.length>0&&i.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:p("settings:chartSettings.selected",{count:j.length})})]}),i.jsx("button",{onClick:c,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:i.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),"list"===m&&i.jsxs("div",{className:"flex justify-between gap-2",children:[i.jsx("button",{onClick:()=>R(!0),disabled:C,className:"h-10 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-2 px-4 rounded transition-colors",children:p("settings:chartSettings.new")}),i.jsxs("div",{className:"relative",ref:O,children:[i.jsx("button",{onClick:()=>M(!A),className:"w-10 h-10 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-lg transition-colors inline-flex items-center justify-center",title:p("settings:chartSettings.moreOptions"),children:i.jsx(Xe,{name:"dots-vertical",className:"w-5 h-5"})}),A&&i.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-700 rounded-lg shadow-lg z-50 overflow-hidden border border-gray-200 dark:border-gray-600",children:[i.jsx("button",{onClick:()=>{N([]),M(!1)},disabled:0===j.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",title:p("settings:chartSettings.bulkActions.deselectAll"),children:i.jsx("span",{className:"text-sm",children:p("settings:chartSettings.bulkActions.deselectAll")})}),i.jsxs("button",{onClick:async()=>{if(0!==j.length){S(!0),w("");try{for(const e of j)await s(e);N([])}catch(e){w(e instanceof Error?e.message:p("settings:chartSettings.errors.bulkDuplicateFailed"))}finally{S(!1)}M(!1)}else w(p("settings:chartSettings.errors.noDuplicateSelection"))},disabled:0===j.length,className:"w-full px-4 py-3 text-left hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-800 dark:text-white transition-colors flex items-center gap-3 border-t border-gray-200 dark:border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),i.jsx("span",{className:"text-sm",children:p("settings:chartSettings.bulkActions.duplicate")})]}),i.jsxs("button",{onClick:async()=>{const e=j.filter(e=>!tt(e));if(0!==e.length){if(confirm(p("settings:chartSettings.confirmBulkDelete",{count:e.length}))){S(!0),w("");try{for(const t of e)await l(t);N([])}catch(t){w(t instanceof Error?t.message:p("settings:chartSettings.errors.bulkDeleteFailed"))}finally{S(!1)}M(!1)}}else w(p("settings:chartSettings.errors.noSelection"))},disabled:0===j.length,className:"w-full px-4 py-3 text-left hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition-colors flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),i.jsx("span",{className:"text-sm",children:p("settings:chartSettings.bulkActions.delete")})]})]})]})]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[k&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:i.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:k})}),d&&"list"===m&&u&&i.jsx("div",{className:"mb-4 p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-300 dark:border-orange-700 rounded-lg",children:i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[i.jsx("svg",{className:"w-5 h-5 text-orange-600 dark:text-orange-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),i.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:p("settings:chartSettings.unsavedWarning")})]}),i.jsx("button",{onClick:()=>{u(),w("")},disabled:C,className:"px-3 py-1.5 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-white rounded text-sm transition-colors whitespace-nowrap disabled:opacity-50",title:p("settings:chartSettings.discard"),children:p("settings:chartSettings.discard")})]})}),"list"===m&&i.jsx(Et,{items:e,selectedIds:j,onToggleItem:$,emptyMessage:p("settings:chartSettings.emptyMessage"),enableDragAndDrop:!!h,onReorder:e=>{if(!h)return;const t=[...e.filter(e=>tt(e.id)),...e.filter(e=>!tt(e.id))];h(t)},renderItem:(e,r,a,s)=>{const n=tt(e.id),o=e.id===t;return i.jsx(Rt,{isSelected:j.includes(e.id),onToggle:()=>$(e.id),showCheckbox:!1,showDragHandle:!!h&&!n,dragHandleProps:s,actions:i.jsxs(i.Fragment,{children:[i.jsx(Ot,{buttonRef:T.current[e.id],onClick:t=>{t.stopPropagation(),L(D===e.id?null:e.id)}}),i.jsx(Tt,{isOpen:D===e.id,buttonRef:T.current[e.id],items:F(e),onClose:()=>L(null)})]}),children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:[e.name,n&&i.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["(",p("settings:chartSettings.preset"),")"]})]}),o&&i.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-accent-light-500 dark:bg-accent-dark-500 text-white rounded flex-shrink-0",children:p("settings:chartSettings.inUse")})]})})}}),("rename"===m||"duplicate"===m)&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:p("settings:chartSettings.nameLabel")}),i.jsx("input",{type:"text",value:x,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"===e.key&&("rename"===m?P():"duplicate"===m&&I())},placeholder:p("settings:chartSettings.namePlaceholder"),maxLength:128,autoFocus:!0,disabled:C,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-accent-light-500 dark:focus:ring-accent-dark-500 focus:border-transparent disabled:opacity-50"}),i.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:p("settings:chartSettings.maxLength")})]})]}),"list"!==m&&i.jsx("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:()=>{f("list"),b(""),v(""),w("")},disabled:C,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:p("settings:chartSettings.cancel")}),i.jsxs("button",{onClick:()=>{"rename"===m?P():"duplicate"===m&&I()},disabled:C||!x.trim(),className:"px-4 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-medium rounded-lg transition-colors disabled:opacity-50",title:p(C?"common:label.processing":"rename"===m?"settings:chartSettings.change":"settings:chartSettings.duplicate"),children:["rename"===m&&p("settings:chartSettings.change"),"duplicate"===m&&p("settings:chartSettings.duplicate")]})]})})]}),E&&i.jsx(Yr,{onCreateSettings:r,onClose:()=>R(!1)})]})},sa=n.memo(({sessions:e,selectedSessionIds:t,onToggleSession:r,onClose:a,onApply:s,onDuplicateSession:o,onDeleteSession:l,onBulkDeleteSessions:c,onBulkDuplicateSessions:d,onUpdateSession:g,onReorderSessions:u,onExportSessions:h,onImportSessions:p,onCreateSession:m,onDeleteAllSessions:f})=>{const{t:x}=Fe(["sessions","common"]),[b,y]=n.useState(t),[v,k]=n.useState(null),[w,C]=n.useState(null),[S,j]=n.useState(!1),[N,D]=n.useState(null),[L,A]=n.useState(()=>{const e=localStorage.getItem("isMultiSelectMode"),r=(()=>{try{if(!e)return!1;const t=JSON.parse(e);return"boolean"==typeof t&&t}catch{return!1}})();return t.length>1||r}),M=n.useRef({});n.useEffect(()=>{localStorage.setItem("isMultiSelectMode",JSON.stringify(L))},[L]),n.useEffect(()=>{b.length>1&&!L&&A(!0)},[b.length]),n.useEffect(()=>{y(t=>{const r=e.map(e=>e.id);return t.filter(e=>r.includes(e))})},[e]),e.forEach(e=>{M.current[e.id]||(M.current[e.id]=n.createRef())});const E=e=>{y(t=>L?t.includes(e)?t.filter(t=>t!==e):[...t,e]:t.includes(e)?t.filter(t=>t!==e):[e])},R=n.useCallback(()=>{A(e=>{const t=!e;return!t&&b.length>0&&setTimeout(()=>{y([])},0),t})},[b.length]);return i.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[9999] p-4",onClick:a,children:[i.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] flex flex-col",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"px-4 pt-4 border-b border-gray-200 dark:border-gray-700",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:x("sessions:title")}),b.length>0&&i.jsx("span",{className:"bg-accent-light-500 dark:bg-accent-dark-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:x("sessions:list.selected",{count:b.length})})]}),i.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400 transition-colors","aria-label":x("common:button.close"),children:i.jsx(Xe,{name:"close",className:"w-5 h-5"})})]}),i.jsx(Pt,{sessions:e,compareSessionIds:b,isMultiSelectMode:L,onToggleMultiSelectMode:R,onCreateSession:()=>{if(!m)return;const e={id:"",name:x("common:unnamed"),diceConfig:{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:1,results:[],targetValue:1,createdAt:String(Date.now()),updatedAt:String(Date.now())};D(e),j(!0)},onToggleCompareSession:E,onExportSessions:h,onImportSessions:p,onBulkDuplicateSessions:d,onBulkDeleteSessions:c,onDeleteAllSessions:f||(()=>{})})]}),i.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:i.jsx(Et,{items:e,selectedIds:b,onToggleItem:E,emptyMessage:x("sessions:empty"),showSelectionCount:!1,enableDragAndDrop:!!u,onReorder:u,renderItem:(t,r,a,s)=>i.jsx(It,{session:t,isSelected:r,onToggle:()=>E(t.id),showCheckbox:!1,showDragHandle:!!u,dragHandleProps:s,sessionsLength:e.length,onSetEditingSessionId:C,onDuplicateSession:o,onDeleteSession:l,openMenuId:v,onOpenMenu:k,menuButtonRef:M.current[t.id]})})}),i.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:i.jsx("button",{onClick:()=>{s?s(b):(t.forEach(e=>{b.includes(e)||r(e)}),b.forEach(e=>{t.includes(e)||r(e)})),a()},className:"w-full px-6 py-2 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded transition-colors",children:x("common:button.apply")})})]}),w&&i.jsx(Mt,{session:e.find(e=>e.id===w),onClose:()=>C(null),onSave:g}),S&&N&&i.jsx(Mt,{session:N,onClose:()=>{j(!1),D(null)},onSave:(e,t)=>{j(!1),D(null),m&&m(t)},isCreateMode:!0})]})});function na(e){const t=[];return(isNaN(e.diceCount)||e.diceCount<1||e.diceCount>He)&&t.push({field:"diceCount",message:"ダイスの数は1〜10の範囲で指定してください"}),(isNaN(e.diceFaces)||e.diceFaces<1||e.diceFaces>qe)&&t.push({field:"diceFaces",message:"面の数は1〜9999の範囲で指定してください"}),e.modifierSign&&(isNaN(e.modifierValue)||e.modifierValue<0||e.modifierValue>_e)&&t.push({field:"modifierValue",message:"修正値は0〜99999の範囲で指定してください"}),t}function ia(e){const t=[];return(isNaN(e)||e<1||e>Je)&&t.push({field:"trialCount",message:"試行回数は1〜1000の範囲で指定してください"}),t}function oa(e,t){return[...na(e),...ia(t)]}sa.displayName="CompareSessionsModal";const la=a.lazy(()=>N(()=>import("./AboutPage-eriucDfn.js"),__vite__mapDeps([4,1,2])).then(e=>({default:e.AboutPage})));function ca(){const{t:e,i18n:t}=Fe();a.useEffect(()=>{document.title=e("common:siteName")},[e,t.language]);const[r,s]=a.useState([]),[n,o]=a.useState(()=>{try{const e=localStorage.getItem("compareSessionIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}}),[l,c]=a.useState(null),[d,g]=a.useState(!1),[u,h]=a.useState(0),[p,m]=a.useState(()=>{const e=localStorage.getItem("mobileView");return"sessions"===e||"results"===e?e:"results"}),[f,x]=a.useState(!0),[b,y]=a.useState(!1),[v,k]=a.useState(!1),[w,C]=a.useState("selected"),{chartSettings:S,currentSettingsId:j,setCurrentSettingsId:N,createSettings:D,duplicateSettings:L,updateSettings:A,deleteSettings:M,renameSettings:E,reorderSettings:R}=Rr(),[T,O]=a.useState({}),[I,P]=a.useState({}),[$,F]=a.useState(void 0),[V,B]=a.useState({}),[W,U]=a.useState(()=>"undefined"!=typeof window&&window.innerWidth<1024),[z,H]=a.useState(()=>{const e=localStorage.getItem("themeMode");if("light"===e||"dark"===e||"system"===e)return e;const t=localStorage.getItem("darkMode");if(t)try{const e=JSON.parse(t);if("boolean"==typeof e)return localStorage.removeItem("darkMode"),e?"dark":"light"}catch{}return"system"}),[q,_]=a.useState(()=>!("undefined"==typeof window||!window.matchMedia)&&window.matchMedia("(prefers-color-scheme: dark)").matches),J="system"===z?q:"dark"===z,[K,G]=a.useState(()=>"#about"===window.location.hash);a.useEffect(()=>{if("undefined"!=typeof window&&window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{_(e.matches)};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[]),a.useEffect(()=>{J?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[J]),a.useEffect(()=>{localStorage.setItem("themeMode",z)},[z]),a.useEffect(()=>{const e=()=>{U(window.innerWidth<1024)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{const e=()=>{G("#about"===window.location.hash)};return window.addEventListener("hashchange",e),()=>window.removeEventListener("hashchange",e)},[]),a.useEffect(()=>{K?"#about"!==window.location.hash&&(window.location.hash="#about"):"#about"===window.location.hash&&history.pushState("",document.title,window.location.pathname+window.location.search)},[K]);const Y=a.useCallback(()=>{H(e=>"system"===e?q?"light":"dark":"light"===e?"dark":"light")},[q]),Q=a.useCallback(e=>{H(e)},[]);a.useEffect(()=>{O({})},[j]),a.useEffect(()=>{localStorage.setItem("compareSessionIds",JSON.stringify(n))},[n]),a.useEffect(()=>{localStorage.setItem("mobileView",p)},[p]);const Z=a.useMemo(()=>0===n.length?null:r.find(e=>e.id===n[0])||null,[r,n]);a.useEffect(()=>{let t=!0;return(async()=>{try{await async function(){return ot.migrateFromLocalStorage()}()&&c({type:"success",text:e("messages:success.migrated")});const r=(await async function(){return ot.loadSessions()}()).map(e=>({...e,targetValue:e.targetValue??1}));if(t){s(r);const e=(()=>{try{const e=localStorage.getItem("compareSessionIds");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t.filter(e=>"string"==typeof e):[]}catch{return[]}})(),t=e.filter(e=>r.some(t=>t.id===e));t.length>0&&JSON.stringify(t)!==JSON.stringify(e)?o(t):0===t.length&&r.length>0&&0===e.length&&o([r[0].id])}}catch(r){t&&c({type:"error",text:e("messages:error.loadFailed")})}finally{t&&x(!1)}})(),()=>{t=!1}},[e]);const X=a.useCallback(async t=>{if(r.length>=Ve)return void c({type:"error",text:e("messages:error.sessionLimitReached",{max:Ve})});const a={id:kt(),name:t?.name||e("common:unnamed"),diceConfig:t?.diceConfig||{diceCount:1,diceFaces:6,modifierSign:"",modifierValue:0},trialCount:t?.trialCount||1,results:[],targetValue:1,createdAt:wt(),updatedAt:wt()};try{await lt(a),s(e=>[...e,a]),o([a.id]),c({type:"success",text:e("messages:success.sessionCreated")})}catch{c({type:"error",text:e("messages:error.sessionCreateFailed")})}},[r.length,e]),ee=a.useCallback(async t=>{try{await ct(t),s(e=>e.filter(e=>e.id!==t)),o(e=>{const a=e.filter(e=>e!==t);if(0===a.length&&r.length>1){const e=r.find(e=>e.id!==t);return e?[e.id]:[]}return a}),c({type:"success",text:e("messages:success.sessionDeleted")})}catch{c({type:"error",text:e("messages:error.sessionDeleteFailed")})}},[r,e]),te=a.useCallback(async()=>{try{const t=r.map(e=>e.id);await Promise.all(t.map(e=>ct(e))),s([]),o([]),c({type:"success",text:e("messages:success.bulkDeleted",{count:t.length})})}catch{c({type:"error",text:e("messages:error.bulkDeleteFailed")})}},[r,e]),re=a.useCallback(async t=>{s(t);try{await async function(e){return ot.saveSessions(e)}(t)}catch{c({type:"error",text:e("messages:error.sessionUpdateFailed")})}},[e]),ae=a.useCallback(async t=>{if(r.length>=Ve)return void c({type:"error",text:e("messages:error.sessionLimitReached",{max:Ve})});const a=r.find(e=>e.id===t);if(!a)return;const n={...a,id:kt(),name:`${a.name}${e("sessions:copy.suffix")}`,results:[],targetValue:a.targetValue??1,createdAt:wt(),updatedAt:wt()};try{await lt(n),s(e=>[...e,n]),c({type:"success",text:e("messages:success.sessionDuplicated")})}catch{c({type:"error",text:e("messages:error.sessionDuplicateFailed")})}},[r,e]),se=a.useCallback(async t=>{if(0===t.length)return;const a=e("sessions:confirm.bulkDeleteWarning",{count:t.length});if(window.confirm(a))try{await Promise.all(t.map(e=>ct(e))),s(e=>e.filter(e=>!t.includes(e.id))),o(e=>{const a=e.filter(e=>!t.includes(e));if(0===a.length&&r.length>t.length){const e=r.find(e=>!t.includes(e.id));return e?[e.id]:[]}return a}),c({type:"success",text:e("messages:success.bulkDeleted",{count:t.length})})}catch{c({type:"error",text:e("messages:error.bulkDeleteFailed")})}},[r,e]),ne=a.useCallback(async t=>{if(0===t.length)return;const a=Ve-r.length;if(t.length>a)c({type:"error",text:e("messages:error.bulkDuplicateLimitReached",{count:a})});else try{const a=[];for(const s of t){const t=r.find(e=>e.id===s);if(!t)continue;const n={...t,id:kt(),name:`${t.name}${e("sessions:copy.suffix")}`,results:[],targetValue:t.targetValue??1,createdAt:wt(),updatedAt:wt()};await lt(n),a.push(n)}s(e=>[...e,...a]),c({type:"success",text:e("messages:success.bulkDuplicated",{count:a.length})})}catch{c({type:"error",text:e("messages:error.bulkDuplicateFailed")})}},[r,e]),ie=a.useCallback(async t=>{try{await lt(t),s(e=>e.map(e=>e.id===t.id?t:e))}catch{c({type:"error",text:e("messages:error.sessionUpdateFailed")})}},[e]),oe=a.useCallback((t,a)=>{const n=r.find(e=>e.id===t);if(!n)return;const i={...n,...void 0!==a.name&&{name:a.name},...void 0!==a.diceConfig&&{diceConfig:a.diceConfig},...void 0!==a.trialCount&&{trialCount:a.trialCount},updatedAt:wt()};s(e=>e.map(e=>e.id===i.id?i:e)),lt(i).then(()=>{c({type:"success",text:e("messages:success.sessionUpdated")})}).catch(t=>{c({type:"error",text:e("messages:error.sessionUpdateFailed")})})},[r,e]),le=a.useCallback(async()=>{const t="selected"===w?r.filter(e=>n.includes(e.id)):r.filter(e=>e.id===w);if(0===t.length)return!1;const a=[];for(const r of t){const t=oa(r.diceConfig,r.trialCount);t.length>0&&a.push({sessionName:r.name,errors:t.map(e=>e.message)}),r.trialCount>Ke&&a.push({sessionName:r.name,errors:[e("messages:error.trialCountExceeded",{max:Ke.toLocaleString()})]})}if(a.length>0){const e=a.map(({sessionName:e,errors:t})=>`${e}: ${t.join(", ")}`).join("\n");return c({type:"error",text:e}),!1}g(!0),h(0);try{const r=t.reduce((e,t)=>e+t.trialCount,0);let a=0;const n=[],o=[];for(const s of t)try{const e=await yt(s.diceConfig,s.trialCount,e=>{const t=s.trialCount*e/100;h((a+t)/r*100)}),t={...s,results:e,resultsConfig:{...s.diceConfig},hasMultipleDiceConfigs:!1,targetValue:s.targetValue,updatedAt:wt()};await lt(t),n.push(t),a+=s.trialCount}catch(i){const t=i instanceof Error?i.message:e("messages:error.generic");o.push(`${s.name}: ${t}`),a+=s.trialCount}return s(e=>e.map(e=>n.find(t=>t.id===e.id)||e)),o.length>0&&c({type:"warning",text:e("messages:error.partialSuccess",{completed:n.length,failed:o.length,errors:o.join("\n")})}),!0}catch(i){const t=i instanceof Error?i.message:e("messages:error.rollFailed");return c({type:"error",text:t}),!1}finally{g(!1),h(0)}},[r,n,w,e]),ce=a.useCallback(async()=>{const t="selected"===w?r.filter(e=>n.includes(e.id)&&e.results.length>0):r.filter(e=>e.id===w&&e.results.length>0);if(0===t.length)return!1;const a=[];for(const r of t){const t=oa(r.diceConfig,r.trialCount);t.length>0&&a.push({sessionName:r.name,errors:t.map(e=>e.message)});r.results.length+r.trialCount>Ke&&a.push({sessionName:r.name,errors:[e("messages:error.maxRecordsExceeded",{max:Ke.toLocaleString()})]})}if(a.length>0){const e=a.map(({sessionName:e,errors:t})=>`${e}: ${t.join(", ")}`).join("\n");return c({type:"error",text:e}),!1}g(!0),h(0);try{const r=t.reduce((e,t)=>e+t.trialCount,0);let a=0;const n=[],o=[];for(const s of t)try{const e=await yt(s.diceConfig,s.trialCount,e=>{const t=s.trialCount*e/100;h((a+t)/r*100)}),t=s.results.length>0?s.results[s.results.length-1].trialNumber+1:1,i=e.map((e,r)=>({...e,trialNumber:t+r})),o=[...s.results,...i],l=s.resultsConfig&&!Ct(s.resultsConfig,s.diceConfig),c={...s,results:o,resultsConfig:s.resultsConfig||{...s.diceConfig},hasMultipleDiceConfigs:s.hasMultipleDiceConfigs||l,updatedAt:wt()};await lt(c),n.push(c),a+=s.trialCount}catch(i){const t=i instanceof Error?i.message:e("messages:error.generic");o.push(`${s.name}: ${t}`),a+=s.trialCount}return s(e=>e.map(e=>n.find(t=>t.id===e.id)||e)),o.length>0&&c({type:"warning",text:e("messages:error.partialSuccess",{completed:n.length,failed:o.length,errors:o.join("\n")})}),!0}catch(i){const t=i instanceof Error?i.message:e("messages:error.rollFailed");return c({type:"error",text:t}),!1}finally{g(!1),h(0)}},[r,n,w,e]),de=a.useCallback(()=>{if(!Z)return;const t={...Z,results:[],updatedAt:wt()};ie(t),c({type:"info",text:e("messages:info.resetResults")})},[Z,ie,e]),ge=a.useCallback(e=>{O(t=>({...t,resultChart:e}))},[]),ue=a.useCallback(e=>{O(t=>({...t,individualDiceChart:e}))},[]),he=a.useCallback(e=>{O(t=>({...t,rollProgressChart:e}))},[]),pe=a.useCallback(e=>{P(t=>({...t,resultChartType:e}))},[]),me=a.useCallback(e=>{P(t=>({...t,individualDiceChartType:e}))},[]),fe=a.useCallback(e=>{P(t=>({...t,targetValueChartType:e}))},[]),xe=a.useCallback(e=>{F(e)},[]),be=a.useCallback(e=>{B({distributionType:e.distributionType,showOnlyActualData:e.showOnlyActualData,quantileCount:e.quantileCount})},[]),ye=a.useCallback(async t=>{if(t===Be)throw new Error(e("messages:error.cannotModifyDefault"));const r={};T.resultChart&&(r.resultChart=T.resultChart),T.individualDiceChart&&(r.individualDiceChart=T.individualDiceChart),T.rollProgressChart&&(r.rollProgressChart=T.rollProgressChart),I.resultChartType&&(r.resultChartType=I.resultChartType),I.individualDiceChartType&&(r.individualDiceChartType=I.individualDiceChartType),I.targetValueChartType&&(r.targetValueChartType=I.targetValueChartType),void 0!==$&&(r.rollProgressMovingAverageWindow=$),void 0!==V.distributionType&&(r.cumulativeDistributionType=V.distributionType),void 0!==V.showOnlyActualData&&(r.cumulativeShowOnlyActualData=V.showOnlyActualData),void 0!==V.quantileCount&&(r.cumulativeQuantileCount=V.quantileCount),Object.keys(r).length>0&&(await A(t,r),O({}),P({}),F(void 0),B({}),c({type:"success",text:e("messages:success.settingsSaved")}))},[T,I,$,V,A,e]),ve=a.useCallback(()=>{O({}),P({}),F(void 0),B({})},[]),ke=a.useMemo(()=>Object.keys(T).length>0||Object.keys(I).length>0||void 0!==$||Object.keys(V).length>0,[T,I,$,V]),we=a.useCallback(e=>{if(!Z)return;const t={...Z,sortConfig:e,updatedAt:wt()};ie(t)},[Z,ie]),Ce=a.useCallback(e=>{if(!Z)return;const t={...Z,targetValue:e,updatedAt:wt()};ie(t)},[Z,ie]),Se=a.useCallback(e=>{o(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),je=a.useCallback(()=>{try{!function(e,t){const r=t.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-"));if(0===e.length&&0===r.length)throw new Error("エクスポートするデータがありません");const a={version:"1.0",exportedAt:(new Date).toISOString(),sessions:e,chartSettings:r},s=JSON.stringify(a,null,2),n=new Blob([s],{type:"application/json;charset=utf-8;"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i;const l=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5);o.download=`dice-sim-backup_${l}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}(r,S),c({type:"success",text:e("messages:success.dataExported")})}catch(t){t instanceof Error?c({type:"error",text:t.message}):c({type:"error",text:e("messages:error.exportFailed")})}},[r,S,e]),Ne=a.useCallback(async t=>{try{const{sessions:n,chartSettings:i}=await function(e){return new Promise((t,r)=>{const a=new FileReader;a.onload=e=>{try{const a=e.target?.result,s=JSON.parse(a);if(s.version&&s.sessions&&s.chartSettings){if(!Array.isArray(s.sessions))return void r(new Error("バックアップファイルの形式が正しくありません（sessionsが配列である必要があります）"));if(!Array.isArray(s.chartSettings))return void r(new Error("バックアップファイルの形式が正しくありません（chartSettingsが配列である必要があります）"));const e=s.sessions.map((e,t)=>{if(!e.id||"string"!=typeof e.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(!e.name||"string"!=typeof e.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(e.name.length>Ge)throw new Error(`ダイスセット${t+1}: 名前が長すぎます（最大128文字）`);if(Dt(e.diceConfig,t),"number"!=typeof e.trialCount||e.trialCount<1||e.trialCount>Je)throw new Error(`ダイスセット${t+1}: 試行回数が不正です`);if(!Array.isArray(e.results))throw new Error(`ダイスセット${t+1}: 結果が不正です`);if(!Nt(e.createdAt))throw new Error(`ダイスセット${t+1}: 作成日時が不正です`);if(!Nt(e.updatedAt))throw new Error(`ダイスセット${t+1}: 更新日時が不正です`);return{id:e.id,name:e.name,diceConfig:e.diceConfig,trialCount:e.trialCount,results:e.results,resultsConfig:e.resultsConfig||void 0,hasMultipleDiceConfigs:e.hasMultipleDiceConfigs||!1,aggregationSettings:e.aggregationSettings,targetValue:"number"==typeof e.targetValue?e.targetValue:1,resultsTargetValue:e.resultsTargetValue,createdAt:e.createdAt,updatedAt:e.updatedAt,sortOrder:e.sortOrder}}),a=s.chartSettings.map((e,t)=>{if(!e.id||"string"!=typeof e.id)throw new Error(`チャート設定${t+1}: IDが不正です`);if(!e.name||"string"!=typeof e.name)throw new Error(`チャート設定${t+1}: 名前が不正です`);if(e.name.length>Ge)throw new Error(`チャート設定${t+1}: 名前が長すぎます`);if(!Nt(e.createdAt))throw new Error(`チャート設定${t+1}: 作成日時が不正です`);if(!Nt(e.updatedAt))throw new Error(`チャート設定${t+1}: 更新日時が不正です`);return{id:e.id,name:e.name,resultChart:e.resultChart,individualDiceChart:e.individualDiceChart,rollProgressChart:e.rollProgressChart,resultChartType:e.resultChartType,individualDiceChartType:e.individualDiceChartType,targetValueChartType:e.targetValueChartType,rollProgressMovingAverageWindow:e.rollProgressMovingAverageWindow,cumulativeDistributionType:e.cumulativeDistributionType,cumulativeShowOnlyActualData:e.cumulativeShowOnlyActualData,cumulativeQuantileCount:e.cumulativeQuantileCount,createdAt:e.createdAt,updatedAt:e.updatedAt,sortOrder:e.sortOrder}});t({sessions:e,chartSettings:a})}else if(Array.isArray(s)){const e=s.map((e,t)=>{if(!e.id||"string"!=typeof e.id)throw new Error(`ダイスセット${t+1}: IDが不正です`);if(!e.name||"string"!=typeof e.name)throw new Error(`ダイスセット${t+1}: 名前が不正です`);if(e.name.length>Ge)throw new Error(`ダイスセット${t+1}: 名前が長すぎます`);if(Dt(e.diceConfig,t),"number"!=typeof e.trialCount||e.trialCount<1||e.trialCount>Je)throw new Error(`ダイスセット${t+1}: 試行回数が不正です`);if(!Array.isArray(e.results))throw new Error(`ダイスセット${t+1}: 結果が不正です`);if(!Nt(e.createdAt))throw new Error(`ダイスセット${t+1}: 作成日時が不正です`);if(!Nt(e.updatedAt))throw new Error(`ダイスセット${t+1}: 更新日時が不正です`);return{id:e.id,name:e.name,diceConfig:e.diceConfig,trialCount:e.trialCount,results:e.results,resultsConfig:e.resultsConfig||void 0,hasMultipleDiceConfigs:e.hasMultipleDiceConfigs||!1,aggregationSettings:e.aggregationSettings,targetValue:"number"==typeof e.targetValue?e.targetValue:1,resultsTargetValue:e.resultsTargetValue,createdAt:e.createdAt,updatedAt:e.updatedAt,sortOrder:e.sortOrder}});t({sessions:e,chartSettings:[]})}else r(new Error("ファイル形式が正しくありません"))}catch(a){a instanceof Error?r(a):r(new Error("ファイルのパースに失敗しました"))}},a.onerror=()=>{r(new Error("ファイルの読み込みに失敗しました"))},a.readAsText(e)})}(t);let o=0;if(n.length>0){const e=new Set(r.map(e=>e.id)),t=n.map(t=>e.has(t.id)?{...t,id:kt(),name:`${t.name}（インポート）`,createdAt:wt(),updatedAt:wt()}:t);for(const r of t)await lt(r);s(e=>[...e,...t]),o+=t.length}if(i.length>0){const e=new Set(S.map(e=>e.id));let t=0;for(const r of i)if(!e.has(r.id))try{await D(r.name,r),t++}catch(a){}t>0&&(o+=t)}if(0===o)return void c({type:"warning",text:e("messages:warning.noImportableData")});const l=[];n.length>0&&l.push(e("messages:import.sessionsCount",{count:n.length})),i.length>0&&l.push(e("messages:import.chartSettingsCount",{count:i.length})),c({type:"success",text:e("messages:import.successWithDetails",{details:l.join(e("common:punctuation.comma"))})})}catch(n){n instanceof Error?c({type:"error",text:n.message}):c({type:"error",text:e("messages:error.importFailed")})}},[r,S,D,e]);return i.jsxs("div",{className:"min-h-screen flex flex-col bg-white dark:bg-gray-800 lg:bg-gray-50 lg:dark:bg-gray-900 pb-16 lg:pb-0",children:[i.jsx(bt,{darkMode:J,onToggleDarkMode:Y,sessionName:Z?.name,isMobileView:W&&"sessions"!==p,showSessionName:W&&"results"===p,onBackToSessions:()=>m("sessions"),onAboutClick:()=>G(!0),themeMode:z,onChangeThemeMode:Q,onExportData:je,onImportData:Ne,sessionsCount:r.length,chartSettingsCount:S.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-")).length}),f?i.jsx("div",{className:"w-100 lg:container lg:mx-auto mt-4 lg:mt-0 lg:px-4 pb-20 pt-12 lg:pb-6 lg:pt-20 flex-grow",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:e("common:label.loading")})})}):i.jsxs("div",{className:"w-100 lg:container lg:mx-auto mt-4 lg:mt-0 lg:px-4 pb-20 pt-12 lg:pb-6 lg:pt-20 flex-grow",children:[i.jsx(Xr,{message:l,onClose:()=>c(null)}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 xl:grid-cols-11 2xl:grid-cols-12 gap-6",children:[i.jsx("div",{className:"hidden lg:block lg:col-span-4 xl:col-span-3 2xl:col-span-3",children:i.jsx(Sr,{sessions:r,compareSessionIds:n,onToggleCompareSession:Se,onCreateSession:X,onDuplicateSession:ae,onDeleteSession:ee,onDeleteAllSessions:te,onBulkDeleteSessions:se,onBulkDuplicateSessions:ne,onReorderSessions:re,onExportSessions:je,onImportSessions:Ne,onUpdateSession:oe})}),i.jsx("div",{className:"lg:col-span-8 xl:col-span-8 2xl:col-span-9",children:Z?i.jsx(i.Fragment,{children:i.jsx("div",{className:"results"!==p?"hidden lg:block":"",children:i.jsx(Zr,{session:Z,sessions:r,compareSessionIds:n,onResetResults:de,onReroll:le,onAddRoll:ce,isSimulating:d,simulationProgress:u,onResultChartAggregationChange:ge,onIndividualDiceChartAggregationChange:ue,onRollProgressChartAggregationChange:he,onResultChartTypeChange:pe,onIndividualDiceChartTypeChange:me,onTargetValueChartTypeChange:fe,onRollProgressMovingAverageWindowChange:xe,onCumulativeSettingsChange:be,onSortConfigChange:we,onTargetValueChange:Ce,onViewChange:m,selectedSessionIds:n,targetSessionType:w,onTargetSessionTypeChange:C,chartSettings:S,currentChartSettingsId:j,onSelectChartSettings:e=>{N(e),O({}),P({}),F(void 0),B({})},onManageChartSettings:()=>{y(!0)},onCreateChartSettings:()=>{y(!0)},onCreateNewSettings:async t=>{const r=S.find(e=>e.id===j),a={};r&&(a.resultChart=r.resultChart,a.individualDiceChart=r.individualDiceChart,a.rollProgressChart=r.rollProgressChart,a.resultChartType=r.resultChartType,a.individualDiceChartType=r.individualDiceChartType,a.targetValueChartType=r.targetValueChartType,a.rollProgressMovingAverageWindow=r.rollProgressMovingAverageWindow,a.cumulativeDistributionType=r.cumulativeDistributionType,a.cumulativeShowOnlyActualData=r.cumulativeShowOnlyActualData,a.cumulativeQuantileCount=r.cumulativeQuantileCount),T.resultChart&&(a.resultChart=T.resultChart),T.individualDiceChart&&(a.individualDiceChart=T.individualDiceChart),T.rollProgressChart&&(a.rollProgressChart=T.rollProgressChart),I.resultChartType&&(a.resultChartType=I.resultChartType),I.individualDiceChartType&&(a.individualDiceChartType=I.individualDiceChartType),I.targetValueChartType&&(a.targetValueChartType=I.targetValueChartType),void 0!==$&&(a.rollProgressMovingAverageWindow=$),void 0!==V.distributionType&&(a.cumulativeDistributionType=V.distributionType),void 0!==V.showOnlyActualData&&(a.cumulativeShowOnlyActualData=V.showOnlyActualData),void 0!==V.quantileCount&&(a.cumulativeQuantileCount=V.quantileCount);await D(t,Object.keys(a).length>0?a:void 0)&&(O({}),P({}),F(void 0),B({})),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})})},onSaveChartSettings:ye,hasPendingChanges:ke,onShowCompareModal:()=>k(!0)})})}):i.jsxs("div",{className:"bg-white dark:bg-gray-800 lg:rounded-lg lg:shadow-md p-12 text-center transition-colors",children:[i.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-lg mb-6",children:e("sessions:selectOrCreatePrompt")}),W&&i.jsxs("button",{onClick:()=>k(!0),className:"px-6 py-3 bg-accent-light-500 dark:bg-accent-dark-500 hover:bg-accent-light-600 dark:hover:bg-accent-dark-600 text-white font-bold rounded-lg transition-colors inline-flex items-center gap-2",children:[i.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),i.jsx("span",{children:e("sessions:action.selectSession")})]})]})})]})]}),i.jsx(ta,{onReroll:async()=>{await le()&&m("results")},onAddRoll:async()=>{await ce()&&m("results")},isSimulating:d,hasResults:!!Z?.results.length&&Z.results.length>0,isAddRollDisabled:!1,sessions:r,selectedSessionIds:n,targetSessionType:w,onTargetSessionTypeChange:C,onOpenSessionList:()=>k(!0),themeMode:z,onChangeThemeMode:Q,onExportData:je,onImportData:Ne,sessionsCount:r.length,chartSettingsCount:S.filter(e=>"default"!==e.id&&!e.id.startsWith("preset-")).length,onAboutClick:()=>G(!0)}),!W&&i.jsx(ra,{}),K&&i.jsx(a.Suspense,{fallback:i.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:i.jsx("div",{className:"text-white",children:"読み込み中..."})}),children:i.jsx(la,{onClose:()=>G(!1)})}),b&&i.jsx(aa,{chartSettings:S,currentSettingsId:j,onCreateSettings:async t=>{const r={};T.resultChart&&(r.resultChart=T.resultChart),T.individualDiceChart&&(r.individualDiceChart=T.individualDiceChart),I.resultChartType&&(r.resultChartType=I.resultChartType),I.individualDiceChartType&&(r.individualDiceChartType=I.individualDiceChartType),I.targetValueChartType&&(r.targetValueChartType=I.targetValueChartType);await D(t,Object.keys(r).length>0?r:void 0)&&(O({}),P({})),c({type:"success",text:e("messages:success.settingsCreatedWithName",{name:t})})},onDuplicateSettings:async(t,r)=>{const a=await L(t,r);a&&c({type:"success",text:e("messages:success.settingsDuplicatedWithName",{name:a.name})})},onRenameSettings:async(t,r)=>{await E(t,r),c({type:"success",text:e("messages:success.settingsRenamed")})},onDeleteSettings:async t=>{await M(t),c({type:"success",text:e("messages:success.settingsDeleted")})},onClose:()=>{y(!1)},hasUnsavedChanges:Object.keys(T).length>0||Object.keys(I).length>0,onSaveToSettings:ye,onDiscardChanges:ve,onReorderSettings:R}),v&&i.jsx(sa,{sessions:r,selectedSessionIds:n,onToggleSession:Se,onApply:e=>{n.forEach(t=>{e.includes(t)||Se(t)}),e.forEach(e=>{n.includes(e)||Se(e)})},onClose:()=>k(!1),onDuplicateSession:ae,onDeleteSession:ee,onBulkDeleteSessions:se,onBulkDuplicateSessions:ne,onUpdateSession:oe,onReorderSessions:re,onExportSessions:je,onImportSessions:Ne,onCreateSession:X})]})}d.register(g,u,h,p,m,f,x,b,y,v),S.createRoot(document.getElementById("root")).render(i.jsx(n.StrictMode,{children:i.jsx(ca,{})}));export{Xe as I,Ur as a,ut as c,wr as f,pt as s,Fe as u};
